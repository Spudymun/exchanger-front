// ‚úÖ Prisma Schema for Session Management
// This schema defines the database structure for production session management

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email          String    @unique @db.VarChar(255)
  hashedPassword String?   @map("hashed_password") @db.Text
  isVerified     Boolean   @default(false) @map("is_verified")
  createdAt      DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  lastLoginAt    DateTime? @map("last_login_at") @db.Timestamptz(6)

  // Relations - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏ –Ω–æ–≤—ã–µ
  sessions              Session[]
  appRoles              UserAppRole[]
  
  // ‚úÖ –ù–û–í–´–ï Relations –¥–ª—è Order —Å–∏—Å—Ç–µ–º—ã
  orders                Order[]                           // –ó–∞—è–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  operatorAssignments   Order[] @relation("OperatorAssignments")  // –ó–∞—è–≤–∫–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ —ç—Ç–æ–º—É –æ–ø–µ—Ä–∞—Ç–æ—Ä—É
  auditLogsPerformed    OrderAuditLog[] @relation("AuditLogPerformer") // –î–µ–π—Å—Ç–≤–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º

  // Indexes
  @@index([email])
  @@index([createdAt])
  @@map("users")
}

model Session {
  id           String    @id @db.VarChar(255)
  userId       String    @map("user_id") @db.Uuid
  data         Json?     @db.JsonB
  expiresAt    DateTime  @map("expires_at") @db.Timestamptz(6)
  createdAt    DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  lastActivity DateTime  @default(now()) @map("last_activity") @db.Timestamptz(6)
  ipAddress    String?   @map("ip_address") @db.Inet
  userAgent    String?   @map("user_agent") @db.Text
  revoked      Boolean   @default(false)
  revokedAt    DateTime? @map("revoked_at") @db.Timestamptz(6)

  // ‚úÖ –ù–û–í–û–ï –ø–æ–ª–µ –¥–ª—è application context —Å default 'WEB' –¥–ª—è backward compatibility
  applicationContext ApplicationType @default(WEB) @map("application_context")

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  // ‚úÖ –û–ë–ù–û–í–õ–Ø–ï–ú indexes - –¥–æ–±–∞–≤–ª—è–µ–º applicationContext
  @@index([userId])
  @@index([applicationContext, userId]) // ‚úÖ –ù–û–í–´–ô –∏–Ω–¥–µ–∫—Å –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º
  @@index([expiresAt])
  @@index([createdAt])
  @@index([revoked])
  @@map("sessions")
}

// ‚úÖ –ù–û–í–ê–Ø –º–æ–¥–µ–ª—å: —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º
model UserAppRole {
  id                 String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId             String          @map("user_id") @db.Uuid
  applicationContext ApplicationType @map("application_context")
  role               UserRole
  createdAt          DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  // ‚úÖ CONSTRAINT: –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –æ–¥–Ω–∞ —Ä–æ–ª—å –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
  @@unique([userId, applicationContext])
  @@index([applicationContext])
  @@index([role])
  @@index([userId])
  @@map("user_app_roles")
}

enum UserRole {
  USER     @map("user")
  ADMIN    @map("admin")
  OPERATOR @map("operator") 
  SUPPORT  @map("support")
}

// ‚úÖ –ù–û–í–´–ô enum –¥–ª—è application context
enum ApplicationType {
  WEB      @map("web")
  ADMIN    @map("admin")
}

// ‚úÖ Order statuses enum - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç packages/constants/src/order-statuses.ts
enum OrderStatus {
  PENDING    @map("pending")
  PAID       @map("paid")
  PROCESSING @map("processing")
  COMPLETED  @map("completed")
  CANCELLED  @map("cancelled")
  FAILED     @map("failed")
}

// ‚úÖ Order –º–æ–¥–µ–ª—å - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π User –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π  
model Order {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId        String    @map("user_id") @db.Uuid

  // Business fields - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É Order interface
  cryptoAmount  Decimal   @map("crypto_amount") @db.Decimal(36, 18)  // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å –¥–ª—è –≤—Å–µ—Ö –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç
  currency      String    @db.VarChar(10)                            // BTC, ETH, USDT
  uahAmount     Decimal   @map("uah_amount") @db.Decimal(12, 2)      // UAH —Å –∫–æ–ø–µ–π–∫–∞–º–∏
  tokenStandard String?   @map("token_standard") @db.VarChar(20)     // ERC20, TRC20, etc

  // Status tracking
  status        OrderStatus @default(PENDING)

  // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ê —Å—Å—ã–ª–æ—á–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å - depositAddress —Ç–µ–ø–µ—Ä—å —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ Wallet
  walletId      String?     @map("wallet_id") @db.Uuid          // FK –Ω–∞ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π –∫–æ—à–µ–ª–µ–∫ (nullable –¥–ª—è –æ—á–µ—Ä–µ–¥–∏)
  txHash        String?     @map("tx_hash") @db.VarChar(255)

  // Recipient data - JSON –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏ (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç existing interface)
  recipientData  Json?     @map("recipient_data") @db.JsonB

  // Operator assignment tracking
  assignedOperatorId String? @map("assigned_operator_id") @db.Uuid
  assignedAt         DateTime? @map("assigned_at") @db.Timestamptz(6)

  // Timestamps - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –ø–∞—Ç—Ç–µ—Ä–Ω—É
  createdAt     DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt     DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6)
  processedAt   DateTime? @map("processed_at") @db.Timestamptz(6)

  // Relations - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  assignedOperator  User?    @relation("OperatorAssignments", fields: [assignedOperatorId], references: [id], onDelete: SetNull)
  wallet            Wallet?  @relation(fields: [walletId], references: [id], onDelete: SetNull)  // ‚úÖ –°–≤—è–∑—å —Å –∫–æ—à–µ–ª—å–∫–æ–º
  auditLogs         OrderAuditLog[] // –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
  queueEntries      WalletQueue[]   // ‚úÖ –°–≤—è–∑—å —Å –æ—á–µ—Ä–µ–¥—å—é –æ–∂–∏–¥–∞–Ω–∏—è

  // Indexes - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Ç–∏–ø–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
  @@index([userId])                    // –ó–∞—è–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  @@index([status])                    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É
  @@index([currency])                  // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤–∞–ª—é—Ç–µ
  @@index([createdAt])                 // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
  @@index([status, createdAt])         // –°–æ—Å—Ç–∞–≤–Ω–æ–π –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
  @@index([walletId])                  // ‚úÖ –ó–∞—è–≤–∫–∏ –∫–æ—à–µ–ª—å–∫–∞
  @@index([assignedOperatorId])        // –ó–∞—è–≤–∫–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
  @@index([txHash])                    // –ü–æ–∏—Å–∫ –ø–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

  @@map("orders")
}

// ‚úÖ OrderAuditLog –º–æ–¥–µ–ª—å - –ê—É–¥–∏—Ç/–ò—Å—Ç–æ—Ä–∏—è –∑–∞—è–≤–æ–∫ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞
model OrderAuditLog {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  orderId   String   @map("order_id") @db.Uuid

  // –ê—É–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ - –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
  action    String   @db.VarChar(100)  // "ORDER_CREATED", "STATUS_CHANGED", "ASSIGNED_TO_OPERATOR", "OPERATOR_COMMENT"
  oldValue  String?  @map("old_value") @db.VarChar(100)  // —Å—Ç–∞—Ä—ã–π —Å—Ç–∞—Ç—É—Å/–∑–Ω–∞—á–µ–Ω–∏–µ
  newValue  String?  @map("new_value") @db.VarChar(100)  // –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å/–∑–Ω–∞—á–µ–Ω–∏–µ

  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞, –ø—Ä–∏—á–∏–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π)
  metadata  Json?    @db.JsonB  // –ì–∏–±–∫–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
  comment   String?  @db.Text   // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

  // –ö—Ç–æ –≤—ã–ø–æ–ª–Ω–∏–ª –¥–µ–π—Å—Ç–≤–∏–µ (null –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π)
  performedBy String? @map("performed_by") @db.Uuid  // userId –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

  // –ö–æ–≥–¥–∞
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  // Relations
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  user      User?    @relation("AuditLogPerformer", fields: [performedBy], references: [id], onDelete: SetNull)

  // Indexes –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
  @@index([orderId])           // –ò—Å—Ç–æ—Ä–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞—è–≤–∫–∏
  @@index([createdAt])         // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
  @@index([action])            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É –¥–µ–π—Å—Ç–≤–∏—è
  @@index([performedBy])       // –î–µ–π—Å—Ç–≤–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
  @@index([orderId, createdAt]) // –°–æ—Å—Ç–∞–≤–Ω–æ–π –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞—è–≤–∫–∏

  @@map("order_audit_logs")
}

// ================================================================================
// üü¢ –ù–ï–î–û–°–¢–ê–Æ–©–ò–ï –ú–û–î–ï–õ–ò –î–õ–Ø WALLET MANAGEMENT –°–ò–°–¢–ï–ú–´ 
// ================================================================================

// ‚úÖ –°—Ç–∞—Ç—É—Å—ã –∫–æ—à–µ–ª—å–∫–æ–≤ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—É–ª–æ–º
enum WalletStatus {
  AVAILABLE  @map("available")   // –°–≤–æ–±–æ–¥–µ–Ω, –≥–æ—Ç–æ–≤ –∫ –≤—ã–¥–µ–ª–µ–Ω–∏—é
  ALLOCATED  @map("allocated")   // –í—ã–¥–µ–ª–µ–Ω –¥–ª—è –∑–∞—è–≤–∫–∏  
  DISABLED   @map("disabled")    // –û—Ç–∫–ª—é—á–µ–Ω (—Ç–µ—Ö–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ, –ø—Ä–æ–±–ª–µ–º—ã)
}

// ‚úÖ –ú–æ–¥–µ–ª—å Wallet - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω—ã–º–∏ –∫–æ—à–µ–ª—å–∫–∞–º–∏
model Wallet {
  id            String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  
  // ‚úÖ –ö–†–ò–¢–ò–ß–ù–û: UNIQUE constraint –¥–ª—è –∞–¥—Ä–µ—Å–∞ (–æ–¥–∏–Ω –∞–¥—Ä–µ—Å = –æ–¥–∏–Ω –∫–æ—à–µ–ª–µ–∫)
  address       String      @unique @db.VarChar(255)    // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫—Ä–∏–ø—Ç–æ–∞–¥—Ä–µ—Å
  currency      String      @db.VarChar(10)             // BTC, ETH, USDT
  tokenStandard String?     @map("token_standard") @db.VarChar(20)  // ERC20, TRC20, null –¥–ª—è –Ω–∞—Ç–∏–≤–Ω—ã—Ö
  
  // ‚úÖ –°—Ç–∞—Ç—É—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ FIFO –∞–ª–≥–æ—Ä–∏—Ç–º–∞
  status        WalletStatus @default(AVAILABLE)
  
  // ‚úÖ –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
  label         String?      @db.VarChar(100)           // –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –∏–º—è
  notes         String?      @db.Text                   // –ó–∞–º–µ—Ç–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  
  // ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
  totalOrders   Int          @default(0) @map("total_orders")     // –°—á–µ—Ç—á–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π
  lastUsedAt    DateTime?    @map("last_used_at") @db.Timestamptz(6)  // –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
  
  // ‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
  createdAt     DateTime     @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt     DateTime     @updatedAt @map("updated_at") @db.Timestamptz(6)
  disabledAt    DateTime?    @map("disabled_at") @db.Timestamptz(6)

  // Relations
  orders        Order[]      // –ó–∞—è–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ —ç—Ç–æ—Ç –∫–æ—à–µ–ª–µ–∫
  queueEntries  WalletQueue[] // ‚úÖ –û—á–µ—Ä–µ–¥–∏ –æ–∂–∏–¥–∞–Ω–∏—è –¥–ª—è —ç—Ç–æ–≥–æ –∫–æ—à–µ–ª—å–∫–∞

  // ‚úÖ –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è O(log n) FIFO –æ–ø–µ—Ä–∞—Ü–∏–π
  @@index([currency, status])             // ‚úÖ –ü–æ–∏—Å–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤ –ø–æ –≤–∞–ª—é—Ç–µ
  @@index([status])                       // ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É
  @@index([currency])                     // ‚úÖ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –≤–∞–ª—é—Ç–µ
  @@index([lastUsedAt])                   // ‚úÖ FIFO —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
  @@index([currency, status, lastUsedAt]) // ‚úÖ –°–û–°–¢–ê–í–ù–û–ô –∏–Ω–¥–µ–∫—Å –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ FIFO
  @@index([createdAt])                    // ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–∑–¥–∞–Ω–∏—è
  @@index([address])                      // ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∫ UNIQUE)

  @@map("wallets")
}

// ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –¥–ª—è —É–º–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥—å—é  
enum QueuePriority {
  LOW      @map("low")       // –û–±—ã—á–Ω—ã–µ –∑–∞—è–≤–∫–∏
  NORMAL   @map("normal")    // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç  
  HIGH     @map("high")      // –í–∞–∂–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã
  URGENT   @map("urgent")    // –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏
}

// ‚úÖ –ú–æ–¥–µ–ª—å WalletQueue - FIFO –æ—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞–Ω–∏—è –∫–æ—à–µ–ª—å–∫–æ–≤
model WalletQueue {
  id            String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  
  // ‚úÖ –°–≤—è–∑–∏ —Å Order –∏ Wallet –¥–ª—è –ø–æ–ª–Ω–æ–π —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏
  orderId       String        @map("order_id") @db.Uuid                // –ó–∞—è–≤–∫–∞ –≤ –æ—á–µ—Ä–µ–¥–∏
  walletId      String?       @map("wallet_id") @db.Uuid               // –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π –∫–æ—à–µ–ª–µ–∫ (nullable)
  currency      String        @db.VarChar(10)                          // –ù—É–∂–Ω–∞—è –≤–∞–ª—é—Ç–∞
  
  // ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥—å—é –∏ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è
  priority      QueuePriority @default(NORMAL)                        // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤ –æ—á–µ—Ä–µ–¥–∏
  position      Int           @map("queue_position")                   // –ü–æ–∑–∏—Ü–∏—è –≤ –æ—á–µ—Ä–µ–¥–∏ (–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
  
  // ‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –¥–ª—è FIFO –ª–æ–≥–∏–∫–∏
  createdAt     DateTime      @default(now()) @map("created_at") @db.Timestamptz(6)  // –í—Ä–µ–º—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å
  processedAt   DateTime?     @map("processed_at") @db.Timestamptz(6)                // –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
  expiresAt     DateTime?     @map("expires_at") @db.Timestamptz(6)                  // –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  
  // ‚úÖ –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
  retryCount    Int           @default(0) @map("retry_count")          // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏
  lastError     String?       @map("last_error") @db.Text              // –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
  metadata      Json?         @db.JsonB                                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

  // Relations
  order         Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)
  wallet        Wallet?       @relation(fields: [walletId], references: [id], onDelete: SetNull)

  // ‚úÖ –ö–†–ò–¢–ò–ß–ù–´–ï –ò–ù–î–ï–ö–°–´ –¥–ª—è –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ FIFO O(log n)
  @@index([currency, priority, createdAt])    // ‚úÖ –ì–õ–ê–í–ù–´–ô –∏–Ω–¥–µ–∫—Å: FIFO —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ –ø–æ –≤–∞–ª—é—Ç–µ
  @@index([processedAt])                      // ‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏
  @@index([expiresAt])                        // ‚úÖ –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö
  @@index([orderId])                          // ‚úÖ –ü–æ–∏—Å–∫ –ø–æ –∑–∞—è–≤–∫–µ
  @@index([walletId])                         // ‚úÖ –ó–∞–ø–∏—Å–∏ –ø–æ –∫–æ—à–µ–ª—å–∫—É
  @@index([createdAt])                        // ‚úÖ FIFO —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
  @@index([priority, createdAt])              // ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è FIFO
  
  // ‚úÖ CONSTRAINT: –æ–¥–Ω–∞ –∑–∞—è–≤–∫–∞ = –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å –≤ –æ—á–µ—Ä–µ–¥–∏
  @@unique([orderId])

  @@map("wallet_queue")
}
