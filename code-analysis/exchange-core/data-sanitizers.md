### Путь: packages/exchange-core/src/utils/data-sanitizers.ts

**Краткое назначение (1 предложение)**

Утилиты санитизации входящих данных для нормализации email адресов, пользовательского ввода и кодов валют перед обработкой.

**Подробное описание (3–6 предложений)**

Модуль предоставляет набор простых, но критически важных функций для очистки и нормализации данных, поступающих от пользователей перед их обработкой в системе. Санитизация email включает приведение к нижнему регистру и удаление пробелов для обеспечения консистентности в базе данных и предотвращения дублирования аккаунтов. Функция общей санитизации входящих данных удаляет лишние пробелы, что помогает предотвратить ошибки валидации и улучшает качество данных. Санитизация кодов валют приводит их к верхнему регистру для соответствия стандартным обозначениям криптовалют. Модуль архитектурно отделен от логики валидации для лучшей организации кода и следования принципу единственной ответственности. Все функции являются чистыми без побочных эффектов и легко тестируются.

**Экспортируемые сущности / API**

- `export function sanitizeEmail(email: string): string` — Нормализация email адреса
- `export function sanitizeInput(input: string): string` — Очистка пользовательского ввода
- `export function sanitizeCurrency(currency: string): string` — Нормализация кода валюты

**Входы (expected inputs) / Параметры**

- `sanitizeEmail`: `email: string` — email адрес с возможными пробелами и смешанным регистром
- `sanitizeInput`: `input: string` — любая строка пользовательского ввода
- `sanitizeCurrency`: `currency: string` — код криптовалюты в любом регистре

**Выходы / Побочные эффекты**

- `sanitizeEmail`: возвращает `string` — email в нижнем регистре без пробелов в начале/конце
- `sanitizeInput`: возвращает `string` — строка без пробелов в начале/конце
- `sanitizeCurrency`: возвращает `string` — код валюты в верхнем регистре без пробелов
- Побочные эффекты отсутствуют — все функции чистые без мутаций состояния
- Не выполняют валидацию — только нормализацию формата данных

**Взаимосвязи (кто вызывает / что вызывает)**

Файлы, которые импортируют этот файл:

- `apps/web/src/server/trpc/routers/exchange.ts` — sanitizeEmail для заявок обмена
- `apps/web/src/server/trpc/routers/auth.ts` — sanitizeEmail для аутентификации
- `packages/exchange-core/src/index.ts` — реэкспорт функций (предположительно)

Файлы, которые импортируются здесь:

- Нет внешних зависимостей — использует только встроенные методы JavaScript

**Домен данных / типы**

```typescript
// Входные/выходные типы
type EmailString = string;
type UserInputString = string;
type CurrencyCodeString = string;

// Примеры трансформаций
const emailTransforms = {
  input: '  User@Example.COM  ',
  output: 'user@example.com',
};

const currencyTransforms = {
  input: '  btc  ',
  output: 'BTC',
};

const inputTransforms = {
  input: '  some user input  ',
  output: 'some user input',
};
```

**Риски и безопасность**

- **Data integrity**: санитизация не заменяет валидацию и не гарантирует корректность данных
- **Unicode handling**: простая очистка может не обрабатывать корректно специальные Unicode символы
- **Email case sensitivity**: хотя RFC допускает case-sensitive локальную часть email, практика приведения к нижнему регистру может создать проблемы в редких случаях
- **Input truncation**: функции не ограничивают длину входящих данных
- **Injection prevention**: санитизация не защищает от injection атак, требуется дополнительная валидация
- **Data loss**: агрессивная санитизация может удалить важные символы

**Тесты / рекомендации по покрытию**

- Unit тесты для sanitizeEmail: различные комбинации регистра, пробелы в начале/конце, валидные/невалидные email
- Unit тесты для sanitizeInput: строки с пробелами, пустые строки, специальные символы
- Unit тесты для sanitizeCurrency: коды валют в разных регистрах, с пробелами
- Edge case тесты: очень длинные строки, Unicode символы, null/undefined входы
- Integration тесты: совместная работа с валидаторами после санитизации
- Performance тесты: обработка больших объемов данных
- Security тесты: попытки injection через санитизируемые поля

**Оценка сложности (low/medium/high)**

**low** — простейшие утилиты с минимальной логикой, но критически важные для качества данных.

**TODO / Рефакторинг**

- Добавить проверки на null/undefined для предотвращения runtime ошибок
- Рассмотреть добавление более продвинутой санитизации Unicode символов
- Добавить опциональные параметры для кастомизации санитизации (например, сохранение регистра)
- Расширить функционал санитизации для других типов данных (номера телефонов, адреса)
- Добавить TypeScript строгую типизацию с branded types для санитизированных данных
- Рассмотреть интеграцию с библиотеками для более продвинутой санитизации (DOMPurify для веб-контента)
