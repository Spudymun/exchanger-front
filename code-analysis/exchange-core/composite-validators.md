### Путь: packages/exchange-core/src/utils/composite-validators.ts

**Краткое назначение (1 предложение)**

Валидация сложных составных структур данных, в частности данных получателя для заявок обмена с проверкой номеров банковских карт.

**Подробное описание (3–6 предложений)**

Модуль предназначен для валидации композитных структур данных, которые состоят из нескольких связанных полей и требуют комплексной проверки. В настоящее время содержит валидацию данных получателя (RecipientData), включая проверку номеров банковских карт по регулярным выражениям из централизованных паттернов. Архитектурно отделен от простых валидаторов для лучшей организации кода и возможности расширения функционала без усложнения базовых валидаторов. Система использует единообразные ValidationResult объекты для интеграции с остальной системой валидации. Модуль спроектирован с учетом будущего расширения для валидации других композитных структур, таких как полные профили пользователей или сложные настройки обмена. Все проверки построены на принципе fail-fast с детальными сообщениями об ошибках.

**Экспортируемые сущности / API**

- `export function validateRecipientData(recipientData?: RecipientData): ValidationResult` — Валидация данных получателя платежа

**Входы (expected inputs) / Параметры**

- `validateRecipientData`: `recipientData?: RecipientData` — необязательный объект с данными получателя (номер карты, имя, телефон, банковские реквизиты)

**Выходы / Побочные эффекты**

- `validateRecipientData`: возвращает `ValidationResult` с массивом ошибок валидации
- В настоящее время проверяет только формат номера банковской карты через регулярное выражение
- Возвращает пустой массив ошибок если recipientData не предоставлен или cardNumber отсутствует
- Побочные эффекты отсутствуют — чистая функция без мутаций состояния

**Взаимосвязи (кто вызывает / что вызывает)**

Файлы, которые импортируют этот файл:

- `packages/exchange-core/src/utils/order-validators.ts` — использует validateRecipientData для валидации заявок
- `packages/exchange-core/src/index.ts` — реэкспорт функции

Файлы, которые импортируются здесь:

- `@repo/constants` — EXCHANGE_VALIDATION_PATTERNS, EXCHANGE_VALIDATION_MESSAGES
- `@repo/utils` — createValidationResult, ValidationResult типы
- `../types` — RecipientData интерфейс

**Домен данных / типы**

```typescript
// Основные типы
interface RecipientData {
  cardNumber?: string; // Номер банковской карты
  bankDetails?: string; // Банковские реквизиты
  recipientName?: string; // Имя получателя
  phone?: string; // Телефон получателя
}

interface ValidationResult {
  isValid: boolean;
  errors: string[];
}

// Используемые константы
const EXCHANGE_VALIDATION_PATTERNS: {
  CARD_NUMBER: RegExp; // Паттерн для проверки номера карты
  // другие паттерны
};

const EXCHANGE_VALIDATION_MESSAGES: {
  CARD_NUMBER_INVALID: string;
  // другие сообщения
};
```

**Риски и безопасность**

- **Card number validation**: недостаточная валидация номеров карт может привести к неудачным платежам
- **Pattern synchronization**: изменения в EXCHANGE_VALIDATION_PATTERNS должны синхронизироваться с бизнес-требованиями
- **Incomplete validation**: модуль проверяет только формат номера карты, но не другие поля RecipientData
- **PII data handling**: номера карт являются sensitive данными и требуют особой осторожности
- **Regex security**: сложные регулярные выражения могут быть уязвимы к ReDoS атакам
- **Data leakage**: детальные сообщения об ошибках не должны раскрывать внутреннюю логику валидации

**Тесты / рекомендации по покрытию**

- Unit тесты для validateRecipientData: валидные номера карт различных банков, невалидные номера
- Unit тесты с undefined/null recipientData, пустыми объектами
- Unit тесты проверки всех полей RecipientData (имя, телефон, банковские реквизиты)
- Integration тесты с order-validators для проверки полного flow валидации заявок
- Security тесты: попытки injection через поля данных, проверка ReDoS устойчивости
- Edge case тесты: очень длинные номера карт, специальные символы
- Performance тесты: валидация больших объемов данных

**Оценка сложности (low/medium/high)**

**low** — простая функция с одной проверкой, но потенциал для роста сложности при расширении.

**TODO / Рефакторинг**

- Добавить валидацию других полей RecipientData (имя получателя, телефон, банковские реквизиты)
- Рассмотреть добавление Luhn algorithm проверки для номеров карт
- Добавить валидацию банковских реквизитов по IBAN/SWIFT стандартам
- Расширить функционал для валидации других композитных структур (профили пользователей, настройки)
- Добавить типизированные константы для различных типов карт и банков
- Рассмотреть создание отдельных функций для каждого типа композитной валидации
