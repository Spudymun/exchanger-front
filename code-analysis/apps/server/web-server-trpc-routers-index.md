### Путь: apps/web/src/server/trpc/routers/index.ts

**Краткое назначение (1 предложение)**

Главный агрегатор всех tRPC роутеров приложения в единую типизированную API структуру.

**Подробное описание (3–6 предложений)**

Файл создает основной роутер приложения путем композиции всех предметно-ориентированных роутеров в единую иерархическую структуру API. Каждый роутер отвечает за свой функциональный домен: аутентификация, обмен валют, фиатные операции, пользовательские действия, операторские функции, поддержка и общие операции. Структура обеспечивает четкое разделение ответственности и позволяет легко расширять API без конфликтов имен. Экспортируемый тип `AppRouter` обеспечивает full-stack типобезопасность между сервером и клиентом через tRPC. Такая архитектура следует принципам модульности и позволяет независимо разрабатывать различные части API.

**Экспортируемые сущности / API**

- `export const appRouter` — главный роутер приложения с композицией всех sub-роутеров
- `export type AppRouter` — TypeScript тип для типобезопасности клиент-сервер взаимодействия

**Входы (expected inputs) / Параметры**

Файл не принимает прямых входных параметров, но агрегирует роутеры, которые принимают:

- tRPC контекст с аутентификацией и локализацией
- Процедуры различных типов (public, protected, role-based)
- Валидированные input схемы через Zod

**Выходы / Побочные эффекты**

- Единая точка доступа ко всем API эндпоинтам
- Типизированный интерфейс для tRPC клиента
- Иерархическая структура API: `trpc.exchange.*`, `trpc.auth.*`, etc.
- Автоматическая типизация всех процедур и их параметров

**Взаимосвязи (кто вызывает / что вызывает)**

Файлы, которые импортируют этот файл:

- `../index.ts` — реэкспорт для использования в приложении
- `apps/web/pages/api/trpc/[trpc].ts` — Next.js API handler
- `apps/web/lib/trpc-provider.tsx` — клиентская типизация

Файлы, которые импортируются здесь:

- `../init` — фабрика `createTRPCRouter` для создания композитного роутера
- `./auth` — роутер аутентификации и авторизации
- `./exchange` — роутер операций обмена валют
- `./fiat` — роутер фиатных операций
- `./operator` — роутер функций для операторов
- `./shared` — роутер общих функций
- `./support` — роутер функций службы поддержки
- `./user` — роутер пользовательских операций

**Домен данных / типы**

```typescript
// Композитная структура API
interface AppRouter {
  exchange: ExchangeRouter;
  fiat: FiatRouter;
  auth: AuthRouter;
  user: UserRouter;
  operator: OperatorRouter;
  support: SupportRouter;
  shared: SharedRouter;
}

// Пример структуры вызовов
type APICall =
  | 'exchange.createOrder'
  | 'auth.login'
  | 'user.getProfile'
  | 'fiat.getRates'
  | 'operator.getOrders'
  | 'support.getTickets'
  | 'shared.getConstants';
```

**Риски и безопасность**

- **API surface**: Большая поверхность атаки из-за агрегации всех эндпоинтов
- **Authorization leaks**: Неправильная композиция может привести к обходу авторизации
- **Type safety**: Ошибки в типизации могут нарушить контракт клиент-сервер
- **Breaking changes**: Изменения в sub-роутерах влияют на всю API структуру
- **Performance**: Большой объем типов может замедлить TypeScript компиляцию

**Тесты / рекомендации по покрытию**

- Integration тесты полной API структуры
- Тесты типизации TypeScript для `AppRouter`
- E2E тесты всех API endpoints через композитный роутер
- Тесты обратной совместимости при изменениях sub-роутеров
- Тесты производительности загрузки и компиляции типов

**Оценка сложности (low/medium/high)**

**low** — простая композиция без собственной бизнес-логики

**TODO / Рефакторинг**

- Рассмотреть версионирование API для управления breaking changes
- Добавить автоматическую генерацию OpenAPI документации
- Реализовать мониторинг использования различных частей API
- Рассмотреть lazy loading для больших роутеров в development
- Добавить валидацию целостности композиции роутеров
