# Acceptance Criteria: Компонент "Обменник криптовалюты на фиат"

**Связанная User Story:** Как пользователь, я хочу быстро, безопасно и без регистрации обменять криптовалюту (USDT) на фиатную валюту (UAH, USD, EUR и т.д.) через выбранный банк, чтобы получить деньги на счет по выгодному курсу.

**Область применения:** Основной компонент на странице сервиса обмена криптовалют.

**Ключевые особенности:**

- **Левый блок:** Выбор криптовалюты и ввод суммы отправки.
- **Правый блок:** Выбор фиатной валюты -> Выбор банка для выбранной валюты -> Отображение суммы получения.
- **Автоматический расчет:** Сумма получения пересчитывается мгновенно при изменении суммы отправки, курса или выбора валюты/банка.
- **Динамические данные:** Курс, мин/макс суммы, резервы банков запрашиваются с бэкенда в реальном времени.
- **Кнопка действия:** "Обменять".

---

## 1. Общая Структура и Статичные Элементы

- **AC 1.1:** Компонент визуально разделен на два основных блока: "Вы отправляете" (слева) и "Вы получаете" (справа).
- **AC 1.2:** Над компонентом отображаются преимущества сервиса: "Быстро • Безопасно • Без регистрации • Выгодный курс • Моментальные переводы".
- **AC 1.3:** Под заголовками преимуществ отображаются ключевые фичи: "Обмен за 5 минут", "Без регистрации", "Лучший курс".
- **AC 1.4:** Внизу компонента отображается кнопка "Обменять".

## 2. Блок "Вы отправляете" (Криптовалюта)

- **AC 2.1:** В блоке отображается заголовок "Вы отправляете".
- **AC 2.2:** Под заголовком находится выпадающий список/селектор для выбора криптовалюты. По умолчанию выбран `USDT (Tether TRC20)`.
  - **AC 2.2.1:** При клике на селектор открывается список доступных криптовалют (напр., `BTC`, `ETH`, `USDT (ERC20)`, `USDT (TRC20)`, `USDC`). Данные списка криптовалют запрашиваются с бэкенда при загрузке компонента.
- **AC 2.3:** Под селектором находится поле ввода с лейблом "Сумма".
- **AC 2.4:** Под полем ввода отображается текст `min: [значение] [код криптовалюты]` (напр., `min: 10 USDT`). Значение `min` и код валюты динамически обновляются при смене криптовалюты и запрашиваются с бэкенда.
- **AC 2.5:** Под минимальной суммой отображается строка с курсом: `Курс: 1 [код криптовалюты] = [значение] [код фиатной валюты]` (напр., `Курс: 1 USDT = 40.5 UAH`). Значение курса обновляется динамически (см. раздел 4).

## 3. Блок "Вы получаете" (Фиатная Валюта и Банк)

- **AC 3.1:** В блоке отображается заголовок "Вы получаете".
- **AC 3.2:** Под заголовком находится **первый выпадающий список/селектор** для выбора фиатной валюты. По умолчанию выбран `UAH` (или другая основная валюта региона).
  - **AC 3.2.1:** При клике на селектор открывается список доступных фиатных валют (напр., `UAH`, `USD`, `EUR`). Данные списка валют запрашиваются с бэкенда при загрузке компонента.
- **AC 3.3:** Под селектором валюты находится **второй выпадающий список/селектор** с лейблом "Выберите банк".
  - **AC 3.3.1:** Список банков в этом селекторе **динамически зависит** от выбранной в блоке "Вы получаете" фиатной валюты.
  - **AC 3.3.2:** При смене фиатной валюты (AC 3.2.1), список банков во втором селекторе обновляется (запрос к бэкенду), а текущее значение сбрасывается (пользователь должен выбрать банк заново или отображается первый из списка).
  - **AC 3.3.3:** При клике на селектор банка открывается список доступных банков для _выбранной_ фиатной валюты (напр., для UAH: `ПриватБанк`, `Монобанк`, `PUMB`; для USD: `Wise`, `Payoneer`). Каждый банк в списке отображает свой логотип и название. Данные банков запрашиваются с бэкенда.
- **AC 3.4:** Под селектором банка находится поле (возможно, read-only) с лейблом "Сумма", отображающее рассчитанную сумму к получению в выбранной фиатной валюте (напр., `0.00`).
- **AC 3.5:** Под полем суммы получения отображается текст `min: [значение] [код фиатной валюты]` (напр., `min: 100 UAH`). Значение `min` динамически обновляется при смене фиатной валюты и/или банка и запрашивается с бэкенда.
- **AC 3.6:** Под минимальной суммой отображается строка с резервом: `Резерв: [значение] [код фиатной валюты]` (напр., `Резерв: 10 000 000 UAH`). Значение резерва динамически обновляется при смене фиатной валюты и/или банка и запрашивается с бэкенда.

## 4. Динамический Курс и Автоматический Пересчет

- **AC 4.1:** Курс обмена (`Курс: 1 [крипта] = [значение] [фиат]` в блоке "Вы отправляете") динамически зависит от:
  - Выбранной криптовалюты (AC 2.2)
  - Выбранной фиатной валюты (AC 3.2)
  - Выбранного банка (AC 3.3) _(если курс зависит от банка)_
- **AC 4.2:** Курс запрашивается с бэкенда при:
  - Первоначальной загрузке компонента.
  - Изменении выбранной криптовалюты.
  - Изменении выбранной фиатной валюты.
  - Изменении выбранного банка.
  - _(Опционально)_ Периодически (например, каждые 30 секунд) для актуализации.
- **AC 4.3:** **Автоматический пересчет суммы получения:**
  - `Given` Пользователь ввел сумму в поле "Сумма" в блоке "Вы отправляете" (AC 2.3) ИЛИ изменился курс (AC 4.2) ИЛИ изменилась выбранная фиатная валюта (AC 3.2) ИЛИ изменился выбранный банк (AC 3.3)
  - `Then` Значение в поле "Сумма" блока "Вы получаете" (AC 3.4) **мгновенно пересчитывается** по формуле: `[Сумма получения] = [Сумма отправки] * [Текущий курс]`.
  - `And` Пересчет происходит без необходимости нажатия кнопок или перезагрузки страницы (AJAX/WebSocket).
- **AC 4.4:** **Автоматический пересчет суммы отправки:**
  - `Given` Поле "Сумма" в блоке "Вы получаете" является редактируемым (если задумано) И пользователь ввел сумму в него ИЛИ изменился курс (AC 4.2) ИЛИ изменилась выбранная криптовалюта (AC 2.2)
  - `Then` Значение в поле "Сумма" блока "Вы отправляете" (AC 2.3) **мгновенно пересчитывается** по формуле: `[Сумма отправки] = [Сумма получения] / [Текущий курс]`.
  - `And` Пересчет происходит без необходимости нажатия кнопок или перезагрузки страницы. _(Примечание: AC 4.4 актуален, только если поле получения редактируемо. По вашему скриншоту оно, скорее всего, read-only)._

## 5. Валидация и Ограничения (min/max)

- **AC 5.1:** При вводе суммы в поле "Сумма" (блок "Вы отправляете"):
  - Разрешен ввод только цифр и точки/запятой (в зависимости от локали) как разделителя дробной части.
  - Количество знаков после запятой ограничено точностью выбранной криптовалюты (напр., для BTC - 8 знаков, для USDT - обычно 2 знака). Данные о точности берутся с бэкенда.
- **AC 5.2:** **Проверка минимальной суммы отправки:**
  - `Given` Пользователь ввел сумму в поле "Сумма" (блок "Вы отправляете")
  - `When` Сумма меньше значения `min`, указанного под полем (AC 2.4)
  - `Then` Поле ввода подсвечивается (например, красной рамкой).
  - `Then` Под полем ввода (или рядом с `min`) отображается сообщение об ошибке: `Минимальная сумма: [min] [код крипты]`.
  - `Then` Кнопка "Обменять" становится неактивной (disabled).
- **AC 5.3:** **Проверка минимальной суммы получения (опционально, но желательно):**
  - `Given` Автоматически рассчитанная сумма в блоке "Вы получаете" (AC 3.4)
  - `When` Эта сумма меньше значения `min`, указанного под полем (AC 3.5)
  - `Then` Поле суммы получения подсвечивается (например, красной рамкой).
  - `Then` Под полем суммы получения (или рядом с `min`) отображается сообщение об ошибке: `Минимальная сумма получения: [min] [код фиата]`.
  - `Then` Кнопка "Обменять" становится неактивной (disabled).
- **AC 5.4:** **Проверка на резерв банка:**
  - `Given` Автоматически рассчитанная сумма в блоке "Вы получаете" (AC 3.4)
  - `When` Эта сумма превышает значение `Резерв` для выбранного банка и валюты (AC 3.6)
  - `Then` Поле суммы получения подсвечивается (например, красной рамкой).
  - `Then` Под полем суммы получения (или рядом с `Резерв`) отображается сообщение об ошибке: `Недостаточный резерв. Максимум: [резерв] [код фиата]`.
  - `Then` Кнопка "Обменять" становится неактивной (disabled).
- **AC 5.5:** **Проверка максимальной суммы (если применимо):**
  - `Given` Значение `max` для суммы отправки/получения получено с бэкенда (аналогично `min`).
  - `When` Введенная/рассчитанная сумма превышает `max`
  - `Then` Соответствующее поле подсвечивается.
  - `Then` Отображается сообщение об ошибке: `Максимальная сумма: [max] [код валюты]`.
  - `Then` Кнопка "Обменять" становится неактивной (disabled).
- **AC 5.6:** **Кнопка "Обменять" активна только если:**
  - Выбрана криптовалюта.
  - Выбрана фиатная валюта.
  - Выбран банк.
  - Введена валидная сумма отправки (число, соответствует min/max, точности).
  - Рассчитанная сумма получения соответствует min/max и не превышает резерв банка.
  - Нет активных ошибок валидации (AC 5.2-5.5).
  - _(Опционально)_ Успешно получен актуальный курс.

## 6. Состояния Загрузки и Ошибки Бэкенда

- **AC 6.1:** При выполнении запросов к бэкенду (загрузка списков валют/банков, получение курса, min/max, резерва) в соответствующих областях интерфейса (селекторах, полях min/max/резерв) отображается индикатор загрузки (например, спиннер).
- **AC 6.2:** Если запрос к бэкенду (на получение курса, списков, лимитов, резервов) завершился ошибкой:
  - В соответствующей области интерфейса (например, вместо курса, вместо списка банков, вместо значения min/резерв) отображается понятное сообщение об ошибке (напр., `Ошибка загрузки курса. Попробуйте позже.`, `Не удалось загрузить список банков.`).
  - Поля, зависящие от этих данных (сумма получения, кнопка "Обменять"), блокируются или переходят в невалидное состояние.
  - _(Опционально)_ Предлагается кнопка "Повторить попытку".

---

**Примечания для команды:**

1.  **Источник данных:** Все динамические данные (курсы, списки крипты/фиата/банков, min/max суммы, резервы) **обязательно** берутся с бэкенда через API. Не должно быть хардкода.
2.  **Зависимости:** Внимание на цепочку зависимостей: Выбор Фиата -> Обновление списка Банков -> Обновление Курса/min/резерва -> Пересчет Суммы Получения -> Валидация -> Состояние кнопки "Обменять".
3.  **Тестируемость:** Каждый критерий должен иметь четкий `Pass/Fail` результат. Особое внимание - на корректность пересчетов и валидаций при всех комбинациях действий пользователя и ответов бэкенда.
4.  **Ошибки бэкенда:** Сценарии обработки ошибок API (таймауты, 5xx ошибки, невалидные данные) критически важны для стабильности компонента.
5.  **UX/UI Детали:** Данные AC фокусируются на логике и данных. Внешний вид (точное расположение элементов, шрифты, цвета, анимации пересчета, вид индикаторов загрузки/ошибок) должен быть определен в макетах (Figma) и описаниях стилей.
6.  **Дальнейшие шаги:** Нажатие кнопки "Обменять" инициирует процесс обмена (создание ордера, показ реквизитов и т.д.). Это выходит за рамки данного компонента и должно быть описано в отдельной User Story и AC.
7.  **Локализация:** Форматирование чисел (разделители тысяч, десятичные знаки), названия валют/банков должны соответствовать выбранному языку/региону.
8.  **Комиссии:** В примере курс указан как `1 USDT = 40.5 UAH`. Необходимо уточнить у Product Owner, включены ли все комиссии в этот курс или их нужно отображать отдельно (AC не охватывают отображение комиссий, если оно требуется).
