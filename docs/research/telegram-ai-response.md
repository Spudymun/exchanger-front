–û—Ç–ª–∏—á–Ω–æ ‚Äî —Ä–∞–∑–±–µ—Ä—ë–º—Å—è –∫–∞–∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª: —Ü–µ–ª—å ‚Äî —Å–Ω–∏–∑–∏—Ç—å ¬´—à—É–º¬ª –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–µ, —á—Ç–æ–±—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä –≤–∏–¥–µ–ª —Ç–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∏ _–¥–µ–π—Å—Ç–≤—É–µ–º—ã–µ_ —Å–æ–±—ã—Ç–∏—è, –º–æ–≥ –±—ã—Å—Ç—Ä–æ –ø–æ–Ω—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ (–∏–ª–∏ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å). –ù–∏–∂–µ ‚Äî production-—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø–ª–∞–Ω –ø–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∏ –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–π –≤ Telegram (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ + –ø—Ä–∞–≤–∏–ª–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ + —à–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π + UX –≤ —Å–∞–º–æ–º –±–æ—Ç–µ + —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è).

# –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **–†–∞–∑–¥–µ–ª—è–π –≤–∞–∂–Ω–æ–µ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ.** –í—Å—ë —á—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è ‚Äî –≤—ã–¥–µ–ª—è–π –æ—Ç–¥–µ–ª—å–Ω—ã–º –∫–∞–Ω–∞–ª–æ–º/—Ñ–æ—Ä–º–∞—Ç–æ–º –∏ –ø–æ–≤—ã—à–∞–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –ª–æ–≥–∏ ‚Äî –≤ –¥—Ä—É–≥–æ–π –ø–æ—Ç–æ–∫/—á–∞—Ç/–∫–∞–Ω–∞–ª/–¥—ç–π–¥–∂–µ—Å—Ç.
2. **–î–µ–ª–∞–π –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä—è–º–æ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏.** Inline-–∫–Ω–æ–ø–∫–∏ (claim / mark paid / cancel / view) ‚Äî —á—Ç–æ–±—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä—É –Ω–µ –Ω—É–∂–Ω–æ –±—ã–ª–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –≤ –∞–¥–º–∏–Ω–∫—É –±–µ–∑ –Ω–∞–¥–æ–±–Ω–æ—Å—Ç–∏.
3. **–ì—Ä—É–ø–ø–∏—Ä—É–π –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π, –Ω–µ —Å–ø–∞–º—å.** –û–±–Ω–æ–≤–ª—è–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è (editMessage) –≤–º–µ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–æ–≤—ã—Ö, –µ—Å–ª–∏ —ç—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞—è–≤–∫–∏.
4. **Routing & assignment.** –ò—Å–ø–æ–ª—å–∑—É–π —Å–∏—Å—Ç–µ–º—É ¬´–≤–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É¬ª (claim) + lock –≤ –±–µ–∫–µ–Ω–¥–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏.
5. **–§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–¥–ø–∏—Å–∫–∏.** –û–ø–µ—Ä–∞—Ç–æ—Ä—ã –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–µ —Ç–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –∏–º –Ω—É–∂–Ω—ã (—Å–æ–∑–¥–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏ / —Å—Ä–æ—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã / –æ—Ç–º–µ–Ω—ã / —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏).
6. **Rate limit, batching, digest.** –ù–∏–∑–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚Äî –≤ batched digest (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∂–¥—ã–µ 5‚Äì30 –º–∏–Ω) –∏–ª–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª/—á–∞—Ç.
7. **Auditability & idempotency.** –•—Ä–∞–Ω–∏—Ç—å mapping orderId ‚Üî message_id + —Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ callback-events –¥–ª—è –∞—É–¥–∏—Ç–∞ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∫–∞—Ç–∞.
8. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ retry.** –ù–∞–¥—ë–∂–Ω—ã–π adapter —Å retry/backoff, DLQ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –æ—à–∏–±–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏.

---

# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (high level)

Events (order.created / payment.received / order.cancelled / dispute / manual)
‚Üí Event Bus (internal: Kafka / RabbitMQ / simple pubsub)
‚Üí Notification Service (transformer + routing rules + rate limiter)
‚Üí Telegram Adapter (bot token, API calls, webhook for callbacks)
‚Üí Chats / Groups / Channels / Operators

Notification Service responsibilities:

- –ø—Ä–∏–º–µ–Ω—è—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ (–∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å);
- —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (template, priority, actions);
- –≤–∏–¥–µ—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ message_id –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª—è—Ç—å –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞;
- —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å callback handlers (claim/confirm/cancel) –∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É;
- throttle/batch –Ω–∏–∑–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π;
- –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–µ—Ç—Ä–∏–∫–∏.

---

# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —á–∞—Ç–æ–≤ / –∫–∞–Ω–∞–ª–æ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

1. **Ops / Actionable group(s)** ‚Äî –¥–ª—è –∑–∞–¥–∞—á, —Ç—Ä–µ–±—É—é—â–∏—Ö —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞. –ú–æ–∂–µ—Ç –±—ã—Ç—å:
   - –æ–¥–∏–Ω –æ–±—â–∏–π —á–∞—Ç —Å —Ç–µ–º–∞–º–∏ (–µ—Å–ª–∏ –≥—Ä—É–ø–ø–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Topics) ‚Äî —Ç–æ–ø–∏–∫ –Ω–∞ –∫–∞–∂–¥—ã–π —Ç–∏–ø (New orders / Payments / Disputes)
   - –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥—Ä—É–ø–ø: `Operators:NewOrders`, `Operators:Payments`, `Operators:Alerts`.
     –í —ç—Ç–∏ —á–∞—Ç—ã –∏–¥—É—Ç —Ç–æ–ª—å–∫–æ actionable —Å–æ–æ–±—â–µ–Ω–∏—è (claimable).

2. **Info channel / logs** ‚Äî read-only –∫–∞–Ω–∞–ª, –∫—É–¥–∞ –ø–∏—à—É—Ç—Å—è –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ (–º–æ–∂–Ω–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –∞—Ä—Ö–∏–≤–∞).
3. **Digest chat** ‚Äî –¥–ª—è non-critical —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –∫–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç/—á–∞—Å–æ–≤.
4. **Private operator DM** ‚Äî –¥–ª—è –ª–∏—á–Ω—ã—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π/alarms (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –Ω—É–∂–µ–Ω —Å—Ä–æ—á–Ω—ã–π –≤–º–µ—à–∞—Ç–µ–ª—å).

---

# –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã

- Priority HIGH: `payment_confirmed_by_watchers`, `fraud_alert`, `manual_operator_mark_paid` (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞). Push –≤ Ops —Å—Ä–∞–∑—É.
- Priority MEDIUM: `order_created` (–µ—Å–ª–∏ —Å—É–º–º–∞ > threshold) ‚Äî push actionable; –º–∞–ª—ã–µ —Å—É–º–º—ã ‚Üí digest.
- Priority LOW: `order_created` (small amounts), `informational logs` ‚Üí digest / info channel.

–ü—Ä–∞–≤–∏–ª–∞:

- –ø–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: `amount_threshold`, `suspicious_flags` (KYC failed/unusual address) ‚Äî –ø–æ–≤—ã—à–∞—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.
- –±–∞–≥–∏/–≤—ã—Å–æ–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞ –Ω–æ–≤—ã—Ö —Å–æ–∑–¥–∞–Ω–∏–π ‚Äî –≤—Ä–µ–º–µ–Ω–Ω–æ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è (rate limit) –∏–ª–∏ –≤–∫–ª—é—á–∞—é—Ç ¬´rate mode¬ª (—Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω—ã–µ —Ç–∏–ø—ã).

---

# UX —Å–æ–æ–±—â–µ–Ω–∏—è (—à–∞–±–ª–æ–Ω—ã + –¥–µ–π—Å—Ç–≤–∏—è)

1. **New order (actionable)**
   –°–æ–æ–±—â–µ–Ω–∏–µ (markdown):

```
üîî *New Order*  #ID order_12345
User: @username (user_id)
Amount: 10 USDT ‚Üí 407 UAH
Network: TRC-20
Deposit: `TXYZabcd...`
Expires in: 28:34

[üü¢ Claim] [üîç View] [‚ö†Ô∏è Mark suspicious]
```

–ö–Ω–æ–ø–∫–∏ (inline callback data):

- `claim:order_12345` ‚Äî –±–µ–∫–µ–Ω–¥ —Å—Ç–∞–≤–∏—Ç lock (claim by operator_id), –±–æ—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ: ¬´üîµ Claimed by @op1¬ª.
- `view:order_12345` ‚Äî deep link –≤ –∞–¥–º–∏–Ω–∫—É –∏–ª–∏ popup —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
- `suspicious:order_12345` ‚Äî –ø–æ–º–µ—Ç–∫–∞, –ø–æ–≤—ã—à–∞–µ—Ç—Å—è priority.

2. **Payment detected (actionable / high)**
   –ï—Å–ª–∏ watcher –Ω–∞—Ö–æ–¥–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–∞ –∞–¥—Ä–µ—Å:

```
‚úÖ *Payment received* ‚Äî order_12345
Tx: TXHASH... (link)
Amount received: 10 USDT
Status: awaiting confirmation (3 / 20)
[‚úîÔ∏è Process] [‚ùå Dispute] [View]
```

–ö–Ω–æ–ø–∫–∏:

- `process` ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç atomic pay workflow.
- `dispute` ‚Äî –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ —Å–ø–µ—Ü-—Ç–æ–ø–∏–∫/ops.

3. **Cancelled (info or action)**

```
‚ùå *Order cancelled* ‚Äî order_12345
Reason: expired
Operator: system
```

–û–±—ã—á–Ω–æ –≤ info channel ‚Äî –Ω–æ –µ—Å–ª–∏ –æ—Ç–º–µ–Ω–∞ –ø–æ fraud ‚Üí actionable alert.

4. **Claim handling**

- –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Claim: backend –¥–µ–ª–∞–µ—Ç conditional lock (UPDATE orders SET claimed_by=op, claimed_at=now WHERE id=? AND claimed_by IS NULL) –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ë–æ—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ (editMessage) —Å –ø–æ–º–µ—Ç–∫–æ–π –∫—Ç–æ –≤–∑—è–ª. –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å ‚Äî –∏–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç.

---

# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram

- **Bot API**: –∏—Å–ø–æ–ª—å–∑—É–µ–º single bot per environment (staging/prod). –•—Ä–∞–Ω–∏–º token –≤ vault.
- **Send vs Edit**: –≤—Å–µ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–π `chat_id` + `message_id` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (orderId ‚Üí message_id). –ü—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞ ‚Äî `editMessageText`/`editMessageReplyMarkup`, –∞ –Ω–µ –Ω–æ–≤—ã–π send, –µ—Å–ª–∏ —ç—Ç–æ —Ç–æ—Ç –∂–µ –ø–æ—Ç–æ–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
- **CallbackQueries**: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã. Callback data –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä `action:orderId:nonce`), —Å–µ—Ä–≤–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ –æ—Ç–≤–µ—á–∞–µ—Ç `answerCallbackQuery`.
- **Webhooks**: –±–æ—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∞—Ç—å callback —á–µ—Ä–µ–∑ webhook –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å. –ù–µ –±–ª–æ–∫–∏—Ä—É–π –æ–±—Ä–∞–±–æ—Ç–∫—É ‚Äî –æ—Ç–≤–µ—á–∞–π Telegram –±—ã—Å—Ç—Ä–æ (`200`) –∏ –¥–∞–ª–µ–µ process job.
- **Rate limits**: Telegram limit ~30 messages/sec per bot (varies). –ò–º–µ–π throttle –≤ adapter. –ü—Ä–∏ –º–∞—Å—Å–æ–≤–æ–º —Å–æ–±—ã—Ç–∏–∏ ‚Äî –ø–µ—Ä–µ–≤–æ–¥–∏ –≤ batched digest.
- **Security**: –≤–∞–ª–∏–¥–∏—Ä—É–π callback-tokens ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–¥–ø–∏—Å—å/nonce –≤ callback data —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–¥–¥–µ–ª–∫–∏; –ø—Ä–æ–≤–µ—Ä—è–π –∫—Ç–æ –Ω–∞–∂–∞–ª (user_id) –∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–π —Å operator list.
- **Formatting**: parse_mode=MarkdownV2 –∏–ª–∏ HTML –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–∫—Å—Ç–∞, –∏–∑–±–µ–≥–∞–π –¥–ª–∏–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤.

---

# Operator assignment / lock pattern

1. Operator –Ω–∞–∂–∏–º–∞–µ—Ç Claim ‚Üí backend –ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å lock (atomic): `UPDATE orders SET claimed_by=?, claimed_at=NOW() WHERE id=? AND claimed_by IS NULL RETURNING *`
2. –ï—Å–ª–∏ success ‚Äî –±–æ—Ç edits message –≤ –≥—Ä—É–ø–ø–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç ¬´Claimed by @op¬ª. –°—Ç–∞–≤–∏–º TTL –Ω–∞ lock (–Ω–∞–ø—Ä–∏–º–µ—Ä 30 min) ‚Äî –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç, lock –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è (—á–µ—Ä–µ–∑ job).
3. –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ ‚Äî –æ–ø–µ—Ä–∞—Ç–æ—Ä –Ω–∞–∂–∏–º–∞–µ—Ç `Done` / `Cancel` ‚Äî backend —Å–æ–≤–µ—Ä—à–∞–µ—Ç final transition –∏ –±–æ—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç summary –≤ info-channel.

---

# –°–Ω–∏–∂–µ–Ω–∏–µ —à—É–º–∞: batching / digest

- –î–ª—è low priority: –∞–∫–∫—É–º—É–ª–∏—Ä—É–π —Å–æ–±—ã—Ç–∏—è per minute (–Ω–∞–ø—Ä–∏–º–µ—Ä `order.created` –¥–ª—è small amounts) –∏ —à–ª–∏ –æ–¥–Ω—É —Å–≤–æ–¥–∫—É:

  ```
  üìù Digest ‚Äî New orders (last 10m)
  12 new orders, total 120 USDT
  Top 5: order_..., order_...
  [View list]
  ```

- –î–ª—è high-volume periods ‚Äî –∞–∫—Ç–∏–≤–∏—Ä—É–π ¬´quiet mode¬ª –∏ –Ω–∞–ø—Ä–∞–≤–ª—è–π —Ç–æ–ª—å–∫–æ –∞–Ω–æ–º–∞–ª–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è.

---

# Monitoring, metrics, runbook

- –ú–µ—Ç—Ä–∏–∫–∏: messages_sent, message_failures, callback_rate, claim_conflicts, avg_latency_edit.
- –ê–ª–µ—Ä—Ç—ã: failed sends > threshold, DLQ growth, callback errors spike.
- Runbook: –µ—Å–ª–∏ –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π bot token / health endpoint, requeue critical messages (DLQ).

---

# –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö callback (—Ñ–æ—Ä–º–∞—Ç)

Callback data (compact JSON or encoded string):

```
{ "a":"claim", "o":"order_12345", "n":"nonce" }
```

Server validates `nonce` (HMAC of orderId + secret) ‚Üí prevents forged clicks.

---

# –ü—Ä–∏–º–µ—Ä—ã –±–∏–±–ª–∏–æ—Ç–µ–∫ / infra (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

- Bot SDK: `node-telegram-bot-api` (polling/webhook) –∏–ª–∏ `telegraf` (webhooks + middleware).
- –î–ª—è production: webhook + ingress (k8s) + TLS.
- Rate limiting: internal adapter (token bucket).

---

# –ò—Ç–æ–≥–æ–≤–∞—è –∫—Ä–∞—Ç–∫–∞—è —Ä–µ—Ü–µ–ø—Ç—É—Ä–∞

1. –°–æ–∑–¥–∞—Ç—å Notification Service –º–µ–∂–¥—É events –∏ telegram.
2. –†–∞–∑–¥–µ–ª–∏—Ç—å —á–∞—Ç—ã: Actionable vs Info vs Digest.
3. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å inline actions + claim lock –Ω–∞ –±–µ–∫–µ–Ω–¥–µ.
4. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞, –Ω–µ –ø—Ä–∏—Å—ã–ª–∞—Ç—å –Ω–æ–≤—ã–µ.
5. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å batching –¥–ª—è low priority.
6. –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å mapping order‚Üîmessage –∏ –≤—Å–µ callbacks (audit).
7. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å retries, DLQ, monitoring.

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –º–æ–≥—É:

- –ø—Ä–∏—Å–ª–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π + payload—ã (5‚Äì7 —Ç–∏–ø–æ–≤) –≤ –≤–∏–¥–µ JSON –∏ markdown;
- –∏–ª–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø—Å–µ–≤–¥–æ–∫–æ–¥ –Ω–∞ —Ç–≤–æ—ë–º —Å—Ç–µ–∫–µ (Node + Nest/Express + Redis + telegraf + Postgres) ‚Äî —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –≤–ª–∏—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç;
- –∏–ª–∏ –ø–æ–º–æ—á—å —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å admin UI/Topics –≤ —Ç–µ–ª–µ–≥—Ä–∞–º –≥—Ä—É–ø–ø–µ.

–ß—Ç–æ –∏–∑ —ç—Ç–æ–≥–æ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—à—å ‚Äî —à–∞–±–ª–æ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏–ª–∏ –ø—Å–µ–≤–¥–æ–∫–æ–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏?
