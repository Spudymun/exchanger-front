# BullMQ Testing Guide

## –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ—á–µ—Ä–µ–¥–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: Worker –≤—ã–∫–ª—é—á–µ–Ω - –∑–∞–¥–∞—á–∏ –∂–¥—É—Ç –≤ –æ—á–µ—Ä–µ–¥–∏

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–∞–¥–∞—á–∏ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –≤ Redis –∫–æ–≥–¥–∞ Worker –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–®–∞–≥–∏:**

1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å telegram-bot:

   ```bash
   # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–µ—Ä–µ–∑ Ctrl+C –∏–ª–∏:
   docker-compose stop telegram-bot
   ```

2. –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É —á–µ—Ä–µ–∑ web app (http://localhost:3000)
   - –ó–∞–¥–∞—á–∞ –¥–æ–±–∞–≤–∏—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å
   - –°—Ç–∞—Ç—É—Å –≤ Bull Board: `waiting`

3. –û—Ç–∫—Ä—ã—Ç—å Bull Board Dashboard (http://localhost:3010)
   - –í–∫–ª–∞–¥–∫–∞ "WAITING" - –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å –∑–∞–¥–∞—á—É
   - –°—á–µ—Ç—á–∏–∫ "WAITING" —É–≤–µ–ª–∏—á–∏—Ç—Å—è

4. –ó–∞–ø—É—Å—Ç–∏—Ç—å telegram-bot:

   ```bash
   npm run dev:telegram
   # –∏–ª–∏
   docker-compose start telegram-bot
   ```

5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Bull Board:
   - –ó–∞–¥–∞—á–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∏–∑ `waiting` ‚Üí `active` ‚Üí `completed`
   - Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

- ‚úÖ –ó–∞–¥–∞—á–∏ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –≤ Redis
- ‚úÖ –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ Worker –≤—Å–µ –∑–∞–¥–∞—á–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
- ‚úÖ –ü–æ—Ç–µ—Ä—å –Ω–µ—Ç

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: Retry –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ BullMQ –¥–µ–ª–∞–µ—Ç retry –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö

**–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ retry:**

```typescript
// packages/constants/src/queue-config.ts
RETRY: {
  MAX_ATTEMPTS: 5,
  BASE_DELAY_MS: 60000, // 1 minute
  BACKOFF_TYPE: 'exponential',
}
```

**–¢–∞–π–º–ª–∞–π–Ω retry:**

| –ü–æ–ø—ã—Ç–∫–∞  | –ó–∞–¥–µ—Ä–∂–∫–∞        | –í—Ä–µ–º—è –æ—Ç –Ω–∞—á–∞–ª–∞ |
| -------- | --------------- | --------------- |
| 1        | 0 —Å–µ–∫           | 0:00 (—Å—Ä–∞–∑—É)    |
| 2        | 60 —Å–µ–∫ (1 –º–∏–Ω)  | 1:00            |
| 3        | 120 —Å–µ–∫ (2 –º–∏–Ω) | 3:00            |
| 4        | 240 —Å–µ–∫ (4 –º–∏–Ω) | 7:00            |
| 5        | 480 —Å–µ–∫ (8 –º–∏–Ω) | 15:00           |
| ‚Üí FAILED | -               | **~15 –º–∏–Ω—É—Ç**   |

**–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ - —Å–ª–æ–º–∞—Ç—å Telegram API:**
–í—Ä–µ–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω–∏—Ç–µ –∫–æ–¥ Worker –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ –æ—à–∏–±–∫–∏:

```typescript
// apps/telegram-bot/src/workers/telegram-notification-worker.ts
private async sendNotification(data: TelegramNotificationPayload): Promise<void> {
  // üî• –í–†–ï–ú–ï–ù–ù–ê–Ø –≠–ú–£–õ–Ø–¶–ò–Ø –û–®–ò–ë–ö–ò –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø
  throw new Error('TEST: Simulated Telegram API failure');

  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å)
}
```

**–®–∞–≥–∏:**

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å telegram-bot —Å –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–º –∫–æ–¥–æ–º
2. –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É —á–µ—Ä–µ–∑ web app
3. –û—Ç–∫—Ä—ã—Ç—å Bull Board Dashboard (http://localhost:3010)
4. –ù–∞–±–ª—é–¥–∞—Ç—å –≤ –ª–æ–≥–∞—Ö telegram-bot:

   ```
   JOB_PROCESSING_START attempt: 1/5
   JOB_FAILED

   (–∂–¥–µ–º 1 –º–∏–Ω—É—Ç—É)

   JOB_PROCESSING_START attempt: 2/5
   JOB_FAILED

   (–∂–¥–µ–º 2 –º–∏–Ω—É—Ç—ã)

   JOB_PROCESSING_START attempt: 3/5
   JOB_FAILED

   ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ
   ```

5. –í Bull Board –Ω–∞–±–ª—é–¥–∞—Ç—å:
   - –í–∫–ª–∞–¥–∫–∞ "ACTIVE" - –∑–∞–¥–∞—á–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–µ
   - –°—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è
   - –ü–æ—Å–ª–µ 5 –ø–æ–ø—ã—Ç–∫–∏ ‚Üí –≤–∫–ª–∞–¥–∫–∞ "FAILED"

6. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ failed –∑–∞–¥–∞—á—É –≤ Bull Board:
   - Details ‚Üí Stacktrace - —É–≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É
   - Details ‚Üí Logs - –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö 5 –ø–æ–ø—ã—Ç–æ–∫
   - –ö–Ω–æ–ø–∫–∞ "Retry" - –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

- ‚úÖ 5 –ø–æ–ø—ã—Ç–æ–∫ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏: 1m ‚Üí 2m ‚Üí 4m ‚Üí 8m
- ‚úÖ –ü–æ—Å–ª–µ 5 –Ω–µ—É–¥–∞—á ‚Üí —Å—Ç–∞—Ç—É—Å `failed`
- ‚úÖ –õ–æ–≥–∏ –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ Bull Board
- ‚è±Ô∏è –û–±—â–µ–µ –≤—Ä–µ–º—è: ~15 –º–∏–Ω—É—Ç

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: Worker restart –≤–æ –≤—Ä–µ–º—è retry - persistence

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ BullMQ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ job'–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ Worker

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
–í production Worker –º–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å –∏–ª–∏ –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å restart. Job'—ã –Ω–µ –¥–æ–ª–∂–Ω—ã —Ç–µ—Ä—è—Ç—å—Å—è –∏–ª–∏ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å —Å—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫.

**–®–∞–≥–∏:**

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å telegram-bot —Å —Å–∏–º—É–ª—è—Ü–∏–µ–π –æ—à–∏–±–∫–∏:

   ```powershell
   $env:SIMULATE_TELEGRAM_ERROR="true"; npm run dev:telegram
   ```

2. –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É —á–µ—Ä–µ–∑ web app
3. –î–æ–∂–¥–∞—Ç—å—Å—è 2 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤ –ª–æ–≥–∞—Ö:

   ```
   JOB_PROCESSING_START attempt: 1/5
   JOB_FAILED

   (–∂–¥—ë–º 1 –º–∏–Ω—É—Ç—É)

   JOB_PROCESSING_START attempt: 2/5
   JOB_FAILED
   ```

4. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å telegram-bot (Ctrl+C)
5. –ó–∞–ø—É—Å—Ç–∏—Ç—å telegram-bot –ë–ï–ó —Å–∏–º—É–ª—è—Ü–∏–∏ –æ—à–∏–±–∫–∏:

   ```bash
   npm run dev:telegram
   ```

6. –î–æ–∂–¥–∞—Ç—å—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ job'–∞ (—á–µ—Ä–µ–∑ ~2 –º–∏–Ω—É—Ç—ã –∏–∑-–∑–∞ exponential backoff)
7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `attempt: 3` (–ù–ï —Å–±—Ä–æ—Å –Ω–∞ 1):
   ```json
   {
     "message": "JOB_PROCESSING_START",
     "attempt": 3,
     "maxAttempts": 5
   }
   ```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

- ‚úÖ Job –ù–ï –ø–æ—Ç–µ—Ä—è–Ω –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ Worker
- ‚úÖ –°—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ –ù–ï —Å–±—Ä–æ—à–µ–Ω (`attempt: 3`, –∞ –Ω–µ `1`)
- ‚úÖ Job —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω –Ω–∞ 3-–π –ø–æ–ø—ã—Ç–∫–µ
- ‚úÖ Exponential backoff —Å–æ–±–ª—é–¥—ë–Ω (–∑–∞–¥–µ—Ä–∂–∫–∞ ~2 –º–∏–Ω—É—Ç—ã –ø–µ—Ä–µ–¥ 3-–π –ø–æ–ø—ã—Ç–∫–æ–π)

**–ü–æ—á–µ–º—É –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π?**

BullMQ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **exponential backoff**:

- –ü–æ—Å–ª–µ 2-–π –Ω–µ—É–¥–∞—á–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏ ‚Üí job –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `delayed` –Ω–∞ 2 –º–∏–Ω—É—Ç—ã
- –î–∞–∂–µ –µ—Å–ª–∏ Worker –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª—Å—è —Ä–∞–Ω—å—à–µ - job –∂–¥—ë—Ç –∏—Å—Ç–µ—á–µ–Ω–∏—è backoff
- –≠—Ç–æ –ü–†–ê–í–ò–õ–¨–ù–û–ï –ø–æ–≤–µ–¥–µ–Ω–∏–µ - –∑–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞ Telegram API

**Best Practice:**

- Job –ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç crash Worker'–∞
- –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Redis
- Backoff –∑–∞—â–∏—â–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–µ API –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏
- –ü–æ—Å–ª–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã job –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç—Å—è

---

## –°—Ü–µ–Ω–∞—Ä–∏–π 3: Redis –æ—Ç–∫–ª—é—á–∏–ª—Å—è - reconnect

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ Redis

**–®–∞–≥–∏:**

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å telegram-bot + redis
2. –°–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞—è–≤–æ–∫ (—É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—é—Ç—Å—è)
3. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Redis:
   ```bash
   docker-compose stop redis
   ```
4. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É —á–µ—Ä–µ–∑ web app
   - Web app —É–ø–∞–¥–µ—Ç —Å –æ—à–∏–±–∫–æ–π "Cannot connect to Redis"
5. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ telegram-bot:
   - Worker –±—É–¥–µ—Ç –ø—ã—Ç–∞—Ç—å—Å—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
   - –°–æ–æ–±—â–µ–Ω–∏—è `ECONNREFUSED`
6. –ó–∞–ø—É—Å—Ç–∏—Ç—å Redis:
   ```bash
   docker-compose start redis
   ```
7. Worker –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è
8. –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É - –¥–æ–ª–∂–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å—Å—è

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

- ‚úÖ Worker –ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ Redis
- ‚úÖ –ü–æ—Å–ª–µ reconnect –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚ö†Ô∏è –ó–∞–¥–∞—á–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –≤–æ –≤—Ä–µ–º—è downtime Redis - –ø–æ—Ç–µ—Ä—è–Ω—ã (web app —É–ø–∞–¥–µ—Ç)

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ú–∞—Å—Å–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ - concurrency

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–¥–∞—á

**–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**

```typescript
WORKER: {
  CONCURRENCY: 3, // 3 –∑–∞–¥–∞—á–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
}
```

**–®–∞–≥–∏:**

1. –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á:

   ```bash
   # –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
   node scripts/load-test-orders.mjs
   ```

2. –û—Ç–∫—Ä—ã—Ç—å Bull Board (http://localhost:3010)
3. –ù–∞–±–ª—é–¥–∞—Ç—å:
   - –í–∫–ª–∞–¥–∫–∞ "ACTIVE" - –¥–æ 3 –∑–∞–¥–∞—á –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
   - –í–∫–ª–∞–¥–∫–∞ "WAITING" - –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∂–¥—É—Ç
   - –°—á–µ—Ç—á–∏–∫ "COMPLETED" —Ä–∞—Å—Ç–µ—Ç

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

- ‚úÖ –ú–∞–∫—Å–∏–º—É–º 3 –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- ‚úÖ Throughput: ~3-10 –∑–∞–¥–∞—á/—Å–µ–∫ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç Telegram API rate limits)

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Bull Board Dashboard

### URL: http://localhost:3010

### –°—Ç–∞—Ç—É—Å—ã –∑–∞–¥–∞—á:

| –°—Ç–∞—Ç—É—Å        | –ó–Ω–∞—á–µ–Ω–∏–µ                 | –î–µ–π—Å—Ç–≤–∏—è               |
| ------------- | ------------------------ | ---------------------- |
| **WAITING**   | –ñ–¥—É—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ Worker    | –ù–æ—Ä–º–∞ –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ     |
| **ACTIVE**    | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å–µ–π—á–∞—Å    | ‚â§ CONCURRENCY (3)      |
| **COMPLETED** | –£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω—ã        | Auto-cleanup —á–µ—Ä–µ–∑ 24—á |
| **FAILED**    | –£–ø–∞–ª–∏ –ø–æ—Å–ª–µ 5 retry      | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –∞–Ω–∞–ª–∏–∑–∞     |
| **DELAYED**   | –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è        |
| **PAUSED**    | –û—á–µ—Ä–µ–¥—å –Ω–∞ –ø–∞—É–∑–µ         | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è        |

### –ß—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å –≤ Bull Board:

1. **Dashboard –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞:**
   - –°—á–µ—Ç—á–∏–∫–∏ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
   - –ì—Ä–∞—Ñ–∏–∫ —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

2. **–í–∫–ª–∞–¥–∫–∞ WAITING:**
   - –ï—Å–ª–∏ –º–Ω–æ–≥–æ –∑–∞–¥–∞—á - —É–≤–µ–ª–∏—á–∏—Ç—å CONCURRENCY
   - –ï—Å–ª–∏ –≤–∏—Å—è—Ç –¥–æ–ª–≥–æ - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å Worker

3. **–í–∫–ª–∞–¥–∫–∞ FAILED:**
   - –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –∑–∞–¥–∞—á—É ‚Üí Details ‚Üí Logs
   - –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å stacktrace –æ—à–∏–±–∫–∏
   - –ö–Ω–æ–ø–∫–∞ "Retry" - –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é

4. **–í–∫–ª–∞–¥–∫–∞ COMPLETED:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å returnValue (—É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)
   - –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (processedOn - timestamp)

---

## –õ–æ–≥–∏ Worker

### –ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å:

- –¢–µ—Ä–º–∏–Ω–∞–ª —Å `npm run dev:telegram`
- –ò–ª–∏: `docker logs exchanger-telegram-bot -f`

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤:

```json
// –£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
{
  "level": "info",
  "timestamp": "2025-10-14T20:00:00.000Z",
  "message": "JOB_COMPLETED",
  "jobId": "8",
  "orderId": "order_123",
  "duration": 245
}

// Retry –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏
{
  "level": "error",
  "message": "JOB_FAILED",
  "jobId": "9",
  "attempt": 1,
  "maxAttempts": 5,
  "error": "Connection timeout"
}

// –û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞ (–ø–æ—Å–ª–µ 5 –ø–æ–ø—ã—Ç–æ–∫)
{
  "level": "error",
  "message": "JOB_FAILED",
  "jobId": "10",
  "attempt": 5,
  "maxAttempts": 5,
  "error": "Telegram API unavailable"
}
```

---

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Redis

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Redis –æ—á–µ—Ä–µ–¥—å –Ω–∞–ø—Ä—è–º—É—é:

```bash
docker exec exchanger-redis redis-cli -n 1 KEYS "bull:telegram-notifications:*"
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å waiting –∑–∞–¥–∞—á–∏:

```bash
docker exec exchanger-redis redis-cli -n 1 LRANGE "bull:telegram-notifications:wait" 0 -1
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å failed –∑–∞–¥–∞—á–∏:

```bash
docker exec exchanger-redis redis-cli -n 1 SMEMBERS "bull:telegram-notifications:failed"
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:

```bash
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª—é—á–µ–π –≤ –æ—á–µ—Ä–µ–¥–∏
docker exec exchanger-redis redis-cli -n 1 KEYS "bull:telegram-notifications:*" | wc -l

# –†–∞–∑–º–µ—Ä waiting –æ—á–µ—Ä–µ–¥–∏
docker exec exchanger-redis redis-cli -n 1 LLEN "bull:telegram-notifications:wait"
```

### –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ failed –∑–∞–¥–∞—á–∏ (–¥–ª—è —Ç–µ—Å—Ç–æ–≤):

```bash
docker exec exchanger-redis redis-cli -n 1 DEL "bull:telegram-notifications:failed"
```

---

## FAQ: –ü–æ–≤–µ–¥–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥–∏

### ‚ùì –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–æ —Å—á–µ—Ç—á–∏–∫–æ–º –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ Worker?

**–û—Ç–≤–µ—Ç:** –°—á–µ—Ç—á–∏–∫ **–ù–ï –°–ë–†–ê–°–´–í–ê–ï–¢–°–Ø**. BullMQ —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ job'–∞ –≤ Redis:

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ (`attemptsMade`)
- –ò—Å—Ç–æ—Ä–∏—è –æ—à–∏–±–æ–∫
- –°–ª–µ–¥—É—é—â–µ–µ –≤—Ä–µ–º—è retry (backoff)

**–ü—Ä–∏–º–µ—Ä –∏–∑ production:**

```
–ü–æ–ø—ã—Ç–∫–∞ 1: FAILED (Worker —Å –æ—à–∏–±–∫–æ–π)
–ü–æ–ø—ã—Ç–∫–∞ 2: FAILED (Worker —Å –æ—à–∏–±–∫–æ–π)
Worker restart
–ü–æ–ø—ã—Ç–∫–∞ 3: SUCCESS ‚úÖ (—Å—á—ë—Ç—á–∏–∫ –ø—Ä–æ–¥–æ–ª–∂–∏–ª—Å—è —Å 3)
```

---

### ‚ùì –ü–æ—á–µ–º—É job –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ restart Worker?

**–û—Ç–≤–µ—Ç:** –ò–∑-–∑–∞ **exponential backoff**. –ü–æ—Å–ª–µ –Ω–µ—É–¥–∞—á–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏ job –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `delayed`:

| –ü–æ—Å–ª–µ –ø–æ–ø—ã—Ç–∫–∏ | –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π |
| ------------- | ------------------------ |
| 1             | 1 –º–∏–Ω—É—Ç–∞                 |
| 2             | 2 –º–∏–Ω—É—Ç—ã                 |
| 3             | 4 –º–∏–Ω—É—Ç—ã                 |
| 4             | 8 –º–∏–Ω—É—Ç                  |

–î–∞–∂–µ –µ—Å–ª–∏ Worker –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª—Å—è **—Ä–∞–Ω—å—à–µ** –∏—Å—Ç–µ—á–µ–Ω–∏—è backoff - job **–∂–¥—ë—Ç** –ø–æ–ª–æ–∂–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è.

**–≠—Ç–æ –ü–†–ê–í–ò–õ–¨–ù–û** - –∑–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞ –≤–Ω–µ—à–Ω–∏—Ö API.

---

### ‚ùì –ß—Ç–æ –µ—Å–ª–∏ Worker —É–ø–∞–¥—ë—Ç –ù–ê–í–°–ï–ì–î–ê?

**–û—Ç–≤–µ—Ç:** Job –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ Redis –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `delayed` –∏–ª–∏ `waiting`. –í–∞—Ä–∏–∞–Ω—Ç—ã:

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ–≤—ã–π Worker instance** - –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç –≤—Å–µ pending jobs
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Bull Board** - —Ä—É—á–Ω–æ–π retry —á–µ—Ä–µ–∑ UI
3. **Automatic recovery** - –µ—Å–ª–∏ Worker –≤ Kubernetes/Docker —Å restart policy

**Job –ù–ò–ö–û–ì–î–ê –Ω–µ —Ç–µ—Ä—è–µ—Ç—Å—è** –ø–æ–∫–∞ Redis —Ä–∞–±–æ—Ç–∞–µ—Ç.

---

### ‚ùì –ú–æ–∂–Ω–æ –ª–∏ —Å–±—Ä–æ—Å–∏—Ç—å —Å—á—ë—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ä—É—á–Ω—É—é?

**–û—Ç–≤–µ—Ç:** –î–∞, —á–µ—Ä–µ–∑ Bull Board:

1. –û—Ç–∫—Ä—ã—Ç—å http://localhost:3010
2. –ù–∞–π—Ç–∏ failed job ‚Üí Details
3. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É **"Retry"**
4. Job –Ω–∞—á–Ω—ë—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É **—Å attempt: 1** (—Å–±—Ä–æ—à–µ–Ω–Ω—ã–π —Å—á—ë—Ç—á–∏–∫)

---

### ‚ùì –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç attempt: 3 –≤ –ª–æ–≥–∞—Ö –ø–æ—Å–ª–µ restart?

**–û—Ç–≤–µ—Ç:** –≠—Ç–æ –¢–†–ï–¢–¨–Ø –ø–æ–ø—ã—Ç–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ job'–∞:

- –ü–æ–ø—ã—Ç–∫–∞ 1: FAILED
- –ü–æ–ø—ã—Ç–∫–∞ 2: FAILED
- **Worker restart**
- –ü–æ–ø—ã—Ç–∫–∞ 3: SUCCESS ‚úÖ

–°—á—ë—Ç—á–∏–∫ –ù–ï —Å–±—Ä–æ—Å–∏–ª—Å—è - BullMQ –ø—Ä–æ–¥–æ–ª–∂–∏–ª —Å —Ç–æ–π –∂–µ –ø–æ–ø—ã—Ç–∫–∏.

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ó–∞–¥–∞—á–∏ –≤–∏—Å—è—Ç –≤ WAITING, Worker —Ä–∞–±–æ—Ç–∞–µ—Ç

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Worker –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π DB
docker logs exchanger-telegram-bot | grep "REDIS_DB"

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: db: 1
```

**–†–µ—à–µ–Ω–∏–µ:**

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `REDIS_DB_QUEUE=1` –≤ .env
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Worker

---

### –ü—Ä–æ–±–ª–µ–º–∞: –í—Å–µ –∑–∞–¥–∞—á–∏ –ø–∞–¥–∞—é—Ç –≤ FAILED —Å—Ä–∞–∑—É

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**

- –û—Ç–∫—Ä—ã—Ç—å Bull Board ‚Üí FAILED ‚Üí –ª—é–±–∞—è –∑–∞–¥–∞—á–∞ ‚Üí Details ‚Üí Stacktrace
- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—à–∏–±–∫—É

**–ß–∞—Å—Ç—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `TELEGRAM_BOT_TOKEN`
2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `TELEGRAM_CHAT_ID`
3. Telegram API rate limit (429 Too Many Requests)
4. TELEGRAM_BOT_URL –Ω–µ —É–∫–∞–∑–∞–Ω –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

---

### –ü—Ä–æ–±–ª–µ–º–∞: Worker –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:**

```bash
npm run dev:telegram
# –∏–ª–∏
docker logs exchanger-telegram-bot --tail 50
```

**–ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏:**

- `REDIS_URL is required` - –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
- `Cannot connect to Redis` - Redis –Ω–µ –∑–∞–ø—É—â–µ–Ω
- `Port 3003 already in use` - –¥—Ä—É–≥–æ–π –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–Ω—è–ª –ø–æ—Ä—Ç
- `WORKER_INIT_FAILED` - –ø—Ä–æ–±–ª–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

---

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ "Eviction policy is allkeys-lru"

**–ü—Ä–∏—á–∏–Ω–∞:**
Redis –Ω–∞—Å—Ç—Ä–æ–µ–Ω —É–¥–∞–ª—è—Ç—å –∫–ª—é—á–∏ –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ –ø–∞–º—è—Ç–∏, —á—Ç–æ –æ–ø–∞—Å–Ω–æ –¥–ª—è –æ—á–µ—Ä–µ–¥–µ–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

```bash
docker exec exchanger-redis redis-cli CONFIG GET maxmemory-policy
```

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å Redis –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∫–æ–Ω—Ñ–∏–≥–æ–º
docker-compose up -d --force-recreate redis

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
docker exec exchanger-redis redis-cli CONFIG GET maxmemory-policy
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: noeviction
```

---

## Best Practices –¥–ª—è Production

### 1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ —Ä–æ—Å—Ç FAILED –∑–∞–¥–∞—á
- –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å throughput (–∑–∞–¥–∞—á/–º–∏–Ω—É—Ç—É)
- –°–ª–µ–¥–∏—Ç—å –∑–∞ latency (–≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –≤ WAITING)

### 2. Retry —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:

- 5 –ø–æ–ø—ã—Ç–æ–∫ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ–µ–≤
- Exponential backoff –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç DDoS Telegram API
- ~15 –º–∏–Ω—É—Ç –Ω–∞ –≤—Å–µ retry - –ø—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- Failed –∑–∞–¥–∞—á–∏ —Ç—Ä–µ–±—É—é—Ç —Ä—É—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

### 3. Cleanup:

- **Completed**: 24 —á–∞—Å–∞ (–¥–ª—è –∞—É–¥–∏—Ç–∞)
- **Failed**: –ù–ï —É–¥–∞–ª—è—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–¥–ª—è debugging)
- –í—Ä—É—á–Ω—É—é —á–∏—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ Bull Board –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é

### 4. Scaling:

- –£–≤–µ–ª–∏—á–∏—Ç—å CONCURRENCY –ø—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏
- –î–æ–±–∞–≤–∏—Ç—å –≤—Ç–æ—Ä–æ–π Worker instance –ø—Ä–∏ >1000 –∑–∞–¥–∞—á/—á–∞—Å
- Rate limiting: 20 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω—É—Ç—É –≤ Telegram –≥—Ä—É–ø–ø—É

---

## –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞ end-to-end

```bash
# 1. –û—á–∏—Å—Ç–∏—Ç—å Redis –æ—á–µ—Ä–µ–¥—å
docker exec exchanger-redis redis-cli -n 1 DEL "bull:telegram-notifications:wait"
docker exec exchanger-redis redis-cli -n 1 DEL "bull:telegram-notifications:failed"
docker exec exchanger-redis redis-cli -n 1 DEL "bull:telegram-notifications:completed"

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å Bull Board
npm run dev:bull-board
# –û—Ç–∫—Ä—ã—Ç—å http://localhost:3010

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å Web App
npm run dev
# –û—Ç–∫—Ä—ã—Ç—å http://localhost:3000

# 4. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å telegram-bot
# (—á–µ—Ä–µ–∑ Ctrl+C –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)

# 5. –°–æ–∑–¥–∞—Ç—å 5 –∑–∞—è–≤–æ–∫ —á–µ—Ä–µ–∑ UI
# –ö–∞–∂–¥–∞—è —Å–æ–∑–¥–∞—Å—Ç –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥–∏

# 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Bull Board
# –û—Ç–∫—Ä—ã—Ç—å http://localhost:3010
# –í–∫–ª–∞–¥–∫–∞ WAITING - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 5 –∑–∞–¥–∞—á

# 7. –ó–∞–ø—É—Å—Ç–∏—Ç—å telegram-bot
npm run dev:telegram

# 8. –ù–∞–±–ª—é–¥–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ Bull Board
# WAITING ‚Üí ACTIVE (3 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ) ‚Üí COMPLETED

# 9. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram –≥—Ä—É–ø–ø—É
# –í—Å–µ 5 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–π—Ç–∏
```

# 7. –ó–∞–ø—É—Å—Ç–∏—Ç—å telegram-bot c —Å–∏–º—É–ª—è—Ü–∏–µ–π –æ—à–∏–±–∫–∏, –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ retry

$env:SIMULATE_TELEGRAM_ERROR="true"; npm run dev:telegram

# 8. –î–æ–∂–¥–∞—Ç—å—Å—è 2-3 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤ –ª–æ–≥–∞—Ö, –∑–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ë–ï–ó —Å–∏–º—É–ª—è—Ü–∏–∏

# Ctrl+C ‚Üí npm run dev:telegram

# Job –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Å —Ç–æ–π –∂–µ –ø–æ–ø—ã—Ç–∫–∏ (–Ω–µ —Å–±—Ä–æ—Å–∏—Ç—Å—è) –∏ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç—Å—è

## –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

| –ú–µ—Ç—Ä–∏–∫–∞             | –ù–æ—Ä–º–∞             | –¢—Ä–µ–≤–æ–≥–∞        |
| ------------------- | ----------------- | -------------- |
| WAITING count       | < 50              | > 100          |
| ACTIVE count        | ‚â§ 3 (concurrency) | > 3 (bug)      |
| FAILED count        | 0                 | > 10           |
| Avg processing time | < 500ms           | > 2s           |
| Jobs/minute         | 10-50             | < 5 (–ø—Ä–æ–±–ª–µ–º—ã) |
| Retry rate          | < 5%              | > 20%          |

---

## –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –°–∏–º–ø—Ç–æ–º: –ó–∞–¥–∞—á–∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Worker –∑–∞–ø—É—â–µ–Ω
docker ps | grep telegram-bot

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Redis –¥–æ—Å—Ç—É–ø–µ–Ω
docker exec exchanger-redis redis-cli ping

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Worker –∫ Redis
docker logs exchanger-telegram-bot | grep "WORKER_STARTED"

# 4. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥–∏
docker exec exchanger-redis redis-cli -n 1 LLEN "bull:telegram-notifications:wait"
```

### –°–∏–º–ø—Ç–æ–º: –í—ã—Å–æ–∫–∏–π FAILED rate

```bash
# 1. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏
docker logs exchanger-telegram-bot --tail 100 | grep "JOB_FAILED"

# 2. –û—Ç–∫—Ä—ã—Ç—å Bull Board
# http://localhost:3010 ‚Üí FAILED tab ‚Üí Details

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram API –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
curl https://api.telegram.org/bot<YOUR_TOKEN>/getMe
```

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [BullMQ Documentation](https://docs.bullmq.io/)
- [Bull Board GitHub](https://github.com/felixmosh/bull-board)
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [Redis Commands](https://redis.io/commands)
