# Task List: –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–æ–∫ –Ω–∞ –∫—Ä–∏–ø—Ç–æ–æ–±–º–µ–Ω

> **–ò—Å—Ç–æ—á–Ω–∏–∫:** `docs/analysis/PROJECT_ALIGNED_ORDERS_AC.md` + `docs/analysis/ARCHITECTURE_ANALYSIS_ORDER_SYSTEM.md`  
> **–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 15 —Å–µ–Ω—Ç—è–±—Ä—è 2025  
> **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** Next.js 15 + tRPC + Turborepo + Security-Enhanced Validation

---

## üèóÔ∏è Phase 0: Infrastructure Foundation (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ)

### 1. Database Persistence

> **–ü—Ä–æ–±–ª–µ–º–∞:** –°–µ–π—á–∞—Å –≤—Å–µ –∑–∞—è–≤–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ (–º–∞—Å—Å–∏–≤—ã), –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞ –¥–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è
> **–¶–µ–ª—å:** –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—É –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è production

- [ ] **1.1** –†–∞—Å—à–∏—Ä–∏—Ç—å Prisma schema –≤ `packages/session-management/` –¥–ª—è Order, Transaction —Ç–∞–±–ª–∏—Ü
  - _–î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª–∏ Order, Transaction –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º User, Session –≤ schema.prisma_
  - _–°–≤—è–∑–∞—Ç—å –∑–∞—è–≤–∫–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —á–µ—Ä–µ–∑ foreign keys_
  - _–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤, —Å—É–º–º, –∞–¥—Ä–µ—Å–æ–≤ –∫–æ—à–µ–ª—å–∫–æ–≤_

- [ ] **1.2** –°–æ–∑–¥–∞—Ç—å Repository –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –≤ `packages/exchange-core/src/repositories/`
  - _–°–æ–∑–¥–∞—Ç—å OrderRepositoryInterface, WalletRepositoryInterface –¥–ª—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏_
  - _–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Ç–æ–¥—ã create, findById, updateStatus, findByEmail_
  - _–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –¥–ª—è –±—É–¥—É—â–∏—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π_

- [ ] **1.3** –ó–∞–º–µ–Ω–∏—Ç—å mock data managers –Ω–∞ Prisma-based —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
  - _–ó–∞–º–µ–Ω–∏—Ç—å –º–∞—Å—Å–∏–≤—ã mockUsers, mockOrders –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ DB –∑–∞–ø—Ä–æ—Å—ã_
  - _–ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å orderManager.create(), userManager.findByEmail() —á–µ—Ä–µ–∑ Prisma_
  - _–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å API_

### 2. Wallet Pool Management Core

> **–ü—Ä–æ–±–ª–µ–º–∞:** –°–µ–π—á–∞—Å –∞–¥—Ä–µ—Å–∞ –∫–æ—à–µ–ª—å–∫–æ–≤ –≤—ã–±–∏—Ä–∞—é—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ –∏–∑ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã, –Ω–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—É–ª–æ–º
> **–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞–º–∏ —Å –æ—á–µ—Ä–µ–¥—è–º–∏ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –∑–∞–Ω—è—Ç–æ—Å—Ç–∏

- [ ] **2.1** –°–æ–∑–¥–∞—Ç—å `WalletPoolManager` –≤ `packages/exchange-core/src/services/`
  - _–ù–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—É–ª–æ–º –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω—ã—Ö –∞–¥—Ä–µ—Å–æ–≤_
  - _–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ—à–µ–ª—å–∫–æ–≤: —Å–≤–æ–±–æ–¥–µ–Ω/–∑–∞–Ω—è—Ç/–≤ —Ä–µ–∑–µ—Ä–≤–µ_
  - _–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º generateDepositAddress()_

- [ ] **2.2** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å FIFO –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è –∫–æ—à–µ–ª—å–∫–æ–≤ —Å Redis
  - _–û—á–µ—Ä–µ–¥—å "–ø–µ—Ä–≤—ã–π –≤–æ—à–µ–ª - –ø–µ—Ä–≤—ã–π –≤—ã—à–µ–ª" –¥–ª—è —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è_
  - _–•—Ä–∞–Ω–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥–∏ –≤ Redis –¥–ª—è persistence –º–µ–∂–¥—É —Ä–µ—Å—Ç–∞—Ä—Ç–∞–º–∏_
  - _–û—Ç–¥–µ–ª—å–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã (BTC, ETH, USDT)_

- [ ] **2.3** –°–æ–∑–¥–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–æ–≤ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞—è–≤–æ–∫
  - _–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ –≤ –ø—É–ª –ø—Ä–∏ COMPLETED/CANCELLED_
  - _–û—á–∏—Å—Ç–∫–∞ –∫–æ—à–µ–ª—å–∫–∞ –æ—Ç –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –∑–∞—è–≤–∫–µ_
  - _–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–Ω–æ–≥–æ –∫–æ—à–µ–ª—å–∫–∞ –≤ –∫–æ–Ω–µ—Ü FIFO –æ—á–µ—Ä–µ–¥–∏_

### 3. User Session Management Enhancement

> **–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞—è–≤–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–Ω–æ–Ω–∏–º–Ω–æ, –Ω–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ —á—Ç–æ —É –∑–∞—è–≤–∫–∏ –µ—Å—Ç—å –≤–ª–∞–¥–µ–ª–µ—Ü –¥–ª—è —Å–≤—è–∑–∏
> **–¶–µ–ª—å:** –û–±–µ—Å–ø–µ—á–∏—Ç—å –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–£–Æ –ø—Ä–∏–≤—è–∑–∫—É –∫–∞–∂–¥–æ–π –∑–∞—è–≤–∫–∏ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á–µ—Ä–µ–∑ —Å–µ—Å—Å–∏—é

- [ ] **3.1** –†–∞—Å—à–∏—Ä–∏—Ç—å `UserManagerFactory` –¥–ª—è flexible authentication
  - _–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã findOrCreateByEmail(), createSessionForEmail()_
  - _–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π/–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π/–∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã–π_
  - _–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ª–æ–≥–∏–∫–∏ –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏_

- [ ] **3.2** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å auto-registration logic –¥–ª—è –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
  - _–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏_
  - _–°–æ–∑–¥–∞–Ω–∏–µ User —Å —Ä–æ–ª—å—é USER, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è session_
  - _–ü—Ä–∏–≤—è–∑–∫–∞ –Ω–æ–≤–æ—Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ user –∫ –∑–∞—è–≤–∫–µ_

- [ ] **3.3** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å auto-login logic –¥–ª—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–µ–∑ —Å–µ—Å—Å–∏–∏
  - _–ü–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ user –ø–æ email_
  - _–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π session –¥–ª—è –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è_
  - _–ü—Ä–∏–≤—è–∑–∫–∞ –∑–∞—è–≤–∫–∏ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É user —á–µ—Ä–µ–∑ –Ω–æ–≤—É—é session_

- [ ] **3.4** –û–±–µ—Å–ø–µ—á–∏—Ç—å –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–£–Æ —Å–µ—Å—Å–∏—é –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞—è–≤–∫–∏
  - _–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è exchange.createOrder –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏/—Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏_
  - _–ì–∞—Ä–∞–Ω—Ç–∏—è —á—Ç–æ –∫–∞–∂–¥–∞—è Order –∏–º–µ–µ—Ç userId –∏ sessionId_
  - _–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–≤—è–∑–∞—Ç—å—Å—è —Å –∫–ª–∏–µ–Ω—Ç–æ–º —á–µ—Ä–µ–∑ email/—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è_

---

## üèóÔ∏è Phase 1: Core Business Logic Enhancement

### 4. Exchange Router Enhancement

> **–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ–∫—É—â–∏–π createOrder —Å–æ–∑–¥–∞–µ—Ç –∑–∞—è–≤–∫–∏ –±–µ–∑ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞–º–∏ –∏ —Å–µ—Å—Å–∏—è–º–∏
> **–¶–µ–ª—å:** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å wallet management –∏ user sessions –≤ –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏

- [ ] **4.1** –î–æ–ø–æ–ª–Ω–∏—Ç—å `apps/web/src/server/trpc/routers/exchange.ts`
  - _–†–∞—Å—à–∏—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π createOrder procedure –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–æ–π_
  - _–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å UserManagerFactory –∏ WalletPoolManager_
  - _–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ security-enhanced schemas_

- [ ] **4.2** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å conditional auto-registration/login –≤ `createOrder`
  - _–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email –≤ –Ω–∞—á–∞–ª–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã_
  - _–í—ã–∑–æ–≤ auto-registration –∏–ª–∏ auto-login –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞_
  - _–ü–æ–ª—É—á–µ–Ω–∏–µ userId –∏ sessionId –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –∑–∞—è–≤–∫–µ_

- [ ] **4.3** –î–æ–±–∞–≤–∏—Ç—å wallet allocation strategy –≤ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
  - _–ü–æ–ø—ã—Ç–∫–∞ –≤—ã–¥–µ–ª–∏—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–π –∫–æ—à–µ–ª–µ–∫ –∏–∑ –ø—É–ª–∞ —á–µ—Ä–µ–∑ WalletPoolManager_
  - _–ü—Ä–∏–≤—è–∑–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –∫ –∑–∞—è–≤–∫–µ_
  - _–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ—à–µ–ª—å–∫–∞ –Ω–∞ "–∑–∞–Ω—è—Ç"_

- [ ] **4.4** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å queue mechanism –¥–ª—è –∑–∞—è–≤–æ–∫ –±–µ–∑ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤
  - _–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º PENDING –∏ —Ñ–ª–∞–≥–æ–º inQueue: true_
  - _–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ –≤ –æ—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞–Ω–∏—è —á–µ—Ä–µ–∑ walletQueueManager_
  - _–í–æ–∑–≤—Ä–∞—Ç response —Å –ø–æ–∑–∏—Ü–∏–µ–π –≤ –æ—á–µ—Ä–µ–¥–∏_

### 5. Operator Router Enhancement

> **–ü—Ä–æ–±–ª–µ–º–∞:** –û–ø–µ—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å—ã, –Ω–æ –∫–æ—à–µ–ª—å–∫–∏ –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è, –Ω–µ—Ç tracking –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π
> **–¶–µ–ª—å:** –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∑–∞—è–≤–æ–∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º

- [ ] **5.1** –†–∞—Å—à–∏—Ä–∏—Ç—å `apps/web/src/server/trpc/routers/operator.ts`
  - _–î–æ–ø–æ–ª–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ takeOrder –∏ updateOrderStatus procedures_
  - _–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ procedures –¥–ª—è operator workflow_
  - _–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ operatorOnly middleware_

- [ ] **5.2** –î–æ–±–∞–≤–∏—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–æ–≤ –≤ `updateOrderStatus`
  - _–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ COMPLETED/CANCELLED - –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –∫–æ—à–µ–ª–µ–∫_
  - _–í—ã–∑–æ–≤ walletPoolManager.releaseWallet() –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –ø—É–ª_
  - _–¢—Ä–∏–≥–≥–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏ –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ—Å–ª–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è_

- [ ] **5.3** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å operator assignment tracking
  - _–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ operatorId –ø—Ä–∏ takeOrder –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö_
  - _–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫—Ç–æ –∏ –∫–æ–≥–¥–∞ –≤–∑—è–ª –∑–∞—è–≤–∫—É –≤ —Ä–∞–±–æ—Ç—É_
  - _–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–∏–¥–µ—Ç—å "–º–æ–∏ –∑–∞—è–≤–∫–∏" —É –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞_

- [ ] **5.4** –î–æ–±–∞–≤–∏—Ç—å concurrent access protection –¥–ª—è `takeOrder`
  - _–ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –∑–∞—è–≤–∫–∞ –µ—â–µ –Ω–µ –≤–∑—è—Ç–∞ –¥—Ä—É–≥–∏–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º_
  - _Database locking –∏–ª–∏ optimistic concurrency control_
  - _–í–æ–∑–≤—Ä–∞—Ç –æ—à–∏–±–∫–∏ –µ—Å–ª–∏ –∑–∞—è–≤–∫–∞ —É–∂–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞_

### 6. Wallet Queue Management

> **–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–≥–¥–∞ –≤—Å–µ –∫–æ—à–µ–ª—å–∫–∏ –∑–∞–Ω—è—Ç—ã, –Ω–æ–≤—ã–µ –∑–∞—è–≤–∫–∏ –¥–æ–ª–∂–Ω—ã –æ–∂–∏–¥–∞—Ç—å –≤ –æ—á–µ—Ä–µ–¥–∏
> **–¶–µ–ª—å:** –°–∏—Å—Ç–µ–º–∞ FIFO –æ—á–µ—Ä–µ–¥–µ–π –¥–ª—è —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Å–≤–æ–±–æ–∂–¥–∞—é—â–∏—Ö—Å—è –∫–æ—à–µ–ª—å–∫–æ–≤

- [ ] **6.1** –°–æ–∑–¥–∞—Ç—å `walletQueueManager` –¥–ª—è FIFO –æ—á–µ—Ä–µ–¥–∏ –æ–∂–∏–¥–∞–Ω–∏—è
  - _–û—Ç–¥–µ–ª—å–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã (BTC, ETH, USDT)_
  - _–•—Ä–∞–Ω–µ–Ω–∏–µ –≤ Redis –¥–ª—è persistence –∏ distributed access_
  - _–ú–µ—Ç–æ–¥—ã addToQueue(), getNextInQueue(), removeFromQueue()_

- [ ] **6.2** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å background –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏
  - _–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–≥–¥–∞ –∫–æ—à–µ–ª–µ–∫ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è_
  - _–í—ã–±–æ—Ä —Å–∞–º–æ–π —Å—Ç–∞—Ä–æ–π –∑–∞—è–≤–∫–∏ –∏–∑ –æ—á–µ—Ä–µ–¥–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –≤–∞–ª—é—Ç—ã_
  - _–ü—Ä–∏–≤—è–∑–∫–∞ –∫–æ—à–µ–ª—å–∫–∞ –∫ –∑–∞—è–≤–∫–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è_

- [ ] **6.3** –î–æ–±–∞–≤–∏—Ç—å monitoring –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –≤ `shared.ts` —Ä–æ—É—Ç–µ—Ä
  - _getWalletPoolStats procedure –¥–ª—è operatorAndSupport_
  - _–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö/–∑–∞–Ω—è—Ç—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤ –ø–æ –≤–∞–ª—é—Ç–∞–º_
  - _–†–∞–∑–º–µ—Ä—ã –æ—á–µ—Ä–µ–¥–µ–π –æ–∂–∏–¥–∞–Ω–∏—è –∏ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è_

- [ ] **6.4** –°–æ–∑–¥–∞—Ç—å –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º —É–º–µ–Ω—å—à–µ–Ω–∏–∏ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤
  - _–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–æ–≥–¥–∞ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤ < 10%_
  - _–û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Telegram/email –∞–¥–º–∏–Ω–∞–º/–æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º_
  - _–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–ø–æ–ª–Ω–∏—Ç—å –ø—É–ª –∫–æ—à–µ–ª—å–∫–æ–≤_

---

## üèóÔ∏è Phase 2: External Integrations

### 7. Email Service Package

> **–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ —Å—Ç–∞—Ç—É—Å–µ –∑–∞—è–≤–æ–∫
> **–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å email —Å–µ—Ä–≤–∏—Å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ –æ–±—Ä–∞–∑—Ü—É session-management

- [ ] **7.1** –°–æ–∑–¥–∞—Ç—å `packages/email-service/` –ø–æ –æ–±—Ä–∞–∑—Ü—É session-management
  - _–ù–æ–≤—ã–π –ø–∞–∫–µ—Ç –≤ –º–æ–Ω–æ—Ä–µ–ø–æ —Å –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π_
  - _–ü–∞–ø–∫–∏ src/providers/, src/factories/, src/interfaces/_
  - _TypeScript –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ package.json setup_

- [ ] **7.2** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Provider Pattern —Å environment-based switching
  - _EmailProviderInterface –¥–ª—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏_
  - _MockEmailProvider –¥–ª—è development_
  - _ProductionEmailProvider –¥–ª—è real services_

- [ ] **7.3** –°–æ–∑–¥–∞—Ç—å EmailProviderFactory –¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (Resend, Gmail SMTP)
  - _Factory –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ environment variables_
  - _–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Resend API (3000 emails/month –±–µ—Å–ø–ª–∞—Ç–Ω–æ)_
  - _Fallback –Ω–∞ Gmail SMTP —á–µ—Ä–µ–∑ Nodemailer_

- [ ] **7.4** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É —á–µ—Ä–µ–∑ background queue
  - _Bull Queue –∏–ª–∏ –∞–Ω–∞–ª–æ–≥ –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏_
  - _Retry –ª–æ–≥–∏–∫–∞ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º backoff_
  - _Tracking —Å—Ç–∞—Ç—É—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –æ—à–∏–±–æ–∫_

### 8. Email Notifications Integration

> **–ü—Ä–æ–±–ª–µ–º–∞:** –ö–ª–∏–µ–Ω—Ç—ã –Ω–µ –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –∑–∞—è–≤–æ–∫ –∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫–æ—à–µ–ª—å–∫–æ–≤
> **–¶–µ–ª—å:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞ –∫–ª—é—á–µ–≤—ã—Ö —ç—Ç–∞–ø–∞—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–∫–∏

- [ ] **8.1** –î–æ–ø–æ–ª–Ω–∏—Ç—å `exchange.createOrder` –æ—Ç–ø—Ä–∞–≤–∫–æ–π email –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
  - _–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è EmailService –≤ procedure –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ email_
  - _–®–∞–±–ª–æ–Ω —Å –¥–µ—Ç–∞–ª—è–º–∏ –∑–∞—è–≤–∫–∏, —Å—É–º–º–æ–π, –∞–¥—Ä–µ—Å–æ–º –∫–æ—à–µ–ª—å–∫–∞_
  - _–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å response_

- [ ] **8.2** –î–æ–±–∞–≤–∏—Ç—å email –ø—Ä–∏ –≤—ã–¥–µ–ª–µ–Ω–∏–∏ –∫–æ—à–µ–ª—å–∫–∞ –¥–ª—è –∑–∞—è–≤–æ–∫ –∏–∑ –æ—á–µ—Ä–µ–¥–∏
  - _–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–æ–≥–¥–∞ –∑–∞—è–≤–∫–∞ –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –ø–æ–ª—É—á–∞–µ—Ç –∫–æ—à–µ–ª–µ–∫_
  - _–û—Ç–¥–µ–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω "–í–∞—à –∞–¥—Ä–µ—Å –≥–æ—Ç–æ–≤"_
  - _–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ background –ø—Ä–æ—Ü–µ—Å—Å–µ queue management_

- [ ] **8.3** –°–æ–∑–¥–∞—Ç—å email templates –≤ `packages/constants/`
  - _–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ HTML/text —à–∞–±–ª–æ–Ω—ã –ø–∏—Å–µ–º_
  - _ORDER_CREATED_TEMPLATE, WALLET_READY_TEMPLATE_
  - _–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö: –∏–º—è, —Å—É–º–º–∞, –∞–¥—Ä–µ—Å, —Å—Ç–∞—Ç—É—Å_

- [ ] **8.4** –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ—Å—Ç–∞–≤–∫–∏ email –≤ `shared.ts`
  - _–ù–æ–≤—ã–µ procedures –¥–ª—è tracking –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö emails_
  - _–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ delivery rate, bounce rate, errors_
  - _–ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π_

### 9. Telegram Bot Application

> **–ü—Ä–æ–±–ª–µ–º–∞:** –û–ø–µ—Ä–∞—Ç–æ—Ä—ã –Ω–µ –ø–æ–ª—É—á–∞—é—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∑–∞—è–≤–∫–∞—Ö
> **–¶–µ–ª—å:** Telegram bot –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –∏ –±—ã—Å—Ç—Ä–æ–≥–æ –≤–∑—è—Ç–∏—è –∑–∞—è–≤–æ–∫ –≤ —Ä–∞–±–æ—Ç—É

- [ ] **9.1** –°–æ–∑–¥–∞—Ç—å `/apps/telegram-bot/` –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –º–æ–Ω–æ—Ä–µ–ø–æ
  - _–ù–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ apps/ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ web/admin-panel_
  - _Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å Telegram Bot API_
  - _Package.json –∏ TypeScript –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è_

- [ ] **9.2** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å tRPC client –¥–ª—è —Å–≤—è–∑–∏ —Å –æ—Å–Ω–æ–≤–Ω—ã–º API
  - _Import type { AppRouter } –∏–∑ @repo/web_
  - _createTRPCClient –¥–ª—è –≤—ã–∑–æ–≤–∞ operator procedures_
  - _–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è bot –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ API keys_

- [ ] **9.3** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∑–∞—è–≤–∫–∞—Ö
  - _–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ exchange.createOrder –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram_
  - _–°–æ–æ–±—â–µ–Ω–∏—è —Å –¥–µ—Ç–∞–ª—è–º–∏ –∑–∞—è–≤–∫–∏ –∏ inline –∫–Ω–æ–ø–∫–∞–º–∏_
  - _–†–∞–∑–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è immediate –∏ queued –∑–∞—è–≤–æ–∫_

- [ ] **9.4** –°–æ–∑–¥–∞—Ç—å Telegram callback procedures –≤ `operator.ts`
  - _operator.claimOrderFromTelegram procedure_
  - _–í–∞–ª–∏–¥–∞—Ü–∏—è —á—Ç–æ –∑–∞—è–≤–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –≤–∑—è—Ç–∏—è_
  - _–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Telegram —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ claim_

---

## üèóÔ∏è Phase 3: Production Operations

### 10. Enhanced Logging and Audit

> **–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏, –Ω–µ—Ç –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –º–µ–∂–¥—É —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏
> **–¶–µ–ª—å:** –†–∞—Å—à–∏—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Logger –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ audit trail –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏

- [ ] **10.1** –î–æ–±–∞–≤–∏—Ç—å Correlation ID –≤ centralized Logger
  - _–†–∞—Å—à–∏—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Logger –≤ packages/utils/src/logger.ts_
  - _–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID –¥–ª—è –∫–∞–∂–¥–æ–π operation (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏, —Å–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞)_
  - _–ü–µ—Ä–µ–¥–∞—á–∞ correlation ID —á–µ—Ä–µ–∑ –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è_

- [ ] **10.2** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å centralized log storage
  - _–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ELK stack –∏–ª–∏ —Ñ–∞–π–ª–æ–≤—ã–º —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º_
  - _Structured JSON –ª–æ–≥–∏ –¥–ª—è easy parsing_
  - _Retention policy –∏ rotation –¥–ª—è log files_

- [ ] **10.3** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å audit trail –¥–ª—è operator procedures
  - _–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤: takeOrder, updateOrderStatus_
  - _–ó–∞–ø–∏—Å—å: –∫—Ç–æ, —á—Ç–æ, –∫–æ–≥–¥–∞, —Å –∫–∞–∫–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏_
  - _–ù–µ–∏–∑–º–µ–Ω—è–µ–º—ã–π audit log –¥–ª—è compliance_

- [ ] **10.4** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å structured logging –≤–æ –≤—Å–µ –Ω–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã
  - _WalletPoolManager, EmailService, QueueManager –ª–æ–≥–∏—Ä—É—é—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏_
  - _Consistent log format –∏ metadata_
  - _Integration —Å existing error handling_

### 11. Monitoring and Metrics

> **–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç visibility –≤ —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã, —Å–ª–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å bottlenecks –∏ –ø—Ä–æ–±–ª–µ–º—ã
> **–¶–µ–ª—å:** Comprehensive monitoring –¥–ª—è production –æ–ø–µ—Ä–∞—Ü–∏–π –∏ business intelligence

- [ ] **11.1** –†–∞—Å—à–∏—Ä–∏—Ç—å `shared.getOrdersStatistics` –Ω–æ–≤—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
  - _–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏: –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–æ–∫, load –ø–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º_
  - _Conversion rate, average processing time, error rates_
  - _Breakdown –ø–æ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞–º, —Å—É–º–º–∞–º, –≤—Ä–µ–º–µ–Ω–∏ –¥–Ω—è_

- [ ] **11.2** –î–æ–±–∞–≤–∏—Ç—å wallet pool stats procedures
  - _getWalletPoolStats –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —É—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –∫–æ—à–µ–ª—å–∫–æ–≤_
  - _–ê–ª–µ—Ä—Ç—ã –∫–æ–≥–¥–∞ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤ < threshold_
  - _Prediction –∫–æ–≥–¥–∞ –∫–æ—à–µ–ª—å–∫–∏ –∑–∞–∫–æ–Ω—á–∞—Ç—Å—è –ø—Ä–∏ —Ç–µ–∫—É—â–µ–º rate_

- [ ] **11.3** –°–æ–∑–¥–∞—Ç—å alerting system —á–µ—Ä–µ–∑ Telegram/email
  - _–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ high error rate, –¥–æ–ª–≥–∏—Ö –æ—á–µ—Ä–µ–¥—è—Ö_
  - _Escalation rules: warning ‚Üí critical ‚Üí emergency_
  - _Integration —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ notification channels_

- [ ] **11.4** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ tRPC procedures
  - _Response time tracking –¥–ª—è –∫–∞–∂–¥–æ–≥–æ procedure_
  - _Rate limiting violations, timeout errors_
  - _Performance degradation detection_

### 12. Security Enhancements

> **–ü—Ä–æ–±–ª–µ–º–∞:** Current security measures –Ω–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã –¥–ª—è production environment
> **–¶–µ–ª—å:** Enterprise-grade security –¥–ª—è –∑–∞—â–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –±–∏–∑–Ω–µ—Å–∞

- [ ] **12.1** –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å rate limiting –Ω–∞ Redis-based
  - _–ó–∞–º–µ–Ω–∏—Ç—å in-memory rate limiting –Ω–∞ distributed Redis solution_
  - _Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç across multiple server instances_
  - _Configurable limits –¥–ª—è —Ä–∞–∑–Ω—ã—Ö endpoints –∏ user roles_

- [ ] **12.2** –î–æ–±–∞–≤–∏—Ç—å API Keys –¥–ª—è –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
  - _Secure authentication –¥–ª—è Telegram bot, email service_
  - _API key rotation –∏ management_
  - _Different permission levels –¥–ª—è different services_

- [ ] **12.3** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å encryption –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  - _Encrypt email addresses, recipient info –≤ database_
  - _Key management —á–µ—Ä–µ–∑ environment variables_
  - _Encryption at rest –∏ in transit_

- [ ] **12.4** –î–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É Telegram webhook signatures
  - _Verify incoming webhooks –ø–æ–¥–ø–∏—Å–∞–Ω—ã Telegram_
  - _Prevent spoofed webhook calls_
  - _Rate limiting –¥–ª—è webhook endpoints_

---

## üèóÔ∏è Phase 4: Advanced Features

### 13. Operator Dashboard Features

> **–ü—Ä–æ–±–ª–µ–º–∞:** –û–ø–µ—Ä–∞—Ç–æ—Ä—ã –Ω–µ –∏–º–µ—é—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ dashboard –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–≤–æ–∏–º–∏ –∑–∞—è–≤–∫–∞–º–∏
> **–¶–µ–ª—å:** Advanced operator tools –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –∑–∞—è–≤–∫–∞–º–∏

- [ ] **13.1** –°–æ–∑–¥–∞—Ç—å `operator.getAssignedOrders` procedure
  - _–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞—è–≤–æ–∫ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –æ–ø–µ—Ä–∞—Ç–æ—Ä—É_
  - _–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º, –¥–∞—Ç–∞–º, —Å—É–º–º–∞–º_
  - _Pagination –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –∑–∞—è–≤–æ–∫_

- [ ] **13.2** –î–æ–±–∞–≤–∏—Ç—å `operator.getWorkloadStats` –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
  - _–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞: processed orders, avg time_
  - _–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ (anonymized)_
  - _Performance metrics –∏ KPIs_

- [ ] **13.3** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `operator.escalateToSupport` —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
  - _–≠—Å–∫–∞–ª–∞—Ü–∏—è —Å–ª–æ–∂–Ω—ã—Ö cases –Ω–∞ support team_
  - _–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞_
  - _Automatic notification support team_

- [ ] **13.4** –î–æ–±–∞–≤–∏—Ç—å timeout mechanism –¥–ª—è operator assignments
  - _–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫ –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç_
  - _Configurable timeout periods –ø–æ —Ç–∏–ø–∞–º –∑–∞—è–≤–æ–∫_
  - _Re-assignment –≤ –æ–±—â–∏–π pool –ø–æ—Å–ª–µ timeout_

### 14. Advanced Queue Management

> **–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–æ—Å—Ç–∞—è FIFO –æ—á–µ—Ä–µ–¥—å –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –¥–ª—è –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤
> **–¶–µ–ª—å:** Intelligent queue management –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è customer experience

- [ ] **14.1** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å priority queue –¥–ª—è VIP –∫–ª–∏–µ–Ω—Ç–æ–≤
  - _Multiple priority levels: normal, priority, VIP_
  - _VIP –∫–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –∫–æ—à–µ–ª—å–∫–∏ –≤–Ω–µ –æ—á–µ—Ä–µ–¥–∏_
  - _Configurable rules –∫—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è VIP (—Å—É–º–º–∞, history)_

- [ ] **14.2** –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫
  - _Rebalancing –∑–∞—è–≤–æ–∫ –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ based on workload_
  - _Automatic reassignment –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä overloaded_
  - _Load balancing algorithm –¥–ª—è fair distribution_

- [ ] **14.3** –°–æ–∑–¥–∞—Ç—å queue analytics –∏ reporting
  - _Detailed analytics: wait times, abandonment rate_
  - _Peak time analysis, capacity planning_
  - _Reports –¥–ª—è business intelligence_

- [ ] **14.4** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å queue cleanup mechanisms
  - _–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ abandoned –∑–∞—è–≤–æ–∫_
  - _Cleanup expired –∑–∞—è–≤–æ–∫ –∏–∑ –æ—á–µ—Ä–µ–¥–µ–π_
  - _Archive mechanism –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö_

### 15. Performance Optimization

> **–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ —Ä–æ—Å—Ç–µ –æ–±—ä–µ–º–æ–≤ –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
> **–¶–µ–ª—å:** –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∫ –≤—ã—Å–æ–∫–∏–º –Ω–∞–≥—Ä—É–∑–∫–∞–º –∏ –±–æ–ª—å—à–∏–º –æ–±—ä–µ–º–∞–º –¥–∞–Ω–Ω—ã—Ö

- [ ] **15.1** –î–æ–±–∞–≤–∏—Ç—å caching –¥–ª—è wallet pool data
  - _Redis caching –¥–ª—è frequently accessed wallet data_
  - _Cache invalidation strategy –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö_
  - _Reduced database load –¥–ª—è wallet operations_

- [ ] **15.2** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å database queries —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
  - _Database indexes –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –ø–æ–ª–µ–π_
  - _Query optimization –¥–ª—è order searches_
  - _Composite indexes –¥–ª—è complex queries_

- [ ] **15.3** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å pagination –¥–ª—è –±–æ–ª—å—à–∏—Ö datasets
  - _Cursor-based pagination –¥–ª—è order lists_
  - _Efficient pagination –¥–ª—è operator dashboards_
  - _Lazy loading –¥–ª—è UI components_

- [ ] **15.4** –î–æ–±–∞–≤–∏—Ç—å connection pooling –¥–ª—è external services
  - _Database connection pooling –¥–ª—è better resource usage_
  - _HTTP connection pooling –¥–ª—è email/telegram APIs_
  - _Resource optimization under high load_

---

## üéØ Integration Guidelines

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:

- –í—Å–µ –Ω–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã ‚Üí `packages/constants/`
- –í—Å–µ utility functions ‚Üí `packages/utils/`
- –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ ‚Üí `packages/exchange-core/`
- UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã ‚Üí `packages/ui/`

### tRPC Integration:

- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ existing —Ä–æ—É—Ç–µ—Ä–æ–≤ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ appropriate middleware (`operatorOnly`, `supportOnly`)
- –°–ª–µ–¥–æ–≤–∞–Ω–∏–µ existing naming conventions
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ security-enhanced schemas

### Error Handling:

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ centralized error creators –∏–∑ `@repo/utils`
- Consistent error messages —á–µ—Ä–µ–∑ internationalization
- Proper tRPC error codes
- Integration —Å existing audit logging

---

## üìä Priority Mapping

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ü–£–¢–¨ (Phase 0-1):**

- Database persistence ‚Üê –ë–µ–∑ —ç—Ç–æ–≥–æ –¥–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è
- User session management ‚Üê –ö–∞–∂–¥–∞—è –∑–∞—è–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞
- Wallet pool management ‚Üê Core business logic
- Operator enhancements ‚Üê Workflow completion

**–í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (Phase 2):**

- Email notifications ‚Üê Customer communication
- Basic monitoring ‚Üê Production readiness
- Enhanced security ‚Üê Data protection

**–°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (Phase 3-4):**

- Telegram bot ‚Üê Operator convenience
- Advanced features ‚Üê Business optimization
- Performance tuning ‚Üê Scale preparation

---

## ‚úÖ Definition of Done

–ö–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –ø—Ä–∏ —Å–æ–±–ª—é–¥–µ–Ω–∏–∏:

1. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:**
   - –ö–æ–¥ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω –±–µ–∑ –æ—à–∏–±–æ–∫
   - –ù–µ—Ç TypeScript/ESLint –æ—à–∏–±–æ–∫
   - –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å)

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
   - –ù–æ–≤—ã–π –∫–æ–¥ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   - –°—Ç–∞—Ä—ã–π –∫–æ–¥ –∑–∞–º–µ–Ω–µ–Ω –≥–¥–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
   - –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

3. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
   - –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ runtime
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
   - –ò—Å—Ö–æ–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞

4. **–ö–∞—á–µ—Å—Ç–≤–æ:**
   - –°–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º patterns
   - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–µ –Ω–∞—Ä—É—à–µ–Ω–∞
   - –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
