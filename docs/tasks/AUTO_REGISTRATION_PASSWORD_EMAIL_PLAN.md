# –ü–ª–∞–Ω: –û—Ç–ø—Ä–∞–≤–∫–∞ email —Å –ø–∞—Ä–æ–ª–µ–º –ø—Ä–∏ –∞–≤—Ç–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 18 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å**: üü° –í –ü–õ–ê–ù–ò–†–û–í–ê–ù–ò–ò  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã](#–ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞-–ø—Ä–æ–±–ª–µ–º—ã)
2. [–ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#–∞–Ω–∞–ª–∏–∑-—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
3. [–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ñ–ª–æ—É —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏](#–¥–µ—Ç–∞–ª—å–Ω—ã–π-–∞–Ω–∞–ª–∏–∑-—Ñ–ª–æ—É-—Å–æ–∑–¥–∞–Ω–∏—è-–∑–∞—è–≤–∫–∏)
4. [–ê–Ω–∞–ª–∏–∑ —Ñ–ª–æ—É –∞–≤—Ç–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏](#–∞–Ω–∞–ª–∏–∑-—Ñ–ª–æ—É-–∞–≤—Ç–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
5. [–ê–Ω–∞–ª–∏–∑ email-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã](#–∞–Ω–∞–ª–∏–∑-email-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã)
6. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ-—Ä–µ—à–µ–Ω–∏–µ)
7. [–ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#–ø–ª–∞–Ω-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
8. [–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏](#–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ-—Ç–æ—á–∫–∏)
9. [–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ AI Agent Rules](#—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ-ai-agent-rules)

---

## üî¥ –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –±–∏–∑–Ω–µ—Å-–ø—Ä–æ–±–ª–µ–º–∞

**–°–∏–º–ø—Ç–æ–º**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –∞–≤—Ç–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ (–±–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —Ñ–ª–æ—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏), –Ω–µ –∑–Ω–∞—é—Ç —Å–≤–æ–π –ø–∞—Ä–æ–ª—å –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏.

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –º–æ–∂–µ—Ç –æ—Ç—Å–ª–µ–¥–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–≤–æ–µ–π –∑–∞—è–≤–∫–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–∞–∫–∞–∑–æ–≤
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π UX –æ–ø—ã—Ç

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø - –≤–ª–∏—è–µ—Ç –Ω–∞ core —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∞

---

## üèóÔ∏è –ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ (–∏–∑ PROJECT_STRUCTURE_MAP.md)

```
üì¶ –ú–æ–Ω–æ—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π exchanger-front
‚îú‚îÄ‚îÄ üìÅ apps/
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ web/ - Next.js 15, tRPC, i18n
‚îÇ       ‚îî‚îÄ‚îÄ üìÅ src/server/trpc/routers/
‚îÇ           ‚îî‚îÄ‚îÄ exchange.ts - –°–û–ó–î–ê–ù–ò–ï –ó–ê–Ø–í–û–ö
‚îú‚îÄ‚îÄ üìÅ packages/
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ email-service/ - EMAIL –°–ò–°–¢–ï–ú–ê
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ src/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ email-service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ email-template-service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ templates/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ crypto-address.html/txt
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ password-reset.html/txt ‚úÖ –£–ñ–ï –°–£–©–ï–°–¢–í–£–ï–¢
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ wallet-ready.html/txt
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ types/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts - PasswordResetEmailData ‚úÖ
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ utils/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ rate-limited-email-service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ GMAIL_SMTP_USAGE.md
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ exchange-core/ - –ë–ò–ó–ù–ï–°-–õ–û–ì–ò–ö–ê
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ src/services/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ auto-registration-service.ts - –ê–í–¢–û–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ utils/ - –£–¢–ò–õ–ò–¢–´
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ src/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ password-generation.ts - –ì–ï–ù–ï–†–ê–¶–ò–Ø –ü–ê–†–û–õ–Ø ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ constants/ - –ö–û–ù–°–¢–ê–ù–¢–´
```

### –ö–ª—é—á–µ–≤—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –Ω–∞—Ö–æ–¥–∫–∏

‚úÖ **–ü–û–õ–û–ñ–ò–¢–ï–õ–¨–ù–´–ï –§–ê–ö–¢–û–†–´ (Rule 20 - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏)**:

1. `email-service` –ø–∞–∫–µ—Ç –£–ñ–ï –°–£–©–ï–°–¢–í–£–ï–¢ –∏ –ü–û–õ–ù–û–°–¢–¨–Æ –ù–ê–°–¢–†–û–ï–ù
2. `PasswordResetEmailData` —Ç–∏–ø –£–ñ–ï –û–ü–†–ï–î–ï–õ–ï–ù –≤ `email-service/src/types/index.ts`
3. `password-reset.html` –∏ `password-reset.txt` —à–∞–±–ª–æ–Ω—ã –£–ñ–ï –°–û–ó–î–ê–ù–´
4. `EmailTemplateService.generatePasswordResetEmail()` –º–µ—Ç–æ–¥ –£–ñ–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù
5. `EmailService.sendPasswordReset()` –º–µ—Ç–æ–¥ –£–ñ–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù
6. `generatePasswordForAutoFlow()` —Ñ—É–Ω–∫—Ü–∏—è –£–ñ–ï –°–£–©–ï–°–¢–í–£–ï–¢ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Å—Ç–æ–π–∫–∏–µ –ø–∞—Ä–æ–ª–∏
7. `AutoRegistrationService` —É–∂–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–∞—Ä–æ–ª—å –ø—Ä–∏ `generatePassword: true`

‚ö†Ô∏è **–ü–†–û–ë–õ–ï–ú–ù–´–ï –¢–û–ß–ö–ò**:

1. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ development —Ä–µ–∂–∏–º–µ (`DEV_ONLY_GENERATED_PASSWORD`)
2. –ü–∞—Ä–æ–ª—å –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–∏ –ø—Ä–∏ –∫–∞–∫–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö
3. –ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ email —Å crypto address, –Ω–æ –ù–ï —Å –ø–∞—Ä–æ–ª–µ–º

---

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ñ–ª–æ—É —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏

### –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: `apps/web/src/server/trpc/routers/exchange.ts`

#### –ü—Ä–æ—Ü–µ–¥—É—Ä–∞: `exchangeRouter.createOrder`

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `exchange.ts:746-856`

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**:

```typescript
// 1Ô∏è‚É£ –í–ê–õ–ò–î–ê–¶–ò–Ø –ò –ü–û–î–ì–û–¢–û–í–ö–ê
input: securityEnhancedCreateExchangeOrderSchema
  ‚Üì
validateOrderInput() // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤
  ‚Üì
prepareOrderRequest() // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö + —Ä–∞—Å—á–µ—Ç –∫—É—Ä—Å–∞
  ‚Üì

// 2Ô∏è‚É£ SESSION MANAGEMENT & –ê–í–¢–û–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø
ensureUserSessionWithCookie()
  ‚îú‚îÄ‚îÄ UserManagerFactory.createForWeb()
  ‚îú‚îÄ‚îÄ new AutoRegistrationService(webUserManager)
  ‚îî‚îÄ‚îÄ autoRegService.ensureUserWithSession(
        email,
        sessionMetadata,
        ctx.sessionId,
        { generatePassword: true } // ‚úÖ –ü–ê–†–û–õ–¨ –ì–ï–ù–ï–†–ò–†–£–ï–¢–°–Ø –ó–î–ï–°–¨
      )
  ‚Üì

// 3Ô∏è‚É£ –°–û–ó–î–ê–ù–ò–ï –ó–ê–Ø–í–ö–ò
createOrderInSystem()
  ‚îú‚îÄ‚îÄ handleWalletAllocation()
  ‚îÇ   ‚îî‚îÄ‚îÄ allocateWalletForOrder()
  ‚îî‚îÄ‚îÄ processSuccessfulOrder()
      ‚îú‚îÄ‚îÄ orderManager.create() // –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ –≤ –ë–î
      ‚îú‚îÄ‚îÄ scheduleOrderExpiration() // Redis TTL
      ‚îú‚îÄ‚îÄ sendCryptoAddressEmail() // ‚úÖ EMAIL –° –ê–î–†–ï–°–û–ú
      ‚îî‚îÄ‚îÄ sendTelegramNotification() // Telegram –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º
```

### –ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Ö–æ–¥–∫–∏ –∏–∑ –∫–æ–¥–∞

#### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è

**–§–∞–π–ª**: `apps/web/src/server/trpc/routers/exchange.ts:462-476`

```typescript
const userSession = await autoRegService.ensureUserWithSession(
  orderRequest.email,
  sessionMetadata,
  ctx.sessionId,
  { generatePassword: true } // ‚úÖ –ö–õ–Æ–ß–ï–í–ê–Ø –°–¢–†–û–ö–ê
);
```

#### 2. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è (—Ç–æ–ª—å–∫–æ development)

**–§–∞–π–ª**: `packages/exchange-core/src/services/auto-registration-service.ts:246-254`

```typescript
const plainPassword = generatePasswordForAutoFlow();

// üö® –¢–û–õ–¨–ö–û –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ö–ò - –ª–æ–≥–∏—Ä—É–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å
if (process.env.NODE_ENV === 'development') {
  this.logger.warn('DEV_ONLY_GENERATED_PASSWORD', {
    email,
    plainPassword, // ‚ö†Ô∏è –£–î–ê–õ–ò–¢–¨ –í –ü–†–û–î–ê–ö–®–ï–ù–ï!
    note: 'This is development-only logging. Remove in production!',
  });
}

const bcrypt = await import('bcryptjs');
userData.hashedPassword = await bcrypt.hash(plainPassword, VALIDATION_LIMITS.BCRYPT_SALT_ROUNDS);
```

**–ü–†–û–ë–õ–ï–ú–ê**: –ü–æ—Å–ª–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è `plainPassword` —Ç–µ—Ä—è–µ—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞!

#### 3. –û—Ç–ø—Ä–∞–≤–∫–∞ crypto address email

**–§–∞–π–ª**: `apps/web/src/server/trpc/routers/exchange.ts:204-258`

```typescript
await RateLimitedEmailService.sendCryptoAddress(
  {
    orderId: order.publicId,
    cryptoAddress: depositAddress,
    currency: orderRequest.currency,
    amount: orderRequest.cryptoAmount,
    expiresAt: new Date(Date.now() + ORDER_EXPIRATION_TIME_MS),
    userEmail: orderRequest.email,
    tokenStandard: effectiveTokenStandard,
  },
  sessionMetadata.ip
);
```

**–í–ê–ñ–ù–û**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –¢–û–õ–¨–ö–û –∞–¥—Ä–µ—Å –¥–ª—è –¥–µ–ø–æ–∑–∏—Ç–∞, –ø–∞—Ä–æ–ª—å –ù–ï —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è

---

## üîê –ê–Ω–∞–ª–∏–∑ —Ñ–ª–æ—É –∞–≤—Ç–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### AutoRegistrationService

**–§–∞–π–ª**: `packages/exchange-core/src/services/auto-registration-service.ts`

#### –ú–µ—Ç–æ–¥: `ensureUserWithSession()`

**–°–∏–≥–Ω–∞—Ç—É—Ä–∞**:

```typescript
async ensureUserWithSession(
  email: string,
  sessionMetadata: SessionMetadata,
  existingSessionId?: string,
  options: AutoRegistrationOptions = {} // { generatePassword?: boolean }
): Promise<AutoRegistrationResult>
```

**–õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏—è**:

```typescript
// 1. EXISTING_SESSION - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω
if (existingSessionId && sessionValid) {
  return {
    user: existingUser,
    authenticationMethod: 'existing-session',
    isNewUser: false,
  };
}

// 2. AUTO_LOGIN - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –Ω–µ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω
if (existingUser) {
  return {
    user: existingUser,
    authenticationMethod: 'auto-login',
    isNewUser: false,
  };
}

// 3. AUTO_REGISTRATION - –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
const newUser = await this.createNewUserWithPassword(email, generatePassword);
return {
  user: newUser,
  authenticationMethod: 'auto-registration',
  isNewUser: true, // ‚úÖ –í–ê–ñ–ù–´–ô –§–õ–ê–ì
};
```

#### –ú–µ—Ç–æ–¥: `createNewUserWithPassword()`

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `auto-registration-service.ts:231-265`

```typescript
private async createNewUserWithPassword(
  email: string,
  generatePassword: boolean
): Promise<User> {
  const userData = {
    email,
    hashedPassword: undefined,
    isVerified: false,
  };

  if (generatePassword) {
    const plainPassword = generatePasswordForAutoFlow(); // ‚úÖ –ì–ï–ù–ï–†–ê–¶–ò–Ø

    // DEV_ONLY LOGGING
    if (process.env.NODE_ENV === 'development') {
      this.logger.warn('DEV_ONLY_GENERATED_PASSWORD', {
        email,
        plainPassword
      });
    }

    userData.hashedPassword = await bcrypt.hash(plainPassword, BCRYPT_SALT_ROUNDS);
    userData.isVerified = true;
  }

  return await this.userManager.create(userData);
}
```

**–ö–õ–Æ–ß–ï–í–ê–Ø –ù–ê–•–û–î–ö–ê**: `plainPassword` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –¢–û–õ–¨–ö–û –≤ scope —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏!

---

## üìß –ê–Ω–∞–ª–∏–∑ email-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è email –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

#### 1. –ü–∞–∫–µ—Ç `email-service`

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `packages/email-service/`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:

```
email-service/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ email-service.ts - –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ email-template-service.ts - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ email-monitoring-service.ts
‚îÇ   ‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ crypto-address.html/txt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ password-reset.html/txt ‚úÖ –ì–û–¢–û–í
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ system-alert.html/txt
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ wallet-ready.html/txt
‚îÇ   ‚îú‚îÄ‚îÄ types/index.ts
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rate-limited-email-service.ts
‚îÇ   ‚îú‚îÄ‚îÄ providers/ - SendGrid, Resend, Gmail SMTP, Mock
‚îÇ   ‚îî‚îÄ‚îÄ factories/ - EmailServiceFactory
‚îî‚îÄ‚îÄ GMAIL_SMTP_USAGE.md
```

#### 2. –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∏–ø—ã

**–§–∞–π–ª**: `packages/email-service/src/types/index.ts:78-84`

```typescript
/**
 * Password reset email template data
 */
export interface PasswordResetEmailData {
  token: string;
  expiresAt: Date;
  userEmail: string;
}
```

**–ü–†–û–ë–õ–ï–ú–ê**: –¢–∏–ø –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ç–æ–∫–µ–Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è, –ù–ï –¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è!

#### 3. –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —à–∞–±–ª–æ–Ω—ã

**–§–∞–π–ª**: `packages/email-service/src/templates/password-reset.html`

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ**: –®–∞–±–ª–æ–Ω –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è —Å —Ç–æ–∫–µ–Ω–æ–º (–∫–æ–¥ –Ω–∞ 15 –º–∏–Ω—É—Ç)

**–ü–†–û–ë–õ–ï–ú–ê**: –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ –ù–ï –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è –Ω–æ–≤–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é!

#### 4. –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã

**EmailService.sendPasswordReset()**

**–§–∞–π–ª**: `packages/email-service/src/services/email-service.ts:165-203`

```typescript
static async sendPasswordReset(
  data: import('../types/index').PasswordResetEmailData,
  config?: Partial<EmailProviderConfig>
): Promise<EmailSendResult>
```

**EmailTemplateService.generatePasswordResetEmail()**

**–§–∞–π–ª**: `packages/email-service/src/services/email-template-service.ts:216-244`

```typescript
static async generatePasswordResetEmail(
  data: import('../types/index').PasswordResetEmailData
): Promise<EmailMessage>
```

#### 5. Rate Limiting

**RateLimitedEmailService**

**–§–∞–π–ª**: `packages/email-service/src/utils/rate-limited-email-service.ts`

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã**:

- ‚úÖ `sendCryptoAddress()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

**–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã**:

- ‚ùå `sendPasswordReset()` - –ù–ï —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚ùå `sendWelcomeWithPassword()` - –ù–ï —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

---

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–µ—à–µ–Ω–∏—è (Rule 2, Rule 20)

1. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ > –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ** (Rule 20)
2. **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å** (Rule 17)
3. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** (Rule 25)
4. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å** (Rule 24)

### –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ä–µ—à–µ–Ω–∏–π

#### ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ô –ø–æ–¥—Ö–æ–¥: –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `password-reset`

**–ü–æ—á–µ–º—É –ù–ï –ø–æ–¥—Ö–æ–¥–∏—Ç**:

- –°–µ–º–∞–Ω—Ç–∏–∫–∞ "–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ" ‚â† "–ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å"
- UX confusion: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- –®–∞–±–ª–æ–Ω –≥–æ–≤–æ—Ä–∏—Ç –ø—Ä–æ "15 –º–∏–Ω—É—Ç" –∏ "–∫–æ–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è"
- –¢–∏–ø `PasswordResetEmailData` —Å –ø–æ–ª–µ–º `token` - –ù–ï —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–¥–∞—á–µ

#### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–´–ô –ø–æ–¥—Ö–æ–¥: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–∏–ø email

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:

- –û—Ç–¥–µ–ª—å–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞: "Welcome + Password" vs "Password Reset"
- –î—Ä—É–≥–æ–π UX –∫–æ–Ω—Ç–µ–∫—Å—Ç: –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –î—Ä—É–≥–∏–µ –¥–∞–Ω–Ω—ã–µ: `plainPassword` –≤–º–µ—Å—Ç–æ `token`
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—É Single Responsibility

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –ù–æ–≤—ã–π —Ç–∏–ø email "Welcome with Password"

#### –ù–∞–∑–≤–∞–Ω–∏–µ: `auto-registration-password`

**–°–µ–º–∞–Ω—Ç–∏–∫–∞**:

- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–∏—Å—å–º–æ –Ω–æ–≤–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è
- –û–±—ä—è—Å–Ω–µ–Ω–∏–µ, —á—Ç–æ –ø–∞—Ä–æ–ª—å –±—ã–ª —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –≤—Ö–æ–¥—É –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç

#### –ù–æ–≤—ã–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö

```typescript
/**
 * Auto-registration password email template data
 * For users who registered automatically during order creation
 */
export interface AutoRegistrationPasswordEmailData {
  userEmail: string;
  generatedPassword: string; // plaintext password - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–∞–∑
  orderId: string; // –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞—è–≤–∫–∏
}
```

#### –¢–æ—á–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**–ú–µ—Å—Ç–æ**: `auto-registration-service.ts` ‚Üí –º–µ—Ç–æ–¥ `createNewUserWithPassword()`

**–¢–µ–∫—É—â–∏–π –∫–æ–¥**:

```typescript
if (generatePassword) {
  const plainPassword = generatePasswordForAutoFlow();
  // ... hashing
  userData.hashedPassword = await bcrypt.hash(plainPassword, ...);
  // ‚ùå plainPassword –¢–ï–†–Ø–ï–¢–°–Ø –∑–¥–µ—Å—å!
}
```

**–ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥**:

```typescript
if (generatePassword) {
  const plainPassword = generatePasswordForAutoFlow();

  // ‚úÖ –í–û–ó–í–†–ê–¢ plainPassword –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email
  return {
    user: await this.userManager.create(userData),
    plainPassword, // –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –¥–ª—è email
  };
}
```

---

## üìù –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –∏ —à–∞–±–ª–æ–Ω–æ–≤ (email-service)

#### 1.1. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∏–ø

**–§–∞–π–ª**: `packages/email-service/src/types/index.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ `PasswordResetEmailData`

```typescript
/**
 * Auto-registration password email template data
 * For users who registered automatically during order creation
 */
export interface AutoRegistrationPasswordEmailData {
  userEmail: string;
  generatedPassword: string;
  orderId: string;
}
```

**–û–±–Ω–æ–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –≤ index.ts**:

```typescript
export type {
  // ... existing types
  AutoRegistrationPasswordEmailData, // üÜï
} from './types/index';
```

#### 1.2. –°–æ–∑–¥–∞—Ç—å HTML —à–∞–±–ª–æ–Ω

**–§–∞–π–ª**: `packages/email-service/src/templates/auto-registration-password.html`

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ**: (–Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ `password-reset.html`, –Ω–æ —Å –¥—Ä—É–≥–æ–π —Å–µ–º–∞–Ω—Ç–∏–∫–æ–π)

```html
<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–í–∞—à –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞ - {{companyName}}</title>
    <style>
      @import url('./email-base.css');

      .password-box {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        border-radius: 12px;
        margin: 2rem 0;
        text-align: center;
      }

      .password-value {
        font-size: 1.8rem;
        font-weight: 700;
        letter-spacing: 0.2rem;
        font-family: 'Courier New', monospace;
        margin: 1rem 0;
        background: rgba(255, 255, 255, 0.2);
        padding: 1rem;
        border-radius: 8px;
        word-break: break-all;
      }

      .info-block {
        background: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 1rem;
        margin: 1rem 0;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <div class="email-container">
      <!-- Header -->
      <div class="header header-primary">
        <div class="logo logo-primary">{{companyName}}</div>
        <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</p>
      </div>

      <!-- Welcome Message -->
      <div class="content-section">
        <h2>üéâ –ó–∞—è–≤–∫–∞ ‚Ññ{{orderId}} —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!</h2>
        <p>
          –î–ª—è –≤–∞—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏ –∏
          —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º–∏ –æ–±–º–µ–Ω–∞–º–∏.
        </p>
      </div>

      <!-- Password Box -->
      <div class="password-box">
        <div style="font-size: 1rem; margin-bottom: 1rem;">üîê –í–∞—à –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞</div>
        <div class="password-value">{{generatedPassword}}</div>
        <div style="font-size: 0.9rem; margin-top: 1rem; opacity: 0.9;">
          –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –≤ –Ω–∞–¥–µ–∂–Ω–æ–º –º–µ—Å—Ç–µ
        </div>
      </div>

      <!-- Instructions -->
      <div class="content-section">
        <h3>üìù –ö–∞–∫ –≤–æ–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç:</h3>
        <ol>
          <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞</li>
          <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∞—à email: <strong>{{userEmail}}</strong></li>
          <li>–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∏–∑ –ø–∏—Å—å–º–∞</li>
          <li>–í—ã –º–æ–∂–µ—Ç–µ —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ—Ñ–∏–ª—è</li>
        </ol>
      </div>

      <!-- Security Notice -->
      <div class="info-block">
        <h3>üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>
        <ul>
          <li>–ù–∏–∫–æ–º—É –Ω–µ —Å–æ–æ–±—â–∞–π—Ç–µ —ç—Ç–æ—Ç –ø–∞—Ä–æ–ª—å</li>
          <li>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ</li>
          <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–æ–∂–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ —Å –±—É–∫–≤–∞–º–∏, —Ü–∏—Ñ—Ä–∞–º–∏ –∏ —Å–∏–º–≤–æ–ª–∞–º–∏</li>
        </ul>
      </div>

      <!-- Footer -->
      <div class="footer">
        <p>–° —É–≤–∞–∂–µ–Ω–∏–µ–º,<br />–ö–æ–º–∞–Ω–¥–∞ {{companyName}}</p>
        <p class="text-muted" style="font-size: 0.8rem;">
          –≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–∏—Å—å–º–æ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –æ—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ –Ω–µ–≥–æ.
        </p>
      </div>
    </div>
  </body>
</html>
```

#### 1.3. –°–æ–∑–¥–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω

**–§–∞–π–ª**: `packages/email-service/src/templates/auto-registration-password.txt`

```txt
{{companyName}} - –í–∞—à –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!

–ó–∞—è–≤–∫–∞ ‚Ññ{{orderId}} —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!

–î–ª—è –≤–∞—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç.
–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏ –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º–∏ –æ–±–º–µ–Ω–∞–º–∏.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üîê –í–ê–® –ü–ê–†–û–õ–¨ –î–õ–Ø –í–•–û–î–ê
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

{{generatedPassword}}

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –≤ –Ω–∞–¥–µ–∂–Ω–æ–º –º–µ—Å—Ç–µ!

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

–ö–ê–ö –í–û–ô–¢–ò –í –õ–ò–ß–ù–´–ô –ö–ê–ë–ò–ù–ï–¢:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∞—à email: {{userEmail}}
3. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∏–∑ –ø–∏—Å—å–º–∞
4. –í—ã –º–æ–∂–µ—Ç–µ —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ—Ñ–∏–ª—è

–ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨:
‚Ä¢ –ù–∏–∫–æ–º—É –Ω–µ —Å–æ–æ–±—â–∞–π—Ç–µ —ç—Ç–æ—Ç –ø–∞—Ä–æ–ª—å
‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–æ–∂–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ —Å –±—É–∫–≤–∞–º–∏, —Ü–∏—Ñ—Ä–∞–º–∏ –∏ —Å–∏–º–≤–æ–ª–∞–º–∏

---
–° —É–≤–∞–∂–µ–Ω–∏–µ–º,
–ö–æ–º–∞–Ω–¥–∞ {{companyName}}

–≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–∏—Å—å–º–æ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –æ—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ –Ω–µ–≥–æ.
```

#### 1.4. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –≤ EmailTemplateService

**–§–∞–π–ª**: `packages/email-service/src/services/email-template-service.ts`

**–ú–µ—Å—Ç–æ**: –ü–æ—Å–ª–µ –º–µ—Ç–æ–¥–∞ `generatePasswordResetEmail()`

```typescript
/**
 * Generate auto-registration password email content
 * For users who registered automatically during order creation
 */
static async generateAutoRegistrationPasswordEmail(
  data: AutoRegistrationPasswordEmailData
): Promise<EmailMessage> {
  const subject = `üéâ –í–∞—à –ø–∞—Ä–æ–ª—å –¥–ª—è –∑–∞—è–≤–∫–∏ ‚Ññ${data.orderId} - ${COMPANY_INFO.NAME}`;

  const variables = {
    companyName: COMPANY_INFO.NAME,
    userEmail: data.userEmail,
    generatedPassword: data.generatedPassword,
    orderId: data.orderId,
  };

  const logContext = {
    orderId: data.orderId,
    userEmail: data.userEmail,
  };

  const { html, text } = await this.generateUniversalTemplateEmail(
    'auto-registration-password',
    subject,
    variables,
    logContext
  );

  return {
    to: data.userEmail,
    subject,
    html,
    text,
  };
}
```

#### 1.5. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –≤ EmailService

**–§–∞–π–ª**: `packages/email-service/src/services/email-service.ts`

**–ú–µ—Å—Ç–æ**: –ü–æ—Å–ª–µ –º–µ—Ç–æ–¥–∞ `sendPasswordReset()`

```typescript
/**
 * Send auto-registration password email to new user
 * For users who registered automatically during order creation
 */
static async sendAutoRegistrationPassword(
  data: AutoRegistrationPasswordEmailData,
  config?: Partial<EmailProviderConfig>
): Promise<EmailSendResult> {
  try {
    this.logger.info('Sending auto-registration password email', {
      orderId: data.orderId,
      to: data.userEmail,
    });

    // Generate email content from template
    const emailMessage = await EmailTemplateService.generateAutoRegistrationPasswordEmail(data);

    // Get email provider and send
    const provider = config
      ? EmailServiceFactory.create(config)
      : EmailServiceFactory.createFromEnvironment();
    const result = await provider.send(emailMessage);

    // Record result for monitoring
    this.recordEmailResultForMonitoring(config, result, result.error);

    if (result.success) {
      this.logger.info('Auto-registration password email sent successfully', {
        orderId: data.orderId,
        to: data.userEmail,
        messageId: result.messageId,
      });
    } else {
      this.logger.error('Failed to send auto-registration password email', {
        orderId: data.orderId,
        to: data.userEmail,
        error: result.error,
      });
    }

    return result;
  } catch (error) {
    const errorMessage = error instanceof Error ? error.message : this.UNKNOWN_ERROR;

    // Record error for monitoring
    this.recordEmailErrorForMonitoring(config, errorMessage);

    this.logger.error(this.EMAIL_SERVICE_ERROR, {
      orderId: data.orderId,
      to: data.userEmail,
      error: errorMessage,
    });

    return {
      success: false,
      error: errorMessage,
    };
  }
}
```

#### 1.6. –î–æ–±–∞–≤–∏—Ç—å rate-limited –æ–±–µ—Ä—Ç–∫—É

**–§–∞–π–ª**: `packages/email-service/src/utils/rate-limited-email-service.ts`

**–ú–µ—Å—Ç–æ**: –ü–æ—Å–ª–µ –º–µ—Ç–æ–¥–∞ `sendCryptoAddress()`

```typescript
/**
 * Send auto-registration password email with rate limiting applied
 * For users who registered automatically during order creation
 */
static async sendAutoRegistrationPassword(
  data: AutoRegistrationPasswordEmailData,
  clientIdentifier: string,
  config?: Partial<EmailProviderConfig>
): Promise<EmailSendResult> {
  try {
    this.logger.info('Applying rate limit for auto-registration password email', {
      orderId: data.orderId,
      clientIdentifier,
    });

    // Apply rate limiting first
    await applyEmailRateLimit(clientIdentifier);

    this.logger.info('Rate limit passed, sending auto-registration password email', {
      orderId: data.orderId,
      clientIdentifier,
    });

    // If rate limit passes, call the actual email service
    return await EmailService.sendAutoRegistrationPassword(data, config);
  } catch (error) {
    this.logger.error('Rate-limited auto-registration password email service error', {
      orderId: data.orderId,
      clientIdentifier,
      error: error instanceof Error ? error.message : 'Unknown error',
    });

    // Re-throw the error
    throw error;
  }
}
```

#### 1.7. –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å —ç–∫—Å–ø–æ—Ä—Ç–æ–≤

**–§–∞–π–ª**: `packages/email-service/src/index.ts`

```typescript
// Type exports
export type {
  // ... existing types
  AutoRegistrationPasswordEmailData, // üÜï –î–û–ë–ê–í–ò–¢–¨
} from './types/index';
```

### –≠—Ç–∞–ø 2: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è AutoRegistrationService

#### 2.1. –ò–∑–º–µ–Ω–∏—Ç—å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Ç–∏–ø

**–§–∞–π–ª**: `packages/exchange-core/src/services/auto-registration-service.ts`

**–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** (–ø–æ—Å–ª–µ `AutoRegistrationResult`):

```typescript
/**
 * Extended result with generated password for email sending
 * Used only when generatePassword option is true
 */
export interface AutoRegistrationResultWithPassword extends AutoRegistrationResult {
  generatedPassword?: string; // plaintext password - only for email sending
}
```

#### 2.2. –ò–∑–º–µ–Ω–∏—Ç—å –º–µ—Ç–æ–¥ `createNewUserWithPassword()`

**–¢–µ–∫—É—â–∞—è —Å–∏–≥–Ω–∞—Ç—É—Ä–∞**:

```typescript
private async createNewUserWithPassword(
  email: string,
  generatePassword: boolean
): Promise<User>
```

**–ù–æ–≤–∞—è —Å–∏–≥–Ω–∞—Ç—É—Ä–∞**:

```typescript
private async createNewUserWithPassword(
  email: string,
  generatePassword: boolean
): Promise<{ user: User; generatedPassword?: string }>
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

```typescript
private async createNewUserWithPassword(
  email: string,
  generatePassword: boolean
): Promise<{ user: User; generatedPassword?: string }> {
  const userData: {
    email: string;
    hashedPassword: string | undefined;
    isVerified: boolean;
  } = {
    email,
    hashedPassword: undefined,
    isVerified: false,
  };

  let plainPassword: string | undefined;

  if (generatePassword) {
    // Generate password
    plainPassword = generatePasswordForAutoFlow();

    // üö® –¢–û–õ–¨–ö–û –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ö–ò - –ª–æ–≥–∏—Ä—É–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å
    if (process.env.NODE_ENV === 'development') {
      this.logger.warn('DEV_ONLY_GENERATED_PASSWORD', {
        email,
        plainPassword,
        note: 'This is development-only logging. Remove in production!'
      });
    }

    // Hash password for storage
    const bcrypt = await import('bcryptjs');
    userData.hashedPassword = await bcrypt.hash(
      plainPassword,
      VALIDATION_LIMITS.BCRYPT_SALT_ROUNDS
    );
    userData.isVerified = true;

    this.logger.info('Generated secure password for auto-registered user', { email });
  }

  const user = await this.userManager.create(userData);

  // ‚úÖ –í–û–ó–í–†–ê–©–ê–ï–ú plainPassword –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email (–µ—Å–ª–∏ –±—ã–ª —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω)
  return {
    user,
    generatedPassword: plainPassword
  };
}
```

#### 2.3. –ò–∑–º–µ–Ω–∏—Ç—å –º–µ—Ç–æ–¥ `determineUserStatus()`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–∏—Ç—å –≤—ã–∑–æ–≤ `createNewUserWithPassword()` –∏ –≤–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

```typescript
private async determineUserStatus(
  email: string,
  existingSessionId?: string,
  generatePassword: boolean = false
): Promise<UserAuthenticationStatus & { generatedPassword?: string }> {
  // ... existing session validation logic

  // ... existing user auto-login logic

  // 3. Unregistered ‚Üí auto-registration
  const result = await this.createNewUserWithPassword(email, generatePassword);

  return {
    user: result.user,
    authenticationMethod: AUTHENTICATION_METHODS.AUTO_REGISTRATION,
    isNewUser: true,
    generatedPassword: result.generatedPassword, // ‚úÖ –ü–ï–†–ï–î–ê–ï–ú –î–ê–õ–¨–®–ï
  };
}
```

#### 2.4. –ò–∑–º–µ–Ω–∏—Ç—å –º–µ—Ç–æ–¥ `ensureUserWithSession()`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–∏—Ç—å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Ç–∏–ø –∏ –ø–µ—Ä–µ–¥–∞—Ç—å `generatedPassword`

```typescript
async ensureUserWithSession(
  email: string,
  sessionMetadata: SessionMetadata,
  existingSessionId?: string,
  options: AutoRegistrationOptions = {}
): Promise<AutoRegistrationResultWithPassword> {
  try {
    this.logger.info('Ensuring user with session', {
      email,
      hasExistingSession: !!existingSessionId,
    });

    const userStatus = await this.determineUserStatus(
      email,
      existingSessionId,
      options.generatePassword || false
    );

    const finalSessionId = await this.resolveSessionId(
      userStatus,
      existingSessionId,
      sessionMetadata
    );

    this.logger.info('User session ensured successfully', {
      userId: userStatus.user.id,
      authMethod: userStatus.authenticationMethod,
      isNewUser: userStatus.isNewUser,
      sessionId: finalSessionId.substring(LOG_TRUNCATE_START, SESSION_ID_LOG_LENGTH) + '...',
    });

    return {
      user: userStatus.user,
      sessionId: finalSessionId,
      isNewUser: userStatus.isNewUser,
      authenticationMethod: userStatus.authenticationMethod,
      generatedPassword: userStatus.generatedPassword, // ‚úÖ –ü–ï–†–ï–î–ê–ï–ú –ù–ê–í–ï–†–•
    };
  } catch (error) {
    this.logger.error('AutoRegistrationService.ensureUserWithSession failed', {
      error: error instanceof Error ? error.message : String(error),
      email,
    });
    throw new Error(
      `Failed to ensure user with session: ${error instanceof Error ? error.message : String(error)}`
    );
  }
}
```

### –≠—Ç–∞–ø 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ exchange router

#### 3.1. –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã

**–§–∞–π–ª**: `apps/web/src/server/trpc/routers/exchange.ts`

**–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–º–ø–æ—Ä—Ç—ã**:

```typescript
import {
  RateLimitedEmailService,
  type AutoRegistrationPasswordEmailData, // üÜï
} from '@repo/email-service';
```

#### 3.2. –°–æ–∑–¥–∞—Ç—å helper —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∞—Ä–æ–ª—è

**–ú–µ—Å—Ç–æ**: –ü–æ—Å–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏ `sendCryptoAddressEmail()`

```typescript
/**
 * –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email —Å –ø–∞—Ä–æ–ª–µ–º –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
 *
 * @architecture
 * - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (isNewUser === true)
 * - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –±—ã–ª —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –ø–∞—Ä–æ–ª—å (generatedPassword —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
 * - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç rate limiting —á–µ—Ä–µ–∑ RateLimitedEmailService
 * - –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –æ—Ç–ø—Ä–∞–≤–∫–∏
 */
async function sendAutoRegistrationPasswordEmail(params: {
  order: Order;
  userEmail: string;
  generatedPassword: string;
  sessionMetadata: SessionMetadata;
}) {
  const { order, userEmail, generatedPassword, sessionMetadata } = params;

  logger.info('Starting auto-registration password email sending', {
    orderId: order.publicId,
    email: userEmail,
  });

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–∫–∏ email
  const environment = process.env.NODE_ENV === 'production' ? 'production' : 'development';
  const isGlobalEnabled = environment === 'production' || EMAIL_ENABLED_IN_DEVELOPMENT.GLOBAL;

  // TODO: –î–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π —Ñ–ª–∞–≥ –¥–ª—è auto-registration password –≤ constants
  // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º GLOBAL —Ñ–ª–∞–≥
  if (!isGlobalEnabled) {
    logger.info('Auto-registration password email disabled by configuration', {
      orderId: order.publicId,
      email: userEmail,
      environment,
      message: 'Email –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏',
    });
    return;
  }

  try {
    await RateLimitedEmailService.sendAutoRegistrationPassword(
      {
        userEmail,
        generatedPassword,
        orderId: order.publicId,
      },
      sessionMetadata.ip
    );

    logger.info('Auto-registration password email sent successfully', {
      orderId: order.publicId,
      email: userEmail,
    });
  } catch (emailError) {
    logger.error('Failed to send auto-registration password email', {
      orderId: order.publicId,
      email: userEmail,
      error: emailError instanceof Error ? emailError.message : UNKNOWN_ERROR_MESSAGE,
    });
    // Continue execution even if email sending fails
    // User can always use password reset functionality
  }
}
```

#### 3.3. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `processSuccessfulOrder()`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `generatedPassword` –∏ –æ—Ç–ø—Ä–∞–≤–∫—É email

```typescript
async function processSuccessfulOrder(params: {
  orderRequest: {
    email: string;
    cryptoAmount: number;
    currency: (typeof CRYPTOCURRENCIES)[number];
    uahAmount: number;
    recipientData?: { cardNumber?: string; bankDetails?: string; bankId?: string };
    fixedExchangeRate?: number;
  };
  depositAddress: string;
  userSession: {
    user: { id: string };
    sessionId: string;
    isNewUser: boolean;
    authenticationMethod: string;
    generatedPassword?: string; // üÜï –î–û–ë–ê–í–õ–ï–ù–û
  };
  sessionMetadata: SessionMetadata;
  usedOldestOccupiedWallet?: boolean;
}) {
  const {
    orderRequest,
    depositAddress,
    userSession,
    sessionMetadata,
    usedOldestOccupiedWallet = false,
  } = params;

  // ... existing wallet and order creation logic

  // –û—Ç–ø—Ä–∞–≤–∫–∞ email —Å –∞–¥—Ä–µ—Å–æ–º
  await sendCryptoAddressEmail({
    order,
    orderRequest,
    depositAddress,
    sessionMetadata,
    walletInfo,
  });

  // üÜï –ù–û–í–û–ï: –û—Ç–ø—Ä–∞–≤–∫–∞ email —Å –ø–∞—Ä–æ–ª–µ–º –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  if (userSession.isNewUser && userSession.generatedPassword) {
    await sendAutoRegistrationPasswordEmail({
      order,
      userEmail: orderRequest.email,
      generatedPassword: userSession.generatedPassword,
      sessionMetadata,
    });
  }

  // –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram
  await sendTelegramNotification(order, orderRequest, depositAddress, usedOldestOccupiedWallet);

  return {
    order,
    depositAddress,
    usedOldestOccupiedWallet,
    sessionInfo: {
      sessionId: userSession.sessionId,
      isNewUser: userSession.isNewUser,
    },
  };
}
```

### –≠—Ç–∞–ø 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

#### 4.1. –î–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ –¥–ª—è auto-registration email

**–§–∞–π–ª**: `packages/constants/src/email.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ñ–ª–∞–≥ –≤ `EMAIL_ENABLED_IN_DEVELOPMENT`

```typescript
export const EMAIL_ENABLED_IN_DEVELOPMENT = {
  GLOBAL: true,
  CRYPTO_ADDRESS: true,
  WALLET_READY: false,
  AUTO_REGISTRATION_PASSWORD: true, // üÜï –ù–û–í–´–ô –§–õ–ê–ì
} as const;
```

#### 4.2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–ª–∞–≥ –≤ `sendAutoRegistrationPasswordEmail()`

**–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É**:

```typescript
const isAutoRegPasswordEnabled =
  environment === 'production' || EMAIL_ENABLED_IN_DEVELOPMENT.AUTO_REGISTRATION_PASSWORD;

if (!isGlobalEnabled || !isAutoRegPasswordEnabled) {
  // ... logging
  return;
}
```

---

## ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏

### Checklist –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

#### –≠—Ç–∞–ø 1: email-service

- [ ] `AutoRegistrationPasswordEmailData` —Ç–∏–ø –¥–æ–±–∞–≤–ª–µ–Ω –≤ `types/index.ts`
- [ ] `auto-registration-password.html` —à–∞–±–ª–æ–Ω —Å–æ–∑–¥–∞–Ω
- [ ] `auto-registration-password.txt` —à–∞–±–ª–æ–Ω —Å–æ–∑–¥–∞–Ω
- [ ] `EmailTemplateService.generateAutoRegistrationPasswordEmail()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] `EmailService.sendAutoRegistrationPassword()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] `RateLimitedEmailService.sendAutoRegistrationPassword()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –≠–∫—Å–ø–æ—Ä—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤ `index.ts`
- [ ] –®–∞–±–ª–æ–Ω—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤–∏–∑—É–∞–ª—å–Ω–æ

#### –≠—Ç–∞–ø 2: exchange-core

- [ ] `AutoRegistrationResultWithPassword` –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ–±–∞–≤–ª–µ–Ω
- [ ] `createNewUserWithPassword()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ user, generatedPassword }`
- [ ] `determineUserStatus()` –ø–µ—Ä–µ–¥–∞–µ—Ç `generatedPassword`
- [ ] `ensureUserWithSession()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `AutoRegistrationResultWithPassword`
- [ ] –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (new user, existing user, existing session)

#### –≠—Ç–∞–ø 3: exchange router

- [ ] –ò–º–ø–æ—Ä—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [ ] `sendAutoRegistrationPasswordEmail()` helper —Å–æ–∑–¥–∞–Ω
- [ ] `processSuccessfulOrder()` –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π email
- [ ] –£—Å–ª–æ–≤–∏–µ `isNewUser && generatedPassword` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –û—à–∏–±–∫–∏ email –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞

#### –≠—Ç–∞–ø 4: constants (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- [ ] `EMAIL_ENABLED_IN_DEVELOPMENT.AUTO_REGISTRATION_PASSWORD` –¥–æ–±–∞–≤–ª–µ–Ω
- [ ] –§–ª–∞–≥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ–≤–µ—Ä–∫–∞—Ö

### Testing checklist

#### Unit tests

- [ ] `EmailTemplateService.generateAutoRegistrationPasswordEmail()` unit test
- [ ] `AutoRegistrationService.createNewUserWithPassword()` unit test —Å `generatedPassword`
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –≤–µ—Ç–æ–∫ —É—Å–ª–æ–≤–∏–π (generatePassword true/false)

#### Integration tests

- [ ] E2E —Ç–µ—Å—Ç: —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ 2 email: crypto-address + auto-registration-password
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –ø–∞—Ä–æ–ª—å –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ rate limiting –¥–ª—è email

#### Manual tests

- [ ] Development: —Å–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É —Å –Ω–æ–≤—ã–º email
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ 2 –ø–∏—Å–µ–º
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —à–∞–±–ª–æ–Ω–æ–≤
- [ ] –í–æ–π—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É—è –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–∞—Ä–æ–ª—å –ù–ï –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ production

---

## üéØ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ AI Agent Rules

### Rule 25: –§–û–ö–£–° –¢–û–õ–¨–ö–û –ù–ê –¶–ï–õ–ò –ó–ê–î–ê–ß–ò ‚úÖ

**–¶–µ–ª—å**: –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É email —Å –ø–∞—Ä–æ–ª–µ–º –ø—Ä–∏ –∞–≤—Ç–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:

- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ: —Ç–æ–ª—å–∫–æ email-—Å–µ—Ä–≤–∏—Å –∏ –∞–≤—Ç–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- ‚úÖ –ù–µ—Ç –ø–æ–±–æ—á–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π –∏–ª–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ –ù–µ —Ç—Ä–æ–≥–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–æ–∫
- ‚úÖ –ù–µ –º–µ–Ω—è–µ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å–µ—Å—Å–∏–π

### Rule 24: –ñ–ï–õ–ï–ó–û–ë–ï–¢–û–ù–ù–û–ï –ó–ù–ê–ù–ò–ï –°–¢–†–£–ö–¢–£–†–´ ‚úÖ

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:

- ‚úÖ PROJECT_STRUCTURE_MAP.md –ø—Ä–æ—á–∏—Ç–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é
- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ email-service –∏–∑—É—á–µ–Ω–∞
- ‚úÖ –§–ª–æ—É —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- ‚úÖ AutoRegistrationService –¥–µ—Ç–∞–ª—å–Ω–æ –∏–∑—É—á–µ–Ω
- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã

### Rule 20: –ó–ê–ü–†–ï–¢ –ò–ó–ë–´–¢–û–ß–ù–û–°–¢–ò ‚úÖ

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**:

- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `email-service`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `EmailTemplateService`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `RateLimitedEmailService`
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `generatePasswordForAutoFlow()`
- ‚úÖ –°–ª–µ–¥—É–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω—É –¥—Ä—É–≥–∏—Ö email (crypto-address, wallet-ready)
- ‚úÖ –ù–ï —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –æ—Ç–ø—Ä–∞–≤–∫–∏ email

**–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**:

- ‚úÖ –ù–ï –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º `password-reset` (—Ä–∞–∑–Ω–∞—è —Å–µ–º–∞–Ω—Ç–∏–∫–∞)
- ‚úÖ –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Ç–∏–ø —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–µ–º–∞–Ω—Ç–∏–∫–∞ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è

### Rule 8: –ó–ê–ü–†–ï–¢ –ü–†–ï–î–ü–û–õ–û–ñ–ï–ù–ò–ô ‚úÖ

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ 4 –º–µ—Ç–æ–¥–∞**:

1. ‚úÖ `list_dir` - –ø—Ä–æ–≤–µ—Ä–∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–∫–µ—Ç–æ–≤
2. ‚úÖ `grep_search` - –Ω–∞—à–ª–∏ –≤—Å–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–∞—Ä–æ–ª—è
3. ‚úÖ `semantic_search` - –Ω–∞—à–ª–∏ email —Å–∏—Å—Ç–µ–º—É
4. ‚úÖ `file_search` - –Ω–∞—à–ª–∏ –≤—Å–µ —Ñ–∞–π–ª—ã —Å –ø–∞—Ä–æ–ª—è–º–∏

**–§–∞–∫—Ç—ã –≤–º–µ—Å—Ç–æ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–π**:

- ‚úÖ –ù–∞—à–ª–∏ —á—Ç–æ `password-reset` –£–ñ–ï —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏ —á—Ç–æ `plainPassword` —Ç–µ—Ä—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏–ª–∏ —á—Ç–æ `generatePassword: true` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ exchange.ts
- ‚úÖ –£–±–µ–¥–∏–ª–∏—Å—å —á—Ç–æ email-service –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω

### Rule 2: –°–¢–†–£–ö–¢–£–†–ò–†–û–í–ê–ù–ù–´–ô –ü–û–î–•–û–î ‚úÖ

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ**:

- ‚úÖ –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∏–∑–ª–æ–∂–µ–Ω–æ
- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–≤–µ–¥–µ–Ω
- ‚úÖ –ü–ª–∞–Ω –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –ø–æ —ç—Ç–∞–ø–∞–º
- ‚úÖ –û–∂–∏–¥–∞–µ—Ç—Å—è –æ–¥–æ–±—Ä–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π

### Rule 17: –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –¶–ï–ù–¢–†–ê–õ–ò–ó–û–í–ê–ù–ù–´–• –°–ò–°–¢–ï–ú ‚úÖ

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:

- ‚úÖ `packages/email-service` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- ‚úÖ `packages/exchange-core` - –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ
- ‚úÖ `packages/utils` - `generatePasswordForAutoFlow()` –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- ‚úÖ `packages/constants` - –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ñ–ª–∞–≥–∏

### Rule 11: –ù–ï–î–û–ü–£–°–¢–ò–ú–û–°–¢–¨ –¢–ï–•–î–û–õ–ì–ê ‚úÖ

**–ö–∞—á–µ—Å—Ç–≤–æ —Ä–µ—à–µ–Ω–∏—è**:

- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–Ω–æ–≤—ã–π —Ç–∏–ø email)
- ‚úÖ –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ —Ç–æ—á–Ω–æ–µ (welcome ‚â† reset)
- ‚úÖ –†–∞—Å—à–∏—Ä—è–µ–º–æ–µ (–ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã email)
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ–µ (—á–µ—Ç–∫–∏–µ unit test —Ç–æ—á–∫–∏)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ (–ø–∞—Ä–æ–ª—å –≤ plaintext —Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏)

### Rule 7: –ì–û–¢–û–í–ù–û–°–¢–¨ –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ ‚úÖ

**–ü–ª–∞–Ω –≤–∫–ª—é—á–∞–µ—Ç**:

- ‚úÖ –ü–æ–ª–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã HTML + TXT
- ‚úÖ –ü–æ–ª–Ω—ã–µ TypeScript —Ç–∏–ø—ã
- ‚úÖ –ü–æ–ª–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
- ‚úÖ Error handling –∏ logging
- ‚úÖ Rate limiting
- ‚úÖ Development/Production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –æ—Ü–µ–Ω–∫–∞

**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: üü° –°–†–ï–î–ù–Ø–Ø

- –¢—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ 3 –ø–∞–∫–µ—Ç–∞—Ö
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π

**–†–∏—Å–∫–∏**: üü¢ –ù–ò–ó–ö–ò–ï

- –ù–ï –º–µ–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–ª–æ—É
- Email –æ—Ç–ø—Ä–∞–≤–∫–∞ –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
- Graceful degradation –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö email

**–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: üü¢ –í–´–°–û–ö–ê–Ø

- –ß–µ—Ç–∫–∏–µ —Ç–æ—á–∫–∏ –¥–ª—è unit —Ç–µ—Å—Ç–æ–≤
- E2E —Ç–µ—Å—Ç –ª–µ–≥–∫–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è
- –í–∏–∑—É–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤ –≤ Storybook

### –í—Ä–µ–º–µ–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: 3-4 —á–∞—Å–∞

- –≠—Ç–∞–ø 1 (email-service): 1.5 —á–∞—Å–∞
- –≠—Ç–∞–ø 2 (exchange-core): 1 —á–∞—Å
- –≠—Ç–∞–ø 3 (exchange router): 0.5 —á–∞—Å–∞
- –≠—Ç–∞–ø 4 (constants): 0.5 —á–∞—Å–∞

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: 2 —á–∞—Å–∞

- Unit tests: 1 —á–∞—Å
- Integration tests: 0.5 —á–∞—Å–∞
- Manual testing: 0.5 —á–∞—Å–∞

**–ò—Ç–æ–≥–æ**: 5-6 —á–∞—Å–æ–≤ —á–∏—Å—Ç–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–û–¥–æ–±—Ä–µ–Ω–∏–µ –ø–ª–∞–Ω–∞**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ UX –ø–æ–¥—Ö–æ–¥–∞ (—Å–µ–º–∞–Ω—Ç–∏–∫–∞ email)

2. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**
   - –°–ª–µ–¥–æ–≤–∞—Ç—å –ø–ª–∞–Ω—É –ø–æ—ç—Ç–∞–ø–Ω–æ
   - –ö–æ–º–º–∏—Ç–∏—Ç—å –ø–æ —ç—Ç–∞–ø–∞–º

3. **–ö–æ–¥-—Ä–µ–≤—å—é**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è AI Agent Rules
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - Unit tests
   - E2E tests
   - Manual QA

5. **–î–µ–ø–ª–æ–π**
   - Staging environment
   - Production rollout

---

**–î–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω**: 18 –æ–∫—Ç—è–±—Ä—è 2025  
**–ê–≤—Ç–æ—Ä**: AI Agent (—Å–ª–µ–¥—É—è ai-agent-rules.yml)  
**–°—Ç–∞—Ç—É—Å**: üü° –û–ñ–ò–î–ê–ï–¢ –û–î–û–ë–†–ï–ù–ò–Ø
