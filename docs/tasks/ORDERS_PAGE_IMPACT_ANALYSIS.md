# üìã Impact Analysis: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞—è–≤–æ–∫ (Orders Page)

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 6 –æ–∫—Ç—è–±—Ä—è 2025  
**–ê–Ω–∞–ª–∏—Ç–∏–∫:** AI Agent (–ê–≥–µ–Ω—Ç-–∞–Ω–∞–ª–∏—Ç–∏–∫ —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ Impact Analysis)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í –ö –†–ê–°–°–ú–û–¢–†–ï–ù–ò–Æ

---

## üéØ –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏

–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É `/orders` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∑–∞—è–≤–æ–∫ (–æ—Ä–¥–µ—Ä–æ–≤) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —É—á–µ—Ç–æ–º:

- –†–æ–ª—å-based –¥–æ—Å—Ç—É–ø–∞ (User –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–∫–∞–∑—ã, Operator/Support –≤–∏–¥—è—Ç –≤—Å–µ)
- –ü–∞–≥–∏–Ω–∞—Ü–∏–∏ –¥–ª—è –ø–æ—Ä—Ü–∏–æ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- –ü–æ–∏—Å–∫–∞ –ø–æ –∑–∞—è–≤–∫–∞–º
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –¥–∞—Ç–µ (–æ—Ç –Ω–æ–≤—ã—Ö –∫ —Å—Ç–∞—Ä—ã–º)
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–∞–∂–¥–æ–π –∑–∞—è–≤–∫–∏
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

---

## üîç –§–ê–ó–ê 1: –ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã

### ‚úÖ 1.1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (Rule 24: –ñ–ï–õ–ï–ó–û–ë–ï–¢–û–ù–ù–û–ï –ó–ù–ê–ù–ò–ï)

**–ü—Ä–æ—á–∏—Ç–∞–Ω:** `docs/core/PROJECT_STRUCTURE_MAP.md`

**–ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Ö–æ–¥–∫–∏:**

```
apps/web/                          # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
  app/[locale]/                    # Next.js App Router —Å i18n
    exchange/                      # ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢ - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–±–º–µ–Ω–∞
    order/[orderId]/              # ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢ - –¥–µ—Ç–∞–ª–∏ –æ–¥–Ω–æ–≥–æ –æ—Ä–¥–µ—Ä–∞
    ‚ùå orders/                     # –ù–ï –°–£–©–ï–°–¢–í–£–ï–¢ - –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å
  src/
    components/
      app-header.tsx               # ‚úÖ Header —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π
      forms/                       # ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ñ–æ—Ä–º
    server/trpc/routers/
      exchange.ts                  # ‚úÖ API –¥–ª—è –∑–∞–∫–∞–∑–æ–≤
      operator.ts                  # ‚úÖ API –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
      user/orders.ts               # ‚úÖ API –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∑–∞–∫–∞–∑–æ–≤

packages/
  constants/
    src/app-routes.ts              # ‚úÖ ORDERS: '/orders' –£–ñ–ï –û–ü–†–ï–î–ï–õ–ï–ù
  ui/
    src/components/
      data-table-compound.tsx      # ‚úÖ –ì–æ—Ç–æ–≤—ã–π DataTable –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
      ui/table.tsx                 # ‚úÖ –ë–∞–∑–æ–≤—ã–µ Table –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
  utils/
    src/order-utils.ts             # ‚úÖ –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏/—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏/–ø–∞–≥–∏–Ω–∞—Ü–∏–∏
  exchange-core/
    src/utils/
      user-role-helpers.ts         # ‚úÖ –†–æ–ª—å-based —É—Ç–∏–ª–∏—Ç—ã
      access-validators.ts         # ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞
```

---

## üîé –§–ê–ó–ê 2: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º

### ‚úÖ 2.1. –ü–æ—Ö–æ–∂–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (Rule 20: –ó–∞–ø—Ä–µ—Ç –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏)

#### 2.1.1. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ `/exchange`** - –∞–Ω–∞–ª–æ–≥ –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ

**–§–∞–π–ª:** `apps/web/app/[locale]/exchange/page.tsx`

**–ü–∞—Ç—Ç–µ—Ä–Ω –Ω–∞–≤–∏–≥–∞—Ü–∏–∏:**

```typescript
// apps/web/src/components/app-header.tsx (—Å—Ç—Ä–æ–∫–∏ 265-273)
<Link href={APP_ROUTES.EXCHANGE} className={getNavLinkClass(pathname, APP_ROUTES.EXCHANGE)}>
  {t('navigation.exchange')}
</Link>
<Link href={APP_ROUTES.ORDERS} className={getNavLinkClass(pathname, APP_ROUTES.ORDERS)}>
  {t('navigation.orders')}  // ‚úÖ –£–ñ–ï –ï–°–¢–¨ –í –•–ï–î–ï–†–ï!
</Link>
```

**‚úÖ –í–´–í–û–î:** –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤ header –£–ñ–ï –ì–û–¢–û–í–ê, –º–∞—Ä—à—Ä—É—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω. –ù—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç—å —Å–∞–º—É —Å—Ç—Ä–∞–Ω–∏—Ü—É.

---

#### 2.1.2. **DataTable –∫–æ–º–ø–æ–Ω–µ–Ω—Ç** - –≥–æ—Ç–æ–≤—ã–π UI –¥–ª—è —Ç–∞–±–ª–∏—Ü

**–§–∞–π–ª:** `packages/ui/src/components/data-table-compound.tsx`

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

- ‚úÖ Compound Component Pattern (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥)
- ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è (`DataTable.Pagination`)
- ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ (`DataTable.Filters`)
- ‚úÖ Loading —Å–æ—Å—Ç–æ—è–Ω–∏—è
- ‚úÖ Responsive –¥–∏–∑–∞–π–Ω
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å design-tokens

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–∑ Storybook:**

```tsx
<DataTable data={sampleData} isLoading={loading} searchTerm={search}>
  <DataTable.Container variant="bordered">
    <DataTable.Header title="Users" description="Manage team members" />
    <DataTable.Filters searchPlaceholder="–ü–æ–∏—Å–∫..." />
    <DataTable.Content>
      <DataTable.TableWrapper>{/* –¢–∞–±–ª–∏—Ü–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ */}</DataTable.TableWrapper>
    </DataTable.Content>
    <DataTable.Pagination showInfo={true} />
  </DataTable.Container>
</DataTable>
```

**‚úÖ –í–´–í–û–î:** –ù–ï –ù–£–ñ–ù–û —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ç–∞–±–ª–∏—Ü—ã —Å –Ω—É–ª—è. –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º `DataTable`.

---

#### 2.1.3. **API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤** - —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

**–§–∞–π–ª:** `apps/web/src/server/trpc/routers/user/orders.ts` (—Å—Ç—Ä–æ–∫–∏ 134-182)

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π endpoint:**

```typescript
getOrderHistory: protectedProcedure
  .input(
    z.object({
      ...securityEnhancedUserOrdersPaginationSchema.shape,
      status: securityEnhancedOrderStatusSchema.optional(),
    })
  )
  .query(async ({ input, ctx }) => {
    const user = await validateUserAccess(ctx.user.id);
    const allOrders = await orderManager.findByUserId(user.id);

    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, –ø–∞–≥–∏–Ω–∞—Ü–∏—è —á–µ—Ä–µ–∑ —É—Ç–∏–ª–∏—Ç—ã
    const result = paginateOrders(sortOrders(filterOrders(allOrders, { status: input.status })), {
      limit,
      offset,
    });

    return { orders: result.items, total: result.total };
  });
```

**‚úÖ –í–´–í–û–î:** API –¥–ª—è USER —É–∂–µ –≥–æ—Ç–æ–≤. –ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–∫–∞–∑—ã.

---

**–§–∞–π–ª:** `apps/web/src/server/trpc/routers/operator.ts` (—Å—Ç—Ä–æ–∫–∏ 49-103)

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π endpoint –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤:**

```typescript
getPendingOrders: operatorOnly
  .input(z.object({ limit, cursor, status }))
  .query(async ({ input }) => {
    const allOrders = await orderManager.getAll(); // ‚úÖ –í–°–ï –∑–∞–∫–∞–∑—ã
    const filteredOrders = status
      ? filterOrders(allOrders, { status })
      : filterOrdersForOperator(allOrders);
    // ...–ø–∞–≥–∏–Ω–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
  });
```

**‚úÖ –í–´–í–û–î:** API –¥–ª—è Operator/Support —Ç–æ–∂–µ –≥–æ—Ç–æ–≤. –ü–æ–ª—É—á–∞–µ—Ç –í–°–ï –∑–∞–∫–∞–∑—ã.

---

#### 2.1.4. **–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–∫–∞–∑–∞–º–∏** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

**–§–∞–π–ª:** `packages/utils/src/order-utils.ts`

**–î–æ—Å—Ç—É–ø–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã:**

```typescript
// –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (—Å—Ç—Ä–æ–∫–∏ 44-65)
sortOrders(orders: Order[], sortBy: 'newest' | 'oldest' = 'newest'): Order[]

// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 68-154)
filterOrders(orders: Order[], filters: OrderFilterOptions, userEmailCache?: Map): Order[]
// –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç: status, userEmail, dateRange, amountRange

// –ü–∞–≥–∏–Ω–∞—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 157-186)
paginateOrders<T>(orders: T[], pagination: PaginationOptions): PaginatedOrdersResult<T>
// –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç: offset-based –∏ cursor-based –ø–∞–≥–∏–Ω–∞—Ü–∏—é

// –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (—Å—Ç—Ä–æ–∫–∏ 236-266)
processOrders<T>(orders: T[], options: ProcessOrdersOptions): PaginatedOrdersResult<T>
// –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é + —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É + –ø–∞–≥–∏–Ω–∞—Ü–∏—é –∑–∞ –æ–¥–∏–Ω –≤—ã–∑–æ–≤
```

**‚úÖ –í–´–í–û–î:** –í–°–ï —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –£–ñ–ï –ì–û–¢–û–í–´. –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º.

---

### ‚úÖ 2.2. –†–æ–ª—å-based –¥–æ—Å—Ç—É–ø (Rule 5: –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ)

#### 2.2.1. **–°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π** - Multi-App Architecture

**–§–∞–π–ª:** `packages/exchange-core/src/utils/user-role-helpers.ts`

**–ö–ª—é—á–µ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è:**

```typescript
// –°—Ç—Ä–æ–∫–∞ 10-22
getUserRoleForApp(user: User, context: ApplicationContext): UserRole | null {
  if (!user.appRoles?.length) return null;
  const appRole = user.appRoles.find(role => role.applicationContext === context);
  return appRole?.role || null;
}
```

**–†–æ–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–µ (–∏–∑ `packages/constants/src/business.ts`):**

```typescript
USER_ROLES = {
  USER: 'user', // ‚úÖ –û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
  OPERATOR: 'operator', // ‚úÖ –û–ø–µ—Ä–∞—Ç–æ—Ä—ã
  SUPPORT: 'support', // ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞
  ADMIN: 'admin', // ‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã
};
```

---

#### 2.2.2. **Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–µ–π**

**–§–∞–π–ª:** `apps/web/src/server/trpc/middleware/auth.ts` (—Å—Ç—Ä–æ–∫–∏ 1-64)

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ middleware:**

```typescript
protectedProcedure; // ‚úÖ –õ—é–±–æ–π –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
operatorOnly; // ‚úÖ –¢–æ–ª—å–∫–æ operator
supportOnly; // ‚úÖ –¢–æ–ª—å–∫–æ support
operatorAndSupport; // ‚úÖ Operator –ò–õ–ò Support
```

**‚úÖ –í–´–í–û–î:** –î–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã orders –Ω—É–∂–µ–Ω `protectedProcedure` + –ª–æ–≥–∏–∫–∞ –≤–Ω—É—Ç—Ä–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ä–æ–ª–∏.

---

### ‚úÖ 2.3. –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è (i18n)

**–§–∞–π–ª:** `apps/web/messages/` (–º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

**–°—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤:**

```
messages/
  en/
    layout.json          # ‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è
    home-page.json
  ru/
    layout.json          # ‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è
    home-page.json
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞ (Rule 8: –ù–ï –ü–†–ï–î–ü–û–õ–ê–ì–ê–¢–¨):**

**–§–∞–π–ª:** `apps/web/src/components/app-header.tsx` (—Å—Ç—Ä–æ–∫–∞ 269)

```typescript
{
  t('navigation.orders');
} // ‚úÖ –ö–õ–Æ–ß –£–ñ–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø
```

**‚úÖ –í–´–í–û–î:** –ü–µ—Ä–µ–≤–æ–¥ `navigation.orders` –£–ñ–ï –î–û–õ–ñ–ï–ù —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ `layout.json`. –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∫–ª—é—á–∏ –¥–ª—è —Å–∞–º–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã, –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –∏ —Ç.–¥.).

---

## üö® –§–ê–ó–ê 3: –í—ã—è–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

### ‚ö†Ô∏è 3.1. –ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–∞—Ä—à—Ä—É—Ç–æ–≤

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ –ø–∞–ø–∫–∞ `/orders`?

**–ù–∞–π–¥–µ–Ω–æ:**

- `apps/web/app/[locale]/order/[orderId]/` - ‚úÖ –î–µ—Ç–∞–ª–∏ –û–î–ù–û–ì–û –∑–∞–∫–∞–∑–∞ (singular)
- `apps/web/app/[locale]/orders/` - ‚ùå –ù–ï –°–£–©–ï–°–¢–í–£–ï–¢ (plural)

**‚úÖ –í–´–í–û–î:** –ö–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –ù–ï–¢. –ú–∞—Ä—à—Ä—É—Ç—ã —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è: `/order/:id` vs `/orders`.

---

### ‚ö†Ô∏è 3.2. API –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ù–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –ª–∏ endpoints?

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ endpoints:**

1. `user.orders.getOrderHistory` - –¥–ª—è USER (—Å–≤–æ–∏ –∑–∞–∫–∞–∑—ã)
2. `operator.getPendingOrders` - –¥–ª—è OPERATOR (–≤—Å–µ –∑–∞–∫–∞–∑—ã —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ —Å—Ç–∞—Ç—É—Å—É)
3. `exchange.getOrderHistory` - –ø—É–±–ª–∏—á–Ω—ã–π endpoint –ø–æ email

**‚úÖ –í–´–í–û–î:** –ö–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –ù–ï–¢. Endpoints —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ —Ä–æ–ª—è–º. –ù–û –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ï–î–ò–ù–´–ô endpoint –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ä–æ–ª—å –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ.

---

### ‚ö†Ô∏è 3.3. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏

**–†–∏—Å–∫:** –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏/—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏/–ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

**‚úÖ –†–ï–®–ï–ù–ò–ï:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `packages/utils/src/order-utils.ts::processOrders()` - –µ–¥–∏–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –≤—Å–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.

---

## üì¶ –§–ê–ó–ê 4: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ—á–µ–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

### ‚úÖ 4.1. –°–æ–∑–¥–∞–Ω–∏–µ –ù–û–í–û–ì–û API endpoint (–µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞)

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `apps/web/src/server/trpc/routers/user/orders.ts`

**–ù–æ–≤—ã–π –º–µ—Ç–æ–¥ (–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ):**

```typescript
getAllOrdersForCurrentUser: protectedProcedure
  .input(
    z.object({
      page: z.number().min(1).default(1),
      pageSize: z.number().min(1).max(100).default(20),
      status: securityEnhancedOrderStatusSchema.optional(),
      search: z.string().optional(),
      sortBy: z.enum(['newest', 'oldest']).default('newest'),
    })
  )
  .query(async ({ input, ctx }) => {
    const user = await validateUserAccess(ctx.user.id);
    const userRole = getUserRoleForApp(user, 'web');

    // ‚úÖ –†–û–õ–¨-BASED –õ–û–ì–ò–ö–ê
    let allOrders: Order[];
    if (userRole === 'user') {
      allOrders = await orderManager.findByUserId(user.id); // –¢–æ–ª—å–∫–æ —Å–≤–æ–∏
    } else {
      allOrders = await orderManager.getAll(); // –í—Å–µ –∑–∞–∫–∞–∑—ã (operator/support)
    }

    // ‚úÖ –ü–ï–†–ï–ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –£–¢–ò–õ–ò–¢
    const result = processOrders(allOrders, {
      filters: { status: input.status },
      sortBy: input.sortBy,
      pagination: {
        limit: input.pageSize,
        offset: (input.page - 1) * input.pageSize,
      },
    });

    return { orders: result.items, total: result.total, hasMore: result.hasMore };
  });
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –í–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö endpoints (`user.orders.getOrderHistory` –∏ `operator.getPendingOrders`), —Å–æ–∑–¥–∞–µ–º –ï–î–ò–ù–£–Æ —Ç–æ—á–∫—É –¥–æ—Å—Ç—É–ø–∞ —Å —Ä–æ–ª—å-based –ª–æ–≥–∏–∫–æ–π –≤–Ω—É—Ç—Ä–∏.

---

### ‚úÖ 4.2. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã `/orders`

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `apps/web/app/[locale]/orders/page.tsx`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ):**

```tsx
'use client';

import { DataTable } from '@repo/ui';
import { trpc } from '@/lib/trpc-provider';
import { useTranslations } from 'next-intl';

export default function OrdersPage() {
  const t = useTranslations('OrdersPage');
  const [page, setPage] = useState(1);
  const [search, setSearch] = useState('');

  const { data, isLoading } = trpc.user.orders.getAllOrdersForCurrentUser.useQuery({
    page,
    pageSize: 20,
    search,
  });

  return (
    <DataTable data={data?.orders} isLoading={isLoading} searchTerm={search}>
      <DataTable.Container variant="bordered">
        <DataTable.Header title={t('title')} description={t('description')} />
        <DataTable.Filters searchPlaceholder={t('searchPlaceholder')} />
        <DataTable.Content>
          <DataTable.TableWrapper>{/* –¢–∞–±–ª–∏—Ü–∞ —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ */}</DataTable.TableWrapper>
        </DataTable.Content>
        <DataTable.Pagination showInfo={true} />
      </DataTable.Container>
    </DataTable>
  );
}
```

---

### ‚úÖ 4.3. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `apps/web/messages/{en,ru}/orders-page.json`

**–ù–æ–≤—ã–π —Ñ–∞–π–ª (–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ):**

```json
{
  "title": "My Orders",
  "description": "View and manage your orders",
  "searchPlaceholder": "Search orders...",
  "columns": {
    "orderId": "Order ID",
    "date": "Date",
    "amount": "Amount",
    "status": "Status",
    "currency": "Currency"
  },
  "noOrders": "No orders found",
  "loadingOrders": "Loading orders..."
}
```

---

## üîç –§–ê–ó–ê 5: –£—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã

### ‚ùì 5.1. –ü–æ–∏—Å–∫: –ü–æ –∫–∞–∫–∏–º –ø–æ–ª—è–º?

**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –í `order-utils.ts` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ø–æ–∏—Å–∫ –ø–æ `userEmail` —á–µ—Ä–µ–∑ `userEmailCache`.

**–í–æ–ø—Ä–æ—Å—ã:**

1. –ù—É–∂–µ–Ω –ª–∏ –ø–æ–∏—Å–∫ –ø–æ ID –∑–∞–∫–∞–∑–∞?
2. –ù—É–∂–µ–Ω –ª–∏ –ø–æ–∏—Å–∫ –ø–æ —Å—É–º–º–µ?
3. –ù—É–∂–µ–Ω –ª–∏ –ø–æ–∏—Å–∫ –ø–æ –≤–∞–ª—é—Ç–µ?
4. –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏–ª–∏ –Ω—É–∂–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –ø–æ–ª—è–º?

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–∞—á–∞—Ç—å —Å –ø–æ–∏—Å–∫–∞ –ø–æ `orderId` (publicId) - —Å–∞–º—ã–π —á–∞—Å—Ç—ã–π use case.

---

### ‚ùì 5.2. –ö–æ–ª–æ–Ω–∫–∏ —Ç–∞–±–ª–∏—Ü—ã: –ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å?

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–ª—è Order (–∏–∑ —Ç–∏–ø–æ–≤):**

```typescript
interface Order {
  id: string; // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ID
  publicId: string; // –ü—É–±–ª–∏—á–Ω—ã–π ID (–¥–ª—è frontend)
  userId: string;
  status: OrderStatus;
  cryptoAmount: number;
  uahAmount: number;
  currency: CryptoCurrency;
  bankId?: string;
  bankName?: string;
  cardNumber?: string;
  depositAddress?: string;
  fixedExchangeRate: number;
  createdAt: Date;
  updatedAt: Date;
  assignedOperatorId?: string;
}
```

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏ (–º–∏–Ω–∏–º—É–º):**

1. **Order ID** (`publicId`) - –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –¥–µ—Ç–∞–ª–∏
2. **Date** (`createdAt`) - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
3. **Amount** (`cryptoAmount` + `currency`) - —Å—É–º–º–∞ –∫—Ä–∏–ø—Ç—ã
4. **UAH Amount** (`uahAmount`) - —Å—É–º–º–∞ –≤ –≥—Ä–∏–≤–Ω–∞—Ö
5. **Status** (`status`) - —Å—Ç–∞—Ç—É—Å —Å badge
6. **Actions** - –∫–Ω–æ–ø–∫–∞ "View Details"

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**

- **Bank** (`bankName`) - –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
- **Operator** (`assignedOperatorId`) - –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤

**–í–æ–ø—Ä–æ—Å:** –ù—É–∂–Ω—ã –ª–∏ —Ä–∞–∑–Ω—ã–µ –Ω–∞–±–æ—Ä—ã –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è USER –∏ OPERATOR?

---

### ‚ùì 5.3. –ü–∞–≥–∏–Ω–∞—Ü–∏—è: Offset –∏–ª–∏ Cursor-based?

**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** `paginateOrders` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ –ø–æ–¥—Ö–æ–¥–∞.

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:**

- `user.orders.getOrderHistory` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç offset (page/pageSize)
- `operator.getPendingOrders` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç cursor

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **offset-based** (page/pageSize) –¥–ª—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ —Å user API –∏ –ø—Ä–æ—Å—Ç–æ—Ç—ã UI.

---

### ‚ùì 5.4. –°—Ç–∞—Ç—É—Å—ã: –ù—É–∂–Ω–∞ –ª–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º?

**–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã (–∏–∑ `ORDER_STATUSES`):**

```typescript
ORDER_STATUSES = {
  PENDING: 'pending',
  PROCESSING: 'processing',
  PAID: 'paid',
  CONFIRMED: 'confirmed',
  COMPLETED: 'completed',
  CANCELLED: 'cancelled',
  EXPIRED: 'expired',
  REFUNDED: 'refunded',
};
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å dropdown —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ –≤ v2).

---

## üìä –§–ê–ó–ê 6: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å

### ‚úÖ 6.1. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

| –ü–∞—Ç—Ç–µ—Ä–Ω                  | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ                                 | –°—Ç–∞—Ç—É—Å |
| ------------------------ | ------------------------------------------ | ------ |
| Next.js App Router       | `app/[locale]/orders/page.tsx`             | ‚úÖ     |
| i18n (next-intl)         | `useTranslations('OrdersPage')`            | ‚úÖ     |
| tRPC API                 | `trpc.user.orders.getAllOrders.useQuery()` | ‚úÖ     |
| Compound Components      | `<DataTable.Container>`                    | ‚úÖ     |
| –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã | `processOrders()`                          | ‚úÖ     |
| –†–æ–ª—å-based –¥–æ—Å—Ç—É–ø        | `getUserRoleForApp()`                      | ‚úÖ     |
| Design-tokens            | Tailwind classes –∏–∑ preset                 | ‚úÖ     |

**‚úÖ –í–´–í–û–î:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –°–û–•–†–ê–ù–Ø–ï–¢–°–Ø. –í—Å–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Å–æ–≥–ª–∞—Å—É—é—Ç—Å—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º.

---

### ‚úÖ 6.2. –ü—Ä–∏–Ω—Ü–∏–ø—ã DRY –∏ SOLID

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

1. **DataTable** - ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–æ—Ç–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
2. **order-utils** - ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º —É—Ç–∏–ª–∏—Ç—ã
3. **user-role-helpers** - ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–æ–ª–µ–π
4. **Header –Ω–∞–≤–∏–≥–∞—Ü–∏—è** - ‚úÖ –£–ñ–ï –ì–û–¢–û–í–ê, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º
5. **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è** - ‚úÖ –†–∞—Å—à–∏—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–∏—Å—Ç–µ–º—É

**‚úÖ –í–´–í–û–î:** –ù–£–õ–ï–í–û–ï –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ.

---

## üìà –§–ê–ó–ê 7: –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã

### ‚úÖ 7.1. –í–ª–∏—è–Ω–∏–µ –Ω–∞ API

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

- ‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ endpoint `user.orders.getAllOrdersForCurrentUser`
- ‚úÖ –ù–ï –¢–†–û–ì–ê–ï–ú —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ endpoints

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã:** –ú–ò–ù–ò–ú–ê–õ–¨–ù–û–ï. –ù–æ–≤—ã–π endpoint –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω.

---

### ‚úÖ 7.2. –í–ª–∏—è–Ω–∏–µ –Ω–∞ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

- ‚úÖ –ù–ï –¢–†–û–ì–ê–ï–ú DataTable (–∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å)
- ‚úÖ –ù–ï –¢–†–û–ì–ê–ï–ú Header (–Ω–∞–≤–∏–≥–∞—Ü–∏—è –£–ñ–ï –ì–û–¢–û–í–ê)
- ‚úÖ –ù–ï –¢–†–û–ì–ê–ï–ú —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–æ—Ä–º—ã

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ UI:** –ù–£–õ–ï–í–û–ï. –ü–æ–ª–Ω–æ–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ.

---

### ‚úÖ 7.3. –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–û—Ü–µ–Ω–∫–∞:**

1. **Database queries:**
   - USER: `findByUserId(user.id)` - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
   - OPERATOR: `getAll()` - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π, –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–∞—Ö

2. **–ü–∞–≥–∏–Ω–∞—Ü–∏—è:**
   - Offset-based - —Ä–∞–±–æ—Ç–∞–µ—Ç in-memory –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤
   - ‚ö†Ô∏è **–†–ò–°–ö:** –ü—Ä–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–∞—Ö (>10000 –∑–∞–∫–∞–∑–æ–≤) –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ

3. **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
   - –î–ª—è v1: –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å (in-memory –ø–∞–≥–∏–Ω–∞—Ü–∏—è)
   - –î–ª—è v2: —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å database-level –ø–∞–≥–∏–Ω–∞—Ü–∏—é —Å `skip`/`take` –≤ Prisma

---

## üéØ –§–ê–ó–ê 8: –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### ‚úÖ 8.1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

**–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**

```
apps/web/
  app/[locale]/
    orders/
      page.tsx                    # ‚úÖ –ù–û–í–´–ô - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–ø–∏—Å–∫–∞
      layout.tsx                  # ‚úÖ –ù–û–í–´–ô (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - layout –¥–ª—è orders —Å–µ–∫—Ü–∏–∏
  messages/
    en/orders-page.json           # ‚úÖ –ù–û–í–´–ô - –ø–µ—Ä–µ–≤–æ–¥—ã EN
    ru/orders-page.json           # ‚úÖ –ù–û–í–´–ô - –ø–µ—Ä–µ–≤–æ–¥—ã RU
  src/
    server/trpc/routers/user/
      orders.ts                   # ‚úÖ –†–ê–°–®–ò–†–ò–¢–¨ - –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π endpoint
```

**–ù–ï –¢–†–û–ì–ê–¢–¨:**

- ‚úÖ `apps/web/src/components/app-header.tsx` - –Ω–∞–≤–∏–≥–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞
- ‚úÖ `packages/ui/src/components/data-table-compound.tsx` - –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º
- ‚úÖ `packages/utils/src/order-utils.ts` - –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º
- ‚úÖ `packages/constants/src/app-routes.ts` - –º–∞—Ä—à—Ä—É—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω

---

### ‚úÖ 8.2. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π (MVP)

**–ß—Ç–æ —Å–æ–∑–¥–∞—Ç—å:**

1. **–°—Ç—Ä–∞–Ω–∏—Ü–∞** - `apps/web/app/[locale]/orders/page.tsx` (~150 —Å—Ç—Ä–æ–∫)
2. **API endpoint** - —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `user/orders.ts` (~80 —Å—Ç—Ä–æ–∫)
3. **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è** - 2 —Ñ–∞–π–ª–∞ `orders-page.json` (~20 —Å—Ç—Ä–æ–∫ –∫–∞–∂–¥—ã–π)

**–ò—Ç–æ–≥–æ:** ~270 —Å—Ç—Ä–æ–∫ –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞.

**–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º:** ~1500 —Å—Ç—Ä–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞ (DataTable, utilities, role helpers).

---

### ‚úÖ 8.3. –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

| –†–∏—Å–∫                                             | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è                                  |
| ------------------------------------------------ | ----------- | ------- | ------------------------------------------ |
| –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è operator –ø—Ä–∏ >10k –∑–∞–∫–∞–∑–æ–≤ | –°—Ä–µ–¥–Ω—è—è     | –°—Ä–µ–¥–Ω–µ–µ | v2: Database-level –ø–∞–≥–∏–Ω–∞—Ü–∏—è               |
| –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –≤ `layout.json`               | –ù–∏–∑–∫–∞—è      | –ù–∏–∑–∫–æ–µ  | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª—é—á–∏               |
| –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Å—Ç–∞—Ç—É—Å–æ–≤ –º–µ–∂–¥—É UI –∏ API        | –ù–∏–∑–∫–∞—è      | –°—Ä–µ–¥–Ω–µ–µ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ORDER_STATUSES` –∏–∑ constants |
| –ü—Ä–æ–±–ª–µ–º—ã —Å —Ä–æ–ª—è–º–∏ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ `appRoles`      | –ù–∏–∑–∫–∞—è      | –í—ã—Å–æ–∫–æ–µ | –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ `getUserRoleForApp()`      |

---

## üìã –§–ê–ó–ê 9: –î–µ—Ç–∞–ª—å–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–ª–æ–Ω–æ–∫

### ‚úÖ 9.1. –ö–æ–ª–æ–Ω–∫–∏ –¥–ª—è USER —Ä–æ–ª–∏

| –ö–æ–ª–æ–Ω–∫–∞           | –ü–æ–ª–µ                      | –¢–∏–ø      | –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ                            |
| ----------------- | ------------------------- | -------- | ---------- | ----------------------------------- |
| **Order ID**      | `publicId`                | `string` | ‚ùå         | –ü—É–±–ª–∏—á–Ω—ã–π ID –∑–∞–∫–∞–∑–∞ (–∫–ª–∏–∫ ‚Üí –¥–µ—Ç–∞–ª–∏) |
| **Date**          | `createdAt`               | `Date`   | ‚úÖ         | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é DESC)   |
| **Crypto Amount** | `cryptoAmount + currency` | `string` | ‚úÖ         | "0.5 BTC"                           |
| **UAH Amount**    | `uahAmount`               | `number` | ‚úÖ         | "15,000 UAH"                        |
| **Status**        | `status`                  | `badge`  | ‚ùå         | Badge —Å —Ü–≤–µ—Ç–æ–º –ø–æ —Å—Ç–∞—Ç—É—Å—É           |
| **Actions**       | -                         | `button` | ‚ùå         | "View Details" –∫–Ω–æ–ø–∫–∞               |

**–í—Å–µ–≥–æ:** 6 –∫–æ–ª–æ–Ω–æ–∫

---

### ‚úÖ 9.2. –ö–æ–ª–æ–Ω–∫–∏ –¥–ª—è OPERATOR/SUPPORT —Ä–æ–ª–∏

| –ö–æ–ª–æ–Ω–∫–∞           | –ü–æ–ª–µ                      | –¢–∏–ø       | –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ                             |
| ----------------- | ------------------------- | --------- | ---------- | ------------------------------------ |
| **Order ID**      | `publicId`                | `string`  | ‚ùå         | –ü—É–±–ª–∏—á–Ω—ã–π ID –∑–∞–∫–∞–∑–∞                  |
| **Date**          | `createdAt`               | `Date`    | ‚úÖ         | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è                        |
| **User Email**    | `userId ‚Üí user.email`     | `string`  | ‚ùå         | Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—á–µ—Ä–µ–∑ relation)  |
| **Crypto Amount** | `cryptoAmount + currency` | `string`  | ‚úÖ         | "0.5 BTC"                            |
| **UAH Amount**    | `uahAmount`               | `number`  | ‚úÖ         | "15,000 UAH"                         |
| **Bank**          | `bankName`                | `string`  | ‚ùå         | –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞                       |
| **Status**        | `status`                  | `badge`   | ‚ùå         | Badge —Å —Ü–≤–µ—Ç–æ–º                       |
| **Operator**      | `assignedOperatorId`      | `string`  | ‚ùå         | Assigned operator (–µ—Å–ª–∏ –µ—Å—Ç—å)        |
| **Actions**       | -                         | `buttons` | ‚ùå         | "View" + "Take Order" (–µ—Å–ª–∏ pending) |

**–í—Å–µ–≥–æ:** 9 –∫–æ–ª–æ–Ω–æ–∫

---

### ‚úÖ 9.3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (MVP):**

- –ü–æ–∏—Å–∫ –ø–æ `publicId` (Order ID)
- –ì–ª–æ–±–∞–ª—å–Ω—ã–π search input –≤ `DataTable.Filters`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (Future):**

- –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É (dropdown)
- –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ (date range picker)
- –§–∏–ª—å—Ç—Ä –ø–æ –≤–∞–ª—é—Ç–µ (multi-select)

---

## üöÄ –§–ê–ó–ê 10: –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–¥–ª—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞)

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ API

1. –†–∞—Å—à–∏—Ä–∏—Ç—å `apps/web/src/server/trpc/routers/user/orders.ts`
2. –î–æ–±–∞–≤–∏—Ç—å endpoint `getAllOrdersForCurrentUser` —Å —Ä–æ–ª—å-based –ª–æ–≥–∏–∫–æ–π
3. –î–æ–±–∞–≤–∏—Ç—å input schema —Å `search`, `page`, `pageSize`, `sortBy`
4. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ endpoint (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –≠—Ç–∞–ø 2: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

1. –°–æ–∑–¥–∞—Ç—å `apps/web/app/[locale]/orders/page.tsx`
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `DataTable` compound component
3. –ü–æ–¥–∫–ª—é—á–∏—Ç—å tRPC query `user.orders.getAllOrdersForCurrentUser`
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏ —Å–æ–≥–ª–∞—Å–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ (—Ä–∞–∑–Ω—ã–µ –¥–ª—è USER/OPERATOR)

### –≠—Ç–∞–ø 3: –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è

1. –°–æ–∑–¥–∞—Ç—å `apps/web/messages/en/orders-page.json`
2. –°–æ–∑–¥–∞—Ç—å `apps/web/messages/ru/orders-page.json`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª—é—á–∏ –≤ `layout.json` –¥–ª—è `navigation.orders`

### –≠—Ç–∞–ø 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –¥–ª—è USER (–≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–∫–∞–∑—ã)
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –¥–ª—è OPERATOR (–≤–∏–¥–∏—Ç –≤—Å–µ –∑–∞–∫–∞–∑—ã)
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é (–ø–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏)
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ (–ø–æ Order ID)
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É (–ø–æ –¥–∞—Ç–µ)
6. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ (–∫–ª–∏–∫ –ø–æ ID)

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ó–∞–¥–∞—á–∞ –ü–û–õ–ù–û–°–¢–¨–Æ –ü–û–ù–Ø–¢–ù–ê –∏ –ì–û–¢–û–í–ê –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.**

### –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã:

1. ‚úÖ **–ù–ï–¢ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
2. ‚úÖ **–ù–ï–¢ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤** - –º–∞—Ä—à—Ä—É—Ç—ã –∏ API –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã
3. ‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å** - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤—Å–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –ø—Ä–æ–µ–∫—Ç–∞
4. ‚úÖ **–†–æ–ª—å-based –¥–æ—Å—Ç—É–ø** - –≥–æ—Ç–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —á–µ—Ä–µ–∑ `getUserRoleForApp()`
5. ‚úÖ **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä–µ–º** - ~270 —Å—Ç—Ä–æ–∫ –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞ + ~1500 —Å—Ç—Ä–æ–∫ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –†–∏—Å–∫–∏:

‚ö†Ô∏è **–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫:** –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è operator –ø—Ä–∏ >10k –∑–∞–∫–∞–∑–æ–≤  
‚úÖ **–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** Database-level –ø–∞–≥–∏–Ω–∞—Ü–∏—è –≤ v2

---

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü–µ—Ä–µ–¥–∞—Ç—å —ç—Ç–æ—Ç –∞–Ω–∞–ª–∏–∑ –ê–≥–µ–Ω—Ç—É-–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä—É –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ—à–µ–Ω–∏—è.
