# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Topics –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –ß—Ç–æ —ç—Ç–æ?

**Telegram Topics (–¢–µ–º—ã)** - —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ "–≤–∫–ª–∞–¥–∫–∏" –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø—ã. –ö–∞–∂–¥–∞—è —Ç–µ–º–∞ –∏–º–µ–µ—Ç —Å–≤–æ–π `message_thread_id`, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ç–µ–º—É.

## –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

–í–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –≥—Ä—É–ø–ø –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–Ω–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã, –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã–µ, –æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ), –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–æ–¥–Ω—É –≥—Ä—É–ø–ø—É Orders —Å —Ç—Ä–µ–º—è —Ç–µ–º–∞–º–∏**:

- üÜï –ù–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã
- ‚ùå –û—Ç–º–µ–Ω—ë–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã
- ‚úÖ –û–ø–ª–∞—á–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã

## –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å?

### –®–∞–≥ 1: –í–∫–ª—é—á–∏—Ç—å Topics –≤ –≥—Ä—É–ø–ø–µ Orders

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≥—Ä—É–ø–ø—É Orders –≤ Telegram
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã ‚Üí **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–æ–π**
3. –í–∫–ª—é—á–∏—Ç–µ –æ–ø—Ü–∏—é **"–¢–µ–º—ã"** (Topics)
4. –ì—Ä—É–ø–ø–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–µ—Ç —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–æ–π —Å —Ñ–æ—Ä—É–º–æ–º

### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å —Ç–µ–º—ã

1. –í –≥—Ä—É–ø–ø–µ Orders –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"+ –°–æ–∑–¥–∞—Ç—å —Ç–µ–º—É"**
2. –°–æ–∑–¥–∞–π—Ç–µ 3 —Ç–µ–º—ã:
   - **"–ù–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã"** (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —ç–º–æ–¥–∑–∏ üÜï)
   - **"–û—Ç–º–µ–Ω—ë–Ω–Ω—ã–µ"** (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —ç–º–æ–¥–∑–∏ ‚ùå)
   - **"–û–ø–ª–∞—á–µ–Ω–Ω—ã–µ"** (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —ç–º–æ–¥–∑–∏ ‚úÖ)

### –®–∞–≥ 3: –ü–æ–ª—É—á–∏—Ç—å Topic ID –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–µ–º—ã

–ï—Å—Ç—å 2 —Å–ø–æ—Å–æ–±–∞:

#### –°–ø–æ—Å–æ–± 1: –ò–∑ URL —Ç–µ–º—ã (Web Telegram)

1. –û—Ç–∫—Ä–æ–π—Ç–µ Web Telegram (web.telegram.org)
2. –û—Ç–∫—Ä–æ–π—Ç–µ –≥—Ä—É–ø–ø—É Orders
3. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Ç–µ–º—É
4. –í URL –±—É–¥–µ—Ç: `.../#-1003037178274/2`
5. –ü–æ—Å–ª–µ–¥–Ω—è—è —Ü–∏—Ñ—Ä–∞ –ø–æ—Å–ª–µ `/` - —ç—Ç–æ `message_thread_id` (–≤ –ø—Ä–∏–º–µ—Ä–µ: `2`)

#### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ –ª–æ–≥–∏ –±–æ—Ç–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ–º—É –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ç–µ–º—É
3. –í –ª–æ–≥–∞—Ö –±–æ—Ç–∞ –ø–æ—è–≤–∏—Ç—Å—è `message_thread_id` –¥–ª—è —ç—Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Ç–∫—Ä–æ–π—Ç–µ `apps/telegram-bot/.env` –∏ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫–∏:

```bash
# ID —Ç–µ–º—ã –¥–ª—è –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤
TELEGRAM_NEW_ORDERS_TOPIC_ID=2

# ID —Ç–µ–º—ã –¥–ª—è –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
TELEGRAM_CANCELLED_ORDERS_TOPIC_ID=3

# ID —Ç–µ–º—ã –¥–ª—è –æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
TELEGRAM_PAID_ORDERS_TOPIC_ID=4
```

**–ó–∞–º–µ–Ω–∏—Ç–µ —Ü–∏—Ñ—Ä—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ Topic ID**, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –ø–æ–ª—É—á–∏–ª–∏ –≤ –®–∞–≥–µ 3.

### –®–∞–≥ 5: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞

```bash
npm run dev
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –õ–æ–≥–∏–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏

1. **–ï—Å–ª–∏ Topics –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã** (`TELEGRAM_*_TOPIC_ID` —É–∫–∞–∑–∞–Ω—ã):
   - `new_order` ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ —Ç–µ–º—É —Å ID –∏–∑ `TELEGRAM_NEW_ORDERS_TOPIC_ID`
   - `order_cancelled` ‚Üí –≤ —Ç–µ–º—É `TELEGRAM_CANCELLED_ORDERS_TOPIC_ID`
   - `order_paid` ‚Üí –≤ —Ç–µ–º—É `TELEGRAM_PAID_ORDERS_TOPIC_ID`

2. **–ï—Å–ª–∏ Topics –ù–ï –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã**:
   - –í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏–¥—É—Ç –≤ **General topic** (–æ—Å–Ω–æ–≤–Ω–∞—è –ª–µ–Ω—Ç–∞ –≥—Ä—É–ø–ø—ã)

3. **–ï—Å–ª–∏ –≥—Ä—É–ø–ø–∞ Orders –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞** (`TELEGRAM_ORDERS_CHAT_ID` –ø—É—Å—Ç–æ–π):
   - Fallback –Ω–∞ broadcast –≤—Å–µ–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º (—Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞)

### –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –ì—Ä—É–ø–ø–∞ Orders
TELEGRAM_ORDERS_CHAT_ID=-1003037178274

# Topics –≤–Ω—É—Ç—Ä–∏ –≥—Ä—É–ø–ø—ã Orders
TELEGRAM_NEW_ORDERS_TOPIC_ID=2        # –¢–µ–º–∞ "üÜï –ù–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã"
TELEGRAM_CANCELLED_ORDERS_TOPIC_ID=3  # –¢–µ–º–∞ "‚ùå –û—Ç–º–µ–Ω—ë–Ω–Ω—ã–µ"
TELEGRAM_PAID_ORDERS_TOPIC_ID=4       # –¢–µ–º–∞ "‚úÖ –û–ø–ª–∞—á–µ–Ω–Ω—ã–µ"
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑

```bash
# –í web –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑
# –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ –≤ —Ç–µ–º—É "üÜï –ù–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã"
```

### 2. –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑

```bash
# –ù–∞–∂–º–∏—Ç–µ "–û—Ç–º–µ–Ω–∏—Ç—å" –Ω–∞ –∑–∞–∫–∞–∑–µ
# –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ –≤ —Ç–µ–º—É "‚ùå –û—Ç–º–µ–Ω—ë–Ω–Ω—ã–µ"
```

### 3. –û—Ç–º–µ—Ç–∏—Ç—å –∑–∞–∫–∞–∑ –∫–∞–∫ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–π

```bash
# –ù–∞–∂–º–∏—Ç–µ "–û–ø–ª–∞—Ç–∏–ª" –Ω–∞ –∑–∞–∫–∞–∑–µ
# –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ –≤ —Ç–µ–º—É "‚úÖ –û–ø–ª–∞—á–µ–Ω–Ω—ã–µ"
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

```bash
# –õ–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:
TELEGRAM_NOTIFICATION_TO_ORDERS_CHANNEL {
  notificationType: 'new_order',
  chatId: '-1003037178274',
  topicId: 2,  # ‚Üê Topic ID
  orderId: 'xxx'
}
```

## Troubleshooting

### –°–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ General topic, –∞ –Ω–µ –≤ —Ç–µ–º—É

**–ü—Ä–∏—á–∏–Ω–∞:** Topic ID —É–∫–∞–∑–∞–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–ª–∏ —Ç–µ–º–∞ –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞.

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Topic ID –≤ URL —Ç–µ–º—ã
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ç–µ–º–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –±–æ—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –ø–∏—Å–∞—Ç—å –≤ —Ç–µ–º—É

### –ë–æ—Ç –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ç–µ–º—É

**–ü—Ä–∏—á–∏–Ω–∞:** –ë–æ—Ç –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤ –≤ —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–µ.

**–†–µ—à–µ–Ω–∏–µ:**

1. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø—É –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
2. –î–∞–π—Ç–µ –ø—Ä–∞–≤–∞: "–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π", "–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ —Ç–µ–º—ã"

### –•–æ—á—É –æ—Ç–∫–ª—é—á–∏—Ç—å Topics –∏ –≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ –≤ General

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ—Å—Ç–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```bash
# TELEGRAM_NEW_ORDERS_TOPIC_ID=2
# TELEGRAM_CANCELLED_ORDERS_TOPIC_ID=3
# TELEGRAM_PAID_ORDERS_TOPIC_ID=4
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ - –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–π–¥—É—Ç –≤ General topic.

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Topics

‚úÖ **–û–¥–Ω–∞ –≥—Ä—É–ø–ø–∞** –≤–º–µ—Å—Ç–æ —Ç—Ä—ë—Ö –æ—Ç–¥–µ–ª—å–Ω—ã—Ö  
‚úÖ **–£–¥–æ–±–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è** –ø–æ –≤–∫–ª–∞–¥–∫–∞–º  
‚úÖ **–ú–µ–Ω—å—à–µ —Å–ø–∞–º–∞** –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö  
‚úÖ **–ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ** –º–µ–∂–¥—É —Ç–∏–ø–∞–º–∏ –∑–∞–∫–∞–∑–æ–≤  
‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** (—Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Topics)

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **apps/telegram-bot/.env**
   - –î–æ–±–∞–≤–ª–µ–Ω—ã `TELEGRAM_*_TOPIC_ID` –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

2. **turbo.json**
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ env –¥–ª—è –≤—Å–µ—Ö –∑–∞–¥–∞—á

3. **apps/telegram-bot/pages/api/notify-operators.ts**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `getTopicIdForNotificationType()`
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ `notifyOperator()` - –¥–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `topicId`
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ `sendOperatorNotifications()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Topics

### Telegram API

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä `message_thread_id` –≤ –º–µ—Ç–æ–¥–µ `sendMessage`:

```typescript
{
  chat_id: "-1003037178274",
  text: "...",
  parse_mode: "HTML",
  reply_markup: {...},
  message_thread_id: 2  // ‚Üê Topic ID
}
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- [Telegram Topics Documentation](https://telegram.org/blog/topics-in-groups-collectible-usernames)
- [Telegram Bot API - sendMessage](https://core.telegram.org/bots/api#sendmessage)
