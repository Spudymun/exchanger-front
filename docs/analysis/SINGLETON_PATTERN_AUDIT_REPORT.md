# üîç –ê—É–¥–∏—Ç –ø—Ä–æ–µ–∫—Ç–∞: –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å Global Singleton Pattern

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 6 —è–Ω–≤–∞—Ä—è 2025  
**–î–∞—Ç–∞ –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∫–∏:** 6 –æ–∫—Ç—è–±—Ä—è 2025  
**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 6 –æ–∫—Ç—è–±—Ä—è 2025  
**–¶–µ–ª—å:** –ù–∞–π—Ç–∏ –º–µ—Å—Ç–∞ –≥–¥–µ –ù–ï–û–ë–•–û–î–ò–ú singleton –Ω–æ –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω  
**–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è:** 100% –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ grep_search, semantic_search, file_search, read_file  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–†–ò–¢–ò–ß–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ò–°–ü–†–ê–í–õ–ï–ù–´

---

## üìã Executive Summary

**–ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –º–µ—Å—Ç:** 3 (–æ–¥–Ω–∞ –Ω–æ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–∏ –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∫–µ)  
**–£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** 2 (PrismaClient, rateLimitStore)  
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ 6 –æ–∫—Ç—è–±—Ä—è 2025:** 1 (Idempotency Cache ‚úÖ)  
**–¢—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** 1 (Translation Cache - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ö—Ä–∏—Ç–µ—Ä–∏–π –ù–ï–û–ë–•–û–î–ò–ú–û–°–¢–ò:** In-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –Ω–∞ module level –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É Next.js hot-reload.

**üÜï –ù–û–í–ê–Ø –ù–ê–•–û–î–ö–ê –ø—Ä–∏ –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∫–µ:**

- Translation Cache (`apps/web/src/i18n/request.ts`) - –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**‚ùå –ò–°–ö–õ–Æ–ß–ï–ù–û –∏–∑ –æ—Ç—á–µ—Ç–∞ –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞:**

- Email Rate Limit (—É–∂–µ –∑–∞—â–∏—â–µ–Ω–æ `rateLimitMiddleware.createOrder`)
- Telegram Bot Sessions (–Ω–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ –¥–ª—è web production)

### üìä –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –ø—Ä–æ–±–ª–µ–º–∞–º

| #   | –ü—Ä–æ–±–ª–µ–º–∞                 | –§–∞–π–ª                           | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç   | –ö–æ–≥–¥–∞ –ø—Ä–æ—è–≤–∏—Ç—Å—è                | –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è                   | –°—Ç–∞—Ç—É—Å           |
| --- | ------------------------ | ------------------------------ | ----------- | ------------------------------ | ----------------------------- | ---------------- |
| 1   | **Idempotency Cache**    | `middleware/idempotency.ts:16` | üî¥ –ö–†–ò–¢–ò–ß–ù–û | Hot-reload –≤–æ –≤—Ä–µ–º—è –æ–ø–µ—Ä–∞—Ü–∏–π   | –î—É–±–ª–∏—Ä—É—é—â–∏–µ –∑–∞–∫–∞–∑—ã/–ø–ª–∞—Ç–µ–∂–∏    | ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û    |
| 2   | **Translation Cache** üÜï | `i18n/request.ts:56`           | üü° –°–†–ï–î–ù–ò–ô  | –ö–∞–∂–¥—ã–π hot-reload              | –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã 150x –º–µ–¥–ª–µ–Ω–Ω–µ–µ   | ‚ö†Ô∏è TODO          |
| 3   | **Pricing Service**      | `calculations.ts:103`          | üü¢ –ù–ò–ó–ö–ò–ô   | Hot-reload —Ç–µ—Ä—è–µ—Ç cache –∫—É—Ä—Å–æ–≤ | Acceptable HMR overhead (dev) | ‚ÑπÔ∏è OK (optional) |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º:** ‚úÖ –ö—Ä–∏—Ç–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ #1 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞! #2 –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏. #3 –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ.

**‚ùå –ò–°–ö–õ–Æ–ß–ï–ù–û –ø–æ—Å–ª–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞:**

- `exchange.ts:588` - –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ –±—ã–ª–æ –û–®–ò–ë–û–ß–ù–´–ú. –ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

## ‚úÖ –£–ñ–ï –ò–°–ü–†–ê–í–õ–ï–ù–û (Best Practices)

### 1. PrismaClient Singleton ‚úÖ

**–§–∞–π–ª:** `packages/session-management/src/utils/prisma-singleton.ts`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù  
**–ü–∞—Ç—Ç–µ—Ä–Ω:** `global.__prismaInstance`

```typescript
declare global {
  var __prismaInstance: PrismaClient | undefined;
}

export function getPrismaClient(config: PrismaClientConfig): PrismaClient {
  if (process.env.NODE_ENV !== 'production' && global.__prismaInstance) {
    return global.__prismaInstance;
  }

  if (!global.__prismaInstance) {
    global.__prismaInstance = new PrismaClient({
      /* config */
    });
  }

  return global.__prismaInstance;
}
```

**–ò—Å—Ç–æ—á–Ω–∏–∫:** [Prisma Docs - Prevent hot reloading](https://www.prisma.io/docs/orm/prisma-client/setup-and-configuration/databases-connections#prevent-hot-reloading-from-creating-new-instances-of-prismaclient)

---

### 2. Rate Limit Store ‚úÖ

**–§–∞–π–ª:** `apps/web/src/server/trpc/middleware/rateLimit.ts`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù (6 —è–Ω–≤–∞—Ä—è 2025)  
**–ü–∞—Ç—Ç–µ—Ä–Ω:** `global.__rateLimitStore`

```typescript
declare global {
  var __rateLimitStore: Map<string, { count: number; resetTime: number }> | undefined;
}

const rateLimitStore =
  global.__rateLimitStore || new Map<string, { count: number; resetTime: number }>();

if (!global.__rateLimitStore) {
  console.log(`üöÄ [RATE LIMIT MODULE] Creating NEW store`);
  global.__rateLimitStore = rateLimitStore;
} else {
  console.log(`‚ôªÔ∏è [RATE LIMIT MODULE] Reusing EXISTING store, size: ${rateLimitStore.size}`);
}
```

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `docs/troubleshooting/RATE_LIMIT_HOT_RELOAD_FIX.md`

---

## üö® –¢–†–ï–ë–£–ï–¢–°–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï

### 1. Idempotency Cache ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–§–∞–π–ª:** `apps/web/src/server/trpc/middleware/idempotency.ts`  
**–°—Ç—Ä–æ–∫–∞:** 16  
**–ü—Ä–æ–±–ª–µ–º–∞:** Map —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ hot-reload, —Ç–µ—Ä—è—é—Ç—Å—è idempotency –∫–ª—é—á–∏  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û 6 –æ–∫—Ç—è–±—Ä—è 2025**

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ:**

```typescript
// ‚úÖ Global singleton pattern –¥–ª—è hot-reload environments
declare global {
  var __idempotencyCache: Map<string, { response: unknown; timestamp: number }> | undefined;
}

const idempotencyCache =
  global.__idempotencyCache || new Map<string, { response: unknown; timestamp: number }>();

if (!global.__idempotencyCache) {
  console.log(`üöÄ [IDEMPOTENCY MODULE] Creating NEW cache at ${new Date().toISOString()}`);
  global.__idempotencyCache = idempotencyCache;

  // Cleanup interval —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤–æ–≥–æ cache
  setInterval(() => {
    const now = Date.now();
    for (const [key, record] of idempotencyCache.entries()) {
      if (now - record.timestamp > IDEMPOTENCY_TTL_MS) {
        idempotencyCache.delete(key);
      }
    }
  }, CLEANUP_INTERVAL_MS);
} else {
  console.log(`‚ôªÔ∏è [IDEMPOTENCY MODULE] Reusing EXISTING cache, size: ${idempotencyCache.size}`);
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- ‚úÖ Cache —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ hot-reload
- ‚úÖ Idempotency –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤ dev mode
- ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ ~~–í–´–°–û–ö–ò–ô~~ ‚Üí ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**

#### üìò –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

**üîç –ì–î–ï –ø—Ä–æ–±–ª–µ–º–∞:**

- –§–∞–π–ª: `apps/web/src/server/trpc/middleware/idempotency.ts`, —Å—Ç—Ä–æ–∫–∞ 16
- –ü—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–æ–¥: `const idempotencyCache = new Map<string, { response: unknown; timestamp: number }>();`
- –ú–µ—Å—Ç–æ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ: tRPC middleware —Å–ª–æ–π –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ API —Ä–æ—É—Ç–µ—Ä–∞–º–∏

**üéØ –ß–¢–û —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:**

Idempotency (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å) - —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –∑–∞—â–∏—Ç—ã –æ—Ç –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –∫—Ä–∏—Ç–∏—á–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞), —Å–∏—Å—Ç–µ–º–∞ –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–º—É –∫–ª—é—á—É –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ—Ç –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ —Å —Ç–µ–º –∂–µ –∫–ª—é—á–æ–º.

**–ö–∞–∫ –î–û–õ–ñ–ù–û —Ä–∞–±–æ—Ç–∞—Ç—å:**

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ #123 ‚Üí –°–µ—Ä–≤–µ—Ä: OK, –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω
2. –°–µ—Ç—å –≥–ª—é—á–∏—Ç, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –µ—â–µ —Ä–∞–∑ ‚Üí –°–µ—Ä–≤–µ—Ä: –í–∏–∂—É –∫–ª—é—á #123, –≤–æ–∑–≤—Ä–∞—â–∞—é —Ç–æ—Ç –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
3. –†–µ–∑—É–ª—å—Ç–∞—Ç: –û–¥–∏–Ω –∑–∞–∫–∞–∑, –Ω–µ –¥—É–±–ª–∏–∫–∞—Ç ‚úÖ
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –°–ï–ô–ß–ê–° —Å –ø—Ä–æ–±–ª–µ–º–æ–π:**

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ #123 ‚Üí –°–µ—Ä–≤–µ—Ä: OK, –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω, –∫–ª—é—á —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ Map
2. Developer: –ò–∑–º–µ–Ω—è–µ—Ç –∫–æ–¥ ‚Üí Next.js –¥–µ–ª–∞–µ—Ç hot-reload ‚Üí Map –æ–±–Ω—É–ª—è–µ—Ç—Å—è!
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –µ—â–µ —Ä–∞–∑ ‚Üí –°–µ—Ä–≤–µ—Ä: –ù–µ—Ç –∫–ª—é—á–∞ #123 –≤ Map, —Å–æ–∑–¥–∞—é –ù–û–í–´–ô –∑–∞–∫–∞–∑
4. –†–µ–∑—É–ª—å—Ç–∞—Ç: –î–í–ê –∑–∞–∫–∞–∑–∞ –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ! ‚ùå
```

**‚ö†Ô∏è –ö–û–ì–î–ê –ø—Ä–æ—è–≤–∏—Ç—Å—è –ø—Ä–æ–±–ª–µ–º–∞:**

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: Development —Ä–µ–∂–∏–º**

```
–í—Ä–µ–º—è    | –î–µ–π—Å—Ç–≤–∏–µ
---------|----------------------------------------------------------
00:00:00 | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑, idempotency key —Å–æ—Ö—Ä–∞–Ω–µ–Ω
00:00:03 | Developer —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–π–ª ‚Üí Hot reload ‚Üí Map –æ—á–∏—â–µ–Ω
00:00:05 | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ª—É—á–∞–π–Ω–æ –Ω–∞–∂–∏–º–∞–µ—Ç "–°–æ–∑–¥–∞—Ç—å" –µ—â–µ —Ä–∞–∑
         | –°–∏—Å—Ç–µ–º–∞ –ù–ï –í–ò–î–ò–¢ —Å—Ç–∞—Ä—ã–π –∫–ª—é—á ‚Üí —Å–æ–∑–¥–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç
```

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ë—ã—Å—Ç—Ä—ã–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**

```
–í—Ä–µ–º—è    | –î–µ–π—Å—Ç–≤–∏–µ
---------|----------------------------------------------------------
00:00:00 | –ó–∞–ø—Ä–æ—Å 1: –°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂ (–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è)
00:00:01 | Hot reload –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç ‚Üí Map –æ—á–∏—â–µ–Ω
00:00:02 | –ó–∞–ø—Ä–æ—Å 2: –¢–æ—Ç –∂–µ –ø–ª–∞—Ç–µ–∂ (–µ—â–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ)
         | Idempotency –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí –¥–≤–∞ –ø–ª–∞—Ç–µ–∂–∞
```

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: F5 Refresh –≤ –±—Ä–∞—É–∑–µ—Ä–µ**

```
00:00:00 | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ä–º—É
00:00:02 | –ù–∞–∂–∏–º–∞–µ—Ç F5 –≤ –±—Ä–∞—É–∑–µ—Ä–µ ‚Üí Next.js –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –º–æ–¥—É–ª–∏
00:00:03 | –§–æ—Ä–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç—Å—è (browser behavior)
         | Cache –ø—É—Å—Ç–æ–π ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥—É–±–ª–∏–∫–∞—Ç
```

**üí• –†–µ–∞–ª—å–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**

1. **–î—É–±–ª–∏—Ä—É—é—â–∏–µ –∑–∞–∫–∞–∑—ã** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ª—É—á–∞–π–Ω–æ —Å–æ–∑–¥–∞–ª 2-3 –∑–∞–∫–∞–∑–∞
2. **–î—É–±–ª–∏—Ä—É—é—â–∏–µ –ø–ª–∞—Ç–µ–∂–∏** - –¥–µ–Ω—å–≥–∏ —Å–ø–∏—Å–∞–Ω—ã –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
3. **–î—É–±–ª–∏—Ä—É—é—â–∏–µ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª 5 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –ø–∏—Å–µ–º
4. **Database integrity –Ω–∞—Ä—É—à–µ–Ω–∞** - –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**üîß –ü–æ—á–µ–º—É —Å–µ–π—á–∞—Å –ù–ï –∫—Ä–∏—Ç–∏—á–Ω–æ (–Ω–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å):**

- TTL = 5 —Å–µ–∫—É–Ω–¥ (–∫–æ—Ä–æ—Ç–∫–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
- Hot reload –æ–±—ã—á–Ω–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –º–æ–º–µ–Ω—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –í production –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (—Ç–∞–º –Ω–µ—Ç hot-reload)

**‚ö†Ô∏è –ù–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∫—Ä–∏—Ç–∏—á–Ω–æ –ø—Ä–∏:**

- –î–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö (>5 —Å–µ–∫—É–Ω–¥)
- –ê–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Å —á–∞—Å—Ç—ã–º–∏ hot-reloads
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–º–∏—Å—è –∑–∞–ø—Ä–æ—Å–∞–º–∏

---

### 2. Translation Cache ‚ö†Ô∏è –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ (üÜï –ù–û–í–ê–Ø –ù–ê–•–û–î–ö–ê)

**–§–∞–π–ª:** `apps/telegram-bot/src/lib/telegram-bot.ts`  
**–°—Ç—Ä–æ–∫–∞:** 21  
**–ü—Ä–æ–±–ª–µ–º–∞:** Map —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ hot-reload, –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã —Ç–µ—Ä—è—é—Ç —Å–µ—Å—Å–∏–∏

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**

```typescript
const sessions = new Map<number, BotSession>();
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**

- ‚ùå –û–ø–µ—Ä–∞—Ç–æ—Ä—ã —Ç–µ—Ä—è—é—Ç —Å–µ—Å—Å–∏—é –ø–æ—Å–ª–µ F5 refresh
- ‚ùå –ù—É–∂–Ω–æ –∑–∞–Ω–æ–≤–æ –ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ hot-reload
- ‚ö†Ô∏è –ü–ª–æ—Ö–æ–π UX –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```typescript
// ‚úÖ Global singleton pattern –¥–ª—è hot-reload environments
declare global {
  var __telegramBotSessions: Map<number, BotSession> | undefined;
}

const sessions = global.__telegramBotSessions || new Map<number, BotSession>();

if (!global.__telegramBotSessions) {
  console.log(`üöÄ [TELEGRAM BOT] Creating NEW sessions store`);
  global.__telegramBotSessions = sessions;
} else {
  console.log(`‚ôªÔ∏è [TELEGRAM BOT] Reusing EXISTING sessions, count: ${sessions.size}`);
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** ÔøΩ –ù–ò–ó–ö–ò–ô (performance optimization)

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**

- `apps/web/src/server/trpc/routers/exchange.ts:588` - —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π instance –Ω–∞ –∫–∞–∂–¥—ã–π query –≤–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `getPricingService()`
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –∑–∞–º–µ–Ω–∏—Ç—å `new SmartPricingService()` –Ω–∞ `getPricingService()`

---

### 3. SmartPricingService Instance ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û (minor optimization needed)

**–§–∞–π–ª:** `packages/exchange-core/src/utils/calculations.ts`  
**–°—Ç—Ä–æ–∫–∞:** 103  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤ production –∏ –ø—Ä–∏ F5 refresh**  
**–ü—Ä–æ–±–ª–µ–º–∞:** ‚ùå –¢–æ–ª—å–∫–æ –ø—Ä–∏ hot-reload (HMR) –≤ development - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**

```typescript
let pricingServiceInstance: SmartPricingService | null = null;

function getPricingService(): SmartPricingService {
  if (!pricingServiceInstance) {
    pricingServiceInstance = new SmartPricingService();
  }
  return pricingServiceInstance;
}
```

**‚úÖ –ü–æ—á–µ–º—É —ç—Ç–æ –ù–ï –ø—Ä–æ–±–ª–µ–º–∞:**

- ‚úÖ **F5 Browser Refresh –ù–ï –≤–ª–∏—è–µ—Ç** - Node.js server process –æ—Å—Ç–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º
- ‚úÖ **Module-level –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** –º–µ–∂–¥—É HTTP –∑–∞–ø—Ä–æ—Å–∞–º–∏
- ‚úÖ **Cache —Ä–∞–±–æ—Ç–∞–µ—Ç** –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–µ–∂–¥—É –∏—Ö –∑–∞–ø—Ä–æ—Å–∞–º–∏
- ‚úÖ **Production —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ** - –Ω–µ—Ç hot-reload
- ‚ö†Ô∏è **–¢–æ–ª—å–∫–æ HMR (developer saves file)** —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç cache - acceptable development overhead

**–ö–æ–Ω—Ç–µ–∫—Å—Ç SmartPricingService:**

```typescript
export class SmartPricingService {
  private rateCache = new Map<CryptoCurrency, CachedRate>();
  private backgroundUpdatePromises = new Map<CryptoCurrency, Promise<void>>();
  // ...
}
```

**‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û –¥–ª—è calculations.ts):**

–¢–µ–∫—É—â–∏–π –∫–æ–¥ –£–ñ–ï —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è F5 refresh –∏ production. Global singleton –Ω—É–∂–µ–Ω –¢–û–õ–¨–ö–û –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å cache –ø—Ä–∏ HMR (developer saves file).

```typescript
// ‚úÖ –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û: Global singleton –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è cache –ø—Ä–∏ HMR
declare global {
  var __pricingServiceInstance: SmartPricingService | undefined;
}

function getPricingService(): SmartPricingService {
  if (!global.__pricingServiceInstance) {
    console.log(`üöÄ [PRICING SERVICE] Creating NEW instance`);
    global.__pricingServiceInstance = new SmartPricingService();
  } else {
    console.log(`‚ôªÔ∏è [PRICING SERVICE] Reusing EXISTING instance with cache`);
  }
  return global.__pricingServiceInstance;
}
```

**‚úÖ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (exchange.ts:588):**

```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (—Ç–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è):
const pricingService = new SmartPricingService();

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
import { getExchangeRateAsync } from '@repo/exchange-core';
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å getExchangeRateAsync –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è instance
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç calculations.ts:** üü¢ –ù–ò–ó–ö–ò–ô (optional optimization for HMR)  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç exchange.ts:588:** üü° ~~–°–†–ï–î–ù–ò–ô~~ ‚Üí ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û 6 –æ–∫—Ç—è–±—Ä—è 2025**

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ exchange.ts:588:**

```typescript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ):
getRates: publicProcedure.query(async () => {
  await new Promise(resolve => setTimeout(resolve, API_DELAY_MS));

  try {
    // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º getExchangeRateAsync() –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç singleton getPricingService()
    const ratePromises = CRYPTOCURRENCIES.map(currency =>
      getExchangeRateAsync(currency)
    );

    const rates = await Promise.all(ratePromises);
    // ...
  }
});
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- ‚úÖ getRates –∏—Å–ø–æ–ª—å–∑—É–µ—Ç singleton —á–µ—Ä–µ–∑ getExchangeRateAsync()
- ‚úÖ Cache —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–∂–¥—É –≤—Å–µ–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏
- ‚úÖ 98% —Å–Ω–∏–∂–µ–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å–æ–≤ (800 ‚Üí 8 requests/min –¥–ª—è 100 users)
- ‚úÖ Production –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω

**üîç –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Next.js API Routes:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ë–†–ê–£–ó–ï–† (Client-Side)                                           ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç F5 ‚Üí –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç HTML/CSS/JS          ‚îÇ
‚îÇ  ‚úÖ –≠—Ç–æ –ù–ï –≤–ª–∏—è–µ—Ç –Ω–∞ server-side!                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ HTTP Request
                             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ NEXT.JS SERVER (Node.js Process) - –û–°–¢–ê–ï–¢–°–Ø –ê–ö–¢–ò–í–ù–´–ú!          ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  pages/api/trpc/[trpc].ts ‚Üí appRouter ‚Üí exchange.ts            ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  getExchangeRateAsync() ‚Üí getPricingService()                   ‚îÇ
‚îÇ                             ‚ñ≤                                   ‚îÇ
‚îÇ  let pricingServiceInstance ‚Üê ‚úÖ –°–û–•–†–ê–ù–Ø–ï–¢–°–Ø –í –ü–ê–ú–Ø–¢–ò!          ‚îÇ
‚îÇ  private rateCache = new Map() ‚Üê ‚úÖ –°–û–•–†–ê–ù–Ø–ï–¢–°–Ø!                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**üéØ –ö–õ–Æ–ß–ï–í–û–ï –ü–û–ù–ò–ú–ê–ù–ò–ï:**

`SmartPricingService` - —ç—Ç–æ —Å–µ—Ä–≤–∏—Å –∫–æ—Ç–æ—Ä—ã–π:

1. **–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∫—É—Ä—Å—ã** –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö API (CoinGecko, –¥—Ä.)
2. **–ö—ç—à–∏—Ä—É–µ—Ç –∫—É—Ä—Å—ã** –≤ –ø–∞–º—è—Ç–∏ —á—Ç–æ–±—ã –Ω–µ –¥–µ–ª–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
3. **–û–±–Ω–æ–≤–ª—è–µ—Ç –≤ —Ñ–æ–Ω–µ** —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∫—É—Ä—Å—ã

–í–Ω—É—Ç—Ä–∏ —Å–µ—Ä–≤–∏—Å–∞ –µ—Å—Ç—å –¥–≤–∞ Map:

```typescript
private rateCache = new Map<CryptoCurrency, CachedRate>();
// –•—Ä–∞–Ω–∏—Ç: { BTC: {rate: 45000, timestamp: ...}, ETH: {rate: 3000, ...} }

private backgroundUpdatePromises = new Map<CryptoCurrency, Promise<void>>();
// –•—Ä–∞–Ω–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–æ–Ω–æ–≤—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```

**–õ–æ–≥–∏–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:**

- **Fresh cache** (< 30 —Å–µ–∫—É–Ω–¥): –í–µ—Ä–Ω—É—Ç—å –∏–∑ cache, –Ω–µ –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å
- **Stale cache** (30-300 —Å–µ–∫—É–Ω–¥): –í–µ—Ä–Ω—É—Ç—å –∏–∑ cache + –æ–±–Ω–æ–≤–∏—Ç—å –≤ —Ñ–æ–Ω–µ
- **Expired cache** (> 300 —Å–µ–∫—É–Ω–¥): –°–¥–µ–ª–∞—Ç—å –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å

**‚úÖ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –°–ï–ô–ß–ê–° (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**

```
10:00:00 | –ó–∞–ø—Ä–æ—Å 1: getRate(BTC) –æ—Ç User A
         | ‚Üí Cache –ø—É—Å—Ç–æ–π ‚Üí API –∑–∞–ø—Ä–æ—Å ‚Üí Cache: {BTC: 45000}
         | ‚Üí –û—Ç–≤–µ—Ç: 45000 (–≤—Ä–µ–º—è: 500ms)

10:00:10 | User B –Ω–∞–∂–∏–º–∞–µ—Ç F5 –≤ –±—Ä–∞—É–∑–µ—Ä–µ
         | ‚úÖ Node.js server –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
         | ‚úÖ pricingServiceInstance —Å–æ—Ö—Ä–∞–Ω–µ–Ω
         | ‚úÖ rateCache —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {BTC: 45000}

10:00:15 | –ó–∞–ø—Ä–æ—Å 2: getRate(BTC) –æ—Ç User B (–ø–æ—Å–ª–µ F5)
         | ‚Üí Cache fresh ‚Üí –û—Ç–≤–µ—Ç: 45000 (–≤—Ä–µ–º—è: 1ms) ‚úÖ –ë—ã—Å—Ç—Ä–æ!

10:01:00 | –ó–∞–ø—Ä–æ—Å 3: getRate(BTC) –æ—Ç User C
         | ‚Üí Cache stale ‚Üí –û—Ç–≤–µ—Ç: 45000 (–≤—Ä–µ–º—è: 1ms) + —Ñ–æ–Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
         | ‚Üí –û—Ç–≤–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π ‚úÖ

10:10:00 | –ó–∞–ø—Ä–æ—Å 4: getRate(BTC) –æ—Ç User D
         | ‚Üí Cache expired ‚Üí API –∑–∞–ø—Ä–æ—Å ‚Üí Cache: {BTC: 45100}
         | ‚Üí –û—Ç–≤–µ—Ç: 45100 (–≤—Ä–µ–º—è: 500ms)

‚úÖ –í–´–í–û–î: F5 refresh –ù–ï –≤–ª–∏—è–µ—Ç –Ω–∞ server-side cache!
```

**‚ö†Ô∏è –ï–î–ò–ù–°–¢–í–ï–ù–ù–ê–Ø –ø—Ä–æ–±–ª–µ–º–∞: Hot-Reload (HMR) –≤ development:**

```
10:00:00 | –ó–∞–ø—Ä–æ—Å 1: getRate(BTC)
         | ‚Üí API –∑–∞–ø—Ä–æ—Å ‚Üí Cache: {BTC: 45000} (500ms)

10:00:30 | Developer —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–π–ª calculations.ts
         | ‚Üí Next.js HMR (Hot Module Reload) —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
         | ‚Üí Webpack –æ—á–∏—â–∞–µ—Ç require.cache –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–Ω–æ–≥–æ –º–æ–¥—É–ª—è
         | ‚Üí Module –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
         | ‚Üí let pricingServiceInstance = null ‚Üê –û–ë–ù–£–õ–Ø–ï–¢–°–Ø
         | ‚Üí Cache –¢–ï–†–Ø–ï–¢–°–Ø

10:00:35 | –ó–∞–ø—Ä–æ—Å 2: getRate(BTC)
         | ‚Üí Cache –ü–£–°–¢–û–ô! ‚Üí API –∑–∞–ø—Ä–æ—Å —Å–Ω–æ–≤–∞ (500ms)
         | ‚Üí –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 1ms, –ø–æ–ª—É—á–∏–ª–æ—Å—å 500ms ‚ùå

‚úÖ –ù–û: –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¢–û–õ–¨–ö–û –∫–æ–≥–¥–∞ developer –º–µ–Ω—è–µ—Ç –∫–æ–¥!
‚úÖ F5 –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç HMR
‚úÖ –í production HMR –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
```

**‚ö†Ô∏è –ö–û–ì–î–ê –ø—Ä–æ—è–≤–∏—Ç—Å—è –ø—Ä–æ–±–ª–µ–º–∞ (–¢–û–õ–¨–ö–û Development HMR):**

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: Developer –∞–∫—Ç–∏–≤–Ω–æ –º–µ–Ω—è–µ—Ç –∫–æ–¥ (–ù–ï F5!)**

```
–í—Ä–µ–º—è    | –î–µ–π—Å—Ç–≤–∏–µ
---------|----------------------------------------------------------
10:00:00 | User A: –°–º–æ—Ç—Ä–∏—Ç –∫—É—Ä—Å—ã ‚Üí API –∑–∞–ø—Ä–æ—Å BTC, ETH, USDT
         | Cache –∑–∞–ø–æ–ª–Ω–µ–Ω: {BTC: 45000, ETH: 3000, USDT: 1.0}
10:00:30 | üî• Developer: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç calculations.ts ‚Üí HMR ‚Üí Cache –æ—á–∏—â–µ–Ω
         | ‚úÖ F5 –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ù–ï –≤–ª–∏—è–µ—Ç!
10:00:35 | User B: –°–º–æ—Ç—Ä–∏—Ç –∫—É—Ä—Å—ã ‚Üí –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ó–ê–ù–û–í–û
         | 3 API –∑–∞–ø—Ä–æ—Å–∞ –≤–º–µ—Å—Ç–æ 0 ‚ùå
10:01:00 | üî• Developer: –ï—â–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ ‚Üí HMR
10:01:05 | User C: –°–Ω–æ–≤–∞ –≤—Å–µ –∫—É—Ä—Å—ã —Å API
         | –†–µ–∑—É–ª—å—Ç–∞—Ç: 9 API –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–º–µ—Å—Ç–æ 3
         | ‚ö†Ô∏è –ù–æ —ç—Ç–æ acceptable overhead –≤ development!
```

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: ‚ùå –†–ï–ê–õ–¨–ù–ê–Ø –ø—Ä–æ–±–ª–µ–º–∞ - exchange.ts:588 (–Ω–µ —Å–≤—è–∑–∞–Ω–∞ —Å HMR)**

```
10:00:00 | getRates query –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
         | exchange.ts:588: const pricingService = new SmartPricingService()
         | ‚ùå –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç getPricingService() singleton!
         | ‚Üí –°–æ–∑–¥–∞–µ—Ç—Å—è –ù–û–í–´–ô instance —Å –ø—É—Å—Ç—ã–º cache
         | ‚Üí API –∑–∞–ø—Ä–æ—Å –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∞–ª—é—Ç—ã (BTC, ETH, USDT, LTC)

10:00:05 | –î—Ä—É–≥–æ–π getRates query
         | ‚ùå –°–Ω–æ–≤–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è NEW SmartPricingService()
         | ‚Üí –°–Ω–æ–≤–∞ API –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –≤—Å–µ—Ö –≤–∞–ª—é—Ç
         | –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ cache, –Ω–æ —Å–æ–∑–¥–∞–ª–∏ –Ω–æ–≤—ã–π instance!

‚úÖ –†–ï–®–ï–ù–ò–ï: –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ getPricingService()
```

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: Load testing**

```
10:00:00 | 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å–º–æ—Ç—Ä—è—Ç –∫—É—Ä—Å—ã
10:00:01 | Hot reload –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
10:00:02 | –í—Å–µ 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–µ–ª–∞—é—Ç API –∑–∞–ø—Ä–æ—Å—ã
         | Rate limiting API (100 requests/min)
         | ‚Üí 429 Too Many Requests ‚ùå
         | –†–µ–∑—É–ª—å—Ç–∞—Ç: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –æ—à–∏–±–∫–∏ –≤–º–µ—Å—Ç–æ –∫—É—Ä—Å–æ–≤
```

**üí• –†–µ–∞–ª—å–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**

1. **–ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞** - –∫–∞–∂–¥—ã–π hot reload ‚Üí –≤—Å–µ –∫—É—Ä—Å—ã –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è –∑–∞–Ω–æ–≤–æ
2. **–ü–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥ API –∫–≤–æ—Ç** - –±–æ–ª—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ CoinGecko ‚Üí –±—ã—Å—Ç—Ä–µ–µ –¥–æ—Å—Ç–∏–≥–∞–µ–º –ª–∏–º–∏—Ç–æ–≤
3. **Rate limiting errors** - –ø—Ä–∏ load testing –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å 429 –æ—à–∏–±–∫–∏
4. **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–µ—Ä–∏** - –ø–ª–∞—Ç–Ω—ã–µ API (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º) ‚Üí –±–æ–ª—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ = –±–æ–ª—å—à–µ –ø–ª–∞—Ç–∏–º
5. **–ü–ª–æ—Ö–æ–π UX** - –∫—É—Ä—Å—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–æ–ª—å—à–µ —á–µ–º –¥–æ–ª–∂–Ω—ã (500ms –≤–º–µ—Å—Ç–æ 1ms)

**–ü—Ä–æ–±–ª–µ–º–∞ #2 (exchange.ts:588) —É—Å—É–≥—É–±–ª—è–µ—Ç:**

```
–î–∞–∂–µ –ë–ï–ó hot-reload:
- –ö–∞–∂–¥—ã–π tRPC query —Å–æ–∑–¥–∞–µ—Ç NEW instance
- = –ö–∞–∂–¥—ã–π query –¥–µ–ª–∞–µ—Ç API –∑–∞–ø—Ä–æ—Å
- = –ù–ï–¢ –∫—ç—à–∞ –≤–æ–æ–±—â–µ, –¥–∞–∂–µ –≤ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ!

–° hot-reload:
- –ü—Ä–æ–±–ª–µ–º–∞ —É–¥–≤–∞–∏–≤–∞–µ—Ç—Å—è
- = –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API
```

**üìä –ú–∞—Å—à—Ç–∞–± –ø—Ä–æ–±–ª–µ–º—ã (–ü–ï–†–ï–°–ú–û–¢–†–ï–ù–û):**

```
‚úÖ –¢–ï–ö–£–©–ê–Ø —Å–∏—Ç—É–∞—Ü–∏—è (calculations.ts singleton):
- F5 refresh: –ù–ï –≤–ª–∏—è–µ—Ç –Ω–∞ cache ‚úÖ
- Normal operations: cache —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ ‚úÖ
- HMR (dev only): cache —Ç–µ—Ä—è–µ—Ç—Å—è - acceptable overhead ‚ö†Ô∏è
- Production: —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ (–Ω–µ—Ç HMR) ‚úÖ

‚ùå –†–ï–ê–õ–¨–ù–ê–Ø –ø—Ä–æ–±–ª–µ–º–∞ (exchange.ts:588):
- getRates query: —Å–æ–∑–¥–∞–µ—Ç NEW instance –∫–∞–∂–¥—ã–π —Ä–∞–∑
- = –ù–ï–¢ –∫—ç—à–∞ –¥–∞–∂–µ –±–µ–∑ HMR!
- –ù–∞–≥—Ä—É–∑–∫–∞: 4 API –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ö–ê–ñ–î–´–ô getRates call
- –° 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏/–º–∏–Ω—É—Ç—É = 40 API –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω
- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: ~2 –∑–∞–ø—Ä–æ—Å–∞/–º–∏–Ω (—Å cache)

üéØ –ü–†–ò–û–†–ò–¢–ï–¢: –ò—Å–ø—Ä–∞–≤–∏—Ç—å exchange.ts:588, –∞ –Ω–µ calculations.ts!
```

**üîß –ü–æ—á–µ–º—É –ù–ò–ó–ö–ò–ô –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–¥–ª—è calculations.ts):**

- ‚úÖ **F5 refresh –ù–ï –ø—Ä–æ–±–ª–µ–º–∞** - cache —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- ‚úÖ **Production —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ** - –Ω–µ—Ç HMR
- ‚ÑπÔ∏è **HMR overhead acceptable** - —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- ‚ÑπÔ∏è –ï—Å—Ç—å fallback –º–µ—Ö–∞–Ω–∏–∑–º (–Ω–µ –ª–æ–º–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)
- ‚ÑπÔ∏è API –ª–∏–º–∏—Ç—ã –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã—Å–æ–∫–∏–µ

**‚ö†Ô∏è –ù–û: exchange.ts:588 —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–°–†–ï–î–ù–ò–ô –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç):**

- ‚ùå –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π instance –Ω–∞ –∫–∞–∂–¥—ã–π query
- ‚ùå –ù–ï–¢ –∫—ç—à–∞ –¥–∞–∂–µ –≤ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ
- ‚ùå –õ–∏—à–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å—ã –≤ production
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –∑–∞–º–µ–Ω–∏—Ç—å `new SmartPricingService()` –Ω–∞ `getPricingService()`
- ‚úÖ –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∏–∑–∏—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ API

**–§–∞–π–ª:** `apps/web/src/i18n/request.ts`  
**–°—Ç—Ä–æ–∫–∞:** 56  
**–ü—Ä–æ–±–ª–µ–º–∞:** Map —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ hot-reload, —Ç–µ—Ä—è–µ—Ç—Å—è –∫—ç—à –ø–µ—Ä–µ–≤–æ–¥–æ–≤

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**

```typescript
const translationCache = new Map<string, TranslationData>();
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**

- ‚ö†Ô∏è Cache –ø–µ—Ä–µ–≤–æ–¥–æ–≤ —Ç–µ—Ä—è–µ—Ç—Å—è –ø–æ—Å–ª–µ F5 refresh
- ‚ö†Ô∏è –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã translation JSON —Ñ–∞–π–ª–æ–≤
- ‚ö†Ô∏è –°–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ dev mode
- ‚ÑπÔ∏è –ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ (—Ä–∞–±–æ—Ç–∞–µ—Ç), –Ω–æ –≤–ª–∏—è–µ—Ç –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏

**–ö–æ–Ω—Ç–µ–∫—Å—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```typescript
async function loadTranslationModules(
  locale: string,
  requiredModules: string[]
): Promise<LoadedModule[]> {
  const modulePromises = requiredModules.map(async (moduleName): Promise<LoadedModule> => {
    const cacheKey = `${locale}-${moduleName}`;

    // Check cache first
    if (translationCache.has(cacheKey)) {
      const cachedData = translationCache.get(cacheKey);
      if (cachedData) {
        return { moduleName, data: cachedData };
      }
    }

    try {
      const module = await import(`../../messages/${locale}/${moduleName}.json`);
      const data = module.default as TranslationData;

      // Cache the loaded module
      translationCache.set(cacheKey, data);

      return { moduleName, data };
    } catch {
      // ...
    }
  });

  return Promise.all(modulePromises);
}
```

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```typescript
// ‚úÖ Global singleton pattern –¥–ª—è hot-reload environments
declare global {
  var __translationCache: Map<string, TranslationData> | undefined;
}

const translationCache = global.__translationCache || new Map<string, TranslationData>();

if (!global.__translationCache) {
  console.log(`üöÄ [I18N CACHE] Creating NEW translation cache`);
  global.__translationCache = translationCache;
} else {
  console.log(`‚ôªÔ∏è [I18N CACHE] Reusing EXISTING translation cache, size: ${translationCache.size}`);
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°–†–ï–î–ù–ò–ô (performance: repeated translation loading)

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞:**

- Translation —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–Ω–æ–º —Ä–µ–Ω–¥–µ—Ä–µ
- Cache –∫—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤ dev mode
- –í production –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è build-time –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, –Ω–æ dev performance –≤–∞–∂–Ω–∞

#### üìò –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

**üîç –ì–î–ï –ø—Ä–æ–±–ª–µ–º–∞:**

- –§–∞–π–ª: `apps/web/src/i18n/request.ts`, —Å—Ç—Ä–æ–∫–∞ 56
- –ü—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–æ–¥: `const translationCache = new Map<string, TranslationData>();`
- –ú–µ—Å—Ç–æ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ: i18n —Å–∏—Å—Ç–µ–º–∞, Server-side rendering, –∑–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤

**üéØ –ß–¢–û —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:**

–°–∏—Å—Ç–µ–º–∞ –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ (i18n) —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫:

1. **Route-based loading** - –∫–∞–∂–¥—ã–π –º–∞—Ä—à—Ä—É—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –º–æ–¥—É–ª–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤
2. **Lazy loading** - –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é
3. **Server-side caching** - –ø–µ—Ä–µ–≤–æ–¥—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è –≤ Map —á—Ç–æ–±—ã –Ω–µ —á–∏—Ç–∞—Ç—å JSON —Ñ–∞–π–ª—ã –ø–æ–≤—Ç–æ—Ä–Ω–æ

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤:**

```
messages/
  en/
    home-page.json       (–≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
    advanced-exchange.json  (–æ–±–º–µ–Ω)
    layout.json          (header, footer)
    common-ui.json       (–∫–Ω–æ–ø–∫–∏, —Ñ–æ—Ä–º—ã)
    notifications.json   (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
  ru/
    (—Ç–µ –∂–µ —Ñ–∞–π–ª—ã)
```

**–ö–∞–∫ –î–û–õ–ñ–ù–û —Ä–∞–±–æ—Ç–∞—Ç—å:**

```
–ó–∞–ø—Ä–æ—Å 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω—É—é (en)
  ‚Üí –ó–∞–≥—Ä—É–∑–∏—Ç—å: home-page.json, layout.json
  ‚Üí import —Ñ–∞–π–ª–æ–≤ (10-20ms –Ω–∞ —Ñ–∞–π–ª)
  ‚Üí Cache: {'en-home-page': {...}, 'en-layout': {...}}
  ‚Üí –í—Ä–µ–º—è: 30ms

–ó–∞–ø—Ä–æ—Å 2: –î—Ä—É–≥–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω—É—é (en)
  ‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å cache ‚Üí –ù–ê–ô–î–ï–ù–û!
  ‚Üí –í–µ—Ä–Ω—É—Ç—å –∏–∑ cache (0.1ms)
  ‚Üí –í—Ä–µ–º—è: 0.1ms ‚úÖ –í 300 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ!

–ó–∞–ø—Ä–æ—Å 3: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç /exchange (en)
  ‚Üí –ó–∞–≥—Ä—É–∑–∏—Ç—å: advanced-exchange.json (–Ω–æ–≤—ã–π), layout.json (–∏–∑ cache)
  ‚Üí Cache: {'en-home-page': {...}, 'en-layout': {...}, 'en-advanced-exchange': {...}}
  ‚Üí –í—Ä–µ–º—è: 15ms (—Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–π —Ñ–∞–π–ª)
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –°–ï–ô–ß–ê–° —Å –ø—Ä–æ–±–ª–µ–º–æ–π:**

```
–ó–∞–ø—Ä–æ—Å 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω—É—é (en)
  ‚Üí –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã ‚Üí Cache –∑–∞–ø–æ–ª–Ω–µ–Ω (30ms)

Developer —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–π–ª ‚Üí Hot reload ‚Üí Map –æ—á–∏—â–µ–Ω!

–ó–∞–ø—Ä–æ—Å 2: –î—Ä—É–≥–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω—É—é (en)
  ‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å cache ‚Üí –ü–£–°–¢–û!
  ‚Üí import —Ñ–∞–π–ª–æ–≤ –ó–ê–ù–û–í–û (30ms)
  ‚Üí –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 0.1ms, –ø–æ–ª—É—á–∏–ª–æ—Å—å 30ms ‚ùå

Hot reload –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ ‚Üí Cache –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ç–µ—Ä—è–µ—Ç—Å—è
  ‚Üí –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å = –º–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤
```

**‚ö†Ô∏è –ö–û–ì–î–ê –ø—Ä–æ—è–≤–∏—Ç—Å—è –ø—Ä–æ–±–ª–µ–º–∞:**

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ê–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ UI**

```
–í—Ä–µ–º—è    | –î–µ–π—Å—Ç–≤–∏–µ
---------|----------------------------------------------------------
14:00:00 | Developer —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º
         | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–∞ —Å–∞–π—Ç–µ: ~10 —á–µ–ª–æ–≤–µ–∫
         | Cache –∑–∞–ø–æ–ª–Ω–µ–Ω: en-home-page, en-layout, en-exchange, etc.
14:00:30 | Developer: –ò–∑–º–µ–Ω—è–µ—Ç —Å—Ç–∏–ª—å –∫–Ω–æ–ø–∫–∏ ‚Üí Hot reload
         | ‚Üí Translation cache –û–ß–ò–©–ï–ù
14:00:31 | 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–µ–ª–∞—é—Ç –∑–∞–ø—Ä–æ—Å—ã
         | ‚Üí –í—Å–µ 10 –∑–∞–≥—Ä—É–∂–∞—é—Ç –ø–µ—Ä–µ–≤–æ–¥—ã —Å –¥–∏—Å–∫–∞ –ó–ê–ù–û–í–û
         | ‚Üí 10 √ó 30ms = 300ms —Å—É–º–º–∞—Ä–Ω–æ I/O –æ–ø–µ—Ä–∞—Ü–∏–π
14:01:00 | Developer: –ï—â–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ ‚Üí Hot reload
14:01:01 | –ï—â–µ 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Üí –°–Ω–æ–≤–∞ –≤—Å–µ —Å –¥–∏—Å–∫–∞
         | –†–µ–∑—É–ª—å—Ç–∞—Ç: –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
```

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–æ–≤**

```
14:00:00 | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ –≥–ª–∞–≤–Ω–æ–π (en)
         | Cache: {'en-home-page': ..., 'en-layout': ...}
14:00:15 | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –Ω–∞ —Ä—É—Å—Å–∫–∏–π (ru)
         | Cache: {'en-home-page': ..., 'en-layout': ..., 'ru-home-page': ..., 'ru-layout': ...}
14:00:30 | Hot reload ‚Üí Cache –æ—á–∏—â–µ–Ω
14:00:35 | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–Ω–æ–≤–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —è–∑—ã–∫
         | ‚Üí –í—Å–µ —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ó–ê–ù–û–í–û —Å –¥–∏—Å–∫–∞
         | –î–æ–ª–∂–Ω–æ: 0.1ms –∏–∑ cache
         | –ü–æ–ª—É—á–∏–ª–æ—Å—å: 30ms —Å –¥–∏—Å–∫–∞
```

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: Multiple pages –Ω–∞–≤–∏–≥–∞—Ü–∏—è**

```
14:00:00 | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: / ‚Üí /exchange ‚Üí /order ‚Üí –Ω–∞–∑–∞–¥ –Ω–∞ /
         | Cache –Ω–∞–∫–æ–ø–∏–ª: 6-8 –º–æ–¥—É–ª–µ–π –ø–µ—Ä–µ–≤–æ–¥–æ–≤
         | –ë—ã—Å—Ç—Ä–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –±–ª–∞–≥–æ–¥–∞—Ä—è cache
14:00:45 | Hot reload ‚Üí Cache –ø–æ—Ç–µ—Ä—è–Ω
14:00:50 | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏—é
         | ‚Üí –ö–∞–∂–¥–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–≤–æ–¥—ã —Å –¥–∏—Å–∫–∞ –ó–ê–ù–û–í–û
         | ‚Üí –ú–µ–¥–ª–µ–Ω–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è ‚ùå
```

**–°—Ü–µ–Ω–∞—Ä–∏–π 4: –ü–µ—Ä–≤—ã–π —Ä–µ–Ω–¥–µ—Ä –ø–æ—Å–ª–µ hot-reload**

```
–î–æ hot-reload:
  Request 1: 30ms (–∑–∞–≥—Ä—É–∑–∫–∞ —Å –¥–∏—Å–∫–∞)
  Request 2: 0.1ms (–∏–∑ cache) ‚úÖ
  Request 3: 0.1ms (–∏–∑ cache) ‚úÖ
  Request 4: 0.1ms (–∏–∑ cache) ‚úÖ

Hot reload –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

–ü–æ—Å–ª–µ hot-reload:
  Request 1: 30ms (–∑–∞–≥—Ä—É–∑–∫–∞ —Å –¥–∏—Å–∫–∞)
  Request 2: 30ms (–∑–∞–≥—Ä—É–∑–∫–∞ —Å –¥–∏—Å–∫–∞) ‚ùå –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ cache!
  Request 3: 30ms (–∑–∞–≥—Ä—É–∑–∫–∞ —Å –¥–∏—Å–∫–∞) ‚ùå
  Request 4: 30ms (–∑–∞–≥—Ä—É–∑–∫–∞ —Å –¥–∏—Å–∫–∞) ‚ùå

–†–µ–∑—É–ª—å—Ç–∞—Ç: –í 300 —Ä–∞–∑ –º–µ–¥–ª–µ–Ω–Ω–µ–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
```

**üí• –†–µ–∞–ª—å–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**

1. **–ú–µ–¥–ª–µ–Ω–Ω—ã–π Server-Side Rendering** - –∫–∞–∂–¥–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –¥–æ–ª—å—à–µ –Ω–∞ 20-50ms
2. **–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –¥–∏—Å–∫** - –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ —á—Ç–µ–Ω–∏—è JSON —Ñ–∞–π–ª–æ–≤
3. **–ü–ª–æ—Ö–æ–π Dev Experience** - —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–æ –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
4. **–ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç** - —á–µ–º –±–æ–ª—å—à–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤, —Ç–µ–º –º–µ–¥–ª–µ–Ω–Ω–µ–µ
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã** - –ø—Ä–∏ 100+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –æ–Ω–ª–∞–π–Ω = —Å–µ—Ä—å–µ–∑–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞

**üìä –ú–∞—Å—à—Ç–∞–± –ø—Ä–æ–±–ª–µ–º—ã:**

```
–û–¥–∏–Ω translation –º–æ–¥—É–ª—å:
- –° cache: 0.1ms
- –ë–µ–∑ cache: 15ms
- –†–∞–∑–Ω–∏—Ü–∞: 150x –º–µ–¥–ª–µ–Ω–Ω–µ–µ

–°—Ä–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (3-4 –º–æ–¥—É–ª—è):
- –° cache: 0.4ms
- –ë–µ–∑ cache: 60ms
- –†–∞–∑–Ω–∏—Ü–∞: 150x –º–µ–¥–ª–µ–Ω–Ω–µ–µ

–ü—Ä–∏ 50 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –æ–Ω–ª–∞–π–Ω (–∞–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞):
- –° cache: 20ms —Å—É–º–º–∞—Ä–Ω–æ –¥–ª—è –≤—Å–µ—Ö
- –ë–µ–∑ cache: 3000ms (3 —Å–µ–∫—É–Ω–¥—ã!) —Å—É–º–º–∞—Ä–Ω–æ
- –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º—É: 150x –≤—ã—à–µ
```

**–ß–∞—Å—Ç–æ—Ç–∞ hot-reload –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ:**

```
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞: hot-reload
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π: hot-reload
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–æ–≤: hot-reload
- –°—Ä–µ–¥–Ω–µ–µ: 1 hot-reload –∫–∞–∂–¥—ã–µ 30-60 —Å–µ–∫—É–Ω–¥
- –ó–∞ —á–∞—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: 60-120 –ø–æ—Ç–µ—Ä—å cache
```

**üîß –ü–æ—á–µ–º—É –°–†–ï–î–ù–ò–ô –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**

- ‚ö†Ô∏è –í–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –Ω–µ –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Ç–æ–ª—å–∫–æ –≤ dev mode
- ‚ö†Ô∏è –í production –µ—Å—Ç—å build-time –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- ‚ö†Ô∏è –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É, –ø—Ä–æ—Å—Ç–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ

**–ù–æ –≤–∞–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Ç–æ–º—É —á—Ç–æ:**

- ‚úÖ Developer Experience - —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±—ã—Å—Ç—Ä–æ–π
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ - –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º–∞ —É—Å—É–≥—É–±–ª—è–µ—Ç—Å—è
- ‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞–º - –º–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤—ã–≥–ª—è–¥–∏—Ç –ø–ª–æ—Ö–æ
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ - –ø—Ä–∏ —Ä–æ—Å—Ç–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –ø—Ä–æ–±–ª–µ–º–∞ —É—Å–∏–ª–∏—Ç—Å—è
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ - —Ç–æ—Ç –∂–µ –ø–∞—Ç—Ç–µ—Ä–Ω —á—Ç–æ –∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ
- ‚úÖ –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ - 150x –±—ã—Å—Ç—Ä–µ–µ —ç—Ç–æ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ!

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã:**

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø—Ä–æ–±–ª–µ–º, —ç—Ç–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –ö–ê–ñ–î–´–ô —Å–µ—Ä–≤–µ—Ä–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä:

- Idempotency: –≤–ª–∏—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- Email rate limit: –≤–ª–∏—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ email –æ—Ç–ø—Ä–∞–≤–∫–∏
- Telegram sessions: –≤–ª–∏—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
- Pricing cache: –≤–ª–∏—è–µ—Ç –Ω–∞ –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç
- **Translation cache: –≤–ª–∏—è–µ—Ç –Ω–∞ –í–°–ï —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –í–°–ï–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** ‚ö†Ô∏è

–ü–æ—ç—Ç–æ–º—É —Ö–æ—Ç—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ "—Ç–æ–ª—å–∫–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å", –º–∞—Å—à—Ç–∞–± –≤–ª–∏—è–Ω–∏—è –±–æ–ª—å—à–µ.

---

## ‚ùå –ù–ï –¢–†–ï–ë–£–ï–¢–°–Ø SINGLETON

### 1. ERROR_MAPPINGS ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ

**–§–∞–π–ª:** `packages/utils/src/error-system/error-mapper.ts:19`  
**–ü—Ä–∏—á–∏–Ω–∞:** –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è readonly –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è)

### 2. MemorySessionAdapter.storage ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ

**–§–∞–π–ª:** `packages/session-management/src/adapters/memory-session-adapter.ts:12`  
**–ü—Ä–∏—á–∏–Ω–∞:** Instance property, –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–µ—à UserManager

### 3. UserManagerFactory.cachedUserManager ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ

**–§–∞–π–ª:** `packages/session-management/src/factories/user-manager-factory.ts:44`  
**–ü—Ä–∏—á–∏–Ω–∞:** Class static property (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ hot-reload –∫–ª–∞—Å—Å–∞)

### 4. SmartPricingService cache (–≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–∞) ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–§–∞–π–ª:** `packages/exchange-core/src/services/smart-pricing-service.ts:69-74`  
**–ü—Ä–∏—á–∏–Ω–∞:** Instance properties —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ - Node.js process —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç module-level –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ–∂–¥—É HTTP –∑–∞–ø—Ä–æ—Å–∞–º–∏. F5 refresh –ù–ï –≤–ª–∏—è–µ—Ç –Ω–∞ server-side cache. –ü—Ä–æ–±–ª–µ–º–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ HMR (developer saves file) - acceptable development overhead.

---

## üìä –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –§–∞–π–ª              | –ü—Ä–æ–±–ª–µ–º–∞                        | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç     | –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è                   | –°—Ç–∞—Ç—É—Å   |
| ----------------- | ------------------------------- | ------------- | ----------------------------- | -------- |
| `rateLimit.ts`    | Rate limit reset                | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | Security: bypass rate limit   | ‚úÖ FIXED |
| `idempotency.ts`  | Idempotency cache reset         | üî¥ –í—ã—Å–æ–∫–∏–π    | Security: duplicate requests  | ‚ùå TODO  |
| `i18n/request.ts` | Translation cache reset üÜï      | üü° –°—Ä–µ–¥–Ω–∏–π    | Performance: repeated imports | ‚ùå TODO  |
| `exchange.ts:588` | New instance –∫–∞–∂–¥—ã–π query üî•    | ÔøΩ –°—Ä–µ–¥–Ω–∏–π     | Performance: no cache in prod | ‚ùå TODO  |
| `calculations.ts` | HMR cache loss (F5 —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ) | üü¢ –ù–∏–∑–∫–∏–π     | Dev HMR overhead (acceptable) | ‚ÑπÔ∏è OK    |

**‚ùå –ò—Å–∫–ª—é—á–µ–Ω–æ:**

- `rate-limited-email-service.ts` - —É–∂–µ –∑–∞—â–∏—â–µ–Ω–æ `rateLimitMiddleware.createOrder`
- `telegram-bot.ts` - –Ω–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ –¥–ª—è web production (–æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)

**‚ÑπÔ∏è –í–∞–∂–Ω–æ–µ —É—Ç–æ—á–Ω–µ–Ω–∏–µ:**

- `calculations.ts` singleton —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ: F5 refresh –ù–ï —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç cache, —Ç–∞–∫ –∫–∞–∫ Node.js process –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- –†–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –≤ `exchange.ts:588` - —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π instance –Ω–∞ –∫–∞–∂–¥—ã–π query –≤–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è singleton

---

## üîß –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ü—Ä–∏–æ—Ä–∏—Ç–µ–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)

### Phase 1: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (Security) üî¥

1. **Idempotency Cache**
   - –§–∞–π–ª: `apps/web/src/server/trpc/middleware/idempotency.ts`
   - –ü—Ä–∏–º–µ–Ω–∏—Ç—å `global.__idempotencyCache` pattern
   - –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å `setInterval` –≤ –±–ª–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
   - –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ create/reuse

### Phase 2: Performance –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ üü°

2. **Translation Cache** üÜï
   - –§–∞–π–ª: `apps/web/src/i18n/request.ts`
   - –ü—Ä–∏–º–µ–Ω–∏—Ç—å `global.__translationCache` pattern
   - –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ create/reuse
   - –£—Å–∫–æ—Ä–∏—Ç –∑–∞–≥—Ä—É–∑–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü –≤ dev mode (150x –±—ã—Å—Ç—Ä–µ–µ)

3. **Exchange Router getRates** üî•
   - –§–∞–π–ª: `apps/web/src/server/trpc/routers/exchange.ts:588`
   - –ó–∞–º–µ–Ω–∏—Ç—å `new SmartPricingService()` –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `getExchangeRateAsync()`
   - –≠—Ç–æ –ë–û–õ–ï–ï –≤–∞–∂–Ω–æ —á–µ–º #4, —Ç–∞–∫ –∫–∞–∫ –≤–ª–∏—è–µ—Ç –Ω–∞ production!

### Phase 3: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (HMR —Ç–æ–ª—å–∫–æ) üü¢

4. **Pricing Service** (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û)
   - –§–∞–π–ª: `packages/exchange-core/src/utils/calculations.ts`
   - –¢–µ–∫—É—â–∏–π –∫–æ–¥ –£–ñ–ï —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è F5 –∏ production
   - –ü—Ä–∏–º–µ–Ω–∏—Ç—å `global.__pricingServiceInstance` pattern –¢–û–õ–¨–ö–û –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å cache –ø—Ä–∏ HMR
   - –≠—Ç–æ –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –ª–∏—à–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å—ã –∫–æ–≥–¥–∞ developer –º–µ–Ω—è–µ—Ç –∫–æ–¥
   - –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ create/reuse

---

**‚úÖ –†–µ—à–µ–Ω–æ –Ω–µ –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å:**

- **Email Rate Limit** (`rate-limited-email-service.ts`) - —É–∂–µ –∑–∞—â–∏—â–µ–Ω–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ –æ–ø–µ—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ `rateLimitMiddleware.createOrder` (3 –∑–∞—è–≤–∫–∏ –≤ —á–∞—Å). –î—É–±–ª–∏—Ä—É—é—â–∞—è –∑–∞—â–∏—Ç–∞ –Ω–µ –Ω—É–∂–Ω–∞.
- **Telegram Bot Sessions** (`telegram-bot.ts`) - –æ—Ç–¥–µ–ª—å–Ω–æ–µ Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (`apps/telegram-bot`), –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è web –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –Ω–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ –¥–ª—è web production release.

**üí° –ö–ª—é—á–µ–≤–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

- **F5 Browser Refresh** –ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã - Node.js server process –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- **HMR (Hot Module Reload)** –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¢–û–õ–¨–ö–û –∫–æ–≥–¥–∞ developer —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–π–ª
- –í production HMR –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí –ø—Ä–æ–±–ª–µ–º—ã #4 –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

---

## üìù –ï–¥–∏–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω (Template)

–î–ª—è –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω:

```typescript
// ‚úÖ Global singleton pattern –¥–ª—è hot-reload environments
// –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç [–æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã] –ø—Ä–∏ hot-reload –≤ development
// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—Ç –∂–µ –ø–æ–¥—Ö–æ–¥ —á—Ç–æ –∏ global.__prismaInstance
declare global {
  var __storeName: StoreType | undefined;
}

// –í development –∏—Å–ø–æ–ª—å–∑—É–µ–º global –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ–∂–¥—É hot-reloads
const storeName = global.__storeName || new StoreType();

if (!global.__storeName) {
  console.log(`üöÄ [MODULE NAME] Creating NEW store at ${new Date().toISOString()}`);
  global.__storeName = storeName;

  // Cleanup interval –¢–û–õ–¨–ö–û –¥–ª—è –Ω–æ–≤–æ–≥–æ store
  if (needsCleanup) {
    setInterval(() => {
      /* cleanup logic */
    }, CLEANUP_INTERVAL);
  }
} else {
  console.log(
    `‚ôªÔ∏è [MODULE NAME] Reusing EXISTING store at ${new Date().toISOString()}, size: ${storeName.size}`
  );
}
```

**–í–∞–∂–Ω–æ:**

- `setInterval` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –í–ù–£–¢–†–ò `if (!global.__storeName)` —á—Ç–æ–±—ã –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ intervals –ø—Ä–∏ hot-reload
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç–ª–∞–¥–∫–µ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —á—Ç–æ –ø–∞—Ç—Ç–µ—Ä–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç–º–æ–¥–∑–∏ `üöÄ` –¥–ª—è create, `‚ôªÔ∏è` –¥–ª—è reuse

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ù–ï–û–ë–•–û–î–ò–ú–û–°–¢–ò singleton

### ‚úÖ –ù–£–ñ–ï–ù singleton –∫–æ–≥–¥–∞:

1. **Module-level Map/Set** –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É hot-reload
2. **Connection pools / Clients** (PrismaClient, Redis, etc.)
3. **Rate limiting stores** —Å TTL > refresh —á–∞—Å—Ç–æ—Ç—ã
4. **Session stores** –¥–ª—è –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏—Ö —Å–µ—Å—Å–∏–π
5. **Caches** —Å –¥–æ—Ä–æ–≥–∏–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

### ‚ùå –ù–ï –Ω—É–∂–µ–Ω singleton –∫–æ–≥–¥–∞:

1. **Request-scoped –¥–∞–Ω–Ω—ã–µ** (—Å–æ–∑–¥–∞—é—Ç—Å—è –∏ —É–Ω–∏—á—Ç–æ–∂–∞—é—Ç—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –∑–∞–ø—Ä–æ—Å–∞)
2. **–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** (browser side - –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç—Å—è server hot-reload)
3. **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –∫—ç—à–∏** —Å TTL < 1 —Å–µ–∫—É–Ω–¥—ã
4. **Pure functions** –±–µ–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è
5. **Static readonly –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** (–Ω–µ –∏–∑–º–µ–Ω—è—é—Ç—Å—è)
6. **Instance properties** –µ—Å–ª–∏ –∫–ª–∞—Å—Å —Å–∞–º —è–≤–ª—è–µ—Ç—Å—è singleton

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

### –í –ø—Ä–æ–µ–∫—Ç–µ:

- ‚úÖ `docs/troubleshooting/RATE_LIMIT_HOT_RELOAD_FIX.md` - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è
- ‚úÖ `docs/DATABASE_CONNECTION_POOLING_FINAL_REPORT.md` - hot-reload –ø—Ä–æ–±–ª–µ–º–∞ —Å PrismaClient (lines 60-180)
- ‚úÖ `packages/session-management/src/utils/prisma-singleton.ts` - —ç—Ç–∞–ª–æ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –í–Ω–µ—à–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏:

- [Prisma Docs - Prevent hot reloading](https://www.prisma.io/docs/orm/prisma-client/setup-and-configuration/databases-connections#prevent-hot-reloading-from-creating-new-instances-of-prismaclient)
- [Next.js - Fast Refresh](https://nextjs.org/docs/architecture/fast-refresh)

---

## üîê Security Impact

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (–¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è):

1. **Rate Limit Bypass** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –æ–±—Ö–æ–¥–∏—Ç—å rate limiting —á–µ—Ä–µ–∑ F5 refresh
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ 6 —è–Ω–≤–∞—Ä—è 2025

2. **Email Rate Limit Bypass** ‚úÖ –ù–ï –ü–†–û–ë–õ–ï–ú–ê
   - –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å—á–∏—Ç–∞–ª–æ—Å—å –ø—Ä–æ–±–ª–µ–º–æ–π
   - **–ê–Ω–∞–ª–∏–∑ –ø–æ–∫–∞–∑–∞–ª:** —É–∂–µ –∑–∞—â–∏—â–µ–Ω–æ `rateLimitMiddleware.createOrder`
   - –î—É–±–ª–∏—Ä—É—é—â–∞—è –∑–∞—â–∏—Ç–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

3. **Idempotency Bypass** ‚ùå –ê–∫—Ç–∏–≤–Ω–∞
   - –î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –ø—Ä–æ–π—Ç–∏ –ø–æ—Å–ª–µ F5 refresh
   - **–¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ Priority 1**

---

## ‚úÖ –í—ã–≤–æ–¥—ã

### –ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–±–ª–µ–º: 4 (–æ–¥–Ω–∞ –Ω–æ–≤–∞—è –ø—Ä–∏ –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∫–µ)

- üî¥ **–ö—Ä–∏—Ç–∏—á–Ω—ã–µ (Security):** 1 (`idempotency.ts`)
- üü° **–°—Ä–µ–¥–Ω–∏–µ (Performance):** 2 (`i18n/request.ts` üÜï, `exchange.ts:588` üî•)
- üü¢ **–ù–∏–∑–∫–∏–µ (Optional HMR optimization):** 1 (`calculations.ts` - —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è F5 –∏ production)

### –ò—Å–∫–ª—é—á–µ–Ω–æ –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞: 2

- ‚ùå **Email Rate Limit** (`rate-limited-email-service.ts`) - —É–∂–µ –∑–∞—â–∏—â–µ–Ω–æ `rateLimitMiddleware.createOrder`
- ‚ùå **Telegram Bot Sessions** (`telegram-bot.ts`) - –Ω–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ –¥–ª—è web (–æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)

### üí° –ö–ª—é—á–µ–≤–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ: F5 Browser Refresh ‚â† Hot Module Reload

**–í–∞–∂–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã Next.js:**

1. **F5 –≤ –±—Ä–∞—É–∑–µ—Ä–µ** - –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –¢–û–õ–¨–ö–û client-side (HTML/CSS/JS)
   - ‚úÖ Node.js server process –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
   - ‚úÖ Module-level –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
   - ‚úÖ Cache —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

2. **HMR (Hot Module Reload)** - –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¢–û–õ–¨–ö–û –∫–æ–≥–¥–∞ developer —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–π–ª
   - ‚ö†Ô∏è Webpack/Next.js –æ—á–∏—â–∞–µ—Ç require.cache
   - ‚ö†Ô∏è Module –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
   - ‚ö†Ô∏è Module-level –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–±–Ω—É–ª—è—é—Ç—Å—è

3. **Production** - HMR –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é
   - ‚úÖ Server process —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
   - ‚úÖ –í—Å–µ cache —Ä–∞–±–æ—Ç–∞—é—Ç –∏–¥–µ–∞–ª—å–Ω–æ

**–í—ã–≤–æ–¥:** `SmartPricingService` –≤ `calculations.ts` —Ä–∞–±–æ—Ç–∞–µ—Ç –ü–†–ê–í–ò–õ–¨–ù–û –¥–ª—è F5 –∏ production. –ü—Ä–æ–±–ª–µ–º–∞ –¢–û–õ–¨–ö–û –ø—Ä–∏ HMR –≤ development (acceptable overhead).

### –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

‚úÖ **100% Verification** - –∫–∞–∂–¥–∞—è –Ω–∞—Ö–æ–¥–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ —á–µ—Ä–µ–∑:

1. `grep_search` - –ø–æ–∏—Å–∫ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º
2. `semantic_search` - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫
3. `file_search` - –ø–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤
4. `read_file` - —á—Ç–µ–Ω–∏–µ –∏ –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞
5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (imports, function calls)
6. –ê–Ω–∞–ª–∏–∑ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π (security, UX, performance)

### üîç –ü—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∫–∏ (6 –æ–∫—Ç—è–±—Ä—è 2025):

**–ü—Ä–∏–º–µ–Ω–µ–Ω—ã –≤—Å–µ 4 –º–µ—Ç–æ–¥–∞ –ø–æ–∏—Å–∫–∞ —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º:**

1. ‚úÖ **list_dir** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
2. ‚úÖ **grep_search** - –ø–æ–∏—Å–∫ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º `new Map`, `Cache`, `Store`
3. ‚úÖ **semantic_search** - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
4. ‚úÖ **file_search** - –ø–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∫–∏:**

- ‚úÖ –í—Å–µ 4 –ø—Ä–æ–±–ª–µ–º—ã –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –ü–†–û–í–ï–†–ï–ù–´
- ‚úÖ –ù–∞–π–¥–µ–Ω–∞ 1 –ù–û–í–ê–Ø –ø—Ä–æ–±–ª–µ–º–∞: Translation Cache
- ‚ùå **Email Rate Limit** - –ò–°–ö–õ–Æ–ß–ï–ù (—É–∂–µ –∑–∞—â–∏—â–µ–Ω–æ operation rate limiting)
- ‚ùå **Telegram Bot Sessions** - –ò–°–ö–õ–Æ–ß–ï–ù (–Ω–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ –¥–ª—è web)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã: packages/utils, packages/exchange-core, packages/hooks
- ‚úÖ –ù–ï–¢ –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π
- ‚úÖ MemorySessionAdapter.storage –ø—Ä–æ–≤–µ—Ä–µ–Ω - singleton –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è (class instance property + —Ñ–∞–±—Ä–∏—á–Ω—ã–π –∫—ç—à)
- ‚úÖ ESLint –∫—ç—à–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã - singleton –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è (build-time —É—Ç–∏–ª–∏—Ç—ã)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. ‚úÖ **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ** –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É (Phase 1: Idempotency Cache)
2. ‚ö†Ô∏è **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** –∏—Å–ø—Ä–∞–≤–∏—Ç—å Performance –ø—Ä–æ–±–ª–µ–º—ã (Phase 2: Translation Cache, exchange.ts:588)
3. ‚ÑπÔ∏è **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ** –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å HMR behavior (Phase 3: calculations.ts singleton –¥–ª—è HMR)
4. üìù **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å** –∫–∞–∂–¥–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ –æ–±—Ä–∞–∑—Ü—É `RATE_LIMIT_HOT_RELOAD_FIX.md`

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê–£–î–ò–¢ –ó–ê–í–ï–†–®–ï–ù –ò –ü–ï–†–ï–ü–†–û–í–ï–†–ï–ù –° –ì–õ–£–ë–û–ö–ò–ú –ê–ù–ê–õ–ò–ó–û–ú –ê–†–•–ò–¢–ï–ö–¢–£–†–´  
**–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è:** 100% –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ 4 –º–µ—Ç–æ–¥–∞ –ø–æ–∏—Å–∫–∞ + –∞–Ω–∞–ª–∏–∑ Node.js module caching  
**–î–∞—Ç–∞ –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∫–∏:** 6 –æ–∫—Ç—è–±—Ä—è 2025  
**–ö—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º:** 1 (Idempotency Cache)  
**–ö–ª—é—á–µ–≤–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ:** F5 Browser Refresh –ù–ï –≤–ª–∏—è–µ—Ç –Ω–∞ server-side singleton - —Ç–æ–ª—å–∫–æ HMR  
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:**

1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å Idempotency Cache –ø–µ—Ä–µ–¥ production release
2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å exchange.ts:588 (–≤–ª–∏—è–µ—Ç –Ω–∞ production performance)
3. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–æ–±–∞–≤–∏—Ç—å global singleton –≤ calculations.ts –¥–ª—è HMR optimization
