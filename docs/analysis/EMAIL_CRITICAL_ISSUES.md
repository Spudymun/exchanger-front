# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –í –°–ò–°–¢–ï–ú–ï EMAIL –£–í–ï–î–û–ú–õ–ï–ù–ò–ô

## –ê–Ω–∞–ª–∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ Email –ø–∏—Å—å–º–∞ (27 —Å–µ–Ω—Ç—è–±—Ä—è 2025)

–ù–∞ –æ—Å–Ω–æ–≤–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –ø–∏—Å—å–º–∞ –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

### 1. ‚ùå –•–ê–†–î–ö–û–î –°–ï–¢–ò –í EMAIL –®–ê–ë–õ–û–ù–ê–•

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –ø–∏—Å—å–º–µ –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è "Ethereum (ERC-20)" –¥–ª—è USDT, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–õ–æ–∫–∞—Ü–∏—è:** `packages/email-service/src/services/email-template-service.ts:106`

```typescript
networkName: NETWORK_NAMES[data.currency], // ‚ùå –•–ê–†–î–ö–û–î!
```

**–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞:** `packages/constants/src/exchange-currencies.ts:28`

```typescript
export const NETWORK_NAMES = {
  USDT: 'Ethereum (ERC-20)', // ‚ùå –í–°–ï–ì–î–ê ERC-20!
};
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å TRC-20 –∏–ª–∏ BEP-20, –Ω–æ –≤ email –ø–æ–ª—É—á–∏—Ç –∞–¥—Ä–µ—Å ERC-20.

### 2. ‚ùå –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –í–ù–£–¢–†–ï–ù–ù–ï–ì–û UUID –í EMAIL

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –ø–∏—Å—å–º–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π database ID –≤–º–µ—Å—Ç–æ –ø—É–±–ª–∏—á–Ω–æ–≥–æ.

**–õ–æ–∫–∞—Ü–∏—è:** `apps/web/src/server/trpc/routers/exchange.ts:263`

```typescript
orderId: order.id, // ‚ùå –í–ù–£–¢–†–ï–ù–ù–ò–ô UUID
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**

```typescript
orderId: order.publicId, // ‚úÖ –ü–£–ë–õ–ò–ß–ù–´–ô ID
```

### 3. ‚ùå –ü–û–¢–ï–†–Ø TOKENSTANDARD –ü–†–ò –°–û–ó–î–ê–ù–ò–ò –ó–ê–Ø–í–ö–ò

**–ü—Ä–æ–±–ª–µ–º–∞:** TokenStandard –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –≤ —Å—Ö–µ–º–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

**–õ–æ–∫–∞—Ü–∏—è:** `packages/utils/src/validation/security-enhanced-exchange-schemas.ts:121-136`

```typescript
export const securityEnhancedCreateExchangeOrderSchema = z.object({
  // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
  // ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢: tokenStandard: z.enum(['ERC-20', 'TRC-20', 'BEP-20']).optional()
});
```

### 4. ‚ùå –ò–ù–¢–ï–†–§–ï–ô–° EMAIL –ù–ï –ü–û–î–î–ï–†–ñ–ò–í–ê–ï–¢ –î–ò–ù–ê–ú–ò–ß–ï–°–ö–£–Æ –°–ï–¢–¨

**–ü—Ä–æ–±–ª–µ–º–∞:** `BaseCryptoEmailData` –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å–µ—Ç–∏.

**–õ–æ–∫–∞—Ü–∏—è:** `packages/email-service/src/types/index.ts:41-48`

```typescript
export interface BaseCryptoEmailData {
  // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
  // ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢: tokenStandard?: string;
}
```

## üîß –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å email –¥–∞–Ω–Ω—ã—Ö

```typescript
export interface BaseCryptoEmailData {
  orderId: string;
  cryptoAddress: string;
  currency: CryptoCurrency;
  amount: number;
  expiresAt: Date;
  userEmail: string;
  tokenStandard?: string; // ‚úÖ –î–û–ë–ê–í–ò–¢–¨
}
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —à–∞–±–ª–æ–Ω–∞

```typescript
private static async generateGenericTemplateEmail() {
  const variables = {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
    networkName: data.tokenStandard
      ? TOKEN_STANDARD_DETAILS[data.tokenStandard]?.network
      : NETWORK_NAMES[data.currency], // ‚úÖ –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ê–Ø –°–ï–¢–¨
  };
}
```

### –®–∞–≥ 3: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–µ–¥–∞—á—É –¥–∞–Ω–Ω—ã—Ö –≤ sendCryptoAddressEmail

```typescript
await RateLimitedEmailService.sendCryptoAddress(
  {
    orderId: order.publicId, // ‚úÖ –ü–£–ë–õ–ò–ß–ù–´–ô ID
    // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
    tokenStandard: order.tokenStandard, // ‚úÖ –ü–ï–†–ï–î–ê–¢–¨ –°–ï–¢–¨
  },
  sessionMetadata.ip
);
```

### –®–∞–≥ 4: –î–æ–±–∞–≤–∏—Ç—å tokenStandard –≤ —Å—Ö–µ–º—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏

```typescript
export const securityEnhancedCreateExchangeOrderSchema = z.object({
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  tokenStandard: z.enum(['ERC-20', 'TRC-20', 'BEP-20']).optional(),
});
```

### –®–∞–≥ 5: –û–±–Ω–æ–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

```typescript
const data = {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  tokenStandard: request.tokenStandard, // ‚úÖ –°–û–•–†–ê–ù–ò–¢–¨ –í –ë–î
};
```

## üéØ –ö–†–ò–¢–ò–ß–ù–û–°–¢–¨ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

1. **–í–´–°–û–ö–ê–Ø** - –•–∞—Ä–¥–∫–æ–¥ —Å–µ—Ç–∏ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∞–¥—Ä–µ—Å–∞)
2. **–°–†–ï–î–ù–Ø–Ø** - UUID –≤ –ø–∏—Å—å–º–∞—Ö (–Ω–∞—Ä—É—à–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
3. **–°–†–ï–î–ù–Ø–Ø** - –ü–æ—Ç–µ—Ä—è tokenStandard (–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
4. **–ù–ò–ó–ö–ê–Ø** - –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞)

**–ë–µ–∑ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã #1 —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∞–¥—Ä–µ—Å–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–µ—Ç–∏!**

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –í–´–ü–û–õ–ù–ï–ù–´ (27 —Å–µ–Ω—Ç—è–±—Ä—è 2025)

### üîß –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

1. **‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ tokenStandard –≤ —Å—Ö–µ–º—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏**
   - –§–∞–π–ª: `packages/utils/src/validation/security-enhanced-exchange-schemas.ts`
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ: –î–æ–±–∞–≤–ª–µ–Ω–æ `tokenStandard: z.enum(VALID_TOKEN_STANDARDS).optional()`

2. **‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å CreateOrderRequest**
   - –§–∞–π–ª: `packages/exchange-core/src/types/order.ts`
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ: –î–æ–±–∞–≤–ª–µ–Ω–æ `tokenStandard?: string`

3. **‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ tokenStandard –≤ —Ñ–æ—Ä–º–µ**
   - –§–∞–π–ª: `apps/web/src/components/exchange/ExchangeContainer.tsx`
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ: –î–æ–±–∞–≤–ª–µ–Ω `tokenStandard: values.tokenStandard` –≤ orderRequest

4. **‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö**
   - –§–∞–π–ª: `packages/session-management/src/adapters/postgres-order-adapter.ts`
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ: –î–æ–±–∞–≤–ª–µ–Ω `tokenStandard: orderData.tokenStandard` –≤ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏

5. **‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ –ø—É–±–ª–∏—á–Ω–æ–≥–æ ID –≤ email**
   - –§–∞–π–ª: `apps/web/src/server/trpc/routers/exchange.ts`
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ: `orderId: order.publicId` –≤–º–µ—Å—Ç–æ `order.id`

6. **‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ tokenStandard –≤ email –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ**
   - –§–∞–π–ª: `packages/email-service/src/types/index.ts`
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ: –î–æ–±–∞–≤–ª–µ–Ω–æ `tokenStandard?: string` –≤ BaseCryptoEmailData

7. **‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ç–∏ –≤ email —à–∞–±–ª–æ–Ω–∞—Ö**
   - –§–∞–π–ª: `packages/email-service/src/services/email-template-service.ts`
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ: –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ —Å–µ—Ç–∏ –ø–æ tokenStandard —Å fallback –Ω–∞ —Ö–∞—Ä–¥–∫–æ–¥

### üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞**: Email —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å–µ—Ç—å (TRC-20, ERC-20, BEP-20) —Å–æ–≥–ª–∞—Å–Ω–æ –≤—ã–±–æ—Ä—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∞**: –í email –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω—ã–π ID
- **–î–∞–Ω–Ω—ã–µ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è**: tokenStandard —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ email
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–æ–±–ª—é–¥–µ–Ω–∞**: –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–ª–µ–¥—É—é—Ç –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –ø—Ä–æ–µ–∫—Ç–∞

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞:

- TypeScript –∫–æ–º–ø–∏–ª—è—Ü–∏—è: **–ü–†–û–ô–î–ï–ù–ê**
- –°–±–æ—Ä–∫–∞ –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π: **–£–°–ü–ï–®–ù–ê**
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ ai-agent-rules.yml: **–°–û–ë–õ–Æ–î–ï–ù–û**
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–Ω–æ Rule 25: **–í–´–ü–û–õ–ù–ï–ù–û**
