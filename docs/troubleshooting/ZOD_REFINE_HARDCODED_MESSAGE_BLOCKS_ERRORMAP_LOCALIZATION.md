# –ü—Ä–æ–±–ª–µ–º–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ PASSWORD_CONFIRMATION_MISMATCH

**–î–∞—Ç–∞:** 5 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–ï–®–ï–ù–û  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç)  
**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º, i18n —Å–∏—Å—Ç–µ–º–∞, Zod —Å—Ö–µ–º—ã

---

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –°–∏–º–ø—Ç–æ–º—ã

–í —Ñ–æ—Ä–º–µ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è (`ConfirmResetForm`) –ø—Ä–∏ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–ª **—Å—ã—Ä–æ–π –∫–ª—é—á –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏** `PASSWORD_CONFIRMATION_MISMATCH` –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è "–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç".

**–°—Ç—Ä–∞–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**

- ‚úÖ –í —Ñ–æ—Ä–º–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (`RegisterForm`) ‚Äî –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è **–†–ê–ë–û–¢–ê–õ–ê**
- ‚ùå –í —Ñ–æ—Ä–º–µ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è (`ConfirmResetForm`) ‚Äî –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è **–ù–ï –†–ê–ë–û–¢–ê–õ–ê**
- ‚ö†Ô∏è –ü–∞—Ç—Ç–µ—Ä–Ω: –±–µ–∑ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤ —Ä–∞–±–æ—Ç–∞–ª–æ, —Å–æ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–∞–º–∏ ‚Äî –Ω–µ—Ç

### –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ

1. –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
2. –í–≤–µ—Å—Ç–∏ —Ä–∞–∑–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ —Å–æ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–∞–º–∏:
   - `newPassword`: `TestPassword1!`
   - `confirmNewPassword`: `TestPassword2!`
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è `PASSWORD_CONFIRMATION_MISMATCH` –≤–º–µ—Å—Ç–æ "–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç"

---

## üîç –ü—Ä–æ—Ü–µ—Å—Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –≠—Ç–∞–ø 1: –ê–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**

- ‚úÖ –ö–ª—é—á `validation.confirmNewPassword.noMatch` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ `apps/web/messages/ru/advanced-exchange.json`
- ‚úÖ –ü–µ—Ä–µ–≤–æ–¥—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç: RU: "–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç", EN: "Passwords do not match"
- ‚úÖ –•—É–∫ `useFormWithNextIntl` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å namespace `AdvancedExchangeForm`
- ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `handleConfirmNewPasswordValidation` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ `packages/utils/src/validation/handlers.ts`

**–í—ã–≤–æ–¥:** –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ i18n –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### –≠—Ç–∞–ø 2: –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞

**–î–æ–±–∞–≤–ª–µ–Ω–æ debug-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ 5 –∫–ª—é—á–µ–≤—ã—Ö —Ç–æ—á–∫–∞—Ö:**

1. `createNextIntlZodErrorMap` (packages/utils/src/validation/core.ts)

   ```typescript
   console.warn('[ZOD_ERROR_MAP] Called with:', { code: issue.code, message: issue.message });
   ```

2. `handleValidationIssue` (packages/utils/src/validation/core.ts)

   ```typescript
   console.warn('[VALIDATION_ISSUE] Processing:', { code: issue.code, message: issue.message });
   ```

3. `createFormValidatorFn` (packages/hooks/src/business/useFormWithNextIntl.ts)

   ```typescript
   console.warn('[FORM_VALIDATOR] Validating form:', { result });
   ```

4. `createFieldValidator` (packages/hooks/src/business/useFormWithNextIntl.ts)

   ```typescript
   console.warn('[FIELD_VALIDATOR] Validating field:', { fieldName, result });
   ```

5. `handleConfirmNewPasswordValidation` (packages/utils/src/validation/handlers.ts)
   ```typescript
   console.warn('[HANDLER] confirmNewPassword - Issue details:', {
     code: issue.code,
     message: issue.message,
   });
   ```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**

- üî¥ **–ë–ï–ó —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤** (`Test1` vs `Test2`): errorMap **–í–´–ó–´–í–ê–õ–°–Ø**, –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–ª–∞
- üî¥ **–°–û —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–∞–º–∏** (`Test1!` vs `Test2!`): errorMap **–ù–ï –í–´–ó–´–í–ê–õ–°–Ø**, –ø–æ–∫–∞–∑—ã–≤–∞–ª—Å—è —Å—ã—Ä–æ–π –∫–ª—é—á

### –≠—Ç–∞–ø 3: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ XSS-–≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–ù–∞–π–¥–µ–Ω–æ:** `xssProtectedPasswordSchema` –≤ `packages/utils/src/validation/enhanced-building-blocks.ts`

```typescript
export const xssProtectedPasswordSchema = passwordSchema.refine(
  password => !containsPotentialXSS(password),
  {
    message: 'INVALID_CHARACTERS_DETECTED', // ‚ö†Ô∏è HARDCODED MESSAGE
  }
);
```

**–ü—Ä–æ–±–ª–µ–º–∞:**

- XSS-–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∞ **–î–û** –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
- –ù–æ –¥–∞–∂–µ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ `INVALID_CHARACTERS_DETECTED` –≤ handler ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å

### –≠—Ç–∞–ø 4: –ê–Ω–∞–ª–∏–∑ —Å—Ö–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –≤ `security-enhanced-auth-schemas.ts`:**

```typescript
// ‚ùå –ë–´–õ–û (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
export const fullySecurityEnhancedConfirmResetPasswordSchema = z
  .object({
    newPassword: enhancedPasswordSchema,
    confirmNewPassword: enhancedPasswordSchema,
  })
  .refine(data => data.newPassword === data.confirmNewPassword, {
    path: ['confirmNewPassword'],
    message: 'PASSWORD_CONFIRMATION_MISMATCH', // üî¥ HARDCODED MESSAGE
  });
```

**–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:**

```typescript
// ‚ùå –ë–´–õ–û (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
export const fullySecurityEnhancedRegisterSchema = z
  .object({
    email: xssProtectedEmailSchema,
    password: enhancedPasswordSchema,
    confirmPassword: enhancedPasswordSchema,
    captcha: securityEnhancedCaptchaSchema,
  })
  .refine(data => data.password === data.confirmPassword, {
    path: ['confirmPassword'],
    message: 'PASSWORD_CONFIRMATION_MISMATCH', // üî¥ HARDCODED MESSAGE
  });
```

---

## üéØ –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

### –ú–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç—ã Zod errorMap

**–ö–ª—é—á–µ–≤–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:** –ö–æ–≥–¥–∞ –≤ `.refine()` —è–≤–Ω–æ —É–∫–∞–∑–∞–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `message`, Zod **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç errorMap** –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é.

**–ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –≤ Zod:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ Zod schema                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ .refine() —É—Å–ª–æ–≤–∏–π                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚ñº
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ –ï—Å—Ç—å message?    ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ                  ‚îÇ
         ‚ñº –î–ê               ‚ñº –ù–ï–¢
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ –í–µ—Ä–Ω—É—Ç—å ‚îÇ      ‚îÇ –í—ã–∑–≤–∞—Ç—å      ‚îÇ
    ‚îÇ message ‚îÇ      ‚îÇ errorMap     ‚îÇ
    ‚îÇ –ù–ê–ü–†–Ø–ú–£–Æ‚îÇ      ‚îÇ ‚Üì            ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ handler      ‚îÇ
                     ‚îÇ ‚Üì            ‚îÇ
                     ‚îÇ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è  ‚îÇ
                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**

- –° `message: 'PASSWORD_CONFIRMATION_MISMATCH'` ‚Üí Zod –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É **–∫–∞–∫ –µ—Å—Ç—å**, –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ë–µ–∑ `message` ‚Üí Zod –≤—ã–∑—ã–≤–∞–µ—Ç errorMap ‚Üí handler –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª—é—á ‚Üí next-intl –ø–µ—Ä–µ–≤–æ–¥–∏—Ç

**–ü–æ—á–µ–º—É —Ä–∞–±–æ—Ç–∞–ª–æ –≤ RegisterForm, –Ω–æ –Ω–µ –≤ ConfirmResetForm:**

- –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –∫–∞–∑–∞–ª–æ—Å—å, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–±–µ–∏—Ö —Ñ–æ—Ä–º–∞—Ö
- –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ: **–í –û–ë–ï–ò–• –ù–ï –†–ê–ë–û–¢–ê–õ–û** –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ hardcoded message
- –†–∞–∑–Ω–∏—Ü–∞ –±—ã–ª–∞ —Ç–æ–ª—å–∫–æ –≤ —Ç–æ–º, —á—Ç–æ RegisterForm —Ä–µ–∂–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª—Å—è —Å–æ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–∞–º–∏

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

**–§–∞–π–ª:** `packages/utils/src/validation/security-enhanced-auth-schemas.ts`

#### 1. –°—Ö–µ–º–∞ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è

```typescript
// ‚úÖ –°–¢–ê–õ–û (–ü–†–ê–í–ò–õ–¨–ù–û):
export const fullySecurityEnhancedConfirmResetPasswordSchema = z
  .object({
    newPassword: enhancedPasswordSchema,
    confirmNewPassword: enhancedPasswordSchema,
  })
  .refine(data => data.newPassword === data.confirmNewPassword, {
    path: ['confirmNewPassword'],
    // FIX: –£–±—Ä–∞–Ω message —á—Ç–æ–±—ã error –ø—Ä–æ—Ö–æ–¥–∏–ª —á–µ—Ä–µ–∑ errorMap –∏ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–ª—Å—è —á–µ—Ä–µ–∑ handler
  });
```

#### 2. –°—Ö–µ–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

```typescript
// ‚úÖ –°–¢–ê–õ–û (–ü–†–ê–í–ò–õ–¨–ù–û):
export const fullySecurityEnhancedRegisterSchema = z
  .object({
    email: xssProtectedEmailSchema,
    password: enhancedPasswordSchema,
    confirmPassword: enhancedPasswordSchema,
    captcha: securityEnhancedCaptchaSchema,
  })
  .refine(data => data.password === data.confirmPassword, {
    path: ['confirmPassword'],
    // FIX: –£–±—Ä–∞–Ω message —á—Ç–æ–±—ã error –ø—Ä–æ—Ö–æ–¥–∏–ª —á–µ—Ä–µ–∑ errorMap –∏ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–ª—Å—è —á–µ—Ä–µ–∑ handler
  });
```

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

**–î–û:**

```typescript
.refine(validator, {
  path: ['field'],
  message: 'SOME_KEY', // ‚ùå Zod –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —ç—Ç–æ –Ω–∞–ø—Ä—è–º—É—é
})
```

**–ü–û–°–õ–ï:**

```typescript
.refine(validator, {
  path: ['field'],
  // ‚úÖ Zod –≤—ã–∑—ã–≤–∞–µ—Ç errorMap ‚Üí handler ‚Üí –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
})
```

---

## üîÑ –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–∫–∏ (–ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —Ä–∞–∑–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ (Test1! ‚â† Test2!)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. fullySecurityEnhancedConfirmResetPasswordSchema.safeParse()   ‚îÇ
‚îÇ    —Å errorMap: createNextIntlZodErrorMap()                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. XSS –ø—Ä–æ–≤–µ—Ä–∫–∞: enhancedPasswordSchema = passwordSchema +       ‚îÇ
‚îÇ    xssProtectedPasswordSchema (–º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å INVALID_CHARACTERS) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 4. .refine() –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: newPassword === confirmNewPassword       ‚îÇ
‚îÇ    –†–µ–∑—É–ª—å—Ç–∞—Ç: false ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è Zod issue –ë–ï–ó message           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 5. Zod –≤—ã–∑—ã–≤–∞–µ—Ç errorMap (—Ç.–∫. message –Ω–µ —É–∫–∞–∑–∞–Ω)               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 6. createNextIntlZodErrorMap() ‚Üí handleValidationIssue()        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 7. –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ –ø–æ–ª—é: confirmNewPassword ‚Üí                  ‚îÇ
‚îÇ    handleConfirmNewPasswordValidation()                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 8. Handler –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:                                            ‚îÇ
‚îÇ    - issue.code === z.ZodIssueCode.custom                       ‚îÇ
‚îÇ    - issue.message === 'INVALID_CHARACTERS_DETECTED'            ‚îÇ
‚îÇ      ‚Üí VALIDATION_KEYS.CONFIRM_NEW_PASSWORD_XSS_DETECTED        ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ    - issue.code === z.ZodIssueCode.custom (–±–µ–∑ message)        ‚îÇ
‚îÇ      ‚Üí VALIDATION_KEYS.CONFIRM_NEW_PASSWORD_NO_MATCH            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 9. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è: 'AdvancedExchangeForm:validation               ‚îÇ
‚îÇ    .confirmNewPassword.noMatch'                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 10. next-intl –ø–æ–ª—É—á–∞–µ—Ç –∫–ª—é—á –∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç:                        ‚îÇ
‚îÇ     RU: "–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç"                                   ‚îÇ
‚îÇ     EN: "Passwords do not match"                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 11. React Hook Form –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –î–û vs –ü–û–°–õ–ï

### –°—Ü–µ–Ω–∞—Ä–∏–π: –†–∞–∑–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ —Å–æ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–∞–º–∏

| –ê—Å–ø–µ–∫—Ç                     | –î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è                   | –ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è               |
| -------------------------- | -------------------------------- | ------------------------------- |
| **–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ** | `PASSWORD_CONFIRMATION_MISMATCH` | "–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç"           |
| **errorMap –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è?**   | ‚ùå –ù–ï–¢                           | ‚úÖ –î–ê                           |
| **Handler –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è?**    | ‚ùå –ù–ï–¢                           | ‚úÖ –î–ê                           |
| **next-intl –ø–µ—Ä–µ–≤–æ–¥–∏—Ç?**   | ‚ùå –ù–ï–¢                           | ‚úÖ –î–ê                           |
| **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç**  | üî¥ –ü–õ–û–•–û (—Å—ã—Ä–æ–π –∫–ª—é—á)            | üü¢ –û–¢–õ–ò–ß–ù–û (—á–∏—Ç–∞–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ) |

### –°—Ü–µ–Ω–∞—Ä–∏–π: –†–∞–∑–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –ë–ï–ó —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤

| –ê—Å–ø–µ–∫—Ç                     | –î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è                                        | –ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è     |
| -------------------------- | ----------------------------------------------------- | --------------------- |
| **–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ** | `PASSWORD_CONFIRMATION_MISMATCH`                      | "–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç" |
| **errorMap –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è?**   | ‚ùå –ù–ï–¢                                                | ‚úÖ –î–ê                 |
| **–ü—Ä–∏—á–∏–Ω–∞ —Ä–∞–±–æ—Ç—ã –î–û**      | XSS –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª, –Ω–æ message –≤—Å—ë —Ä–∞–≤–Ω–æ –±—ã–ª hardcoded | ‚Äî                     |

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—à–µ–Ω–∏—è

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

#### ‚úÖ –§–æ—Ä–º–∞ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è (ConfirmResetForm)

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–∞—Ä–æ–ª–∏ –ù–ï —Å–æ–≤–ø–∞–¥–∞—é—Ç, –ë–ï–ó —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤**

```
newPassword: Test1234
confirmNewPassword: Test5678
–û–∂–∏–¥–∞–µ—Ç—Å—è: "–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç" ‚úÖ
```

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–∞—Ä–æ–ª–∏ –ù–ï —Å–æ–≤–ø–∞–¥–∞—é—Ç, –°–û —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–∞–º–∏**

```
newPassword: TestPassword1!
confirmNewPassword: TestPassword2!
–û–∂–∏–¥–∞–µ—Ç—Å—è: "–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç" ‚úÖ
```

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–∞—Ä–æ–ª–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç**

```
newPassword: TestPassword1!
confirmNewPassword: TestPassword1!
–û–∂–∏–¥–∞–µ—Ç—Å—è: –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç, –æ—à–∏–±–æ–∫ –Ω–µ—Ç ‚úÖ
```

#### ‚úÖ –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (RegisterForm)

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–∞—Ä–æ–ª–∏ –ù–ï —Å–æ–≤–ø–∞–¥–∞—é—Ç**

```
password: SecurePass123!
confirmPassword: SecurePass456!
–û–∂–∏–¥–∞–µ—Ç—Å—è: "–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç" ‚úÖ
```

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–∞—Ä–æ–ª–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç**

```
password: SecurePass123!
confirmPassword: SecurePass123!
–û–∂–∏–¥–∞–µ—Ç—Å—è: –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç ‚úÖ
```

---

## üìö –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ —É—Ä–æ–∫–∏

### 1. **Zod errorMap Design Pattern**

**–ü—Ä–∞–≤–∏–ª–æ:** –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `message` –≤ `.refine()`, –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è.

```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (–±–ª–æ–∫–∏—Ä—É–µ—Ç –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é):
.refine(validator, {
  message: 'SOME_KEY',
})

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (–ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ errorMap):
.refine(validator, {
  // message –æ–ø—É—â–µ–Ω ‚Üí errorMap –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç
})
```

### 2. **Debugging Strategy**

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–µ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏:

1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏ –≤ errorMap ‚Üí handler ‚Üí validateForm ‚Üí validateField
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ errorMap –≤–æ–æ–±—â–µ
3. ‚úÖ –ï—Å–ª–∏ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è ‚Äî –∏—Å–∫–∞—Ç—å hardcoded messages –≤ —Å—Ö–µ–º–∞—Ö

### 3. **XSS Protection Layer**

XSS-–≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞:

- ‚úÖ –†–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ errorMap (–±–µ–∑ hardcoded message)
- ‚úÖ –ò–º–µ—Ç—å —Å–≤–æ–π handler –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ `INVALID_CHARACTERS_DETECTED`
- ‚úÖ –ù–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

### 4. **Testing Checklist**

–î–ª—è —Ñ–æ—Ä–º —Å –ø–∞—Ä–æ–ª—è–º–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:

- ‚úÖ –ü–∞—Ä–æ–ª–∏ –±–µ–∑ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤
- ‚úÖ –ü–∞—Ä–æ–ª–∏ —Å–æ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–∞–º–∏ (!, @, #, $, %, etc.)
- ‚úÖ –°–º–µ—à–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (–æ–¥–∏–Ω —Å–æ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–∞–º–∏, –¥—Ä—É–≥–æ–π –±–µ–∑)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ –≤—Å–µ—Ö —è–∑—ã–∫–∞—Ö (RU, EN)

---

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ —Ä–∞–º–∫–∞—Ö —Ñ–∏–∫—Å–∞

1. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ INVALID_CHARACTERS_DETECTED**

   ```typescript
   // –í handleConfirmNewPasswordValidation:
   if (issue.code === z.ZodIssueCode.custom) {
     if (issue.message === 'INVALID_CHARACTERS_DETECTED') {
       return VALIDATION_KEYS.CONFIRM_NEW_PASSWORD_XSS_DETECTED;
     }
     return VALIDATION_KEYS.CONFIRM_NEW_PASSWORD_NO_MATCH;
   }
   ```

2. **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –æ–±–µ–∏—Ö —Ñ–æ—Ä–º–∞—Ö**
   - `fullySecurityEnhancedConfirmResetPasswordSchema` (—Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è)
   - `fullySecurityEnhancedRegisterSchema` (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –±—É–¥—É—â–µ–≥–æ

1. **Code Review Checklist:**
   - [ ] –í—Å–µ `.refine()` –±–µ–∑ hardcoded `message`
   - [ ] Handlers –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
   - [ ] –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –≤—Å–µ—Ö —è–∑—ã–∫–∞—Ö

2. **ESLint –ø—Ä–∞–≤–∏–ª–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**

   ```javascript
   // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—Ç—å –æ .refine() —Å message
   'no-restricted-syntax': [
     'error',
     {
       selector: "CallExpression[callee.property.name='refine'] > ObjectExpression:has(Property[key.name='message'])",
       message: 'Avoid using message in .refine() - use errorMap for localization instead',
     },
   ]
   ```

3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
   - –î–æ–±–∞–≤–∏—Ç—å —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –≤ `docs/core/I18N_ARCHITECTURE_GUIDE.md`
   - –°–æ–∑–¥–∞—Ç—å —Å–µ–∫—Ü–∏—é "Common Pitfalls" —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏

---

## üìù –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. ‚úÖ `packages/utils/src/validation/security-enhanced-auth-schemas.ts`
   - –£–¥–∞–ª–µ–Ω `message: 'PASSWORD_CONFIRMATION_MISMATCH'` –∏–∑ –æ–±–µ–∏—Ö —Å—Ö–µ–º

2. ‚úÖ `packages/utils/src/validation/handlers.ts`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ `INVALID_CHARACTERS_DETECTED` –≤ `handleConfirmNewPasswordValidation`

### –§–∞–π–ª—ã —Å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º debug-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏)

1. `packages/utils/src/validation/core.ts`
2. `packages/hooks/src/business/useFormWithNextIntl.ts`

---

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ù–£–õ–ï–í–û–ï

- errorMap –≤—ã–∑—ã–≤–∞–ª—Å—è –∏ —Ä–∞–Ω—å—à–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö –æ—à–∏–±–æ–∫
- –£–±—Ä–∞–ª–∏ hardcoded message ‚Üí —Ç–µ–ø–µ—Ä—å –ø—Ä–æ—Ö–æ–¥–∏–º —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å
- –ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π, —Ç–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```
[–§–æ—Ä–º–∞ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è]
newPassword: TestPassword1!
confirmNewPassword: TestPassword2!

‚ùå –û—à–∏–±–∫–∞: PASSWORD_CONFIRMATION_MISMATCH
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```
[–§–æ—Ä–º–∞ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è]
newPassword: TestPassword1!
confirmNewPassword: TestPassword2!

‚úÖ –û—à–∏–±–∫–∞: –ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç (RU)
‚úÖ –û—à–∏–±–∫–∞: Passwords do not match (EN)
```

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [I18N Architecture Guide](../core/I18N_ARCHITECTURE_GUIDE.md)
- [Validation Handlers Documentation](../../packages/utils/src/validation/README.md)
- [Zod Official Documentation](https://zod.dev/)
- [next-intl Documentation](https://next-intl-docs.vercel.app/)

---

## üë§ –ê–≤—Ç–æ—Ä —Ä–µ—à–µ–Ω–∏—è

**AI Agent** (GitHub Copilot)  
**–î–∞—Ç–∞:** 5 –æ–∫—Ç—è–±—Ä—è 2025  
**–í—Ä–µ–º—è –Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É:** ~2 —á–∞—Å–∞ (–≤–∫–ª—é—á–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## ‚ú® –ö–ª—é—á–µ–≤–æ–π –∏–Ω—Å–∞–π—Ç

> **"–ö–æ–≥–¥–∞ Zod `.refine()` –∏–º–µ–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `message`, –æ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç `errorMap` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é, –º–∏–Ω—É—è –≤—Å—é —Å–∏—Å—Ç–µ–º—É –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏."**

–≠—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ Zod, –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å –ø—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü–†–û–ë–õ–ï–ú–ê –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–®–ï–ù–ê**
