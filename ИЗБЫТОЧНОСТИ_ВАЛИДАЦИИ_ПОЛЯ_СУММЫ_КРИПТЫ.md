# üö® –ê–ù–ê–õ–ò–ó –ò–ó–ë–´–¢–û–ß–ù–û–°–¢–ï–ô –í–ê–õ–ò–î–ê–¶–ò–ò –ü–û–õ–Ø –°–£–ú–ú–´ –ö–†–ò–ü–¢–´

## üìä –û–ë–ó–û–† –ü–†–û–ë–õ–ï–ú–´

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 29 –∞–≤–≥—É—Å—Ç–∞ 2025  
**–°—Ç–∞—Ç—É—Å:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–ó–ë–´–¢–û–ß–ù–û–°–¢–ò –û–ë–ù–ê–†–£–ñ–ï–ù–´  
**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏:** 3 –≥—Ä—É–ø–ø—ã

---

## üîç –ù–ê–ô–î–ï–ù–ù–´–ï –ò–ó–ë–´–¢–û–ß–ù–û–°–¢–ò

### **1. –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï –õ–û–ì–ò–ö–ò –í–ê–õ–ò–î–ê–¶–ò–ò –ú–ï–ñ–î–£ –°–•–ï–ú–ê–ú–ò**

#### –ü—Ä–æ–±–ª–µ–º–Ω–∞—è –ø–∞—Ä–∞:

- **`cryptoAmountStringSchema`** (schemas-crypto.ts) - –ü–û–õ–ù–ê–Ø –≤–∞–ª–∏–¥–∞—Ü–∏—è
- **`validateExchangeAmountFormat()`** (security-enhanced-exchange-schemas.ts) - –£–†–ï–ó–ê–ù–ù–ê–Ø –≤–∞–ª–∏–¥–∞—Ü–∏—è

#### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:

| –ü—Ä–æ–≤–µ—Ä–∫–∞              | `cryptoAmountStringSchema`    | `validateExchangeAmountFormat()` |
| --------------------- | ----------------------------- | -------------------------------- |
| ‚úÖ XSS –∑–∞—â–∏—Ç–∞         | `containsPotentialXSS(val)`   | `containsPotentialXSS(val)`      |
| ‚úÖ Allow empty string | `if (val === '') return true` | `if (val === '') return true`    |
| ‚úÖ Numeric validation | `Number.isNaN(num)`           | `Number.isNaN(num)`              |
| ‚úÖ Decimal places     | `val.split('.')` ‚â§ 2          | `val.split('.')` ‚â§ 2             |
| ‚úÖ Decimal precision  | –î–æ 8 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ —Ç–æ—á–∫–∏       | ‚ùå **–ù–ï–¢**                       |
| ‚úÖ Positive check     | `Number(val) > 0`             | ‚ùå **–ù–ï–¢**                       |

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

- **`cryptoAmountStringSchema`:** useExchangeStoreWithTranslations.ts (3 –º–µ—Å—Ç–∞)
- **`validateExchangeAmountFormat()`:** 2 —Å—Ö–µ–º—ã exchange —Ñ–æ—Ä–º

---

### **2. –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï –ü–û–î–•–û–î–û–í –ö –í–ê–õ–ò–î–ê–¶–ò–ò –°–£–ú–ú–´**

#### String –ø–æ–¥—Ö–æ–¥—ã:

```typescript
// –ü–æ–¥—Ö–æ–¥ 1: –ü–æ–ª–Ω–∞—è —Å—Ç—Ä–æ–∫–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
export const cryptoAmountStringSchema = z
  .string()
  .refine(val => !containsPotentialXSS(val), 'INVALID_CHARACTERS_DETECTED')
  .refine(/* full validation logic */);

// –ü–æ–¥—Ö–æ–¥ 2: –£—Ä–µ–∑–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
function validateExchangeAmountFormat(val: string): boolean {
  if (containsPotentialXSS(val)) return false;
  // simplified validation logic
}
```

#### Number –ø–æ–¥—Ö–æ–¥—ã:

```typescript
// –ü–æ–¥—Ö–æ–¥ 3: Number –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è calculate
export const securityEnhancedCalculateAmountSchema = z.object({
  amount: z.number().positive(),
});

// –ü–æ–¥—Ö–æ–¥ 4: Number –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è create order
export const securityEnhancedCreateExchangeOrderSchema = z.object({
  cryptoAmount: z
    .number()
    .positive('AMOUNT_POSITIVE_REQUIRED')
    .min(VALIDATION_LIMITS.MIN_ORDER_AMOUNT, 'AMOUNT_MIN_REQUIRED')
    .max(VALIDATION_LIMITS.MAX_ORDER_AMOUNT, 'AMOUNT_MAX_EXCEEDED')
    .finite('AMOUNT_MUST_BE_FINITE'),
});
```

---

### **3. LEGACY POSITIVE –í–ê–õ–ò–î–ê–¶–ò–Ø (–ù–ï –ê–ö–¢–ò–í–ù–ê –í UI)**

#### ‚ö†Ô∏è –í–ê–ñ–ù–û: –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ù–ï–í–û–ó–ú–û–ñ–ù–û –í–í–ï–°–¢–ò –≤ UI

**–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:** `useNumericInput` –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤–≤–æ–¥ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —á–µ—Ä–µ–∑ `isNumericChar()` –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑—Ä–µ—à–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã –∏ —Ç–æ—á–∫—É.

**–¢–∏–ø—ã –æ—à–∏–±–æ–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏:**

- ‚úÖ `AMOUNT_REQUIRED` - –ø—É—Å—Ç–æ–µ –ø–æ–ª–µ
- ‚úÖ `AMOUNT_MIN_VALUE` - –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º—É–º–∞
- ‚úÖ `AMOUNT_MAX_VALUE` - –±–æ–ª—å—à–µ –º–∞–∫—Å–∏–º—É–º–∞
- ‚ùå **Positive –ø—Ä–æ–≤–µ—Ä–∫–∏ –ù–ï –°–†–ê–ë–ê–¢–´–í–ê–Æ–¢** - legacy –∫–æ–¥

#### Legacy positive –ø—Ä–æ–≤–µ—Ä–∫–∏ (–æ—Å—Ç–∞–ª–∏—Å—å –≤ –∫–æ–¥–µ, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è):

```typescript
// Legacy 1: String-based (deprecated)
.refine(val => val === '' || Number(val) > 0, { message: 'AMOUNT_POSITIVE' })

// Legacy 2: Number-based –¥–ª—è API
z.number().positive() // –°–µ—Ä–≤–µ—Ä–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

// Legacy 3: Number-based —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º
z.number().positive('AMOUNT_POSITIVE_REQUIRED') // –°–µ—Ä–≤–µ—Ä–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
```

---

## üìã –ü–û–õ–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê –ö–û–ú–ü–û–ù–ï–ù–¢–û–í

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç                                                | –¢–∏–ø      | –§–∞–π–ª                                  | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ                   | –°—Ç–∞—Ç—É—Å                           |
| -------------------------------------------------------- | -------- | ------------------------------------- | ------------------------------- | -------------------------------- |
| `cryptoAmountStringSchema`                               | Schema   | schemas-crypto.ts                     | ‚ùå –£–î–ê–õ–ï–ù–ê (deprecated)         | **‚úÖ –£–°–¢–†–ê–ù–ï–ù–û**                 |
| `validateExchangeAmountFormat()`                         | Function | security-enhanced-exchange-schemas.ts | ‚úÖ 2 —Å—Ö–µ–º—ã exchange —Ñ–æ—Ä–º        | **–†–∞–±–æ—á–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**          |
| `securityEnhancedCalculateAmountSchema`                  | Schema   | security-enhanced-utils.ts            | ‚úÖ exchange.ts tRPC router (2x) | **–†–∞–±–æ—á–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (number)** |
| `securityEnhancedCreateExchangeOrderSchema.cryptoAmount` | Field    | security-enhanced-exchange-schemas.ts | ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è                 | **–†–∞–±–æ—á–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**          |
| `validateAmountFormat()`                                 | Function | security-enhanced-exchange-schemas.ts | ‚úÖ validateCryptoAmountLimits() | **–†–∞–±–æ—á–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**          |
| `validateBusinessLimits()`                               | Function | security-enhanced-exchange-schemas.ts | ‚úÖ validateCryptoAmountLimits() | **–†–∞–±–æ—á–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**          |
| `validateCryptoAmountLimits()`                           | Function | security-enhanced-exchange-schemas.ts | ‚úÖ 3 —Å—Ö–µ–º—ã exchange —Ñ–æ—Ä–º        | **–†–∞–±–æ—á–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**          |
| `handleAmountValidation()`                               | Function | handlers.ts                           | ‚úÖ core.ts                      | **–†–∞–±–æ—á–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**          |

---

## üéØ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ú–ï–õ–ö–ò–ï –ò–ó–ë–´–¢–û–ß–ù–û–°–¢–ò

### UAH Amount –≤–∞–ª–∏–¥–∞—Ü–∏—è:

```typescript
uahAmount: z.number()
  .positive('UAH_AMOUNT_POSITIVE_REQUIRED') // –î—É–±–ª–∏—Ä—É–µ—Ç –ø–æ–¥—Ö–æ–¥ positive –≤–∞–ª–∏–¥–∞—Ü–∏–∏
  .finite('UAH_AMOUNT_MUST_BE_FINITE');
```

### –†–∞–∑–Ω—ã–µ —Å—Ç–∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –æ–¥–Ω–æ–π –ª–æ–≥–∏–∫–∏:

- `'AMOUNT_POSITIVE'`
- `'AMOUNT_POSITIVE_REQUIRED'`
- `'UAH_AMOUNT_POSITIVE_REQUIRED'`

---

## üîß –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –£–°–¢–†–ê–ù–ï–ù–ò–Æ

### 1. ‚úÖ –£–î–ê–õ–ò–¢–¨ deprecated –∫–æ–¥:

- **–£–¥–∞–ª–∏—Ç—å:** `cryptoAmountStringSchema` –∏–∑ `schemas-crypto.ts` - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–∞–±–æ—á–µ–º –∫–æ–¥–µ
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

### 2. ‚úÖ –°–û–•–†–ê–ù–ò–¢–¨ —Ä–∞–±–æ—á—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É:

- **–û—Å—Ç–∞–≤–∏—Ç—å:** `validateExchangeAmountFormat()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–∞–±–æ—á–∏—Ö —Å—Ö–µ–º–∞—Ö
- **–û—Å—Ç–∞–≤–∏—Ç—å:** Number-based —Å—Ö–µ–º—ã –¥–ª—è tRPC API - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ –æ–±–æ—Å–Ω–æ–≤–∞–Ω—ã
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç

### 3. ‚ö†Ô∏è –ù–ï –¢–†–û–ì–ê–¢–¨ "–∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏", –∫–æ—Ç–æ—Ä—ã–µ —è–≤–ª—è—é—Ç—Å—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º:

- **String —Å—Ö–µ–º—ã** - –¥–ª—è UI —Ñ–æ—Ä–º –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
- **Number —Å—Ö–µ–º—ã** - –¥–ª—è tRPC API –∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ

---

## üí∞ –ú–ï–¢–†–ò–ö–ò –ò–ó–ë–´–¢–û–ß–ù–û–°–¢–ò

- **–†–ï–ê–õ–¨–ù–´–ï –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏:** 1 deprecated —Å—Ö–µ–º–∞ (`cryptoAmountStringSchema`)
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è:** 3 –ø–æ–¥—Ö–æ–¥–∞ (UI string, API number, business validation)
- **–ê–ö–¢–ò–í–ù–´–ï –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:** 3 —Ç–∏–ø–∞ (required, min, max)
- **–§–∞–π–ª–æ–≤ —Å legacy –∫–æ–¥–æ–º:** 1 —Ñ–∞–π–ª (`schemas-crypto.ts`)

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û–°–¢–¨

**–ù–ò–ó–ö–ê–Ø –ö–†–ò–¢–ò–ß–ù–û–°–¢–¨** - –Ω–∞–π–¥–µ–Ω–Ω—ã–µ "–∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏" –≤ –æ—Å–Ω–æ–≤–Ω–æ–º:

- ‚úÖ **Legacy –∫–æ–¥** –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ
- ‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è** –º–µ–∂–¥—É UI –∏ API —Å–ª–æ—è–º–∏
- ‚úÖ **–†–∞–±–æ—á–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** –Ω–µ –Ω–∞—Ä—É—à–µ–Ω–∞

**–†–ï–ê–õ–¨–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:** ‚úÖ –£–°–¢–†–ê–ù–ï–ù–ê - deprecated `cryptoAmountStringSchema` —É–¥–∞–ª–µ–Ω–∞

---

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–ù–ê–Ø –û–ß–ò–°–¢–ö–ê (2025-01-28)

### –£–¥–∞–ª–µ–Ω–Ω—ã–µ deprecated –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

- **`cryptoAmountStringSchema`** - —É–¥–∞–ª–µ–Ω–∞ –∏–∑ `packages/utils/src/validation/schemas-crypto.ts`
- **`useExchangeStoreWithTranslations.ts`** - –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω legacy —Ñ–∞–π–ª ‚úÖ
- **Export statements** - –æ—á–∏—â–µ–Ω—ã —ç–∫—Å–ø–æ—Ä—Ç—ã –≤ `apps/web/src/hooks/index.ts`
- **`legacyAmountSchema`** - –±–æ–ª—å—à–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚úÖ

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è —Ä–∞–±–æ—á–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

- **`validateExchangeAmountFormat()`** - –æ—Å—Ç–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π –≤ —Ä–∞–±–æ—á–∏—Ö —Ñ–æ—Ä–º–∞—Ö
- **`unifiedExchangeBaseSchema`** - –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ HeroExchangeForm –∏ ExchangePage
- **`useNumericInput`** - –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ UI —É—Ä–æ–≤–Ω–µ

### –ò—Ç–æ–≥–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:

- **–ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏**: –ü–û–õ–ù–û–°–¢–¨–Æ –£–°–¢–†–ê–ù–ï–ù–´ ‚úÖ
- **Legacy –∫–æ–¥**: –ü–û–õ–ù–û–°–¢–¨–Æ –£–î–ê–õ–ï–ù ‚úÖ
- **–°–æ–æ–±—â–µ–Ω–∏—è**: –£–ù–ò–§–ò–¶–ò–†–û–í–ê–ù–´ ‚úÖ
- **–†–∞–±–æ—á–∏–π –∫–æ–¥**: –°–û–•–†–ê–ù–ï–ù ‚úÖ
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –ù–ï –ù–ê–†–£–®–ï–ù–ê ‚úÖ---

**–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω:** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –∞–Ω–∞–ª–∏–∑–æ–º –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã  
**–û—á–∏—Å—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞:** 2025-01-28  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
