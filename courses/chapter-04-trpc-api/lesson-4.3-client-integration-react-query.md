# –£—Ä–æ–∫ 4.3: –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å React Query

> **üéØ –¶–µ–ª—å —É—Ä–æ–∫–∞**: –ù–∞—É—á–∏—Ç—å—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å tRPC –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ —Å React Query –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ UX

## üìñ –í–≤–µ–¥–µ–Ω–∏–µ

### –°–≤—è–∑—å —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º —É—Ä–æ–∫–æ–º

–í –ø—Ä–æ—à–ª–æ–º —É—Ä–æ–∫–µ –º—ã —Å–æ–∑–¥–∞–ª–∏ —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã:

```typescript
// –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –º—ã –Ω–∞–ø–∏—Å–∞–ª–∏:
export const exchangeRouter = createTRPCRouter({
  getCurrencyRate: publicProcedure.input(...).query(...),
  createOrder: publicProcedure.input(...).mutation(...)
});
```

**–ê —Ç–µ–ø–µ—Ä—å –º–∞–≥–∏—è tRPC!** ü™Ñ –≠—Ç–∏ —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ React —Ö—É–∫–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ:

```typescript
// –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ:
trpc.exchange.getCurrencyRate.useQuery(); // ‚Üê –∏–∑ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ query
trpc.exchange.createOrder.useMutation(); // ‚Üê –∏–∑ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ mutation
```

### –ß—Ç–æ —Ç–∞–∫–æ–µ React Query + tRPC?

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ **—É–º–Ω—ã–π —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ —Å –≥–æ–ª–æ—Å–æ–≤—ã–º –ø–æ–º–æ—â–Ω–∏–∫–æ–º**:

**–û–±—ã—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–±–µ–∑ React Query):**

- –ö–∞–∂–¥—ã–π —Ä–∞–∑ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ –µ—Å—Ç—å
- –ó–∞–±—ã–≤–∞–µ—Ç–µ —á—Ç–æ –≤–∏–¥–µ–ª–∏ 5 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥
- –ü–æ—Å—Ç–æ—è–Ω–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç–µ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ

**React Query + tRPC:**

- **–£–º–Ω—ã–π –∫—ç—à** - –ø–æ–º–Ω–∏—Ç —á—Ç–æ –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–µ, –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥—ã–π —Ä–∞–∑
- **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** - –∑–Ω–∞–µ—Ç –∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–ª–∏ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏—Ö
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã, –∏–∑–±–µ–≥–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - —Ç–æ—á–Ω–æ –∑–Ω–∞–µ—Ç –∫–∞–∫–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã –µ—Å—Ç—å –∏ –∏—Ö —Ç–∏–ø—ã

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è** - TypeScript –∑–Ω–∞–µ—Ç –≤—Å–µ –º–µ—Ç–æ–¥—ã –∏ –∏—Ö —Ç–∏–ø—ã
‚úÖ **–£–º–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
‚úÖ **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** - –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ
‚úÖ **Optimistic Updates** - UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –¥–∞–∂–µ –¥–æ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞
‚úÖ **Error Handling** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚úÖ **Loading States** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   React         ‚îÇ    ‚îÇ   tRPC Client    ‚îÇ    ‚îÇ   tRPC Server   ‚îÇ
‚îÇ   Component     ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   + React Query  ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   Router        ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                  ‚îÇ    ‚îÇ                 ‚îÇ
‚îÇ useQuery()      ‚îÇ    ‚îÇ ‚Ä¢ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ    ‚îÇ    ‚îÇ ‚Ä¢ –í–∞–ª–∏–¥–∞—Ü–∏—è     ‚îÇ
‚îÇ useMutation()   ‚îÇ    ‚îÇ ‚Ä¢ –¢–∏–ø–∏–∑–∞—Ü–∏—è      ‚îÇ    ‚îÇ ‚Ä¢ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ ‚Ä¢ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è  ‚îÇ    ‚îÇ ‚Ä¢ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

–í —ç—Ç–æ–º —É—Ä–æ–∫–µ –∏–∑—É—á–∏–º –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å tRPC –∫–ª–∏–µ–Ω—Ç —Å React Query –≤ –ø—Ä–æ–µ–∫—Ç–µ ExchangeGO.

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ tRPC –∫–ª–∏–µ–Ω—Ç–∞

### –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ tRPC –∫–ª–∏–µ–Ω—Ç–∞ - —ç—Ç–æ –∫–∞–∫ **–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É–º–Ω–æ–≥–æ —Ç–µ–ª–µ–≤–∏–∑–æ—Ä–∞**:

1. **–ü–æ–¥–∫–ª—é—á–∞–µ–º –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É** (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º HTTP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ)
2. **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–∞–Ω–∞–ª—ã** (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º React Query)
3. **–í–∫–ª—é—á–∞–µ–º —É–º–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** (–¥–æ–±–∞–≤–ª—è–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ retry)
4. **–ü–æ–¥–∫–ª—é—á–∞–µ–º –∫ –¥–æ–º—É** (–æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã)

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞

```typescript
// apps/web/lib/trpc-provider.tsx
'use client';

import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { httpBatchLink } from '@trpc/client';
import { createTRPCReact } from '@trpc/react-query';
import { useState } from 'react';
import superjson from 'superjson';

import type { AppRouter } from '../src/server/trpc';

// üéØ –°–æ–∑–¥–∞–µ–º —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π tRPC React –∫–ª–∏–µ–Ω—Ç
// AppRouter - —ç—Ç–æ —Ç–∏–ø –∏–∑ —Å–µ—Ä–≤–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –º—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏ –≤ –ø—Ä–æ—à–ª–æ–º —É—Ä–æ–∫–µ
const trpc = createTRPCReact<AppRouter>();

export function TRPCProvider({ children }: { children: React.ReactNode }) {
  // üìä React Query –∫–ª–∏–µ–Ω—Ç - —ç—Ç–æ "–º–µ–Ω–µ–¥–∂–µ—Ä –∫—ç—à–∞" –¥–ª—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
  const [queryClient] = useState(() =>
    new QueryClient({
      defaultOptions: {
        queries: {
          // ‚è∞ –ö—ç—à–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ 5 –º–∏–Ω—É—Ç (–¥–∞–Ω–Ω—ã–µ —Å—á–∏—Ç–∞—é—Ç—Å—è "—Å–≤–µ–∂–∏–º–∏")
          // –ó–∞—á–µ–º: –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç –Ω–µ –º–µ–Ω—è—é—Ç—Å—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
          staleTime: 5 * 60 * 1000,

          // üîÑ –£–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
          retry: (failureCount, error: any) => {
            // üö´ –ù–µ retry –ø—Ä–∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö (400-499)
            // –ü—Ä–∏–º–µ—Ä: –Ω–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –Ω–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            if (error.data?.httpStatus >= 400 && error.data?.httpStatus < 500) {
              return false; // –ë–µ—Å–ø–æ–ª–µ–∑–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—Ç—å
            }
            // ‚úÖ Retry –ø—Ä–∏ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö (500+) –º–∞–∫—Å–∏–º—É–º 3 —Ä–∞–∑–∞
            return failureCount < 3;
          },
        },
        mutations: {
          // üîÑ Retry –º—É—Ç–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö
          // –ó–∞—á–µ–º: –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —É–ø–∞–ª, —Å—Ç–æ–∏—Ç –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â–µ —Ä–∞–∑
          retry: (failureCount, error: any) => {
            if (error.data?.httpStatus >= 500) {
              return failureCount < 2; // –ú–∞–∫—Å–∏–º—É–º 2 –ø–æ–≤—Ç–æ—Ä–∞ –¥–ª—è –º—É—Ç–∞—Ü–∏–π
            }
            return false; // –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ–º
          },
        },
      },
    })
  );

  // üåê tRPC –∫–ª–∏–µ–Ω—Ç - —ç—Ç–æ "–ø–µ—Ä–µ–≤–æ–¥—á–∏–∫" –º–µ–∂–¥—É React –∏ —Å–µ—Ä–≤–µ—Ä–æ–º
  const [trpcClient] = useState(() =>
    trpc.createClient({
      links: [
        httpBatchLink({
          // üìç URL –Ω–∞—à–µ–≥–æ tRPC —Å–µ—Ä–≤–µ—Ä–∞
          url: '/api/trpc',

          // üîÑ Transformer –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ç–∏–ø–æ–≤ (—Ç–æ—Ç –∂–µ —á—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ!)
          // –ó–∞—á–µ–º: —á—Ç–æ–±—ã Date –æ–±—ä–µ–∫—Ç—ã –Ω–µ –ø—Ä–µ–≤—Ä–∞—â–∞–ª–∏—Å—å –≤ —Å—Ç—Ä–æ–∫–∏
          transformer: superjson,

          // üìã –î–æ–±–∞–≤–ª—è–µ–º headers –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
          headers() {
            return {
              'x-requested-with': 'tRPC', // –ü–æ–º–æ–≥–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä—É –ø–æ–Ω—è—Ç—å —á—Ç–æ —ç—Ç–æ tRPC
            };
          },

          // üì¶ Batch - –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –æ–¥–∏–Ω HTTP request
          // –ü—Ä–∏–º–µ—Ä: –≤–º–µ—Å—Ç–æ 3 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí 1 –∑–∞–ø—Ä–æ—Å —Å 3 –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
          // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –µ—Å–ª–∏ URL —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π, —Ä–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —á–∞—Å—Ç–∏
          maxURLLength: 2048,
        }),
      ],
    })
  );

  return (
    <trpc.Provider client={trpcClient} queryClient={queryClient}>
      <QueryClientProvider client={queryClient}>
        {children}
      </QueryClientProvider>
    </trpc.Provider>
  );
}

// üéØ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
// –¢–µ–ø–µ—Ä—å –≤ –ª—é–±–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å: trpc.exchange.getCurrencyRate.useQuery()
export { trpc };

// üí° –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º:
// 1. trpc.Provider –¥–µ–ª–∞–µ—Ç tRPC –∫–ª–∏–µ–Ω—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–º –≤–æ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
// 2. QueryClientProvider –¥–µ–ª–∞–µ—Ç React Query –¥–æ—Å—Ç—É–ø–Ω—ã–º
// 3. –û–±–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ –¥–ª—è –º–∞–≥–∏–∏ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

**–ß—Ç–æ –¥–µ–ª–∞–µ–º:** –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ TRPCProvider, —á—Ç–æ–±—ã tRPC –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω –≤–µ–∑–¥–µ.

```typescript
// apps/web/app/layout.tsx
import { TRPCProvider } from '../lib/trpc-provider';

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body>
        {/* üéØ –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ TRPCProvider */}
        {/* –¢–µ–ø–µ—Ä—å –≤ –ª—é–±–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ –¥–æ—Å—Ç—É–ø–µ–Ω trpc.* */}
        <TRPCProvider>
          {children}
        </TRPCProvider>
      </body>
    </html>
  );
}

// üéâ –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –≤ –ª—é–±–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
// import { trpc } from '../lib/trpc-provider';
// const { data } = trpc.exchange.getCurrencyRate.useQuery({ from: 'BTC', to: 'UAH' });
```

## üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Query (–ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)

### –ß—Ç–æ —Ç–∞–∫–æ–µ Query?

**Query** - —ç—Ç–æ –∑–∞–ø—Ä–æ—Å –¥–ª—è **–ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö** (—á—Ç–µ–Ω–∏–µ). –ü–æ–º–Ω–∏—Ç–µ –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ —É—Ä–æ–∫–∞:

```typescript
// –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –º—ã —Å–æ–∑–¥–∞–ª–∏:
getCurrencyRate: publicProcedure.query(...)

// –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ —ç—Ç–æ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤:
trpc.exchange.getCurrencyRate.useQuery()
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Query:**

- üîç –¢–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- üíæ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è
- üîÑ –ú–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ
- ‚ö° –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

### –ü—Ä–æ—Å—Ç–æ–π Query

**–ó–∞–¥–∞—á–∞:** –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π –∫—É—Ä—Å BTC –∫ –≥—Ä–∏–≤–Ω–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ.

```typescript
// src/components/exchange/CurrencyRates.tsx
'use client';

import { trpc } from '../../lib/trpc-provider';

export function CurrencyRates() {
  // üéØ –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π query —Å –∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç–æ–º
  // TypeScript –∑–Ω–∞–µ—Ç —á—Ç–æ from –∏ to –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞–º–∏
  // –ò —á—Ç–æ data.rate –±—É–¥–µ—Ç —Å—Ç—Ä–æ–∫–æ–π (–∏–∑ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Ç–∏–ø–∞)
  const { data, isLoading, error } = trpc.exchange.getCurrencyRate.useQuery({
    from: 'BTC',
    to: 'UAH',
  });

  // üîÑ –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–∫–∞ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
  if (isLoading) {
    return <div className="animate-pulse">–ó–∞–≥—Ä—É–∑–∫–∞ –∫—É—Ä—Å–∞...</div>;
  }

  // üö® –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—à–∏–±–∫–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
  if (error) {
    return (
      <div className="text-red-500">
        –û—à–∏–±–∫–∞: {error.message}
      </div>
    );
  }

  // ‚úÖ –£—Å–ø–µ—à–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
  return (
    <div className="p-4 border rounded-lg">
      <h3 className="font-semibold">–ö—É—Ä—Å BTC/UAH</h3>
      <p className="text-2xl font-bold text-green-600">
        ‚Ç¥{data?.rate} {/* TypeScript –∑–Ω–∞–µ—Ç —á—Ç–æ rate - —ç—Ç–æ string */}
      </p>
    </div>
  );
}

// üí° –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º:
// 1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è ‚Üí useQuery –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
// 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è HTTP –∑–∞–ø—Ä–æ—Å –Ω–∞ /api/trpc/exchange.getCurrencyRate
// 3. –°–µ—Ä–≤–µ—Ä –≤—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–∞—à—É –ø—Ä–æ—Ü–µ–¥—É—Ä—É getCurrencyRate
// 4. –†–µ–∑—É–ª—å—Ç–∞—Ç –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
// 5. –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º —Ä–µ–Ω–¥–µ—Ä–µ –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ –∫—ç—à–∞ (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞—Ä–µ–ª–∏)
```

### Query —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞—Ç—å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∫–æ–ª—å–∫–æ –≥—Ä–∏–≤–µ–Ω –ø–æ–ª—É—á–∏—Ç—Å—è –∑–∞ –≤–≤–µ–¥–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã.

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- Query –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ù—É–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏

```typescript
// src/components/exchange/AmountCalculator.tsx
'use client';

import { useState } from 'react';
import { trpc } from '../../lib/trpc-provider';

export function AmountCalculator() {
  const [amount, setAmount] = useState(1);
  const [currency, setCurrency] = useState<'BTC' | 'ETH'>('BTC');

  // üéØ Query –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤–∞–ª–∏–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö
  const { data: calculation, isLoading } = trpc.exchange.calculateAmount.useQuery(
    // üìù –ü–µ—Ä–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä - –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ (input)
    {
      fromCurrency: currency,
      amount,
      direction: 'crypto-to-uah',
    },
    // ‚öôÔ∏è –í—Ç–æ—Ä–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ React Query
    {
      // üö¶ enabled: false = query –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
      // –ó–∞—á–µ–º: –Ω–µ —Ö–æ—Ç–∏–º —Å—á–∏—Ç–∞—Ç—å –¥–ª—è 0 –∏–ª–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö —Å—É–º–º
      enabled: amount > 0,

      // üîÑ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
      // –ó–∞—á–µ–º: –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç –º–µ–Ω—è—é—Ç—Å—è, –Ω—É–∂–Ω—ã —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
      refetchInterval: 30000,
    }
  );

  return (
    <div className="space-y-4">
      <div>
        <label className="block text-sm font-medium mb-2">
          –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ {currency}
        </label>
        <input
          type="number"
          value={amount}
          onChange={(e) => setAmount(Number(e.target.value))}
          className="w-full p-2 border rounded"
          min="0"
          step="0.001"
        />
      </div>

      <div>
        <label className="block text-sm font-medium mb-2">
          –í–∞–ª—é—Ç–∞
        </label>
        <select
          value={currency}
          onChange={(e) => setCurrency(e.target.value as 'BTC' | 'ETH')}
          className="w-full p-2 border rounded"
        >
          <option value="BTC">Bitcoin</option>
          <option value="ETH">Ethereum</option>
        </select>
      </div>

      {/* üîÑ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ amount > 0 */}
      {isLoading && amount > 0 && (
        <div className="text-gray-500">–†–∞—Å—á–µ—Ç...</div>
      )}

      {/* ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á–µ—Ç–∞ */}
      {calculation && (
        <div className="p-4 bg-blue-50 rounded-lg">
          <p className="text-lg">
            {amount} {currency} = <strong>‚Ç¥{calculation.amount}</strong>
          </p>
          <p className="text-sm text-gray-600">
            –ö—É—Ä—Å: ‚Ç¥{calculation.rate}
          </p>
        </div>
      )}
    </div>
  );
}

// üí° –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:
// 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç amount = 0.5
// 2. enabled: 0.5 > 0 = true ‚Üí query –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
// 3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å: { fromCurrency: 'BTC', amount: 0.5, direction: 'crypto-to-uah' }
// 4. –°–µ—Ä–≤–µ—Ä —Å—á–∏—Ç–∞–µ—Ç: 0.5 BTC * 50000 UAH = 25000 UAH
// 5. –†–µ–∑—É–ª—å—Ç–∞—Ç –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
// 6. –ß–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥ query –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
    </div>
  );
}
```

### –£—Å–ª–æ–≤–Ω—ã–µ Query

**–ó–∞–¥–∞—á–∞:** –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω.

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –Ω–µ –Ω—É–∂–Ω–æ –¥–∞–∂–µ –ø—ã—Ç–∞—Ç—å—Å—è –∑–∞–≥—Ä—É–∂–∞—Ç—å –∑–∞–∫–∞–∑—ã.
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ–º `enabled` –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è query.

```typescript
// src/components/user/UserOrders.tsx
'use client';

import { trpc } from '../../lib/trpc-provider';

export function UserOrders({ userId }: { userId?: string }) {
  // üö¶ Query –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å userId
  const {
    data: orders,
    isLoading,
    error
  } = trpc.user.orders.getMyOrders.useQuery(
    { page: 1, limit: 10 },
    {
      // üîê enabled: !!userId –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç userId –≤ boolean
      // undefined/null ‚Üí false (query –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è)
      // "123" ‚Üí true (query –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è)
      enabled: !!userId,
    }
  );

  // üö´ –ï—Å–ª–∏ –Ω–µ—Ç userId - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
  if (!userId) {
    return <div>–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–∫–∞–∑–æ–≤</div>;
  }

  // üîÑ –ï—Å–ª–∏ –µ—Å—Ç—å userId –∏ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
  if (isLoading) {
    return <OrdersSkeleton />;
  }

  // üö® –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  if (error) {
    return <ErrorMessage error={error} />;
  }

  // ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–∫–∞–∑—ã
  return (
    <div className="space-y-4">
      {orders?.map(order => (
        <OrderCard key={order.id} order={order} />
      ))}
    </div>
  );
}

// üí° –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:
// 1. userId = undefined ‚Üí enabled: false ‚Üí query –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è ‚Üí isLoading: false
// 2. userId = "123" ‚Üí enabled: true ‚Üí query –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è ‚Üí isLoading: true ‚Üí –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
// 3. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–ª–æ–≥–∏–Ω–∏–ª—Å—è ‚Üí userId —Å—Ç–∞–ª undefined ‚Üí query –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è
}
```

## üîÑ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Mutation (–∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)

### –ß—Ç–æ —Ç–∞–∫–æ–µ Mutation?

**Mutation** - —ç—Ç–æ –∑–∞–ø—Ä–æ—Å –¥–ª—è **–∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö** (—Å–æ–∑–¥–∞–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ). –ü–æ–º–Ω–∏—Ç–µ –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ —É—Ä–æ–∫–∞:

```typescript
// –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –º—ã —Å–æ–∑–¥–∞–ª–∏:
createOrder: publicProcedure.mutation(...)

// –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ —ç—Ç–æ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤:
trpc.exchange.createOrder.useMutation()
```

**–û—Ç–ª–∏—á–∏—è –æ—Ç Query:**

- ‚úèÔ∏è –ò–∑–º–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- üö´ –ù–µ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- üéØ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —è–≤–Ω–æ–º –≤—ã–∑–æ–≤–µ (–Ω–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- üîÑ –ú–æ–∂–µ—Ç –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ query

### –ü—Ä–æ—Å—Ç–∞—è Mutation

**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞—Ç—å —Ñ–æ—Ä–º—É –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –Ω–∞ –æ–±–º–µ–Ω –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã.

```typescript
// src/components/exchange/CreateOrderForm.tsx
'use client';

import { useState } from 'react';
import { trpc } from '../../lib/trpc-provider';
import { toast } from '@repo/ui/components/ui/toast';

export function CreateOrderForm() {
  const [email, setEmail] = useState('');
  const [amount, setAmount] = useState(0);

  // üéØ –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è mutation
  const createOrder = trpc.exchange.createOrder.useMutation({
    // ‚úÖ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
    onSuccess: (data) => {
      // üéâ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
      toast({
        title: '–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω!',
        description: `ID –∑–∞–∫–∞–∑–∞: ${data.id}`, // TypeScript –∑–Ω–∞–µ—Ç —á—Ç–æ data.id —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
      });

      // üßπ –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è
      setEmail('');
      setAmount(0);
    },

    // üö® –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–µ
    onError: (error) => {
      toast({
        title: '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞',
        description: error.message, // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        variant: 'destructive',
      });
    },
  });

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();

    // üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º mutation —Å –¥–∞–Ω–Ω—ã–º–∏ —Ñ–æ—Ä–º—ã
    // TypeScript –ø—Ä–æ–≤–µ—Ä–∏—Ç —á—Ç–æ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –ø–µ—Ä–µ–¥–∞–Ω—ã
    createOrder.mutate({
      email,                    // –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —á–µ—Ä–µ–∑ Zod —Å—Ö–µ–º—É
      fromCurrency: 'BTC',      // –¢–∏–ø CryptoCurrency
      toCurrency: 'UAH',        // –§–∏–∞—Ç–Ω–∞—è –≤–∞–ª—é—Ç–∞
      amount,                   // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
    });
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-4">
      <div>
        <label className="block text-sm font-medium mb-2">
          Email
        </label>
        <input
          type="email"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          required
          className="w-full p-2 border rounded"
        />
      </div>

      <div>
        <label className="block text-sm font-medium mb-2">
          –°—É–º–º–∞ BTC
        </label>
        <input
          type="number"
          value={amount}
          onChange={(e) => setAmount(Number(e.target.value))}
          required
          min="0.001"
          step="0.001"
          className="w-full p-2 border rounded"
        />
      </div>

      <button
        type="submit"
        disabled={createOrder.isPending} // üö¶ –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –≤–æ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏
        className="w-full py-2 px-4 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50"
      >
        {/* üîÑ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è */}
        {createOrder.isPending ? '–°–æ–∑–¥–∞–Ω–∏–µ...' : '–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑'}
      </button>

      {/* üö® –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ */}
      {createOrder.error && (
        <div className="text-red-500 text-sm">
          {createOrder.error.message}
        </div>
      )}
    </form>
  );
}

// üí° –ü–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è mutation:
// 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É –∏ –Ω–∞–∂–∏–º–∞–µ—Ç "–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑"
// 2. handleSubmit –≤—ã–∑—ã–≤–∞–µ—Ç createOrder.mutate()
// 3. isPending —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è true ‚Üí –∫–Ω–æ–ø–∫–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, —Ç–µ–∫—Å—Ç –º–µ–Ω—è–µ—Ç—Å—è
// 4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è HTTP POST –Ω–∞ /api/trpc/exchange.createOrder
// 5. –°–µ—Ä–≤–µ—Ä –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É, —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑
// 6. –ü—Ä–∏ —É—Å–ø–µ—Ö–µ: onSuccess ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º toast, –æ—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
// 7. –ü—Ä–∏ –æ—à–∏–±–∫–µ: onError ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    </form>
  );
}
```

### Optimistic Updates

**–ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?**
Optimistic Updates - —ç—Ç–æ **"–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"**. –ú—ã –æ–±–Ω–æ–≤–ª—è–µ–º UI —Å—Ä–∞–∑—É, –µ—â–µ –¥–æ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞, –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—è —á—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ—Ç —É—Å–ø–µ—à–Ω–æ.

**–ê–Ω–∞–ª–æ–≥–∏—è:** –ö–∞–∫ –ª–∞–π–∫ –≤ Instagram

- –í—ã –Ω–∞–∂–∏–º–∞–µ—Ç–µ ‚ù§Ô∏è ‚Üí —Å–µ—Ä–¥–µ—á–∫–æ —Å—Ä–∞–∑—É —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∫—Ä–∞—Å–Ω—ã–º
- –í —Ñ–æ–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –æ—à–∏–±–∫–æ–π ‚Üí —Å–µ—Ä–¥–µ—á–∫–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–æ–º—É

**–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?**
‚úÖ UI –æ—Ç–∑—ã–≤–∞–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–∞–∂–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ
‚úÖ –õ—É—á—à–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**

- –ü—Ä–æ—Å—Ç—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–ª–∞–π–∫–∏, –∏–∑–±—Ä–∞–Ω–Ω–æ–µ)
- –ö–æ–≥–¥–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—à–∏–±–∫–∏ –Ω–∏–∑–∫–∞—è
- –ö–æ–≥–¥–∞ –≤–∞–∂–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–∫–ª–∏–∫–∞ UI

```typescript
// src/components/user/ProfileSettings.tsx
'use client';

import { trpc } from '../../lib/trpc-provider';

export function ProfileSettings() {
  const utils = trpc.useUtils(); // üõ†Ô∏è –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫—ç—à–µ–º

  // üìä –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const { data: profile } = trpc.user.profile.getProfile.useQuery();

  // ‚úèÔ∏è Mutation —Å –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
  const updateProfile = trpc.user.profile.updateProfile.useMutation({
    // üöÄ onMutate - –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –î–û –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    onMutate: async (newProfile) => {
      // üõë –û—Ç–º–µ–Ω—è–µ–º –≤—Å–µ –∏—Å—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è —ç—Ç–æ–≥–æ query
      // –ó–∞—á–µ–º: —á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–ª–∏ –Ω–∞—à–∏ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
      await utils.user.profile.getProfile.cancel();

      // üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –æ—Ç–∫–∞—Ç–∞
      const previousProfile = utils.user.profile.getProfile.getData();

      // ‚ö° –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à (UI –æ–±–Ω–æ–≤–∏—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ!)
      utils.user.profile.getProfile.setData(undefined, (old) => ({
        ...old!,        // –ë–µ—Ä–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
        ...newProfile,  // –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º –Ω–æ–≤—ã–º–∏
      }));

      // üì§ –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ö—É–∫–æ–≤
      return { previousProfile };
    },

    // üö® onError - –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É
    onError: (error, newProfile, context) => {
      // ‚Ü©Ô∏è –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
      utils.user.profile.getProfile.setData(undefined, context?.previousProfile);
    },

    // üèÅ onSettled - –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞ (—É—Å–ø–µ—Ö –∏–ª–∏ –æ—à–∏–±–∫–∞)
    onSettled: () => {
      // üîÑ –ü–µ—Ä–µ–∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
      // –ó–∞—á–µ–º: —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      utils.user.profile.getProfile.invalidate();
    },
  });

  const handleUpdateName = (name: string) => {
    updateProfile.mutate({ name }); // üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º optimistic update
  };

  return (
    <div className="space-y-4">
      <div>
        <label className="block text-sm font-medium mb-2">
          –ò–º—è: {profile?.name} {/* üëÄ –≠—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–∏—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ! */}
        </label>
        <button
          onClick={() => handleUpdateName('–ù–æ–≤–æ–µ –∏–º—è')}
          className="px-4 py-2 bg-blue-600 text-white rounded"
        >
          –û–±–Ω–æ–≤–∏—Ç—å –∏–º—è
        </button>
      </div>
    </div>
  );
}

// üí° –ü–æ—Ç–æ–∫ Optimistic Updates:
// 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–û–±–Ω–æ–≤–∏—Ç—å –∏–º—è"
// 2. onMutate: UI –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–ù–æ–≤–æ–µ –∏–º—è" (–µ—â–µ –¥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É!)
// 3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
// 4. –ï—Å–ª–∏ —É—Å–ø–µ—Ö: onSettled ‚Üí –ø–µ—Ä–µ–∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
// 5. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞: onError ‚Üí –æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º –∫ —Å—Ç–∞—Ä–æ–º—É –∏–º–µ–Ω–∏ + –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
// 6. onSettled: –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º—Å—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º

// üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–ª–∏–∫, –¥–∞–∂–µ –µ—Å–ª–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –º–µ–¥–ª–µ–Ω–Ω—ã–π!
}
```

## üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—ç—à–µ–º

### –ß—Ç–æ —Ç–∞–∫–æ–µ –∫—ç—à –∏ –∑–∞—á–µ–º –∏–º —É–ø—Ä–∞–≤–ª—è—Ç—å?

**–ö—ç—à** - —ç—Ç–æ "–ø–∞–º—è—Ç—å" –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–∞–Ω–Ω—ã–µ –≤ –∫—ç—à–µ –º–æ–≥—É—Ç —É—Å—Ç–∞—Ä–µ—Ç—å

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–ª –∑–∞–∫–∞–∑ ‚Üí —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ –≤ –∫—ç—à–µ –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏–∑–º–µ–Ω–∏–ª —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å—Ç–∞—Ä—ã–π —Å—Ç–∞—Ç—É—Å

**–†–µ—à–µ–Ω–∏–µ:** –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞

- **–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è** = "–ø–æ–º–µ—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ"
- React Query –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ

### –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞

**–ó–∞–¥–∞—á–∞:** –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞ –æ–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –∑–∞–∫–∞–∑–æ–≤.

```typescript
// src/components/admin/OrdersManagement.tsx
'use client';

import { trpc } from '../../lib/trpc-provider';

export function OrdersManagement() {
  const utils = trpc.useUtils(); // üõ†Ô∏è –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—ç—à–µ–º

  const updateOrderStatus = trpc.admin.updateOrderStatus.useMutation({
    onSuccess: () => {
      // üîÑ –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∑–∞–∫–∞–∑–∞–º–∏ queries

      // –°–ø–æ—Å–æ–± 1: –ò–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–ª—ã–µ —Ä–æ—É—Ç–µ—Ä—ã
      utils.user.orders.invalidate();    // –í—Å–µ queries –≤ user.orders.*
      utils.admin.orders.invalidate();   // –í—Å–µ queries –≤ admin.orders.*

      // –°–ø–æ—Å–æ–± 2: –ò–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π query
      utils.user.orders.getMyOrders.invalidate(); // –¢–æ–ª—å–∫–æ getMyOrders

      // üí° React Query –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç –≤—Å–µ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ queries
    },
  });

  // üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö (—Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
  const handleRefreshAll = () => {
    utils.invalidate(); // ‚ö†Ô∏è –û–±–Ω–æ–≤–ª—è–µ—Ç –í–°–ï queries –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏!
  };

  return (
    <div className="space-y-4">
      <button
        onClick={handleRefreshAll}
        className="px-4 py-2 bg-gray-600 text-white rounded"
      >
        –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
      </button>

      {/* –ö–Ω–æ–ø–∫–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤ */}
    </div>
  );
}

// üí° –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏:
//
// üéØ –¢–æ—á–µ—á–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
// utils.user.orders.getMyOrders.invalidate() - —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π query
//
// üìÇ –ì—Ä—É–ø–ø–æ–≤–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è:
// utils.user.orders.invalidate() - –≤—Å–µ queries –≤ —Ä–æ—É—Ç–µ—Ä–µ
//
// üåç –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!):
// utils.invalidate() - –≤—Å–µ queries –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
```

### –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

**–ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?**
–ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ (prefetch) - —ç—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö **–∑–∞—Ä–∞–Ω–µ–µ**, –¥–æ —Ç–æ–≥–æ –∫–∞–∫ –æ–Ω–∏ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

**–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?**
‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏–∑ –∫—ç—à–∞
‚úÖ –õ—É—á—à–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç
‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–∞–∂–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**

- –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É, –≥–¥–µ —Ç–æ—á–Ω–æ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ
- –ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ —Å—Å—ã–ª–∫—É (hover prefetch)
- –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è–º–∏

```typescript
// src/components/exchange/ExchangePage.tsx
'use client';

import { useEffect } from 'react';
import { trpc } from '../../lib/trpc-provider';

export function ExchangePage() {
  const utils = trpc.useUtils();

  useEffect(() => {
    // üöÄ –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–æ—Ç–æ—Ä—ã–µ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è

    // –ö—É—Ä—Å BTC - —Å–∞–º–∞—è –ø–æ–ø—É–ª—è—Ä–Ω–∞—è –≤–∞–ª—é—Ç–∞
    utils.exchange.getCurrencyRate.prefetch({
      from: 'BTC',
      to: 'UAH',
    });

    // –ö—É—Ä—Å ETH - –≤—Ç–æ—Ä–∞—è –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏
    utils.exchange.getCurrencyRate.prefetch({
      from: 'ETH',
      to: 'UAH',
    });

    // üí° –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è –≤ —Ñ–æ–Ω–µ –∏ –ø–æ–ø–∞–¥—É—Ç –≤ –∫—ç—à
    // –ö–æ–≥–¥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ–ø—Ä–æ—Å—è—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ - –æ–Ω–∏ –ø–æ–ª—É—á–∞—Ç –∏—Ö –º–≥–Ω–æ–≤–µ–Ω–Ω–æ!
  }, [utils]);

  return (
    <div className="space-y-6">
      {/*
        ‚ö° –≠—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—Ç –¥–∞–Ω–Ω—ã–µ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏–∑ –∫—ç—à–∞,
        –ø–æ—Ç–æ–º—É —á—Ç–æ –º—ã –∏—Ö –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∏–ª–∏ –≤—ã—à–µ
      */}
      <CurrencyRates />
      <ExchangeCalculator />
    </div>
  );
}

// üí° –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏:

// üñ±Ô∏è –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏:
function CurrencyLink({ currency }: { currency: string }) {
  const utils = trpc.useUtils();

  return (
    <Link
      href={`/exchange/${currency}`}
      onMouseEnter={() => {
        // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –º—ã—à–∫–æ–π
        utils.exchange.getCurrencyRate.prefetch({
          from: currency,
          to: 'UAH'
        });
      }}
    >
      {currency}
    </Link>
  );
}
```

## üîç –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

### Infinite Queries (–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Å–∫—Ä–æ–ª–ª)

**–ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?**
Infinite Queries - —ç—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö **–ø–æ—Ä—Ü–∏—è–º–∏** —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

- –õ–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö
- –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
- –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (20 –∑–∞–∫–∞–∑–æ–≤)
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫—Ä–æ–ª–ª–∏—Ç –≤–Ω–∏–∑
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
4. –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º

```typescript
// src/components/admin/OrdersHistory.tsx
'use client';

import { trpc } from '../../lib/trpc-provider';

export function OrdersHistory() {
  const {
    data,              // üìä –í—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    fetchNextPage,     // üîÑ –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    hasNextPage,       // ‚ùì –ï—Å—Ç—å –ª–∏ –µ—â–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
    isFetchingNextPage, // ‚è≥ –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ª–∏ —Å–µ–π—á–∞—Å —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
  } = trpc.admin.orders.getOrdersInfinite.useInfiniteQuery(
    // üìù –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    { limit: 20 },
    {
      // üîó –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      getNextPageParam: (lastPage) => lastPage.nextCursor,
      // –ï—Å–ª–∏ lastPage.nextCursor = null ‚Üí hasNextPage = false
    }
  );

  return (
    <div className="space-y-4">
      {/* üìÑ –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */}
      {data?.pages.map((page, pageIndex) => (
        <div key={pageIndex}>
          {page.orders.map(order => (
            <OrderCard key={order.id} order={order} />
          ))}
        </div>
      ))}

      {/* üîÑ –ö–Ω–æ–ø–∫–∞ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ" */}
      {hasNextPage && (
        <button
          onClick={() => fetchNextPage()}
          disabled={isFetchingNextPage}
          className="w-full py-2 px-4 border rounded hover:bg-gray-50 disabled:opacity-50"
        >
          {isFetchingNextPage ? '–ó–∞–≥—Ä—É–∑–∫–∞...' : '–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ'}
        </button>
      )}

      {/* üèÅ –°–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–≥–¥–∞ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã */}
      {!hasNextPage && data?.pages.length > 0 && (
        <div className="text-center text-gray-500 py-4">
          –í—Å–µ –∑–∞–∫–∞–∑—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã
        </div>
      )}
    </div>
  );
}

// üí° –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:
// data = {
//   pages: [
//     { orders: [–∑–∞–∫–∞–∑1, –∑–∞–∫–∞–∑2, ...], nextCursor: "cursor1" },  // –°—Ç—Ä–∞–Ω–∏—Ü–∞ 1
//     { orders: [–∑–∞–∫–∞–∑21, –∑–∞–∫–∞–∑22, ...], nextCursor: "cursor2" }, // –°—Ç—Ä–∞–Ω–∏—Ü–∞ 2
//     { orders: [–∑–∞–∫–∞–∑41, –∑–∞–∫–∞–∑42, ...], nextCursor: null },      // –ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
//   ]
// }

// üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Å–∫—Ä–æ–ª–ª (–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –≤–∞—Ä–∏–∞–Ω—Ç):
function useInfiniteScroll() {
  const { fetchNextPage, hasNextPage } = trpc.admin.orders.getOrdersInfinite.useInfiniteQuery(/*...*/);

  useEffect(() => {
    const handleScroll = () => {
      if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 1000) {
        if (hasNextPage) {
          fetchNextPage();
        }
      }
    };

    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, [fetchNextPage, hasNextPage]);
}
```

### Dependent Queries (–ó–∞–≤–∏—Å–∏–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã)

**–ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?**
Dependent Queries - —ç—Ç–æ –∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ **–∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞**. –í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å –Ω–µ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –±–µ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–µ—Ä–≤–æ–≥–æ.

**–ü—Ä–∏–º–µ—Ä—ã:**

- –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º –∑–∞–∫–∞–∑ ‚Üí –ø–æ—Ç–æ–º –¥–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç–µ–∂–∞ –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–∫–∞–∑–∞
- –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –ø–æ—Ç–æ–º –µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ ‚Üí –ø–æ—Ç–æ–º –¥–µ—Ç–∞–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞

**–ü—Ä–æ–±–ª–µ–º–∞ –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**

```typescript
// ‚ùå –ü–ª–æ—Ö–æ: –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
const order = useQuery(['order', orderId]);
const payment = useQuery(['payment', orderId]); // –ú–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–∞!
```

**–†–µ—à–µ–Ω–∏–µ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏:**

```typescript
// ‚úÖ –•–æ—Ä–æ—à–æ: –≤—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å –∂–¥–µ—Ç –ø–µ—Ä–≤—ã–π
const order = useQuery(['order', orderId]);
const payment = useQuery(['payment', orderId], { enabled: !!order.data });
```

```typescript
// src/components/exchange/OrderDetails.tsx
'use client';

import { trpc } from '../../lib/trpc-provider';

export function OrderDetails({ orderId }: { orderId: string }) {
  // 1Ô∏è‚É£ –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–∫–∞–∑–µ
  const { data: order, isLoading: orderLoading } = trpc.user.orders.getOrderById.useQuery({
    orderId,
  });

  // 2Ô∏è‚É£ –ó–∞—Ç–µ–º –ø–æ–ª—É—á–∞–µ–º –¥–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç–µ–∂–∞ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∑–∞–∫–∞–∑ –∑–∞–≥—Ä—É–∂–µ–Ω)
  const { data: paymentDetails, isLoading: paymentLoading } = trpc.user.orders.getPaymentDetails.useQuery(
    { orderId },
    {
      // üö¶ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ order —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
      enabled: !!order,
    }
  );

  // 3Ô∏è‚É£ –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ (—Ç–æ–∂–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∑–∞–∫–∞–∑–∞)
  const { data: statusHistory, isLoading: historyLoading } = trpc.user.orders.getStatusHistory.useQuery(
    { orderId },
    {
      // üö¶ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ order —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
      enabled: !!order,
    }
  );

  // üîÑ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞
  if (orderLoading) {
    return <div className="animate-pulse">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–∞...</div>;
  }

  // üö´ –ï—Å–ª–∏ –∑–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω
  if (!order) {
    return <div className="text-red-500">–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω</div>;
  }

  return (
    <div className="space-y-6">
      {/* ‚úÖ –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ (—É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞) */}
      <OrderCard order={order} />

      {/* üí≥ –î–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç–µ–∂–∞ */}
      {paymentLoading ? (
        <div className="animate-pulse h-32 bg-gray-200 rounded"></div>
      ) : paymentDetails ? (
        <PaymentDetailsCard details={paymentDetails} />
      ) : null}

      {/* üìä –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ */}
      {historyLoading ? (
        <div className="animate-pulse h-24 bg-gray-200 rounded"></div>
      ) : statusHistory ? (
        <StatusHistoryCard history={statusHistory} />
      ) : null}
    </div>
  );
}

// üí° –ü–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
// 1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è getOrderById
// 2. getOrderById –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è ‚Üí paymentDetails –∏ statusHistory –∂–¥—É—Ç (enabled: false)
// 3. getOrderById –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è ‚Üí order –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ data
// 4. enabled: !!order —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è true ‚Üí –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∑–∞–≤–∏—Å–∏–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã
// 5. paymentDetails –∏ statusHistory –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
// 6. –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–æ –º–µ—Ä–µ –∑–∞–≥—Ä—É–∑–∫–∏

// üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
// ‚úÖ –ù–µ—Ç –ª–∏—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω
// ‚úÖ –ó–∞–≤–∏—Å–∏–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
// ‚úÖ –ß–µ—Ç–∫–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
```

## üéØ Error Handling (–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫)

### –£—Ä–æ–≤–Ω–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

–í tRPC + React Query –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫:

1. **üåç –ì–ª–æ–±–∞–ª—å–Ω–∞—è** - –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
2. **üéØ –õ–æ–∫–∞–ª—å–Ω–∞—è** - –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
3. **üîß –ö–∞—Å—Ç–æ–º–Ω–∞—è** - —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫

### –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–ó–∞—á–µ–º –Ω—É–∂–Ω–∞?**

- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–∞—Å—Ç—ã—Ö –æ—à–∏–±–æ–∫ (401, 403, 500)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è (—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –ª–æ–≥–∏–Ω, –ø–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```typescript
// lib/trpc-provider.tsx
export function TRPCProvider({ children }: { children: React.ReactNode }) {
  const [queryClient] = useState(
    () =>
      new QueryClient({
        defaultOptions: {
          queries: {
            // üîç –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–ª—è –≤—Å–µ—Ö Query
            onError: (error: any) => {
              console.error('Query error:', error); // üìù –õ–æ–≥–∏—Ä—É–µ–º –≤—Å–µ –æ—à–∏–±–∫–∏

              // üîê –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –ª–æ–≥–∏–Ω
              if (error.data?.code === 'UNAUTHORIZED') {
                toast({
                  title: '–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞',
                  description: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É –∑–∞–Ω–æ–≤–æ',
                  variant: 'destructive',
                });
                window.location.href = '/login';
              }

              // üö´ –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
              if (error.data?.code === 'FORBIDDEN') {
                toast({
                  title: '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω',
                  description: '–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è',
                  variant: 'destructive',
                });
              }
            },
          },
          mutations: {
            // ‚úèÔ∏è –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–ª—è –≤—Å–µ—Ö Mutation
            onError: (error: any) => {
              console.error('Mutation error:', error); // üìù –õ–æ–≥–∏—Ä—É–µ–º –≤—Å–µ –æ—à–∏–±–∫–∏

              // üö¶ Rate limiting - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
              if (error.data?.code === 'TOO_MANY_REQUESTS') {
                toast({
                  title: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤',
                  description: '–ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–æ–π',
                  variant: 'destructive',
                });
              }

              // üîß –°–µ—Ä–≤–µ—Ä–Ω–∞—è –æ—à–∏–±–∫–∞ - –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –ø–æ–≤—Ç–æ—Ä–∏—Ç—å
              if (error.data?.httpStatus >= 500) {
                toast({
                  title: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞',
                  description: '–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑',
                  variant: 'destructive',
                });
              }
            },
          },
        },
      })
  );

  // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
}

// üí° –¢–∏–ø—ã –æ—à–∏–±–æ–∫ tRPC:
// - UNAUTHORIZED (401) - –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
// - FORBIDDEN (403) - –Ω–µ—Ç –ø—Ä–∞–≤
// - NOT_FOUND (404) - –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
// - TOO_MANY_REQUESTS (429) - –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
// - INTERNAL_SERVER_ERROR (500) - –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
```

### –õ–æ–∫–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**

- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –û—Å–æ–±—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–µ (–æ—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã, —Ä–µ–¥–∏—Ä–µ–∫—Ç)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –õ–æ–∫–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ **–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç** –≥–ª–æ–±–∞–ª—å–Ω—É—é

```typescript
// src/components/exchange/CurrencyConverter.tsx
'use client';

export function CurrencyConverter() {
  const { data, error, isError, refetch, isRefetching } = trpc.exchange.getCurrencyRate.useQuery(
    { from: 'BTC', to: 'UAH' },
    {
      // üéØ –õ–æ–∫–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—É—é)
      onError: (error) => {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É—Ä—Å–∞:', error);

        // üìä –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫—É –æ–± –æ—à–∏–±–∫–µ
        analytics.track('currency_rate_error', {
          from: 'BTC',
          to: 'UAH',
          error: error.message
        });
      },

      // üîÑ –ö–∞—Å—Ç–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
      retry: (failureCount, error: any) => {
        // üö´ –ù–µ –ø–æ–≤—Ç–æ—Ä—è–µ–º –µ—Å–ª–∏ –≤–∞–ª—é—Ç–Ω–∞—è –ø–∞—Ä–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
        if (error.data?.code === 'NOT_FOUND') {
          return false;
        }

        // üîÑ –ü–æ–≤—Ç–æ—Ä—è–µ–º –º–∞–∫—Å–∏–º—É–º 3 —Ä–∞–∑–∞ —Å —É–≤–µ–ª–∏—á–∏–≤–∞—é—â–µ–π—Å—è –∑–∞–¥–µ—Ä–∂–∫–æ–π
        return failureCount < 3;
      },

      // ‚è∞ –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
      retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 30000),
    }
  );

  // üö® –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Å–∏–≤—É—é –æ—à–∏–±–∫—É —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–æ–≤—Ç–æ—Ä–∞
  if (isError) {
    return (
      <div className="p-4 border border-red-200 bg-red-50 rounded-lg">
        <div className="flex items-start space-x-3">
          <div className="text-red-500">‚ö†Ô∏è</div>
          <div className="flex-1">
            <p className="text-red-800 font-medium mb-1">
              –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫—É—Ä—Å –≤–∞–ª—é—Ç
            </p>
            <p className="text-red-600 text-sm mb-3">
              {error.message}
            </p>
            <button
              onClick={() => refetch()}
              disabled={isRefetching}
              className="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50"
            >
              {isRefetching ? '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...' : '–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞'}
            </button>
          </div>
        </div>
      </div>
    );
  }

  // ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –≤—Å–µ –æ–∫
  if (data) {
    return (
      <div className="p-4 border border-green-200 bg-green-50 rounded-lg">
        <p className="text-lg font-semibold">
          1 BTC = ‚Ç¥{data.rate}
        </p>
      </div>
    );
  }

  // üîÑ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
  return (
    <div className="p-4 border rounded-lg animate-pulse">
      <div className="h-6 bg-gray-200 rounded"></div>
    </div>
  );
}

// üí° –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫:

// üéØ –î–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
// - –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ä–æ–±–Ω—É—é –æ—à–∏–±–∫—É
// - –î–∞–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–∏—Ç—å
// - –õ–æ–≥–∏—Ä—É–µ–º –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

// üîÑ –î–ª—è –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
// - –ü–æ–∫–∞–∑—ã–≤–∞–µ–º fallback UI
// - –¢–∏—Ö–æ –ø–æ–≤—Ç–æ—Ä—è–µ–º –≤ —Ñ–æ–Ω–µ
// - –ù–µ –±–µ—Å–ø–æ–∫–æ–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

// üìä –î–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:
// - –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏ –æ–± –æ—à–∏–±–∫–∞—Ö
// - –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ç–∏–ø–∞–º –æ—à–∏–±–æ–∫
// - –ú–æ–Ω–∏—Ç–æ—Ä–∏–º –∫–∞—á–µ—Å—Ç–≤–æ API
```

## üíª –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ

### –ó–∞–¥–∞—á–∞: –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–∏—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:**

1. **–ü–æ–∏—Å–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –≤–≤–æ–¥–µ
2. **Debounce** - –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –∫–∞–∂–¥—É—é –±—É–∫–≤—É
3. **–°–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏** - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä –≤–æ –≤—Ä–µ–º—è –ø–æ–∏—Å–∫–∞
4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –∫—Ä–∞—Å–∏–≤–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏
5. **–ü—É—Å—Ç—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è** - —á—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å –∫–æ–≥–¥–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**

- –ü–æ–∏—Å–∫ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤–≤–æ–¥–µ –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–æ–≤
- –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–∏—Å–∫–æ–º - 300ms
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∏—Å–∫–∞
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫

–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å –ø–æ–∏—Å–∫–æ–º –∑–∞–∫–∞–∑–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:

```typescript
// src/components/admin/OrdersSearch.tsx
'use client';

import { useState, useMemo } from 'react';
import { useDebouncedValue } from '@repo/hooks';
import { trpc } from '../../lib/trpc-provider';

export function OrdersSearch() {
  const [searchTerm, setSearchTerm] = useState('');
  const [debouncedSearchTerm] = useDebouncedValue(searchTerm, 300);

  // üîç –ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–æ–≤ —Å debounce –∏ —É—Å–ª–æ–≤–Ω—ã–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
  const {
    data: searchResults,
    isLoading,
    error,
    isError
  } = trpc.admin.orders.searchOrders.useQuery(
    { query: debouncedSearchTerm },
    {
      // üö¶ –í—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –¥–ª–∏–Ω–µ –∑–∞–ø—Ä–æ—Å–∞
      enabled: debouncedSearchTerm.length >= 3,

      // üìä –ö—ç—à–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –Ω–∞ 2 –º–∏–Ω—É—Ç—ã
      staleTime: 2 * 60 * 1000,

      // üîÑ –ù–µ –ø–æ–≤—Ç–æ—Ä—è–µ–º –ø–æ–∏—Å–∫ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö (—Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è)
      retry: false,
    }
  );

  // üßπ –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –ø–æ–∏—Å–∫–∞
  const clearSearch = () => {
    setSearchTerm('');
  };

  return (
    <div className="space-y-4">
      {/* üîç –ü–æ–ª–µ –ø–æ–∏—Å–∫–∞ —Å –∫–Ω–æ–ø–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ */}
      <div className="relative">
        <input
          type="text"
          placeholder="–ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–æ–≤ –ø–æ ID, email, —Å—Ç–∞—Ç—É—Å—É..."
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
          className="w-full p-3 pr-10 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        />

        {searchTerm && (
          <button
            onClick={clearSearch}
            className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"
          >
            ‚úï
          </button>
        )}
      </div>

      {/* üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ –æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω–µ */}
      {searchTerm.length > 0 && searchTerm.length < 3 && (
        <div className="text-sm text-gray-500">
          –í–≤–µ–¥–∏—Ç–µ –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞
        </div>
      )}

      {/* üîÑ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */}
      {isLoading && debouncedSearchTerm.length >= 3 && (
        <div className="flex items-center justify-center py-8">
          <div className="animate-spin w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full"></div>
          <span className="ml-2 text-gray-600">–ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–æ–≤...</span>
        </div>
      )}

      {/* üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ */}
      {isError && (
        <div className="p-4 border border-red-200 bg-red-50 rounded-lg">
          <p className="text-red-800 font-medium">–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞</p>
          <p className="text-red-600 text-sm">{error.message}</p>
        </div>
      )}

      {/* ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ */}
      {searchResults && searchResults.length > 0 && (
        <div className="space-y-2">
          <div className="text-sm text-gray-600 mb-2">
            –ù–∞–π–¥–µ–Ω–æ –∑–∞–∫–∞–∑–æ–≤: {searchResults.length}
          </div>
          {searchResults.map(order => (
            <OrderSearchResult key={order.id} order={order} />
          ))}
        </div>
      )}

      {/* üîç –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */}
      {debouncedSearchTerm.length >= 3 &&
       !isLoading &&
       !isError &&
       searchResults?.length === 0 && (
        <div className="text-center py-8">
          <div className="text-gray-400 text-4xl mb-2">üîç</div>
          <p className="text-gray-600 font-medium">–ó–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
          <p className="text-gray-500 text-sm">
            –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
          </p>
        </div>
      )}
    </div>
  );
}

// üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

function OrderSearchResult({ order }: { order: any }) {
  return (
    <div className="p-3 border rounded-lg hover:bg-gray-50 cursor-pointer">
      <div className="flex justify-between items-start">
        <div>
          <p className="font-medium">#{order.id}</p>
          <p className="text-sm text-gray-600">{order.email}</p>
        </div>
        <div className="text-right">
          <span className={`px-2 py-1 text-xs rounded ${
            order.status === 'completed' ? 'bg-green-100 text-green-800' :
            order.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
            'bg-gray-100 text-gray-800'
          }`}>
            {order.status}
          </span>
          <p className="text-sm text-gray-500 mt-1">
            {order.amount} {order.fromCurrency}
          </p>
        </div>
      </div>
    </div>
  );
}

// üéØ –ß—Ç–æ –º—ã –∏–∑—É—á–∏–ª–∏ –≤ —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ:
// ‚úÖ Debounced –ø–æ–∏—Å–∫ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
// ‚úÖ –£—Å–ª–æ–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ query —Å enabled
// ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π (–∑–∞–≥—Ä—É–∑–∫–∞, –æ—à–∏–±–∫–∞, –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)
// ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ–∏—Å–∫–∞
// ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞–Ω–∏–π

### –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Å–∞–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—è:

**ü§î –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–±—è - –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –∞ –ø–æ—Ç–æ–º –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã:**

1. **–í —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É useQuery –∏ useMutation?**
   <details>
   <summary>–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç</summary>
   - **useQuery** - –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∫—ç—à–∏—Ä—É–µ—Ç—Å—è
   - **useMutation** - –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ mutate(), –Ω–µ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è
   </details>

2. **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –æ–ø—Ü–∏—è `enabled` –≤ useQuery?**
   <details>
   <summary>–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç</summary>

   –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –∫–æ–≥–¥–∞ query –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è:
   - `enabled: true` - query –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É
   - `enabled: false` - query –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
   - `enabled: !!userId` - query –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ userId —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
   </details>

3. **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç Optimistic Updates?**
   <details>
   <summary>–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç</summary>
   1. **onMutate** - –æ–±–Ω–æ–≤–ª—è–µ–º UI —Å—Ä–∞–∑—É (–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ)
   2. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –≤ —Ñ–æ–Ω–µ
   3. **onError** - –µ—Å–ª–∏ –æ—à–∏–±–∫–∞, –æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
   4. **onSettled** - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º—Å—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
   </details>

4. **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `invalidate` vs `refetch`?**
   <details>
   <summary>–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç</summary>
   - **invalidate** - –ø–æ–º–µ—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
   - **refetch** - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å
   - **invalidate** –ª—É—á—à–µ –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, **refetch** –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ query
   </details>

5. **–ß—Ç–æ —Ç–∞–∫–æ–µ `staleTime` –≤ React Query?**
   <details>
   <summary>–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç</summary>

   –í—Ä–µ–º—è –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö, –≤ —Ç–µ—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –¥–∞–Ω–Ω—ã–µ —Å—á–∏—Ç–∞—é—Ç—Å—è "—Å–≤–µ–∂–∏–º–∏":
   - `staleTime: 0` - –¥–∞–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–≤–∞—é—Ç —Å—Ä–∞–∑—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   - `staleTime: 5 * 60 * 1000` - –¥–∞–Ω–Ω—ã–µ —Å–≤–µ–∂–∏–µ 5 –º–∏–Ω—É—Ç
   - –ü–æ–∫–∞ –¥–∞–Ω–Ω—ã–µ —Å–≤–µ–∂–∏–µ, –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
   </details>

6. **–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –≤ tRPC?**
   <details>
   <summary>–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç</summary>

   **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø–æ–¥—Ö–æ–¥:**
   - **–ì–ª–æ–±–∞–ª—å–Ω–æ** - –≤ QueryClient –¥–ª—è –æ–±—â–∏—Ö –æ—à–∏–±–æ–∫ (401, 500)
   - **–õ–æ–∫–∞–ª—å–Ω–æ** - –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–π –ª–æ–≥–∏–∫–∏
   - **Graceful degradation** - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º fallback UI –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
   </details>

7. **–ß—Ç–æ —Ç–∞–∫–æ–µ Dependent Queries –∏ –∫–æ–≥–¥–∞ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**
   <details>
   <summary>–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç</summary>

   –ó–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞:

   ```typescript
   const order = useQuery(['order', id]);
   const details = useQuery(['details', id], { enabled: !!order.data });
   ```

   –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ–≥–¥–∞ –≤—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å –Ω–µ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –±–µ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–µ—Ä–≤–æ–≥–æ.
   </details>

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è:

**üéØ –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ –ø–æ —Å–≤–æ–µ–º—É —É—Ä–æ–≤–Ω—é:**

#### –£—Ä–æ–≤–µ–Ω—å 1: –ù–∞—á–∏–Ω–∞—é—â–∏–π

1. **–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Å—Ç–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç** —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∫—É—Ä—Å–∞ –æ–¥–Ω–æ–π –≤–∞–ª—é—Ç—ã
2. **–î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫** - –ø–æ–∫–∞–∂–∏—Ç–µ –∫—Ä–∞—Å–∏–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
3. **–†–µ–∞–ª–∏–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** - –ø–æ–∑–≤–æ–ª—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ

#### –£—Ä–æ–≤–µ–Ω—å 2: –°—Ä–µ–¥–Ω–∏–π

4. **–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º** –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç (refetchInterval)
5. **–†–µ–∞–ª–∏–∑—É–π—Ç–µ optimistic updates** –¥–ª—è –ø—Ä–æ—Å—Ç–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑–±—Ä–∞–Ω–Ω–æ–µ)
6. **–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö** –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ —Å—Å—ã–ª–∫–∏

#### –£—Ä–æ–≤–µ–Ω—å 3: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π

7. **–†–µ–∞–ª–∏–∑—É–π—Ç–µ infinite scroll** –¥–ª—è —Å–ø–∏—Å–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å useInfiniteQuery
8. **–°–æ–∑–¥–∞–π—Ç–µ —Å–ª–æ–∂–Ω—ã–π –ø–æ–∏—Å–∫** —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π
9. **–î–æ–±–∞–≤—å—Ç–µ offline support** - –ø–æ–∫–∞–∂–∏—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–≥–¥–∞ –Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

#### –£—Ä–æ–≤–µ–Ω—å 4: –≠–∫—Å–ø–µ—Ä—Ç

10. **–°–æ–∑–¥–∞–π—Ç–µ error boundary** —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è tRPC –æ—à–∏–±–æ–∫
11. **–†–µ–∞–ª–∏–∑—É–π—Ç–µ retry —Å exponential backoff** –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
12. **–î–æ–±–∞–≤—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** - –∏–∑–º–µ—Ä—è–π—Ç–µ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö

**üí° –ü–æ–¥—Å–∫–∞–∑–∫–∏:**

- –ù–∞—á–∏–Ω–∞–π—Ç–µ —Å –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á –∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É—Å–ª–æ–∂–Ω—è–π—Ç–µ
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ DevTools –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ React Query
- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –æ—à–∏–±–æ–∫
- –û–±—Ä–∞—â–∞–π—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ UX - –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–µ–¥–µ—Ç —Å–µ–±—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

### üìñ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:

- [tRPC React Integration](https://trpc.io/docs/client/react) - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å React
- [React Query Documentation](https://tanstack.com/query/latest) - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è React Query
- [tRPC Error Handling](https://trpc.io/docs/client/react/error-handling) - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- [React Query DevTools](https://tanstack.com/query/latest/docs/react/devtools) - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

### üéØ –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏:

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**

- üîÑ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ debounce –¥–ª—è search queries (300-500ms)
- üìä –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ staleTime —Ä–∞–∑—É–º–Ω–æ (5 –º–∏–Ω—É—Ç –¥–ª—è –∫—É—Ä—Å–æ–≤, 1 —á–∞—Å –¥–ª—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤)
- üöÄ –ü—Ä–∏–º–µ–Ω—è–π—Ç–µ prefetch –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
- üì¶ –ì—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å batching

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç:**

- ‚ö° –ü—Ä–∏–º–µ–Ω—è–π—Ç–µ optimistic updates –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- üîÑ –ü–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ skeleton loading –≤–º–µ—Å—Ç–æ —Å–ø–∏–Ω–Ω–µ—Ä–æ–≤
- üö® –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏ gracefully —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–æ–≤—Ç–æ—Ä–∞
- üíæ –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

- üèóÔ∏è –ì—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ invalidation –æ–ø–µ—Ä–∞—Ü–∏–∏
- üéØ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ enabled –¥–ª—è —É—Å–ª–æ–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- üìã –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ö—É–∫–∏ –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏
- üîß –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ retry –ª–æ–≥–∏–∫—É –ø–æ–¥ —Å–ø–µ—Ü–∏—Ñ–∏–∫—É API

**–û—Ç–ª–∞–¥–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**

- üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ React Query DevTools –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- üìä –õ–æ–≥–∏—Ä—É–π—Ç–µ –æ—à–∏–±–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚è±Ô∏è –ò–∑–º–µ—Ä—è–π—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- üß™ –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ offline —Å—Ü–µ–Ω–∞—Ä–∏–∏

### üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ?

–í —Å–ª–µ–¥—É—é—â–µ–º —É—Ä–æ–∫–µ –º—ã –∏–∑—É—á–∏–º:

- Middleware –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
- –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- –°–µ—Å—Å–∏–∏ –∏ JWT —Ç–æ–∫–µ–Ω—ã

### üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:

- [tRPC Examples](https://github.com/trpc/trpc/tree/main/examples) - –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- [React Query Patterns](https://tkdodo.eu/blog/practical-react-query) - –ø–∞—Ç—Ç–µ—Ä–Ω—ã React Query
- [Error Handling Strategies](https://kentcdodds.com/blog/use-react-error-boundary-to-handle-errors-in-react) - —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

---

[‚Üê –£—Ä–æ–∫ 4.2](./lesson-4.2-routers-procedures-server.md) | [–£—Ä–æ–∫ 4.4 ‚Üí](./lesson-4.4-middleware-authentication.md)
