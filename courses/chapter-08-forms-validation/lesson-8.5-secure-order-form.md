# –£—Ä–æ–∫ 8.5: –ü—Ä–∞–∫—Ç–∏–∫–∞ - –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ñ–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏

> **–¶–µ–ª—å —É—Ä–æ–∫–∞**: –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Ñ–æ—Ä–º—É –æ–±–º–µ–Ω–Ω–∏–∫–∞ –≤–∞–ª—é—Ç, –ø—Ä–∏–º–µ–Ω–∏–≤ –≤—Å–µ –∏–∑—É—á–µ–Ω–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ UX –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üìñ –¢–µ–æ—Ä–∏—è

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ñ–æ—Ä–º—ã –æ–±–º–µ–Ω–∞ –≤–∞–ª—é—Ç

–§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏ –Ω–∞ –æ–±–º–µ–Ω - —ç—Ç–æ —Å–µ—Ä–¥—Ü–µ –ª—é–±–æ–≥–æ –æ–±–º–µ–Ω–Ω–∏–∫–∞. –û–Ω–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ—á–µ—Ç–∞—Ç—å:

1. **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –∑–∞—â–∏—Ç–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. **–£–¥–æ–±—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** - –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
3. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –±—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
5. **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ë–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ñ–æ—Ä–º–µ:**

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –æ–±–º–µ–Ω–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –†–∞—Å—á–µ—Ç –∫—É—Ä—Å–∞ –∏ –∫–æ–º–∏—Å—Å–∏–π
- –ó–∞—â–∏—Ç–∞ –æ—Ç –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è–º

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ñ–æ—Ä–º—ã

```typescript
// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã –æ–±–º–µ–Ω–∞
interface ExchangeOrderForm {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±–º–µ–Ω–∞
  fromCurrency: CryptoCurrency;
  toCurrency: 'UAH';
  fromAmount: string;
  toAmount: string;

  // –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  email: string;
  phone?: string;

  // –ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã
  paymentMethod: 'card' | 'bank_transfer';
  cardNumber?: string;
  bankDetails?: {
    accountNumber: string;
    bankName: string;
    recipientName: string;
  };

  // –°–æ–≥–ª–∞—Å–∏—è –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
  termsAccepted: boolean;
  privacyAccepted: boolean;
  riskDisclosureAccepted: boolean;
}
```

## üîç –ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞

### Security-Enhanced —Å—Ö–µ–º–∞ —Ñ–æ—Ä–º—ã –æ–±–º–µ–Ω–∞

–ò–∑—É—á–∏–º —Ä–µ–∞–ª—å–Ω—É—é —Å—Ö–µ–º—É –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ `packages/utils/src/validation/security-enhanced-exchange-schemas.ts`:

```typescript
/**
 * CREATE EXCHANGE ORDER SCHEMA
 * –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏ —Å –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π –∑–∞—â–∏—Ç–æ–π
 */
export const securityEnhancedCreateExchangeOrderSchema = z.object({
  // Email —Å XSS –∑–∞—â–∏—Ç–æ–π
  email: xssProtectedEmailSchema,

  // –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω–∞—è —Å—É–º–º–∞ —Å –±–∏–∑–Ω–µ—Å-–ª–∏–º–∏—Ç–∞–º–∏
  cryptoAmount: z
    .number()
    .positive('AMOUNT_POSITIVE_REQUIRED')
    .min(VALIDATION_LIMITS.MIN_ORDER_AMOUNT, VALIDATION_KEYS.AMOUNT_MIN_VALUE)
    .max(VALIDATION_LIMITS.MAX_ORDER_AMOUNT, VALIDATION_KEYS.AMOUNT_MAX_VALUE)
    .finite('AMOUNT_MUST_BE_FINITE'), // –ó–∞—â–∏—Ç–∞ –æ—Ç Infinity/NaN

  // –ì—Ä–∏–≤–Ω–µ–≤–∞—è —Å—É–º–º–∞
  uahAmount: z.number().positive('AMOUNT_POSITIVE_REQUIRED').finite('UAH_AMOUNT_MUST_BE_FINITE'),

  // –í–∞–ª—é—Ç–∞ –æ–±–º–µ–Ω–∞
  currency: currencySchema,

  // –ü–ª–∞—Ç–µ–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  paymentDetails: z
    .object({
      cardNumber: securityEnhancedCardNumberSchema.optional(),
      bankDetails: createXSSProtectedStringWithLength(
        0,
        SECURITY_VALIDATION_LIMITS.MESSAGE_MAX_LENGTH
      ).optional(),
    })
    .optional(),
});
```

**–£—Ä–æ–≤–Ω–∏ –∑–∞—â–∏—Ç—ã:**

1. **XSS Protection** - –≤—Å–µ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –ø–æ–ª—è –∑–∞—â–∏—â–µ–Ω—ã
2. **Business Rules** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –æ–±–º–µ–Ω–∞
3. **Format Validation** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö
4. **Type Safety** - —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è TypeScript
5. **Security Limits** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –¥–ª–∏–Ω—É –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ª–∏–º–∏—Ç–æ–≤

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–∑–Ω–µ—Å-–ª–∏–º–∏—Ç–æ–≤:

```typescript
// packages/exchange-core/src/utils/validation.ts
export function isAmountWithinLimits(amount: number, currency: CryptoCurrency): ValidationResult {
  const limits = getCurrencyLimits(currency);

  // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞
  if (amount < limits.min) {
    return {
      isValid: false,
      reason: 'AMOUNT_TOO_SMALL',
      localizationKey: 'validation.amount.belowMinimum',
      params: {
        amount: amount.toString(),
        min: limits.min.toString(),
        currency,
      },
    };
  }

  // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞
  if (amount > limits.max) {
    return {
      isValid: false,
      reason: 'AMOUNT_TOO_LARGE',
      localizationKey: 'validation.amount.aboveMaximum',
      params: {
        amount: amount.toString(),
        max: limits.max.toString(),
        currency,
      },
    };
  }

  // –î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
  if (amount > limits.dailyLimit) {
    return {
      isValid: false,
      reason: 'DAILY_LIMIT_EXCEEDED',
      localizationKey: 'validation.amount.dailyLimitExceeded',
      params: {
        dailyLimit: limits.dailyLimit.toString(),
        currency,
      },
    };
  }

  return { isValid: true };
}
```

## üíª –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–π —Ñ–æ—Ä–º—ã –æ–±–º–µ–Ω–∞

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `secure-exchange-form.tsx` –∏ —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ –ø–æ–ª–Ω—É—é —Ñ–æ—Ä–º—É:

```typescript
'use client';

import { z } from 'zod';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { useState, useEffect } from 'react';
import { useTranslations } from 'next-intl';

import {
  securityEnhancedCreateExchangeOrderSchema,
  xssProtectedEmailSchema,
  securityEnhancedCardNumberSchema
} from '@repo/utils';
import { CryptoCurrency } from '@repo/exchange-core';
import {
  InputField,
  SelectField,
  CheckboxField,
  Button,
  Card
} from '@repo/ui';

// –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏
const fullExchangeOrderSchema = securityEnhancedCreateExchangeOrderSchema.extend({
  phone: z.string()
    .regex(/^\+380\d{9}$/, '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –≤ —Ñ–æ—Ä–º–∞—Ç–µ +380XXXXXXXXX')
    .optional(),
  paymentMethod: z.enum(['card', 'bank_transfer']),
  termsAccepted: z.boolean().refine(val => val, '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–Ω—è—Ç—å —É—Å–ª–æ–≤–∏—è'),
  privacyAccepted: z.boolean().refine(val => val, '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–Ω—è—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏'),
});

type ExchangeOrderFormData = z.infer<typeof fullExchangeOrderSchema>;

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ñ–æ—Ä–º—ã
const SUPPORTED_CURRENCIES: CryptoCurrency[] = ['BTC', 'ETH', 'USDT'];
const PAYMENT_METHODS = [
  { value: 'card', label: '–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞' },
  { value: 'bank_transfer', label: '–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥' }
];

export function SecureExchangeForm() {
  const [exchangeRate, setExchangeRate] = useState<number>(0);
  const [isCalculating, setIsCalculating] = useState(false);
  const t = useTranslations('ExchangeForm');
  const tValidation = useTranslations('Validation');

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
  const form = useForm<ExchangeOrderFormData>({
    resolver: zodResolver(fullExchangeOrderSchema),
    defaultValues: {
      fromCurrency: 'USDT',
      fromAmount: '',
      toAmount: '',
      email: '',
      phone: '',
      paymentMethod: 'card',
      termsAccepted: false,
      privacyAccepted: false,
    },
    mode: 'onChange'
  });

  // –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ —Å—É–º–º—ã –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞
  const watchedFromAmount = form.watch('fromAmount');
  const watchedFromCurrency = form.watch('fromCurrency');

  // TODO: –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç –∫—É—Ä—Å–∞
  useEffect(() => {
    const calculateExchange = async () => {
      if (!watchedFromAmount || isNaN(Number(watchedFromAmount))) {
        form.setValue('toAmount', '');
        return;
      }

      setIsCalculating(true);
      try {
        // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å –∫ API –∫—É—Ä—Å–æ–≤
        const rate = await fetchExchangeRate(watchedFromCurrency, 'UAH');
        const toAmount = Number(watchedFromAmount) * rate;

        setExchangeRate(rate);
        form.setValue('toAmount', toAmount.toFixed(2));
      } catch (error) {
        console.error('Error calculating exchange:', error);
      } finally {
        setIsCalculating(false);
      }
    };

    const debounceTimer = setTimeout(calculateExchange, 500);
    return () => clearTimeout(debounceTimer);
  }, [watchedFromAmount, watchedFromCurrency, form]);

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏
  const onSubmit = async (data: ExchangeOrderFormData) => {
    try {
      // TODO: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏
      console.log('Creating exchange order:', data);

      // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å –∫ tRPC endpoint
      // const result = await trpc.exchange.createOrder.mutate(data);

      // –ü–æ–∫–∞–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ
      alert('–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!');
    } catch (error) {
      console.error('Error creating order:', error);
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
    }
  };

  return (
    <Card className="max-w-2xl mx-auto p-6">
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">

        {/* –°–µ–∫—Ü–∏—è –æ–±–º–µ–Ω–∞ */}
        <div className="space-y-4">
          <h2 className="text-lg font-semibold">{t('exchange.title')}</h2>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            {/* –í–∞–ª—é—Ç–∞ –∏—Å—Ç–æ—á–Ω–∏–∫ */}
            <SelectField
              {...form.register('fromCurrency')}
              label={t('exchange.fromCurrency')}
              options={SUPPORTED_CURRENCIES.map(currency => ({
                value: currency,
                label: currency
              }))}
              error={form.formState.errors.fromCurrency?.message}
            />

            {/* –°—É–º–º–∞ –∏—Å—Ç–æ—á–Ω–∏–∫ */}
            <InputField
              {...form.register('fromAmount')}
              type="number"
              step="0.00000001"
              label={t('exchange.fromAmount')}
              placeholder="0.00"
              error={form.formState.errors.fromAmount?.message}
              hint={`–ú–∏–Ω: ${getMinAmount(watchedFromCurrency)} ${watchedFromCurrency}`}
            />
          </div>

          {/* –ö—É—Ä—Å –æ–±–º–µ–Ω–∞ */}
          {exchangeRate > 0 && (
            <div className="bg-blue-50 p-3 rounded-lg">
              <p className="text-sm text-blue-700">
                –ö—É—Ä—Å: 1 {watchedFromCurrency} = {exchangeRate.toFixed(2)} UAH
              </p>
            </div>
          )}

          {/* –°—É–º–º–∞ –ø–æ–ª—É—á–µ–Ω–∏—è */}
          <InputField
            {...form.register('toAmount')}
            type="number"
            label={t('exchange.toAmount')}
            placeholder="0.00"
            disabled
            value={form.watch('toAmount')}
            suffix="UAH"
            className="bg-gray-50"
          />

          {isCalculating && (
            <p className="text-sm text-gray-500">–ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –∫—É—Ä—Å...</p>
          )}
        </div>

        {/* –°–µ–∫—Ü–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ */}
        <div className="space-y-4">
          <h2 className="text-lg font-semibold">{t('contacts.title')}</h2>

          <InputField
            {...form.register('email')}
            type="email"
            label={t('contacts.email')}
            placeholder="your@email.com"
            error={form.formState.errors.email?.message}
            required
          />

          <InputField
            {...form.register('phone')}
            type="tel"
            label={t('contacts.phone')}
            placeholder="+380XXXXXXXXX"
            error={form.formState.errors.phone?.message}
            hint="–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —Å–≤—è–∑–∏ –ø–æ –∑–∞—è–≤–∫–µ"
          />
        </div>

        {/* –°–µ–∫—Ü–∏—è –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö */}
        <div className="space-y-4">
          <h2 className="text-lg font-semibold">{t('payment.title')}</h2>

          <SelectField
            {...form.register('paymentMethod')}
            label={t('payment.method')}
            options={PAYMENT_METHODS}
          />

          {form.watch('paymentMethod') === 'card' && (
            <InputField
              {...form.register('paymentDetails.cardNumber')}
              type="text"
              label={t('payment.cardNumber')}
              placeholder="1234 5678 9012 3456"
              error={form.formState.errors.paymentDetails?.cardNumber?.message}
              maxLength={19}
            />
          )}

          {form.watch('paymentMethod') === 'bank_transfer' && (
            <div className="space-y-3">
              <InputField
                {...form.register('paymentDetails.bankDetails.accountNumber')}
                label={t('payment.accountNumber')}
                placeholder="26XXXXXXXXXXXXXXXXXXXXXXXXX"
              />

              <InputField
                {...form.register('paymentDetails.bankDetails.bankName')}
                label={t('payment.bankName')}
                placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞"
              />

              <InputField
                {...form.register('paymentDetails.bankDetails.recipientName')}
                label={t('payment.recipientName')}
                placeholder="–§–ò–û –ø–æ–ª—É—á–∞—Ç–µ–ª—è"
              />
            </div>
          )}
        </div>

        {/* –°–µ–∫—Ü–∏—è —Å–æ–≥–ª–∞—Å–∏–π */}
        <div className="space-y-3">
          <CheckboxField
            {...form.register('termsAccepted')}
            label={
              <span>
                –Ø –ø—Ä–∏–Ω–∏–º–∞—é <a href="/terms" className="text-blue-600 hover:underline">—É—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a>
              </span>
            }
            error={form.formState.errors.termsAccepted?.message}
          />

          <CheckboxField
            {...form.register('privacyAccepted')}
            label={
              <span>
                –Ø –ø—Ä–∏–Ω–∏–º–∞—é <a href="/privacy" className="text-blue-600 hover:underline">–ø–æ–ª–∏—Ç–∏–∫—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
              </span>
            }
            error={form.formState.errors.privacyAccepted?.message}
          />
        </div>

        {/* –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ */}
        <Button
          type="submit"
          className="w-full"
          disabled={form.formState.isSubmitting || !form.formState.isValid}
          loading={form.formState.isSubmitting}
        >
          {form.formState.isSubmitting
            ? t('submit.creating')
            : t('submit.create')
          }
        </Button>

        {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ */}
        <div className="bg-green-50 p-3 rounded-lg">
          <p className="text-sm text-green-700">
            üîí –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã SSL —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º
          </p>
        </div>
      </form>
    </Card>
  );
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
async function fetchExchangeRate(from: CryptoCurrency, to: string): Promise<number> {
  // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å –∫ API –∫—É—Ä—Å–æ–≤
  // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
  const rates = {
    'BTC': 1200000,
    'ETH': 120000,
    'USDT': 41
  };

  return rates[from] || 0;
}

function getMinAmount(currency: CryptoCurrency): string {
  const minimums = {
    'BTC': '0.001',
    'ETH': '0.01',
    'USDT': '10'
  };

  return minimums[currency] || '0';
}
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è —Ñ–æ—Ä–º—ã

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `secure-exchange-form.test.tsx`:

```typescript
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { SecureExchangeForm } from './secure-exchange-form';

// –ú–æ–∫–∞–µ–º –ø–µ—Ä–µ–≤–æ–¥—ã
jest.mock('next-intl', () => ({
  useTranslations: () => (key: string) => key
}));

describe('SecureExchangeForm', () => {
  test('should validate email field', async () => {
    render(<SecureExchangeForm />);

    const emailInput = screen.getByLabelText(/email/i);

    // –¢–µ—Å—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–≥–æ email
    await userEvent.type(emailInput, 'invalid-email');
    await userEvent.tab(); // Trigger blur

    await waitFor(() => {
      expect(screen.getByText(/–≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email/i)).toBeInTheDocument();
    });

    // –¢–µ—Å—Ç –≤–∞–ª–∏–¥–Ω–æ–≥–æ email
    await userEvent.clear(emailInput);
    await userEvent.type(emailInput, 'test@example.com');

    await waitFor(() => {
      expect(screen.queryByText(/–≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email/i)).not.toBeInTheDocument();
    });
  });

  test('should validate amount limits', async () => {
    render(<SecureExchangeForm />);

    const amountInput = screen.getByLabelText(/fromAmount/i);

    // –¢–µ—Å—Ç —Å—É–º–º—ã –Ω–∏–∂–µ –º–∏–Ω–∏–º—É–º–∞
    await userEvent.type(amountInput, '0.0001');

    await waitFor(() => {
      expect(screen.getByText(/–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞/i)).toBeInTheDocument();
    });
  });

  test('should require terms acceptance', async () => {
    render(<SecureExchangeForm />);

    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –Ω–æ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ–º —É—Å–ª–æ–≤–∏—è
    await userEvent.type(screen.getByLabelText(/email/i), 'test@example.com');
    await userEvent.type(screen.getByLabelText(/fromAmount/i), '10');

    const submitButton = screen.getByRole('button', { name: /create/i });
    await userEvent.click(submitButton);

    await waitFor(() => {
      expect(screen.getByText(/–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–Ω—è—Ç—å —É—Å–ª–æ–≤–∏—è/i)).toBeInTheDocument();
    });
  });

  test('should prevent XSS in input fields', async () => {
    render(<SecureExchangeForm />);

    const emailInput = screen.getByLabelText(/email/i);

    // –ü–æ–ø—ã—Ç–∫–∞ XSS –∞—Ç–∞–∫–∏
    await userEvent.type(emailInput, '<script>alert("xss")</script>');

    await waitFor(() => {
      expect(screen.getByText(/–Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã/i)).toBeInTheDocument();
    });
  });
});
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞–Ω–∏–π

### –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã

1. **–ö–∞–∫–∏–µ —É—Ä–æ–≤–Ω–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π —Ñ–æ—Ä–º–µ?**
   - a) –¢–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
   - b) –¢–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
   - c) –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è + —Å–µ—Ä–≤–µ—Ä–Ω–∞—è + –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ + –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

2. **–ß—Ç–æ –≤–∞–∂–Ω–µ–µ –≤ —Ñ–æ—Ä–º–µ –æ–±–º–µ–Ω–∞ –≤–∞–ª—é—Ç?**
   - a) –°–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã
   - b) –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
   - c) –ö—Ä–∞—Å–∏–≤—ã–π –¥–∏–∑–∞–π–Ω

3. **–ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–µ—Ä–µ—Å—á–µ—Ç –∫—É—Ä—Å–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏?**
   - a) –ü—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–∞–∂–∞—Ç–∏–∏ –∫–ª–∞–≤–∏—à–∏
   - b) –° –∑–∞–¥–µ—Ä–∂–∫–æ–π (debounce) –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
   - c) –¢–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

1. **–î–æ–±–∞–≤—å—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é** –¥–ª—è –ø–æ–ª—è "–°—É–º–º–∞ –ø–æ–ª—É—á–µ–Ω–∏—è" —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –º–∏–Ω–∏–º—É–º–∞ –≤ 100 UAH

2. **–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç** –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–º–∏—Å—Å–∏–∏ –∑–∞ –æ–±–º–µ–Ω

3. **–†–µ–∞–ª–∏–∑—É–π—Ç–µ** —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Ñ–æ—Ä–º—ã –≤ localStorage

## üîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ —É–ª—É—á—à–µ–Ω–∏—è

### Performance –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

```typescript
// 1. –ú–µ–º–æ–∏–∑–∞—Ü–∏—è —Å–ª–æ–∂–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
const exchangeCalculation = useMemo(() => {
  if (!fromAmount || !exchangeRate) return null;

  const result = Number(fromAmount) * exchangeRate;
  const commission = result * 0.02; // 2% –∫–æ–º–∏—Å—Å–∏—è
  const total = result - commission;

  return { result, commission, total };
}, [fromAmount, exchangeRate]);

// 2. Debounced –≤–∞–ª–∏–¥–∞—Ü–∏—è
const debouncedValidation = useCallback(
  debounce(async (fieldName: string, value: string) => {
    await form.trigger(fieldName);
  }, 300),
  [form]
);

// 3. –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ç—è–∂–µ–ª—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
const PaymentMethodSelector = lazy(() => import('./PaymentMethodSelector'));
```

### Accessibility —É–ª—É—á—à–µ–Ω–∏—è

```typescript
// 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ–∫—É—Å–æ–º
useEffect(() => {
  if (form.formState.errors.email) {
    document.getElementById('email-input')?.focus();
  }
}, [form.formState.errors.email]);

// 2. –û–±—ä—è–≤–ª–µ–Ω–∏—è –¥–ª—è screen readers
const announceError = (message: string) => {
  const announcement = document.createElement('div');
  announcement.setAttribute('aria-live', 'polite');
  announcement.textContent = message;
  document.body.appendChild(announcement);

  setTimeout(() => {
    document.body.removeChild(announcement);
  }, 1000);
};

// 3. –ö–ª–∞–≤–∏–∞—Ç—É—Ä–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è
const handleKeyDown = (e: KeyboardEvent) => {
  if (e.key === 'Enter' && e.ctrlKey) {
    form.handleSubmit(onSubmit)();
  }
};
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

```typescript
// 1. Rate limiting –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
const rateLimiter = useRateLimit(5, 60000); // 5 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É

// 2. Validation on server side
const serverValidation = async (data: ExchangeOrderFormData) => {
  // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
  const result = fullExchangeOrderSchema.safeParse(data);

  if (!result.success) {
    throw new Error('Server validation failed');
  }

  return result.data;
};

// 3. CSRF protection
const csrfToken = await getCsrfToken();
const headers = {
  'X-CSRF-Token': csrfToken,
  'Content-Type': 'application/json',
};
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

### –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è

- [PCI DSS Compliance](https://www.pcisecuritystandards.org/) - —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –∫–∞—Ä—Ç
- [AML/KYC Requirements](https://www.fatf-gafi.org/) - —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø–æ –ø—Ä–æ—Ç–∏–≤–æ–¥–µ–π—Å—Ç–≤–∏—é –æ—Ç–º—ã–≤–∞–Ω–∏—é –¥–µ–Ω–µ–≥
- [GDPR for Financial Data](https://gdpr.eu/) - –∑–∞—â–∏—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ñ–æ—Ä–º

- [Testing Financial Applications](https://www.thoughtworks.com/insights/articles/testing-financial-applications)
- [Security Testing Guide](https://owasp.org/www-project-web-security-testing-guide/)

### UX –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤

- [Designing for Trust in Finance](https://www.nngroup.com/articles/financial-trust-ux/)
- [Form Design for Conversions](https://cxl.com/blog/form-design-best-practices/)

## üéØ –†–µ–∑—é–º–µ —É—Ä–æ–∫–∞

–í —ç—Ç–æ–º —É—Ä–æ–∫–µ –≤—ã —Å–æ–∑–¥–∞–ª–∏:

1. **–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Ñ–æ—Ä–º—É –æ–±–º–µ–Ω–Ω–∏–∫–∞ –≤–∞–ª—é—Ç** —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –±–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏
2. **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é —Å–∏—Å—Ç–µ–º—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** –æ—Ç XSS –¥–æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ª–∏–º–∏—Ç–æ–≤
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤—Å–µ—Ö –∏–∑—É—á–µ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π** - Zod, React Hook Form, next-intl
4. **–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ UX –ø–∞—Ç—Ç–µ—Ä–Ω—ã** - real-time —Ä–∞—Å—á–µ—Ç—ã, –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
5. **Comprehensive testing strategy** –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:**

- ‚úÖ **Security-Enhanced –≤–∞–ª–∏–¥–∞—Ü–∏—è** - –∑–∞—â–∏—Ç–∞ –æ—Ç –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∞—Ç–∞–∫
- ‚úÖ **Business Rules Integration** - —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- ‚úÖ **Excellent UX** - –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚úÖ **Type Safety** - –ø–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –æ—Ç —Å—Ö–µ–º—ã –¥–æ UI
- ‚úÖ **Performance** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- ‚úÖ **Accessibility** - –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!

–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª–∏ **–ì–ª–∞–≤—É 8: –§–æ—Ä–º—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è**!

–¢–µ–ø–µ—Ä—å –≤—ã –≤–ª–∞–¥–µ–µ—Ç–µ:

- ‚úÖ **Zod runtime –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **Security-Enhanced —Å—Ö–µ–º–∞–º–∏** –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- ‚úÖ **React Hook Form –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π** —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏
- ‚úÖ **–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–º UX –æ—à–∏–±–æ–∫** –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞
- ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ–º production-ready —Ñ–æ—Ä–º** –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤

**–°–ª–µ–¥—É—é—â–∞—è –≥–ª–∞–≤–∞**: [–ì–ª–∞–≤–∞ 9: Production deployment –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è](../chapter-09-production-deployment/README.md) - –ø–æ–¥–≥–æ—Ç–æ–≤–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫ production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

---

[‚Üê –£—Ä–æ–∫ 8.4](./lesson-8.4-error-handling-ux.md) | [–ì–ª–∞–≤–∞ 9 ‚Üí](../chapter-09-production-deployment/README.md)
